<!DOCTYPE html>
<html lang="ro">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-B6DWPJ4T2C"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-B6DWPJ4T2C');
  </script>
  
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Community Wall â€” KSDAPromovari</title>
  <link rel="icon" type="image/png" href="https://iili.io/fXks1Dv.png">  
  <!-- Fonts & Icons -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;700;800;900&family=Poppins:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <style>
    /* --- VARIABLES & THEME --- */
    :root {
      --bg-dark: #050b14;
      --primary: #29f3ff;
      --primary-dim: rgba(41, 243, 255, 0.15);
      --glass-bg: rgba(13, 25, 41, 0.85);
      --glass-border: rgba(255, 255, 255, 0.08);
      --text-main: #ffffff;
      --text-muted: #a5b1c2;
      --discord-color: #5865F2;
      
      /* COLORS FOR ROLES */
      --admin-red-deep: #8b0000;
      --admin-red-bright: #ff4757;
      --owner-cyan: #00e5ff;
      --owner-blue: #0044ff;

      /* POP-UP SPECIFIC COLORS (Image Match) */
      --popup-bg: #0b111a;
      --popup-border: #ffd700;
      --popup-btn: #00f2ea;
    }

    * { box-sizing: border-box; outline: none; }
    html { scroll-behavior: smooth; }

    body {
      margin: 0;
      min-height: 100vh;
      background-color: var(--bg-dark);
      background-image: linear-gradient(to bottom, rgba(5, 11, 20, 0.85), var(--bg-dark)), url('https://i.makeagif.com/media/3-03-2021/otrneG.gif');
      background-position: center; 
      background-size: cover; 
      background-attachment: fixed;
      font-family: 'Poppins', sans-serif; 
      color: var(--text-main);
      display: flex; 
      flex-direction: column; 
      overflow-x: hidden;
    }

    /* CUSTOM SCROLLBAR */
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: var(--bg-dark); }
    ::-webkit-scrollbar-thumb { background: #1f3a52; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--primary); }

    /* FONTS */
    h1, h2, h3, .logo, .btn, .bubbleBtn, #sideMenu a, .login-btn-header, .side-menu-login-btn, .pop-user, .streak-txt, .coins-count, .timer-txt, .metallic-title { 
        font-family: 'Orbitron', sans-serif; 
    }

    /* --- ADMIN BUTTON STYLE --- */
    #adminControlPanel {
        display: none; /* Hidden by default */
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 10000;
    }
    .admin-stop-btn {
        background: #ff0000;
        color: white;
        border: 2px solid white;
        padding: 12px 20px;
        border-radius: 50px;
        font-family: 'Orbitron', sans-serif;
        font-weight: 800;
        cursor: pointer;
        box-shadow: 0 0 15px rgba(255, 0, 0, 0.6);
        transition: 0.3s;
    }
    .admin-stop-btn:hover {
        transform: scale(1.1);
        background: #8b0000;
    }

    /* --- TOAST NOTIFICATION --- */
    .toast-notification {
        position: fixed; 
        bottom: 20px; 
        left: 50%; 
        transform: translateX(-50%) translateY(100px);
        background: rgba(255, 71, 87, 0.95); 
        color: white; 
        padding: 14px 28px;
        border-radius: 50px; 
        font-size: 14px; 
        font-weight: 600; 
        box-shadow: 0 5px 20px rgba(0,0,0,0.5);
        z-index: 15000; 
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        display: flex; 
        align-items: center; 
        gap: 10px;
        opacity: 0;
        pointer-events: none;
    }
    .toast-notification.show { 
        transform: translateX(-50%) translateY(0); 
        opacity: 1;
        pointer-events: auto;
    }
    .toast-notification.success { 
        background: rgba(41, 243, 255, 0.95); 
        color: #000; 
    }

    /* --- QUEST REWARD MODAL --- */
    .reward-modal {
        position: fixed; inset: 0; background: rgba(0,0,0,0.9);
        display: none; justify-content: center; align-items: center;
        z-index: 12000; padding: 20px; backdrop-filter: blur(8px);
    }
    .reward-modal.active { display: flex; }
    .reward-card {
        background: var(--popup-bg); border: 2px solid var(--popup-border); border-radius: 35px;
        padding: 40px 30px; text-align: center; max-width: 420px; width: 100%;
        box-shadow: 0 0 50px rgba(255, 215, 0, 0.2);
        animation: jumpIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
    }
    .reward-title { font-family: 'Orbitron'; font-size: 26px; font-weight: 800; color: #ffd700; margin-bottom: 20px; }
    .reward-text { font-family: 'Poppins'; font-size: 15px; color: #ffffff; margin-bottom: 30px; }
    .reward-amount-box { display: flex; align-items: center; justify-content: center; gap: 15px; margin-bottom: 5px; }
    .reward-coin-icon { width: 55px; height: 55px; object-fit: contain; }
    .reward-amount-txt { font-family: 'Orbitron'; font-size: 52px; font-weight: 900; color: #ffd700; }
    .reward-btn { background: var(--popup-btn); color: #000; font-family: 'Orbitron'; font-weight: 900; padding: 16px 60px; border-radius: 50px; border: none; cursor: pointer; }
    
    @keyframes jumpIn { 0% { transform: scale(0.3) translateY(100px); opacity: 0; } 100% { transform: scale(1) translateY(0); opacity: 1; } }

    /* --- ACCOUNT MODAL --- */
    .account-modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.85); display: none; justify-content: center; align-items: center; z-index: 11000; backdrop-filter: blur(10px); }
    .account-modal-overlay.active { display: flex; }
    .account-card { background: #08101b; border: 1px solid var(--primary); width: 90%; max-width: 380px; border-radius: 30px; padding: 40px 25px; text-align: center; position: relative; box-shadow: 0 0 50px rgba(41, 243, 255, 0.3); animation: jumpIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
    .close-pop { position: absolute; top: 15px; right: 20px; color: #fff; cursor: pointer; font-size: 24px; background: none; border: none; opacity: 0.5; }
    .pop-img { width: 90px; height: 90px; border-radius: 50%; border: 2px solid var(--primary); margin-bottom: 12px; }
    .pop-user { font-size: 18px; color: #fff; margin: 0; }
    .pop-mail { font-size: 12px; color: var(--text-muted); margin-bottom: 20px; }
    .streak-box { display: inline-flex; align-items: center; gap: 8px; background: rgba(255, 69, 0, 0.1); border-radius: 50px; padding: 6px 16px; margin-bottom: 15px; border: 1px solid rgba(255, 69, 0, 0.2); }
    .streak-txt { font-weight: 800; color: #ff4500; font-size: 13px; }
    .coins-section { display: flex; flex-direction: column; align-items: center; gap: 5px; margin-bottom: 25px; background: rgba(255, 255, 255, 0.03); padding: 12px; border-radius: 20px; border: 1px solid var(--glass-border); }
    .coins-count { font-size: 20px; font-weight: 900; color: #fff; }
    .btn-tasks { background: rgba(41, 243, 255, 0.05); border: 1px solid var(--primary); color: var(--primary); padding: 16px; border-radius: 18px; text-decoration: none; display: flex; flex-direction: column; align-items: center; gap: 5px; transition: 0.3s; margin-bottom: 15px; }
    .btn-logout-pop { background: transparent; border: 1.5px solid #ff4757; color: #ff4757; padding: 10px 25px; border-radius: 12px; font-family: 'Orbitron'; font-weight: 700; cursor: pointer; }

    /* --- HEADER --- */
    .header-container { position: fixed; top: 0; left: 0; right: 0; padding: 20px; z-index: 1000; display: flex; justify-content: center; }
    header { width: 100%; max-width: 1200px; display: flex; align-items: center; justify-content: space-between; padding: 12px 30px; background: rgba(5, 11, 20, 0.6); border: 1px solid var(--glass-border); border-radius: 100px; backdrop-filter: blur(16px); }
    .logo { font-weight: 900; font-size: 24px; letter-spacing: 1px; background: linear-gradient(90deg, #fff, var(--primary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-decoration: none; }
    nav { display: flex; gap: 32px; align-items: center; }
    nav a { color: var(--text-muted); text-decoration: none; font-size: 13px; font-weight: 600; transition: 0.3s; }
    nav a:hover { color: var(--primary); }
    .login-btn-header { background: transparent; border: 1.5px solid var(--primary); color: var(--primary); padding: 8px 20px; border-radius: 20px; font-size: 12px; font-weight: 700; cursor: pointer; display: flex; align-items: center; gap: 8px; }
    .user-avatar-small { width: 24px; height: 24px; border-radius: 50%; border: 1px solid #fff; display: none; object-fit: cover; }
    .hamburger { display: none; background: none; border: none; color: #fff; font-size: 26px; cursor: pointer; }

    /* --- SIDE MENU --- */
    #sideMenu { position: fixed; inset: 0; left: auto; width: 320px; background: #080f1a; border-left: 1px solid rgba(255,255,255,0.05); z-index: 2000; padding: 40px 30px; transform: translateX(100%); transition: transform 0.4s cubic-bezier(0.77, 0, 0.175, 1); display: flex; flex-direction: column; }
    #sideMenu.open { transform: translateX(0); }
    .menu-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
    .closeBtn { font-size: 40px; background: none; border: none; color: #fff; cursor: pointer; transition: 0.3s; }
    .side-menu-login-btn { background: rgba(41, 243, 255, 0.1); border: 1px solid var(--primary); color: var(--primary); width: 100%; padding: 15px; margin-top: 20px; border-radius: 12px; font-size: 16px; font-weight: 700; cursor: pointer; display: flex; justify-content: center; align-items: center; gap: 10px; }
    
    /* --- WALL LAYOUT --- */
    .wall-container { margin-top: 140px; width: 100%; max-width: 900px; margin-left: auto; margin-right: auto; padding: 0 20px 80px; display: flex; flex-direction: column; align-items: center; flex: 1; }
    .metallic-title { font-size: clamp(32px, 5vw, 56px); background: linear-gradient(180deg, #ffffff 0%, #a2cfff 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-align: center; margin-bottom: 10px; text-transform: uppercase; font-weight: 800; }
    .wall-desc { text-align: center; color: var(--text-muted); font-size: 16px; margin-bottom: 40px; max-width: 600px; }
    .wall-card { width: 100%; background: var(--glass-bg); border: 1px solid var(--primary); border-radius: 24px; display: flex; flex-direction: column; overflow: hidden; height: 70vh; max-height: 800px; }

    .locked-view, .banned-view { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 40px; color: #fff; }
    .locked-view { display: flex; } /* Initial state */
    .banned-view { display: none; background: rgba(20, 0, 0, 0.8); }
    .google-btn { background: #fff; color: #000; font-weight: 700; padding: 12px 30px; border-radius: 50px; border: none; cursor: pointer; display: flex; align-items: center; gap: 10px; margin-top: 20px; }

    .chat-view { display: none; flex-direction: column; height: 100%; }
    .chat-header { padding: 15px 20px; background: rgba(0,0,0,0.4); border-bottom: 1px solid var(--glass-border); display: flex; justify-content: space-between; align-items: center; }
    .user-profile { display: flex; align-items: center; gap: 10px; }
    .user-pfp { width: 35px; height: 35px; border-radius: 50%; border: 2px solid var(--primary); object-fit: cover; }
    .logout-btn { color: #ff4757; background: none; border: none; cursor: pointer; font-size: 12px; text-decoration: underline; }

    .messages-feed { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; }
    .msg-wrapper { display: flex; flex-direction: column; max-width: 80%; position: relative; }
    .msg-wrapper.mine { align-self: flex-end; align-items: flex-end; }
    .msg-wrapper.theirs { align-self: flex-start; align-items: flex-start; }
    .msg-bubble { padding: 12px 16px; border-radius: 18px; position: relative; font-size: 14px; line-height: 1.5; word-wrap: break-word; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }

    .msg-bubble.admin-msg { background: linear-gradient(135deg, #b20a2c 0%, #ff4d4d 100%) !important; border: 2px solid #ffffff !important; color: #ffffff !important; }
    .msg-bubble.owner-msg { background: linear-gradient(135deg, #0044ff 0%, #29f3ff 100%) !important; border: 2px solid #fff !important; color: #fff !important; }
    .admin-badge { display: inline-block; background: #ffffff; color: #b20a2c; font-size: 9px; padding: 2px 6px; border-radius: 4px; margin-left: 6px; font-weight: 800; }
    .owner-badge { display: inline-block; background: linear-gradient(90deg, #29f3ff, #0044ff); color: #000; font-size: 9px; padding: 2px 6px; border-radius: 4px; margin-left: 6px; font-weight: 900; }
    .msg-bubble.bot-msg { background: linear-gradient(135deg, #00ff87 0%, #00d0ff 100%) !important; color: #000 !important; font-weight: 600; border: none !important; }

    .quoted-msg { background: rgba(0, 0, 0, 0.2); border-left: 3px solid rgba(255, 255, 255, 0.3); padding: 8px 10px; border-radius: 6px; font-size: 11px; margin-bottom: 8px; color: rgba(255, 255, 255, 0.7); display: block; }

    .msg-wrapper.mine .msg-bubble { background: var(--primary); color: #000; border-bottom-right-radius: 2px; }
    .msg-wrapper.theirs .msg-bubble { background: rgba(255,255,255,0.1); color: #fff; border-bottom-left-radius: 2px; }
    .msg-info { font-size: 10px; margin-top: 4px; opacity: 0.7; display: flex; gap: 10px; align-items: center; }

    .msg-reactions { display: flex; gap: 4px; margin-top: 4px; }
    .reaction-badge { background: rgba(0,0,0,0.4); border: 1px solid var(--glass-border); border-radius: 10px; padding: 2px 6px; font-size: 10px; color: #fff; cursor: pointer; }
    
    .msg-options { position: absolute; top: 0; right: -25px; cursor: pointer; padding: 5px; color: var(--text-muted); opacity: 0; transition: 0.2s; }
    .msg-wrapper.mine .msg-options { left: -25px; right: auto; }
    .msg-wrapper:hover .msg-options { opacity: 1; }
    .options-dropdown { display: none; position: absolute; top: 20px; z-index: 20; background: #08101b; border: 1px solid var(--glass-border); border-radius: 8px; overflow: hidden; width: 140px; }
    .show-menu { display: block !important; }
    .options-dropdown button { width: 100%; text-align: left; background: none; border: none; padding: 10px 12px; color: #fff; font-size: 11px; cursor: pointer; border-bottom: 1px solid rgba(255,255,255,0.05); }

    .input-area-wrapper { background: rgba(0,0,0,0.6); border-top: 1px solid var(--glass-border); backdrop-filter: blur(10px); }
    .input-area { padding: 10px; display: flex; gap: 10px; flex-direction: column; }
    .input-row { display: flex; gap: 8px; align-items: center; }
    .chat-input { flex: 1; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 25px; padding: 10px 15px; color: #fff; }
    .send-btn { width: 45px; height: 45px; border-radius: 50%; border: none; background: var(--primary); color: #000; cursor: pointer; display: flex; align-items: center; justify-content: center; }
    
    .typing-indicator { font-size: 11px; color: var(--text-muted); padding: 4px 20px; font-style: italic; height: 24px; display: flex; align-items: center; }
    .reply-preview-bar { background: rgba(41, 243, 255, 0.1); border-top: 1px solid var(--primary); padding: 10px 20px; display: none; justify-content: space-between; align-items: center; font-size: 12px; color: var(--primary); }
    
    #muteBanner { display: none; background: rgba(40, 0, 0, 0.95); color: #fff; padding: 20px; text-align: center; border-top: 2px solid #ff4757; }

    footer { background: #02050a; border-top: 1px solid var(--glass-border); padding: 60px 20px 30px; text-align: center; margin-top: auto; }
    .footer-links { display: flex; justify-content: center; gap: 30px; margin: 30px 0; flex-wrap: wrap; }
    .footer-links a { color: var(--text-muted); text-decoration: none; font-size: 15px; transition: 0.2s; }
    .footer-links a:hover { color: var(--primary); }

    @media (max-width: 768px) { 
        nav { display: none; } 
        .hamburger { display: block; } 
        .wall-card { height: 80vh; }
        .msg-options { opacity: 1; }
    }
  </style>
</head>
<body>

  <!-- ADMIN CONTROL PANEL (ONLY VISIBLE TO SPECIFIC IP) -->
  <div id="adminControlPanel">
      <button id="adminStopResetBtn" class="admin-stop-btn">
          <i class="fas fa-hand-paper"></i> STOP RESET
      </button>
  </div>

  <div id="toast" class="toast-notification"><i class="fas fa-exclamation-circle"></i> <span id="toastMsg">Error</span></div>
  
  <div id="rewardModal" class="reward-modal">
    <div class="reward-card">
        <div class="reward-title"><span>ðŸŽ‰</span> QUEST COMPLETAT!</div>
        <p id="rewardText" class="reward-text">Ai Ã®ndeplinit o misiune!</p>
        <div class="reward-amount-box"><img src="https://iili.io/fhc1SKQ.png" class="reward-coin-icon"><span class="reward-amount-txt" id="rewardAmount">0</span></div>
        <div style="color:#ffd700; font-size:14px; margin-bottom:35px; font-family:'Orbitron'; font-weight:700;">KSDA COINS</div>
        <button class="reward-btn" onclick="document.getElementById('rewardModal').classList.remove('active')">Super!</button>
    </div>
  </div>

<div id="accountModal" class="account-modal-overlay">
    <div class="account-card">
        <button id="closeAccountPop" class="close-pop">âœ•</button>
        <img id="popUserImg" src="" class="pop-img">
        <h3 id="popUserName" class="pop-user">Utilizator</h3>
        <p id="popUserEmail" class="pop-mail">email@exemplu.com</p>
        <div class="streak-box"><i class="fas fa-fire"></i><span class="streak-txt">Daily Streak: 0</span></div>
        <div class="coins-section">
            <span style="font-size:10px; color:var(--primary); font-family:'Orbitron';">Puncte KSDA</span>
            <div style="display:flex; gap:10px; align-items:center;"><img src="https://iili.io/fhc1SKQ.png" style="width:30px;"><span id="popUserCoins" class="coins-count">0</span></div>
        </div>
        <div style="margin-top:20px;">
            <a href="DailyTasks.html" class="btn-tasks"><span style="font-family:'Orbitron'; font-weight:800;">DAILY TASKS</span><span style="font-size:10px;">CÃ¢È™tigÄƒ puncte</span></a>
            <button id="popLogoutBtn" class="btn-logout-pop">Log Out</button>
        </div>
    </div>
</div>

<div id="reactionModal" class="account-modal-overlay">
    <div class="account-card" style="max-width:320px; padding:25px;">
        <button onclick="window.closeReactionModal()" class="close-pop">âœ•</button>
        <h3 id="reactModalTitle" style="font-family:'Orbitron'; margin-bottom:20px;">ReacÈ›ii</h3>
        <div id="reactList" style="text-align:left; overflow-y:auto; max-height:350px;"></div>
    </div>
</div>

  <div class="header-container">
    <header>
      <a href="index.html" class="logo"><img src="https://iili.io/fXvBEiB.png" style="height:40px;"></a>
      <nav>
        <a href="index.html">AcasÄƒ</a>
        <a href="index.html#services">Servicii</a>
        <a href="wall.html" style="color: var(--primary);">Wall</a>
        <a href="help.html">SusÈ›ine-ne</a>
        <button id="headerLoginBtn" class="login-btn-header"><img id="headerUserImg" src="" class="user-avatar-small"><span id="headerLoginText">LOGIN</span></button>
      </nav>
      <button id="menuBtn" class="hamburger">â˜°</button>
    </header>
  </div>

  <aside id="sideMenu">
    <div class="menu-header"><div class="logo"><img src="https://iili.io/fXvBEiB.png" style="height:50px;"></div><button id="closeMenu" class="closeBtn">âœ•</button></div>
    <div style="width:100%; height:1px; background:rgba(255,255,255,0.1); margin-bottom:30px;"></div>
    <div style="display:flex; flex-direction:column; gap:30px;">
      <a href="index.html" style="color:#fff; text-decoration:none; font-size:24px; font-weight:700;">AcasÄƒ</a>
      <a href="wall.html" style="color:var(--primary); text-decoration:none; font-size:24px; font-weight:700;">Wall</a>
      <a href="despre_noi.html" style="color:#fff; text-decoration:none; font-size:24px; font-weight:700;">Despre Noi</a>
      <button id="mobileLoginBtn" class="side-menu-login-btn"><i class="fas fa-sign-in-alt"></i> Autentificare</button>
    </div>
  </aside>

  <div class="wall-container">
    <h1 class="metallic-title">Community Wall</h1>
    <p class="wall-desc">ConecteazÄƒ-te cu familia KSDA. DiscutÄƒ liber, Ã®mpÄƒrtÄƒÈ™eÈ™te idei È™i fii parte din miÈ™care.</p>

    <div class="wall-card">
        <div id="lockedView" class="locked-view">
            <i class="fas fa-lock" style="font-size:60px; color:var(--primary); margin-bottom:20px;"></i>
            <h2>Acces Membri</h2>
            <p style="opacity:0.7;">AutentificÄƒ-te pentru a vedea chat-ul.</p>
            <button id="loginBtn" class="google-btn"><img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="20"> LogheazÄƒ-te cu Google</button>
        </div>

        <div id="bannedView" class="banned-view">
            <i class="fas fa-ban" style="font-size:70px; color:#ff4757; margin-bottom:20px;"></i>
            <div style="font-size:28px; font-weight:800; color:#ff4757;">Acces Interzis</div>
            <p>EÈ™ti banat pe acest server.</p>
            <p style="font-size:12px; color:#888;">ID: <span id="banIpDisplay">...</span></p>
        </div>

        <div id="chatView" class="chat-view">
            <div class="chat-header">
                <div class="user-profile">
                    <img id="userAvatar" src="" class="user-pfp">
                    <div><span style="font-size:10px; color:var(--primary); display:block;">Autentificat</span><div id="userName" style="font-weight:700;"></div></div>
                </div>
                <button id="logoutBtn" class="logout-btn">Deconectare</button>
            </div>

            <div id="messagesFeed" class="messages-feed"></div>

            <div class="input-area-wrapper">
                <div id="typingIndicator" class="typing-indicator"></div>
                <div id="muteBanner"><span id="muteReasonDisplay"></span><span id="muteTimer" style="display:block; font-size:20px; margin-top:5px; font-family:'Orbitron';"></span></div>
                
                <div id="inputControls">
                    <div id="replyBar" class="reply-preview-bar"><div>RÄƒspuns cÄƒtre <strong id="replyToUser">User</strong></div><button id="cancelReply" style="background:none; border:none; color:#ff4757; cursor:pointer;">&times;</button></div>
                    <div class="input-area">
                        <div class="input-row">
                            <input type="text" id="msgInput" class="chat-input" placeholder="Scrie un mesaj..." maxlength="1000">
                            <button id="sendBtn" class="send-btn"><i class="fas fa-paper-plane"></i></button>
                        </div>
                        <div id="charCount" style="font-size:10px; color:gray; text-align:right;">0 / 1000</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
  </div>

  <footer>
    <div style="font-size:24px; font-weight:900; margin-bottom:10px;">KSDA</div>
    <div class="footer-links">
        <a href="index.html">AcasÄƒ</a>
        <a href="contact.html">Contact</a>
        <a href="help.html">SusÈ›ine-ne</a>
    </div>
    <p style="color:#556; font-size:13px;">&copy; 2024 KSDAPromovari.</p>
  </footer>

  <script>
    const menuBtn = document.getElementById('menuBtn');
    const sideMenu = document.getElementById('sideMenu');
    const closeMenu = document.getElementById('closeMenu');
    menuBtn.addEventListener('click', () => sideMenu.classList.add('open'));
    closeMenu.addEventListener('click', () => sideMenu.classList.remove('open'));
  </script>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged, setPersistence, browserLocalPersistence } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
    import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp, doc, updateDoc, getDoc, setDoc, deleteDoc, getDocs, limit, writeBatch, increment } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDoH80kffNrzFAcyRqsTVdifs-whUhwH9A",
      authDomain: "ksda-7546f.firebaseapp.com",
      projectId: "ksda-7546f",
      storageBucket: "ksda-7546f.firebasestorage.app",
      messagingSenderId: "306437513808",
      appId: "1:306437513808:web:28479810e3fdf71b32e755"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const provider = new GoogleAuthProvider();

    setPersistence(auth, browserLocalPersistence).catch(console.error);

    const lockedView = document.getElementById('lockedView');
    const chatView = document.getElementById('chatView');
    const bannedView = document.getElementById('bannedView');
    const loginBtn = document.getElementById('loginBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const muteBanner = document.getElementById('muteBanner');
    const inputControls = document.getElementById('inputControls');
    const accountModal = document.getElementById('accountModal');
    
    // ADMIN UI
    const adminControlPanel = document.getElementById('adminControlPanel');
    const adminStopResetBtn = document.getElementById('adminStopResetBtn');

    let currentUid = null;
    let userIP = null;
    let replyData = null;
    let isAdmin = false; 
    let isOwner = false; 
    let isSending = false;
    let muteInterval = null;
    let wipeCheckInterval = null;
    let typingTimeout = null;
    const localProcessedQuests = new Set();

    // FETCH IP
    async function fetchIP() {
        try {
            const res = await fetch('https://api.ipify.org?format=json');
            const data = await res.json();
            userIP = data.ip;
        } catch (e) { console.error("No IP", e); userIP = "unknown"; }
    }
    fetchIP();

    function showToast(msg, type='error') {
        const t = document.getElementById('toast');
        document.getElementById('toastMsg').innerText = msg;
        t.className = `toast-notification ${type === 'success' ? 'success' : ''} show`;
        setTimeout(() => t.classList.remove('show'), 3000);
    }

    async function handleLoginFlow() {
        try { await signInWithPopup(auth, provider); } catch(e) { console.error(e); }
    }

    if(loginBtn) loginBtn.addEventListener('click', handleLoginFlow);
    if(logoutBtn) logoutBtn.addEventListener('click', () => { if(confirm("Deconectare?")) signOut(auth); });
    
    document.getElementById('headerLoginBtn').onclick = () => { if (!auth.currentUser) handleLoginFlow(); else accountModal.classList.add('active'); };
    document.getElementById('mobileLoginBtn').onclick = () => { if (!auth.currentUser) handleLoginFlow(); else { sideMenu.classList.remove('open'); accountModal.classList.add('active'); } };
    document.getElementById('closeAccountPop').onclick = () => accountModal.classList.remove('active');
    document.getElementById('popLogoutBtn').onclick = () => signOut(auth);

    // AUTH STATE
    onAuthStateChanged(auth, async (user) => {
        if(user) {
            currentUid = user.uid;
            
            // --- 1. IP ADMIN CHECK & OWNER CHECK ---
            if (userIP === '86.120.48.10' || user.email === 'nicaemmanuel433qe@gmail.com') {
                isAdmin = true;
                isOwner = true;
                adminControlPanel.style.display = 'block'; // SHOW THE STOP RESET BUTTON
            } else {
                // Check Firestore for other admins
                const adminSnap = await getDoc(doc(db, "admin_ips", userIP || "x"));
                if (adminSnap.exists()) isAdmin = true;
            }

            // BANNED CHECK
            if(userIP) {
                const banSnap = await getDoc(doc(db, "banned_ips", userIP));
                if(banSnap.exists()) {
                    lockedView.style.display = 'none'; chatView.style.display = 'none'; bannedView.style.display = 'flex';
                    document.getElementById('banIpDisplay').textContent = userIP;
                    return; 
                }
            }
            
            // SETUP UI
            lockedView.style.display = 'none'; chatView.style.display = 'flex'; bannedView.style.display = 'none';
            document.getElementById('headerLoginText').innerText = "ACCOUNT";
            document.getElementById('headerUserImg').src = user.photoURL;
            document.getElementById('headerUserImg').style.display = "block";
            document.getElementById('userAvatar').src = user.photoURL;
            
            // USERNAME DISPLAY
            let dName = user.displayName;
            if(isOwner) dName = `Lost Soul <span class="owner-badge">OWNER</span>`;
            else if(isAdmin) dName += ` <span class="admin-badge">ADMIN</span>`;
            document.getElementById('userName').innerHTML = dName;
            
            // FIRESTORE SYNC
            const userRef = doc(db, "accounts", user.uid);
            updateDoc(userRef, { ip: userIP || "unknown", image: user.photoURL }).catch(() => {
                 setDoc(userRef, { uid: user.uid, username: user.displayName, email: user.email, image: user.photoURL, coins: 250, streak: 0, ip: userIP || "unknown", joinedAt: new Date() });
            });

            // QUESTS LISTENER
            onSnapshot(userRef, (docSnap) => {
                if(docSnap.exists()) {
                    const data = docSnap.data();
                    document.getElementById('popUserImg').src = data.image;
                    document.getElementById('popUserName').innerText = data.username;
                    document.getElementById('popUserEmail').innerText = data.email;
                    document.getElementById('popUserCoins').innerText = data.coins || 0;
                    document.querySelector('.streak-txt').innerText = `Streak: ${data.streak || 0}`;

                    // QUEST: MSG3
                    if(data.messagesSentToday >= 3 && !data.completedQuests?.includes('msg3') && !localProcessedQuests.has('msg3')) {
                        localProcessedQuests.add('msg3');
                        updateDoc(userRef, { coins: increment(250), completedQuests: [...(data.completedQuests||[]), 'msg3'] }).then(() => showRewardModal("250"));
                    }
                }
            });

            loadMessages();
            startWipeCheck(); 
            checkMuteStatus(); 

        } else {
            // LOGGED OUT
            currentUid = null; isAdmin = false; isOwner = false;
            adminControlPanel.style.display = 'none';
            chatView.style.display = 'none'; bannedView.style.display = 'none'; lockedView.style.display = 'flex';
            document.getElementById('headerLoginText').innerText = "LOGIN";
            document.getElementById('headerUserImg').style.display = "none";
        }
    });

    // --- STOP WIPE LOGIC ---
    adminStopResetBtn.onclick = async () => {
        if(!confirm("âš ï¸ EÈ™ti sigur cÄƒ vrei sÄƒ OPREÈ˜TI resetarea chat-ului? \n(Asta va amÃ¢na È™tergerea cu 24 de ore).")) return;
        
        try {
            const timerDocRef = doc(db, "sys_config", "timer");
            // Add 24 hours to the current time, pushing the reset away
            const nextDay = Date.now() + (24 * 60 * 60 * 1000);
            await updateDoc(timerDocRef, { nextWipe: nextDay });
            
            showToast("âœ… RESETARE OPRITÄ‚/AMÃ‚NATÄ‚!", "success");
            // Send bot confirmation
            await addDoc(collection(db, "wall_messages"), {
                text: "â›” ADMIN ALERT: Resetarea automatÄƒ a chat-ului a fost amÃ¢natÄƒ manual de Lost Soul.",
                uid: 'kevin-bot', name: 'Kevin-Bot', isBot: true, createdAt: serverTimestamp()
            });

        } catch(e) {
            console.error(e);
            showToast("Eroare la oprirea resetÄƒrii: " + e.message);
        }
    };

    function showRewardModal(coins) {
        document.getElementById('rewardAmount').innerText = coins;
        document.getElementById('rewardModal').classList.add('active');
    }

    function checkMuteStatus() {
        if(!currentUid) return;
        onSnapshot(doc(db, "muted_users", currentUid), (snap) => {
            if(snap.exists()) {
                const data = snap.data();
                if(data.unmuteAt && Date.now() > data.unmuteAt) { deleteDoc(doc(db,"muted_users",currentUid)); return; }
                inputControls.style.display = 'none'; muteBanner.style.display = 'block';
                document.getElementById('muteReasonDisplay').innerText = `Muted: ${data.reason}`;
            } else {
                inputControls.style.display = 'block'; muteBanner.style.display = 'none';
            }
        });
    }

    const msgInput = document.getElementById('msgInput');
    const sendBtn = document.getElementById('sendBtn');

    msgInput.addEventListener('keypress', (e) => { if(e.key === 'Enter') sendMessage(); });
    sendBtn.addEventListener('click', sendMessage);

    async function sendMessage() {
        if(isSending) return;
        const text = msgInput.value.trim();
        if(!text || !auth.currentUser) return;

        // MUTE COMMAND
        if(text.startsWith('/mute ') && isOwner) {
            const parts = text.split(' ');
            if(parts.length < 2) return;
            showToast("ComandÄƒ mute incompletÄƒ.", "error");
            return; 
            // Note: Full mute logic requires user ID targeting which is tricky via command line only 
            // without context, usually handled via UI clicks in this setup.
        }

        isSending = true;
        try {
            await addDoc(collection(db, "wall_messages"), {
                text: text, uid: currentUid, name: isOwner ? "Lost Soul" : auth.currentUser.displayName,
                photo: auth.currentUser.photoURL, ip: userIP, isAdmin: isAdmin, isOwner: isOwner,
                createdAt: serverTimestamp(), isDeleted: false, reactions: {}
            });
            await updateDoc(doc(db,"accounts",currentUid), { messagesSentToday: increment(1) });
            msgInput.value = '';
        } catch(e) { console.error(e); } finally { isSending = false; }
    }

    // WIPE LOGIC
    function startWipeCheck() {
        if(wipeCheckInterval) clearInterval(wipeCheckInterval);
        wipeCheckInterval = setInterval(async () => {
            const timerDocRef = doc(db, "sys_config", "timer");
            const timerSnap = await getDoc(timerDocRef);
            const now = Date.now();
            const twelveHours = 12 * 60 * 60 * 1000;

            if(!timerSnap.exists()) {
                await setDoc(timerDocRef, { nextWipe: now + twelveHours });
            } else {
                const nextWipe = timerSnap.data().nextWipe;
                if(now >= nextWipe) {
                    await updateDoc(timerDocRef, { nextWipe: now + twelveHours });
                    wipeAllMessages();
                }
            }
        }, 10000); // Check every 10s
    }

    async function wipeAllMessages() {
        const q = query(collection(db, "wall_messages"), limit(100));
        const snap = await getDocs(q);
        const batch = writeBatch(db);
        snap.forEach(d => batch.delete(d.ref));
        await batch.commit();
        if(snap.size > 0) wipeAllMessages(); // Loop if more exist
        else addDoc(collection(db, "wall_messages"), { text: "âœ… Chat Resetat Automat.", uid:'kevin-bot', name:'Kevin-Bot', isBot:true, createdAt:serverTimestamp() });
    }

    // CHAT LOAD
    function loadMessages() {
        const q = query(collection(db, "wall_messages"), orderBy("createdAt", "desc"), limit(50));
        onSnapshot(q, (snap) => {
            const feed = document.getElementById('messagesFeed');
            const wasAtBottom = (feed.scrollHeight - feed.scrollTop <= feed.clientHeight + 100);
            feed.innerHTML = '';
            const docs = [];
            snap.forEach(d => docs.push({id:d.id, ...d.data()}));
            docs.reverse().forEach(data => {
                if(data.isDeleted) return;
                const isMine = data.uid === currentUid;
                const div = document.createElement('div');
                div.className = `msg-wrapper ${isMine ? 'mine' : 'theirs'}`;
                
                let content = `<div class="msg-bubble ${data.isOwner?'owner-msg':(data.isAdmin?'admin-msg':'')} ${data.isBot?'bot-msg':''}">${data.text}</div>`;
                if(!isMine) content = `<div style="font-size:11px; margin-bottom:2px; font-weight:700; color:#aaa;">${data.name}</div>` + content;
                
                // DELETE BUTTON (Owner/Admin/Self)
                if(isOwner || (isAdmin && !data.isOwner) || isMine) {
                    content += `<div class="msg-options" onclick="if(confirm('È˜tergi?')) deleteMsg('${data.id}')"><i class="fas fa-trash"></i></div>`;
                }

                div.innerHTML = content;
                feed.appendChild(div);
            });
            if(wasAtBottom) feed.scrollTop = feed.scrollHeight;
        });
    }

    window.deleteMsg = async (id) => {
        await updateDoc(doc(db, "wall_messages", id), { isDeleted: true });
    }
  </script>
</body>
</html>
