<!DOCTYPE html>
<html lang="ro">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-B6DWPJ4T2C"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-B6DWPJ4T2C');
  </script>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Minigame ‚Äî KSDAPromovari</title>
  <meta name="description" content="JoacƒÉ Trivia »ôi c√¢»ôtigƒÉ monede KSDA!">
  <link rel="icon" type="image/png" href="https://iili.io/fXks1Dv.png">

  <!-- Fonts: Orbitron (UI/Gaming) & Poppins (Text) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;700;800;900&family=Poppins:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <style>
    /* --- EXACT VARIABLES & THEME FROM INDEX --- */
    :root {
      --bg-dark: #050b14;
      --primary: #29f3ff;
      --primary-dim: rgba(41, 243, 255, 0.15);
      --secondary: #7000ff;
      --text-main: #ffffff;
      --text-muted: #a5b1c2;
      --glass-bg: rgba(13, 25, 41, 0.7);
      --glass-border: rgba(255, 255, 255, 0.08);
      --glow-shadow: 0 0 20px rgba(41, 243, 255, 0.3);
      --card-radius: 24px;
      --transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      --discord-color: #5865F2;
      --gold: #ffd700;
      --error: #ff4757;
    }

    * { box-sizing: border-box; outline: none; }
    html { scroll-behavior: smooth; }

    body {
      margin: 0;
      min-height: 100vh;
      background-color: var(--bg-dark);
      background-image: 
        linear-gradient(to bottom, rgba(5, 11, 20, 0.85), var(--bg-dark)),
        url('https://i.makeagif.com/media/3-03-2021/otrneG.gif');
      background-position: center;
      background-size: cover;
      background-attachment: fixed;
      font-family: 'Poppins', sans-serif;
      color: var(--text-main);
      overflow-x: hidden;
    }

    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: var(--bg-dark); }
    ::-webkit-scrollbar-thumb { background: #1f3a52; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--primary); }

    /* ORBITRON pe toate elementele UI */
    h1, h2, h3, .logo, .stat-number, .btn, .bubbleBtn, #sideMenu a, .metallic-title-big, .login-btn-header, .side-menu-login-btn, .pop-user, .streak-txt, .coins-count, .btn-tasks { 
        font-family: 'Orbitron', sans-serif; 
    }

    /* --- GAME SPECIFIC STYLES (ADDED) --- */
    .game-section-wrapper {
        padding-top: 130px;
        padding-bottom: 60px;
        min-height: 90vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 100%;
    }

    .game-container {
        width: 100%;
        max-width: 800px;
        background: rgba(8, 16, 27, 0.95);
        border: 1px solid var(--glass-border);
        border-radius: 20px;
        box-shadow: 0 0 40px rgba(0,0,0,0.6);
        overflow: hidden;
        display: flex;
        flex-direction: column;
        min-height: 500px;
    }

    /* THE HEADER THAT LOOKS LIKE A BANNER */
    .game-header-banner {
        padding: 15px 25px;
        display: flex;
        align-items: center;
        gap: 15px;
        border-bottom: 1px solid rgba(255,255,255,0.1);
        background: #0f1926; /* Default dark */
        transition: all 0.3s ease;
    }
    
    /* PFP in Game Header */
    .gh-pfp-wrapper { position: relative; width: 50px; height: 50px; }
    .gh-pfp-img { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; border: 2px solid #fff; }
    .gh-frame-overlay { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 145%; height: 145%; pointer-events: none; }

    .gh-info { display: flex; flex-direction: column; }
    .gh-name { font-weight: 700; font-size: 16px; color: #fff; text-shadow: 0 1px 2px rgba(0,0,0,0.8); }
    .gh-badge { font-size: 10px; background: rgba(0,0,0,0.6); padding: 2px 8px; border-radius: 6px; margin-top: 2px; display: inline-block; color: #fff; border: 1px solid rgba(255,255,255,0.2); }

    /* CONTENT AREA */
    .game-content { flex: 1; padding: 30px; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
    
    .view-box { display: none; width: 100%; flex-direction: column; align-items: center; animation: fadeIn 0.4s ease; }
    .view-box.active { display: flex; }
    @keyframes fadeIn { from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);} }

    /* MODE CARDS */
    .mode-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; width: 100%; max-width: 600px; }
    .mode-card {
        background: rgba(255,255,255,0.03); border: 1px solid var(--glass-border);
        padding: 30px; border-radius: 15px; cursor: pointer; transition: 0.3s;
        display: flex; flex-direction: column; align-items: center;
    }
    .mode-card:hover { background: rgba(41, 243, 255, 0.1); border-color: var(--primary); }
    .mode-card.locked { opacity: 0.5; cursor: not-allowed; }

    /* CATEGORY BUTTONS */
    .cat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 100%; max-width: 600px; }
    .cat-btn {
        background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border);
        color: #fff; padding: 20px; border-radius: 12px; font-family: 'Orbitron';
        cursor: pointer; transition: 0.3s; font-size: 14px;
    }
    .cat-btn:hover { background: var(--primary); color: #000; }

    /* GAMEPLAY */
    .timer-container { width: 100%; height: 6px; background: #222; border-radius: 3px; margin-bottom: 20px; overflow: hidden; }
    .timer-fill { height: 100%; background: var(--primary); width: 100%; transition: width 1s linear; }
    
    .question-display { 
        background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); 
        padding: 20px; border-radius: 15px; width: 100%; margin-bottom: 20px;
        min-height: 120px; display: flex; flex-direction: column; align-items: center; justify-content: center;
    }
    .q-text { font-size: 18px; font-weight: 600; line-height: 1.5; }
    .q-img { max-width: 100%; max-height: 250px; margin-top: 15px; border-radius: 10px; border: 1px solid var(--primary); }

    .answers-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 100%; }
    .ans-btn {
        background: transparent; border: 1px solid rgba(255,255,255,0.2); color: #ddd;
        padding: 15px; border-radius: 10px; cursor: pointer; text-align: left; font-family: 'Poppins';
        transition: 0.2s; display: flex; align-items: center; gap: 10px;
    }
    .ans-btn:hover:not(:disabled) { border-color: var(--primary); background: rgba(41, 243, 255, 0.05); color: #fff; }
    .ans-correct { background: rgba(46, 204, 113, 0.3) !important; border-color: #2ecc71 !important; color: #fff !important; }
    .ans-wrong { background: rgba(255, 71, 87, 0.3) !important; border-color: #ff4757 !important; color: #fff !important; }

    /* STATS */
    .stats-pfp { width: 80px; height: 80px; border-radius: 50%; border: 3px solid var(--gold); margin-bottom: 10px; }
    .stats-val { font-size: 24px; font-weight: 900; color: #fff; }
    .stats-label { font-size: 10px; color: #aaa; text-transform: uppercase; }

    /* --- PASTE EXACT CSS FROM INDEX BELOW --- */
    
    /* [YOUR ORIGINAL CSS] */
    
    /* --- COOKIE POPUP STYLES --- */
    .cookie-wrapper {
        position: fixed; bottom: 20px; right: 20px; left: 20px;
        background: rgba(8, 16, 27, 0.95);
        border: 1px solid var(--primary);
        backdrop-filter: blur(10px);
        padding: 20px;
        border-radius: 16px;
        z-index: 9990;
        display: none;
        flex-direction: row; align-items: center; justify-content: space-between;
        gap: 20px;
        box-shadow: 0 0 25px rgba(41, 243, 255, 0.15);
        max-width: 900px;
        margin: 0 auto;
        animation: slideUp 0.5s ease-out;
    }
    /* (All other CSS from index.html is assumed present here - Banners, Modals, etc) */
    /* I am including the specific Banner/Modal/Header CSS you provided in the prompt */
    
    .account-modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.85); display: none; justify-content: center; align-items: center; z-index: 11000; backdrop-filter: blur(10px); }
    .account-modal-overlay.active { display: flex; }
    .account-card { background: #08101b; border: 1px solid var(--primary); width: 90%; max-width: 380px; border-radius: 30px; padding: 40px 25px; text-align: center; position: relative; box-shadow: 0 0 50px rgba(41, 243, 255, 0.3); }
    .close-pop { position: absolute; top: 15px; right: 20px; color: #fff; cursor: pointer; font-size: 24px; background: none; border: none; }
    .shop-modal-card { background: #08101b; border: 1px solid #d63384; width: 100%; max-width: 600px; border-radius: 30px; padding: 30px; text-align: center; position: relative; display: flex; flex-direction: column; max-height: 85vh; }
    
    /* Copying Banner Classes essential for the game header */
    .bubble-galaxy { background: linear-gradient(135deg, #1a0b2e, #5000ca); border: 1px solid rgba(255, 255, 255, 0.4); box-shadow: 0 0 15px rgba(138, 43, 226, 0.6); color: #fff; }
    .bubble-toxic { background: repeating-linear-gradient(45deg, #000, #000 10px, #1b3a08 10px, #1b3a08 20px); border: 2px solid #39ff14; color: #39ff14; }
    .bubble-fire { background: linear-gradient(to bottom, #500000, #a00000); border: 2px solid #ff4500; color: #ffd700; }
    .bubble-midas { background: radial-gradient(ellipse farthest-corner at right bottom, #FEDB37 0%, #FDB931 8%, #9f7928 30%, #8A6E2F 40%, transparent 80%), radial-gradient(ellipse farthest-corner at left top, #FFFFFF 0%, #FFFFAC 8%, #D1B464 25%, #5d4a1f 62.5%, #5d4a1f 100%); color: #4a3b0f; border: 1px solid #ffd700; }
    .bubble-void { background: #000; color: #fff; border: 1px solid #333; }
    /* ... (All other banner classes work because they are in the style tag if you copied properly, I've added key ones) ... */

    /* Header & Nav */
    .header-container { position: fixed; top: 0; left: 0; right: 0; padding: 20px; z-index: 1000; display: flex; justify-content: center; }
    header { width: 100%; max-width: 1200px; display: flex; align-items: center; justify-content: space-between; padding: 10px 30px; background: rgba(5, 11, 20, 0.6); border: 1px solid var(--glass-border); border-radius: 100px; backdrop-filter: blur(16px); }
    .login-btn-header { background: transparent; border: 1.5px solid var(--primary); color: var(--primary); padding: 8px 20px; border-radius: 20px; font-size: 12px; font-weight: 700; cursor: pointer; text-transform: uppercase; display: flex; align-items: center; gap: 8px; }
    .hamburger { display: none; background: none; border: none; color: #fff; font-size: 26px; cursor: pointer; }
    
    @media (max-width: 768px) {
      nav { display: none; }
      .hamburger { display: block; }
      .mode-grid, .cat-grid, .answers-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>

<!-- ================= MODALS (EXACTLY FROM INDEX) ================= -->

<!-- COOKIE -->
<div id="cookieConsent" class="cookie-wrapper">
    <div class="cookie-content">
        <div class="cookie-title">üç™ Cookie-uri & GDPR</div>
        <p class="cookie-text">Folosim cookie-uri.</p>
    </div>
    <button id="acceptCookiesBtn" class="cookie-btn">Sunt de acord</button>
</div>

<!-- ACCOUNT MODAL -->
<div id="accountModal" class="account-modal-overlay">
    <div class="account-card">
        <button id="closeAccountPop" class="close-pop">‚úï</button>
        <div class="profile-frame-wrapper">
            <img id="popUserImg" src="" class="pop-img-inner">
            <img id="popUserFrame" src="" class="pop-frame-overlay" style="display: none;">
        </div>
        <h3 id="popUserName" class="pop-user">Utilizator</h3>
        <p id="popUserEmail" class="pop-mail">email</p>
        
        <div class="btn-row-pop">
            <button id="openEditProfileBtn" class="btn-edit-profile"><i class="fas fa-edit"></i> EDIT</button>
            <button id="openCosmeticsBtn" class="btn-cosmetics"><i class="fas fa-palette"></i> COSMETICS</button>
        </div>

        <div class="streak-box"><i class="fas fa-fire"></i> <span class="streak-txt">Daily Streak: 0</span></div>

        <div class="coins-section">
            <span class="coins-label">Puncte KSDA</span>
            <div class="coins-display">
                <img src="https://iili.io/fhc1SKQ.png" class="coins-icon-img" alt="Coins">
                <span id="popUserCoins" class="coins-count">0</span>
            </div>
        </div>

        <div class="pop-btns">
            <button class="btn-tasks">Daily Tasks</button>
            <button id="popLogoutBtn" class="btn-logout-pop">Log Out</button>
        </div>
    </div>
</div>

<!-- GAME REWARD MODAL (Specific for Game) -->
<div id="gameRewardModal" class="account-modal-overlay">
    <div class="account-card" style="border-color: #ffd700; box-shadow: 0 0 40px rgba(255,215,0,0.2);">
        <h2 style="color:#fff; font-family:'Orbitron';">FELICITƒÇRI!</h2>
        <p style="color:#ccc; margin-bottom:15px;" id="gameRewardMsg">Ai completat testul.</p>
        
        <div class="reward-coins-box">
            <img src="https://iili.io/fhc1SKQ.png" alt="Coin" style="width: 50px;">
            <span id="gameRewardVal">0</span>
        </div>
        <p style="color:var(--gold); font-size:10px; font-weight:800; margin-bottom:20px;">KSDA COINS</p>
        
        <button class="super-btn" onclick="window.location.reload()" style="background:var(--gold); color:#000;">NOU JOC</button>
    </div>
</div>

<!-- WELCOME REWARD MODAL -->
<div id="rewardModal" class="reward-modal">
    <div class="reward-card">
        <h2>üéâ BUN VENIT!</h2>
        <p>250 KSDA monede cadou!</p>
        <button class="super-btn" onclick="document.getElementById('rewardModal').classList.remove('active')">SUPER!</button>
    </div>
</div>

<!-- COSMETICS/INVENTORY MODALS -->
<div id="cosmeticsSelectModal" class="account-modal-overlay">
    <div class="account-card" style="max-width:300px;">
        <button class="close-pop" onclick="document.getElementById('cosmeticsSelectModal').classList.remove('active')">‚úï</button>
        <h3 style="font-family:'Orbitron'; margin-bottom:20px;">ALEGE CATEGORIA</h3>
        <button class="btn-tasks" onclick="openInventory('badges')">INSIGNE</button>
        <button class="btn-tasks" onclick="openInventory('frames')">RAME</button>
        <button class="btn-tasks" onclick="openInventory('banners')">BANNERE</button>
    </div>
</div>

<div id="inventoryModal" class="account-modal-overlay">
    <div class="shop-modal-card">
        <button class="close-modal-btn" onclick="document.getElementById('inventoryModal').classList.remove('active')">‚úï</button>
        <h2 style="color: var(--primary); font-family:'Orbitron'; margin-bottom:20px;">INVENTAR</h2>
        <div id="inventoryList" class="badges-container"></div>
        <div id="inventoryActions"></div>
    </div>
</div>

<div id="editProfileModal" class="account-modal-overlay">
    <div class="account-card">
        <button id="closeEditProfile" class="close-pop">‚úï</button>
        <h3>EDITEAZƒÇ PROFIL</h3>
        <div class="edit-profile-form">
            <input type="date" id="editBirth" class="edit-input">
            <textarea id="editBio" class="edit-input" placeholder="Bio"></textarea>
            <input type="text" id="editTikTok" class="edit-input" placeholder="TikTok Link">
            <button id="saveProfileBtn" class="btn-save-profile">SALVEAZƒÇ</button>
        </div>
    </div>
</div>

<!-- ================= MAIN CONTENT ================= -->

<div id="siteContent">

    <!-- BOT -->
    <div class="bot-trigger" id="botBtn">üí¨</div>
    <div class="bot-phone-box" id="botWindow">
        <div class="bot-header">
            <div class="bot-avatar"></div>
            <div class="bot-info"><span class="bot-name">kevin-bot</span></div>
            <button class="bot-close" id="botClose">‚úï</button>
        </div>
        <div class="bot-body" id="botHistory"></div>
        <div class="bot-footer">
            <div class="bot-options" id="botOptions"><button class="bot-opt-btn" onclick="startBotConversation()">Start</button></div>
            <div class="bot-input-area" id="botInputArea">
                <input type="text" id="botUserInput"><button id="botSendBtn">></button>
            </div>
        </div>
    </div>

    <!-- HEADER -->
    <div class="header-container">
        <header>
            <a href="index.html" class="logo">
                <img src="https://iili.io/fXvBEiB.png" alt="KSDA Logo" style="height: 40px;">
            </a>
            <nav>
                <a href="index.html">AcasƒÉ</a>
                <a href="index.html#services">Servicii</a>
                <a href="joc.html" style="color:var(--primary);">Minigame</a>
                <a href="help.html">Sus»õine-ne</a>
                <button id="headerLoginBtn" class="login-btn-header">
                    <img id="headerUserImg" src="" class="user-avatar-small">
                    <span id="headerLoginText">LOGIN</span>
                </button>
            </nav>
            <button id="menuBtn" class="hamburger">‚ò∞</button>
        </header>
    </div>

    <!-- MOBILE MENU -->
    <aside id="sideMenu">
        <div class="menu-header">
            <div class="logo">KSDA</div>
            <button id="closeMenu" class="closeBtn">‚úï</button>
        </div>
        <div class="menu-links">
            <a href="index.html">AcasƒÉ</a>
            <a href="joc.html">Minigame</a>
            <button id="mobileLoginBtn" class="side-menu-login-btn">Autentificare</button>
        </div>
    </aside>

    <!-- GAME SECTION -->
    <main class="game-section-wrapper">
        <h1 class="metallic-title-big">TRIVIA KSDA</h1>
        <p style="color:var(--text-muted); text-align:center; max-width:600px; margin-bottom:30px;">
            RƒÉspunde corect la 15 √ÆntrebƒÉri »ôi c√¢»ôtigƒÉ monede pentru a-»õi personaliza profilul!
        </p>

        <div class="game-container">
            
            <!-- GAME HEADER (BANNER STYLE) -->
            <div id="gameHeader" class="game-header-banner">
                <div class="gh-pfp-wrapper">
                    <img id="gameUserImg" src="https://iili.io/fhc1SKQ.png" class="gh-pfp-img">
                    <img id="gameUserFrame" src="" class="gh-frame-overlay" style="display:none;">
                </div>
                <div class="gh-info">
                    <div id="gameUserName" class="gh-name">Vizitator</div>
                    <span id="gameUserBadge" class="gh-badge">Guest</span>
                </div>
            </div>

            <div class="game-content">
                
                <!-- VIEW 1: LOCKED -->
                <div id="viewLocked" class="view-box active">
                    <i class="fas fa-lock" style="font-size:50px; color:var(--primary); margin-bottom:20px;"></i>
                    <h2 style="font-family:'Orbitron'; margin-bottom:10px;">Acces Membri</h2>
                    <p style="color:#aaa; margin-bottom:20px;">Trebuie sƒÉ te autentifici pentru a juca.</p>
                    <button class="login-btn-header" onclick="document.getElementById('headerLoginBtn').click()">LOGHEAZƒÇ-TE CU GOOGLE</button>
                </div>

                <!-- VIEW 2: MODE SELECT -->
                <div id="viewMode" class="view-box">
                    <h2 style="font-family:'Orbitron'; margin-bottom:30px;">ALEGE MODUL</h2>
                    <div class="mode-grid">
                        <div class="mode-card" onclick="startGameFlow('single')">
                            <i class="fas fa-user" style="font-size:30px; color:var(--primary); margin-bottom:10px;"></i>
                            <h3 style="font-family:'Orbitron';">SINGLEPLAYER</h3>
                        </div>
                        <div class="mode-card locked">
                            <i class="fas fa-users" style="font-size:30px; color:#555; margin-bottom:10px;"></i>
                            <h3 style="font-family:'Orbitron'; color:#777;">MULTIPLAYER</h3>
                        </div>
                    </div>
                </div>

                <!-- VIEW 3: CATEGORY -->
                <div id="viewCategory" class="view-box">
                    <h2 style="font-family:'Orbitron'; margin-bottom:30px;">ALEGE CATEGORIA</h2>
                    <div class="cat-grid">
                        <button class="cat-btn" onclick="startQuiz('general')">CULTURƒÇ GENERALƒÇ</button>
                        <button class="cat-btn" onclick="startQuiz('science')">»òTIIN»öƒÇ</button>
                        <button class="cat-btn" onclick="startQuiz('ksda')">KSDA <i class="fas fa-star" style="color:gold;"></i></button>
                        <button class="cat-btn" onclick="startQuiz('geo')">GEOGRAFIE</button>
                    </div>
                </div>

                <!-- VIEW 4: GAMEPLAY -->
                <div id="viewGame" class="view-box">
                    <div style="width:100%; display:flex; justify-content:space-between; margin-bottom:5px; font-size:12px; color:var(--primary);">
                        <span>Timp RƒÉmas</span>
                        <span><span id="qIndex">1</span>/15</span>
                    </div>
                    <div class="timer-container"><div id="timerBar" class="timer-fill"></div></div>
                    
                    <div class="question-display">
                        <p id="qText" class="q-text">Loading...</p>
                        <div id="qImgContainer"></div>
                    </div>

                    <div id="answersGrid" class="answers-grid"></div>
                </div>

                <!-- VIEW 5: STATS -->
                <div id="viewStats" class="view-box">
                    <img id="statsPfp" src="" class="stats-pfp">
                    <h2 id="statsName" style="font-family:'Orbitron'; margin-bottom:20px;">User</h2>
                    
                    <div style="display:flex; gap:40px; margin-bottom:30px;">
                        <div style="text-align:center;">
                            <div class="stats-val" style="color:#2ecc71;" id="statsCorrect">0</div>
                            <div class="stats-label">CORECTE</div>
                        </div>
                        <div style="text-align:center;">
                            <div class="stats-val" style="color:#ff4757;" id="statsWrong">0</div>
                            <div class="stats-label">GRE»òITE</div>
                        </div>
                    </div>

                    <button id="collectRewardBtn" class="btn-tasks" style="background:var(--gold); color:#000; font-weight:800;">
                        COLLECT MY REWARD
                    </button>
                </div>

            </div>
        </div>
    </main>

    <!-- FOOTER -->
    <footer>
        <div class="footer-content">
            <p class="copyright">&copy; 2024 KSDAPromovari.</p>
        </div>
    </footer>
</div>

<!-- ================= LOGIC & FIREBASE ================= -->
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc, onSnapshot, updateDoc, increment, arrayUnion } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDoH80kffNrzFAcyRqsTVdifs-whUhwH9A",
      authDomain: "ksda-7546f.firebaseapp.com",
      projectId: "ksda-7546f",
      storageBucket: "ksda-7546f.firebasestorage.app",
      messagingSenderId: "306437513808",
      appId: "1:306437513808:web:28479810e3fdf71b32e755"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const provider = new GoogleAuthProvider();

    // --- GAME DATA ---
    const BADGES_DB = [
        { id: 'b_boss', text: 'BOSS DE BOSS', color: 'linear-gradient(45deg, #ffd700, #ffaa00)', icon: 'fa-crown' },
        { id: 'b_vip', text: 'V.I.P', color: 'linear-gradient(45deg, #ff00cc, #333399)', icon: 'fa-gem' },
        { id: 'b_happy', text: 'HAPPY', color: 'linear-gradient(45deg, #ffff00, #ffaa00)', price: 900, icon: 'fa-smile' }
    ];
    const BANNERS_DB = [
        { id: 'bub_galaxy', name: 'GALAXY', cssClass: 'bubble-galaxy' },
        { id: 'bub_toxic', name: 'TOXIC', cssClass: 'bubble-toxic' },
        { id: 'bub_fire', name: 'INFERNO', cssClass: 'bubble-fire' }
    ];
    const FRAMES_DB = [
        { id: 'fr_gold', name: 'GOLDEN GUARDIAN', img: 'https://i.ibb.co/5xBTcv2f/c2feac12-d32a-48f7-8514-eee47faf2e7e-removalai-preview.png' },
        { id: 'fr_red', name: 'CRIMSON CORE', img: 'https://i.ibb.co/5hmPh8LP/db5713a5-198a-4634-9f18-21026b81b198-removalai-preview.png' }
    ];

    // --- GAME LOGIC VARS ---
    let questions = [];
    let currentQ = 0;
    let score = 0;
    let timerInterval = null;
    let timeLeft = 10;
    let totalReward = 0;

    // --- DOM ELEMENTS ---
    const headerLoginBtn = document.getElementById('headerLoginBtn');
    const headerLoginText = document.getElementById('headerLoginText');
    const headerUserImg = document.getElementById('headerUserImg');
    const mobileLoginBtn = document.getElementById('mobileLoginBtn');
    
    // Views
    const views = {
        locked: document.getElementById('viewLocked'),
        mode: document.getElementById('viewMode'),
        category: document.getElementById('viewCategory'),
        game: document.getElementById('viewGame'),
        stats: document.getElementById('viewStats')
    };

    // Game Header Elements
    const gameHeader = document.getElementById('gameHeader');
    const gameUserImg = document.getElementById('gameUserImg');
    const gameUserFrame = document.getElementById('gameUserFrame');
    const gameUserName = document.getElementById('gameUserName');
    const gameUserBadge = document.getElementById('gameUserBadge');

    // --- NAVIGATION FUNCTIONS ---
    window.switchView = (viewName) => {
        Object.values(views).forEach(v => v.classList.remove('active'));
        if(views[viewName]) views[viewName].classList.add('active');
    };

    window.startGameFlow = (mode) => {
        if(mode === 'single') window.switchView('category');
    };

    window.startQuiz = (category) => {
        generateQuestions(category);
        currentQ = 0;
        score = 0;
        window.switchView('game');
        loadQuestion();
    };

    function generateQuestions(cat) {
        // Mock data logic
        questions = [];
        for(let i=0; i<15; i++) {
            questions.push({
                q: `Intrebare ${cat.toUpperCase()} #${i+1}`,
                opts: ['A', 'B', 'C', 'D'],
                correct: 0, // A is always correct for demo
                img: null
            });
        }
        
        // SPECIFIC KSDA IMAGE LOGIC
        if(cat === 'ksda') {
            questions[0] = {
                q: "Ce reprezintƒÉ aceastƒÉ imagine √Æn contextul KSDA?",
                opts: ["Logo vechi", "O pozƒÉ random", "Imagine Test", "Admin"],
                correct: 2,
                img: "https://i.ibb.co/7dpMBCQB/92d1760603edb303d32a69aa6180d6a6-tplv-tiktokx-cropcenter-1080-1080.jpg"
            };
        }
    }

    function loadQuestion() {
        if(currentQ >= 15) {
            endGame();
            return;
        }

        const q = questions[currentQ];
        document.getElementById('qIndex').innerText = currentQ + 1;
        document.getElementById('qText').innerText = q.q;
        
        const imgCont = document.getElementById('qImgContainer');
        imgCont.innerHTML = '';
        if(q.img) {
            imgCont.innerHTML = `<a href="https://ibb.co/DHMcmWYm"><img src="${q.img}" class="q-img"></a>`;
        }

        const grid = document.getElementById('answersGrid');
        grid.innerHTML = '';
        
        q.opts.forEach((opt, idx) => {
            const btn = document.createElement('button');
            btn.className = 'ans-btn';
            btn.innerHTML = `<span style="font-weight:700; color:var(--primary);">${String.fromCharCode(65+idx)}.</span> ${opt}`;
            btn.onclick = () => handleAnswer(idx, btn);
            grid.appendChild(btn);
        });

        // Timer
        clearInterval(timerInterval);
        timeLeft = 10;
        updateTimerBar();
        timerInterval = setInterval(() => {
            timeLeft--;
            updateTimerBar();
            if(timeLeft <= 0) handleAnswer(-1, null);
        }, 1000);
    }

    function updateTimerBar() {
        const bar = document.getElementById('timerBar');
        bar.style.width = `${(timeLeft/10)*100}%`;
        if(timeLeft < 3) bar.style.background = 'red';
        else bar.style.background = '#29f3ff';
    }

    function handleAnswer(idx, btn) {
        clearInterval(timerInterval);
        const btns = document.querySelectorAll('.ans-btn');
        btns.forEach(b => b.disabled = true);
        
        const correctIdx = questions[currentQ].correct;

        if(idx === correctIdx) {
            score++;
            if(btn) btn.classList.add('ans-correct');
        } else {
            if(btn) btn.classList.add('ans-wrong');
            // Show correct
            if(btns[correctIdx]) btns[correctIdx].classList.add('ans-correct');
        }

        setTimeout(() => {
            currentQ++;
            loadQuestion();
        }, 1500);
    }

    function endGame() {
        window.switchView('stats');
        
        // Update Stats View
        if(auth.currentUser) {
            document.getElementById('statsPfp').src = auth.currentUser.photoURL;
            document.getElementById('statsName').innerText = auth.currentUser.displayName;
        }
        document.getElementById('statsCorrect').innerText = score;
        document.getElementById('statsWrong').innerText = 15 - score;
        
        totalReward = score * 25;

        // Reward Button
        const btn = document.getElementById('collectRewardBtn');
        btn.onclick = async () => {
            if(!auth.currentUser) return;
            try {
                await updateDoc(doc(db, "accounts", auth.currentUser.uid), {
                    coins: increment(totalReward)
                });
                // Show Reward Modal
                document.getElementById('gameRewardVal').innerText = totalReward;
                document.getElementById('gameRewardMsg').innerText = `Ai rƒÉspuns corect la ${score} din 15 √ÆntrebƒÉri.`;
                document.getElementById('gameRewardModal').classList.add('active');
            } catch(e) { console.error(e); }
        };
    }


    // --- AUTH & HEADER UPDATES ---
    function updateHeaderAndGameUI(user, data) {
        // Main Header
        headerLoginText.innerText = "ACCOUNT";
        headerUserImg.src = data.image;
        headerUserImg.style.display = 'block';
        if(mobileLoginBtn) mobileLoginBtn.innerHTML = '<i class="fas fa-user-circle"></i> Cont';

        // Account Modal
        document.getElementById('popUserImg').src = data.image;
        document.getElementById('popUserName').innerText = data.username;
        document.getElementById('popUserEmail').innerText = data.email;
        document.getElementById('popUserCoins').innerText = data.coins;
        document.querySelector('.streak-txt').innerText = `Daily Streak: ${data.streak}`;
        
        // Game Header
        gameUserImg.src = data.image;
        gameUserName.innerText = data.username;
        
        // Badge
        if(data.equippedBadge) {
            gameUserBadge.innerText = data.equippedBadge.text;
            gameUserBadge.style.background = data.equippedBadge.color;
        }

        // Banner (Game Header Style)
        gameHeader.className = 'game-header-banner'; // reset
        if(data.equippedBanner && data.equippedBanner.cssClass) {
            gameHeader.classList.add(data.equippedBanner.cssClass);
        }

        // Frame
        const popFrame = document.getElementById('popUserFrame');
        if(data.equippedFrame && data.equippedFrame.img) {
            // Modal Frame
            popFrame.src = data.equippedFrame.img;
            popFrame.style.display = 'block';
            // Game Header Frame
            gameUserFrame.src = data.equippedFrame.img;
            gameUserFrame.style.display = 'block';
        } else {
            popFrame.style.display = 'none';
            gameUserFrame.style.display = 'none';
        }

        // Unlock Game View
        if(views.locked.classList.contains('active')) {
            window.switchView('mode');
        }
    }

    onAuthStateChanged(auth, async (user) => {
        if (user) {
            const snap = await getDoc(doc(db, "accounts", user.uid));
            if(snap.exists()) {
                updateHeaderAndGameUI(user, snap.data());
                // Realtime Listener
                onSnapshot(doc(db, "accounts", user.uid), (s) => {
                    if(s.exists()) updateHeaderAndGameUI(user, s.data());
                });
            } else {
                // Create Account
                await setDoc(doc(db, "accounts", user.uid), {
                    username: user.displayName,
                    email: user.email,
                    image: user.photoURL,
                    coins: 250,
                    streak: 0,
                    joinedAt: new Date()
                });
                document.getElementById('rewardModal').classList.add('active');
            }
        } else {
            headerLoginText.innerText = "LOGIN";
            headerUserImg.style.display = 'none';
            mobileLoginBtn.innerHTML = 'Autentificare';
            window.switchView('locked');
        }
    });

    // Login Triggers
    const handleLogin = async () => {
        if(!auth.currentUser) {
            try { await signInWithPopup(auth, provider); } catch(e){console.error(e);}
        } else {
            document.getElementById('accountModal').classList.add('active');
        }
    };
    headerLoginBtn.onclick = handleLogin;
    mobileLoginBtn.onclick = handleLogin;

    document.getElementById('popLogoutBtn').onclick = () => {
        signOut(auth);
        document.getElementById('accountModal').classList.remove('active');
    };

    // --- MENU & MODAL CONTROLS ---
    const sideMenu = document.getElementById('sideMenu');
    document.getElementById('menuBtn').onclick = () => sideMenu.classList.add('open');
    document.getElementById('closeMenu').onclick = () => sideMenu.classList.remove('open');
    
    // Inventory Logic Stub (Directly accessing Firebase array in a real app)
    window.openInventory = async (type) => {
        document.getElementById('cosmeticsSelectModal').classList.remove('active');
        document.getElementById('inventoryModal').classList.add('active');
        document.getElementById('inventoryList').innerHTML = `<p style="text-align:center; color:#aaa;">Loading ${type}...</p>`;
        
        // For full functionality, you would loop through user.ownedBadges, check BADGES_DB, and render.
        // The logic is in your index.html, this is just a placeholder to prevent errors on this page.
        if(!auth.currentUser) return;
        
        const snap = await getDoc(doc(db, "accounts", auth.currentUser.uid));
        const data = snap.data();
        const list = document.getElementById('inventoryList');
        const actions = document.getElementById('inventoryActions');
        list.innerHTML = ''; actions.innerHTML = '';

        if(type === 'banners') {
            const owned = data.ownedBanners || [];
            if(owned.length === 0) list.innerHTML = '<p style="text-align:center; width:100%; color:#aaa;">Nu ai bannere.</p>';
            owned.forEach(id => {
               const item = BANNERS_DB.find(b => b.id === id);
               if(item) {
                   const div = document.createElement('div');
                   div.className = 'shop-badge-item';
                   div.innerHTML = `<div class="${item.cssClass}" style="padding:5px;width:100%;font-size:10px;">PREVIEW</div><div style="font-size:11px;margin:5px 0;">${item.name}</div><button class="equip-btn">ECHIPEAZƒÇ</button>`;
                   div.querySelector('button').onclick = async () => {
                       await updateDoc(doc(db, "accounts", auth.currentUser.uid), { equippedBanner: item });
                       openInventory('banners');
                   };
                   list.appendChild(div);
               }
            });
            // Unequip
            if(data.equippedBanner) {
                const btn = document.createElement('button'); btn.className = 'unequip-all-btn'; btn.innerText = "SCOATE BANNER";
                btn.onclick = async () => { await updateDoc(doc(db, "accounts", auth.currentUser.uid), { equippedBanner: null }); openInventory('banners'); };
                actions.appendChild(btn);
            }
        }
    };
    
    // Modal Close Logic
    document.querySelectorAll('.close-pop, .close-modal-btn').forEach(btn => {
        btn.onclick = function() {
            this.closest('.account-modal-overlay').classList.remove('active');
        }
    });
    
    // Account Modal Sub-buttons
    document.getElementById('openCosmeticsBtn').onclick = () => {
        document.getElementById('accountModal').classList.remove('active');
        document.getElementById('cosmeticsSelectModal').classList.add('active');
    };
    document.getElementById('openEditProfileBtn').onclick = () => {
        document.getElementById('accountModal').classList.remove('active');
        document.getElementById('editProfileModal').classList.add('active');
    };

    // Bot Logic (Simple toggle)
    document.getElementById('botBtn').onclick = () => document.getElementById('botWindow').classList.toggle('active');
    document.getElementById('botClose').onclick = () => document.getElementById('botWindow').classList.remove('active');

</script>
</body>
</html>
