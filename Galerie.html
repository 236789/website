<!DOCTYPE html>
<html lang="ro">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-B6DWPJ4T2C"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-B6DWPJ4T2C');
  </script>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Galerie Portrete â€” KSDAPromovari</title>
  <link rel="icon" type="image/png" href="https://iili.io/fXks1Dv.png">
  
  <!-- Fonts: Orbitron (UI) & Poppins (Body) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;700;800;900&family=Poppins:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    /* --- THEME VARIABLES --- */
    :root {
      --bg-dark: #050b14;
      --primary: #29f3ff;
      --primary-dim: rgba(41, 243, 255, 0.15);
      --glass-bg: rgba(13, 25, 41, 0.85);
      --glass-border: rgba(255, 255, 255, 0.08);
      --text-main: #ffffff;
      --text-muted: #a5b1c2;
      --transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      --star-color: #ffcc00;
      --card-radius: 20px;
    }

    * { box-sizing: border-box; outline: none; }
    html { scroll-behavior: smooth; }

    /* --- SCROLLBAR --- */
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: var(--bg-dark); }
    ::-webkit-scrollbar-thumb { background: #1f3a52; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--primary); }

    body {
      margin: 0;
      min-height: 100vh;
      background-color: var(--bg-dark);
      background-image: linear-gradient(to bottom, rgba(5, 11, 20, 0.85), var(--bg-dark)), url('https://i.makeagif.com/media/3-03-2021/otrneG.gif');
      background-position: center; background-size: cover; background-attachment: fixed;
      font-family: 'Poppins', sans-serif; color: var(--text-main);
      display: flex; flex-direction: column; overflow-x: hidden;
    }

    h1, h2, h3, .logo, .bubbleBtn, #sideMenu a, .login-btn-header, .side-menu-login-btn, .pop-user, .streak-txt, .coins-count, .ban-title { 
        font-family: 'Orbitron', sans-serif; 
    }

    /* --- ACCOUNT POPUP MODAL --- */
    .account-modal-overlay {
        position: fixed; inset: 0; background: rgba(0,0,0,0.85);
        display: none; justify-content: center; align-items: center;
        z-index: 11000; backdrop-filter: blur(10px);
    }
    .account-modal-overlay.active { display: flex; }

    .account-card {
        background: #08101b; border: 1px solid var(--primary);
        width: 90%; max-width: 380px; border-radius: 30px;
        padding: 40px 25px; text-align: center; position: relative;
        box-shadow: 0 0 50px rgba(41, 243, 255, 0.3);
        animation: jumpIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
    }
    @keyframes jumpIn {
        0% { transform: scale(0.3) translateY(100px); opacity: 0; }
        100% { transform: scale(1) translateY(0); opacity: 1; }
    }
    .close-pop { position: absolute; top: 15px; right: 20px; color: #fff; cursor: pointer; font-size: 24px; background: none; border: none; opacity: 0.5; transition: 0.3s; }
    .pop-img { width: 90px; height: 90px; border-radius: 50%; border: 2px solid var(--primary); margin-bottom: 12px; box-shadow: 0 0 20px var(--primary-dim); }
    .pop-user { font-size: 18px; color: #fff; margin: 0; letter-spacing: 1px; }
    .pop-mail { font-size: 12px; color: var(--text-muted); margin-bottom: 20px; }

    .streak-box {
        display: inline-flex; align-items: center; gap: 8px;
        background: rgba(255, 69, 0, 0.1); border-radius: 50px;
        padding: 6px 16px; margin-bottom: 15px; border: 1px solid rgba(255, 69, 0, 0.2);
    }
    .streak-box i { color: #ff4500; font-size: 18px; animation: fireBurn 1.5s infinite; }
    @keyframes fireBurn { 0%, 100% { filter: brightness(1); } 50% { filter: brightness(1.5) drop-shadow(0 0 5px #ff4500); } }
    .streak-txt { font-weight: 800; color: #ff4500; font-size: 13px; }

    .coins-section {
        display: flex; flex-direction: column; align-items: center; gap: 5px;
        margin-bottom: 25px; background: rgba(255, 255, 255, 0.03);
        padding: 12px; border-radius: 20px; border: 1px solid var(--glass-border);
    }
    .coins-label { font-family: 'Orbitron'; font-size: 10px; color: var(--primary); text-transform: uppercase; }
    .coins-display { display: flex; align-items: center; gap: 10px; }
    .coins-icon-img { width: 30px; height: 30px; object-fit: contain; }
    .coins-count { font-size: 20px; font-weight: 900; color: #fff; }

    .btn-tasks {
        background: rgba(41, 243, 255, 0.05); border: 1px solid var(--primary); color: var(--primary);
        padding: 16px; border-radius: 18px; text-decoration: none; display: flex;
        flex-direction: column; align-items: center; gap: 5px; transition: 0.3s; margin-bottom: 15px;
    }
    .btn-tasks:hover { background: var(--primary); color: #000; box-shadow: 0 0 20px var(--primary-dim); transform: translateY(-2px); }
    .tasks-title { font-family: 'Orbitron'; font-weight: 800; font-size: 14px; text-transform: uppercase; }
    .tasks-desc { font-family: 'Poppins'; font-size: 10px; opacity: 0.8; font-weight: 400; line-height: 1.3; color: inherit; }

    .btn-logout-pop {
        background: transparent; border: 1.5px solid #ff4757; color: #ff4757;
        padding: 10px 25px; border-radius: 12px; font-family: 'Orbitron'; font-weight: 700;
        cursor: pointer; transition: 0.3s; font-size: 12px; text-transform: uppercase;
    }
    .btn-logout-pop:hover { background: #ff4757; color: #fff; box-shadow: 0 0 15px rgba(255, 71, 87, 0.4); }

    /* REWARD MODAL */
    .reward-modal {
        position: fixed; inset: 0; background: rgba(0,0,0,0.9);
        display: none; justify-content: center; align-items: center;
        z-index: 12000; padding: 20px;
    }
    .reward-modal.active { display: flex; }
    .reward-card {
        background: #08101b; border: 2px solid #ffd700; border-radius: 30px;
        padding: 40px; text-align: center; max-width: 400px; width: 100%;
        animation: jumpIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
    }

    /* --- HEADER --- */
    .header-container { position: fixed; top: 0; left: 0; right: 0; padding: 20px; z-index: 1000; display: flex; justify-content: center; }
    header { width: 100%; max-width: 1200px; display: flex; align-items: center; justify-content: space-between; padding: 12px 30px; background: rgba(5, 11, 20, 0.6); border: 1px solid var(--glass-border); border-radius: 100px; backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
    .logo { font-weight: 900; font-size: 24px; letter-spacing: 1px; background: linear-gradient(90deg, #fff, var(--primary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-transform: uppercase; text-decoration: none; }
    nav { display: flex; gap: 32px; align-items: center; }
    nav a { color: var(--text-muted); text-decoration: none; font-size: 13px; font-weight: 600; transition: 0.3s; }
    nav a:hover { color: var(--primary); }

    .login-btn-header { background: transparent; border: 1.5px solid var(--primary); color: var(--primary); padding: 8px 20px; border-radius: 20px; font-size: 12px; font-weight: 700; cursor: pointer; text-transform: uppercase; transition: 0.3s; display: flex; align-items: center; gap: 8px; }
    .login-btn-header:hover { background: var(--primary); color: #000; box-shadow: 0 0 15px rgba(41, 243, 255, 0.4); }
    .user-avatar-small { width: 24px; height: 24px; border-radius: 50%; border: 1px solid #fff; display: none; }

    .hamburger { display: none; background: none; border: none; color: #fff; font-size: 26px; cursor: pointer; }

    /* --- SIDE MENU --- */
    #sideMenu { position: fixed; inset: 0; left: auto; width: 320px; background: #08101b; border-left: 1px solid var(--glass-border); z-index: 2000; padding: 40px 30px; transform: translateX(100%); transition: transform 0.4s cubic-bezier(0.77, 0, 0.175, 1); display: flex; flex-direction: column; }
    #sideMenu.open { transform: translateX(0); }
    .menu-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
    .closeBtn { font-size: 42px; background: none; border: none; color: #fff; cursor: pointer; }
    .menu-links { display: flex; flex-direction: column; gap: 35px; }
    .menu-links a { color: #fff; text-decoration: none; font-size: 24px; font-weight: 600; transition: 0.3s; }
    .side-menu-login-btn { background: rgba(41, 243, 255, 0.1); border: 1px solid var(--primary); color: var(--primary); width: 100%; padding: 15px; margin-top: 20px; border-radius: 12px; font-size: 16px; font-weight: 700; cursor: pointer; transition: 0.3s; text-transform: uppercase; letter-spacing: 1px; display: flex; justify-content: center; align-items: center; gap: 10px; }

    /* --- MAIN LAYOUT & GALLERY GRID --- */
    .container { width:100%; max-width:1400px; margin-top: 140px; display: flex; flex-direction: column; align-items: center; padding: 0 20px 80px; }
    .metallic-title { background: linear-gradient(180deg, #ffffff 0%, #a2cfff 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-shadow: 0 10px 30px rgba(0,0,0,0.5); text-align: center; font-weight: 800; font-size: clamp(32px, 5vw, 56px); text-transform: uppercase; }
    
    /* REQ: PC = 5 per row, Mobile = 1 per row */
    .gallery-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 20px;
      width: 100%;
      margin-top: 40px;
    }

    .gallery-item {
        background: var(--glass-bg);
        border: 1px solid var(--glass-border);
        border-radius: var(--card-radius);
        overflow: hidden;
        display: flex;
        flex-direction: column;
        transition: var(--transition);
        position: relative;
    }
    .gallery-item:hover { border-color: var(--primary); transform: translateY(-5px); box-shadow: 0 10px 30px rgba(41, 243, 255, 0.2); }

    .gallery-img {
      width: 100%;
      height: 300px;
      object-fit: cover;
      cursor: pointer;
      display: block;
    }

    /* ITEM ACTIONS (LIKE/DISLIKE/COMMENT) */
    .item-actions {
        padding: 12px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: rgba(0,0,0,0.3);
        border-top: 1px solid var(--glass-border);
    }
    .vote-btn { background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border); color: var(--text-muted); padding: 6px 10px; border-radius: 8px; cursor: pointer; font-size: 12px; transition: 0.2s; display: flex; align-items: center; gap: 5px; }
    .vote-btn:hover { background: rgba(41, 243, 255, 0.1); color: var(--primary); }
    .vote-btn.active-like { color: var(--primary); border-color: var(--primary); background: rgba(41, 243, 255, 0.1); }
    .vote-btn.active-dislike { color: #ff4757; border-color: #ff4757; background: rgba(255, 71, 87, 0.1); }

    /* COMMENTS SECTION INSIDE GALLERY ITEM */
    .comments-section {
        display: none;
        padding: 15px;
        background: rgba(0,0,0,0.4);
        border-top: 1px solid var(--glass-border);
        max-height: 300px;
        overflow-y: auto;
    }
    .comment-list { display: flex; flex-direction: column; gap: 10px; margin-bottom: 10px; }
    .comment-item { display: flex; gap: 8px; font-size: 12px; background: rgba(255,255,255,0.03); padding: 8px; border-radius: 8px; }
    .com-pfp { width: 25px; height: 25px; border-radius: 50%; }
    .com-name { font-weight: 700; color: var(--primary); display: block; }
    .comment-input-area { display: flex; gap: 5px; margin-top: 10px; }
    .com-input { flex: 1; background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border); border-radius: 10px; padding: 6px 10px; color: #fff; font-size: 12px; }
    .com-send-btn { background: var(--primary); border: none; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 10px; }

    /* --- LIGHTBOX --- */
    .lightbox { display: none; position: fixed; z-index: 20000; inset: 0; background: rgba(0,0,0,0.95); backdrop-filter: blur(10px); justify-content: center; align-items: center; }
    .lightbox-content { max-width: 90%; max-height: 85vh; border-radius: 10px; border: 2px solid var(--primary); }
    .close-lightbox { position: absolute; top: 30px; right: 40px; color: #fff; font-size: 40px; cursor: pointer; }

    /* --- BANNED SCREEN --- */
    #bannedOverlay { display: none; position: fixed; inset: 0; background: rgba(10, 0, 0, 0.98); z-index: 30000; flex-direction: column; justify-content: center; align-items: center; text-align: center; }
    .ban-icon { font-size: 80px; color: #ff4757; margin-bottom: 20px; }

    /* --- RESPONSIVE --- */
    @media (max-width: 1024px) { .gallery-grid { grid-template-columns: repeat(3, 1fr); } }
    @media (max-width: 768px) { 
        nav { display: none; } .hamburger { display: block; } 
        .gallery-grid { grid-template-columns: 1fr; } 
        .container { margin-top: 100px; padding: 0 10px; }
    }

    footer { background: #02050a; border-top: 1px solid var(--glass-border); padding: 40px 20px; text-align: center; margin-top: auto; }
    .footer-pfp-img { width: 60px; border-radius: 50%; border: 2px solid var(--primary); }
  </style>
</head>
<body>

<!-- REWARD MODAL (SPECIAL THANK YOU) -->
<div id="rewardModal" class="reward-modal">
    <div class="reward-card">
        <h2 style="color:#ffd700;">ðŸŽ‰ MULÈšUMIM!</h2>
        <p>Apreciem interacÈ›iunea ta cu galeria noastrÄƒ. ÃŽn viitor, aici vei primi quest-uri speciale!</p>
        <button class="bubbleBtn" style="margin-top:20px;" onclick="document.getElementById('rewardModal').classList.remove('active')">ÃŽnchide</button>
    </div>
</div>

<!-- ACCOUNT MODAL -->
<div id="accountModal" class="account-modal-overlay">
    <div class="account-card">
        <button id="closeAccountPop" class="close-pop">âœ•</button>
        <img id="popUserImg" src="" class="pop-img">
        <h3 id="popUserName" class="pop-user">Utilizator</h3>
        <p id="popUserEmail" class="pop-mail">email@exemplu.com</p>
        
        <div class="streak-box">
            <i class="fas fa-fire"></i>
            <span class="streak-txt">Daily Streak: 0</span>
        </div>

        <div class="coins-section">
            <span class="coins-label">Puncte KSDA</span>
            <div class="coins-display">
                <img src="https://iili.io/fhc1SKQ.png" class="coins-icon-img" alt="Coins">
                <span id="popUserCoins" class="coins-count">0</span>
            </div>
        </div>

        <div class="pop-btns">
            <a href="DailyTasks.html" class="btn-tasks">
                <span class="tasks-title"><i class="fas fa-tasks"></i> Daily Tasks</span>
                <span class="tasks-desc">CompleteazÄƒ task-uri È™i cÃ¢È™tigÄƒ puncte</span>
            </a>
            <button id="popLogoutBtn" class="btn-logout-pop">Log Out</button>
        </div>
    </div>
</div>

<!-- BANNED OVERLAY -->
<div id="bannedOverlay">
    <i class="fas fa-user-slash ban-icon"></i>
    <h1 class="ban-title" style="color:#ff4757;">ACCES RESTRICÈšIONAT</h1>
    <p id="banReasonText" style="color:#aaa;">IP-ul tÄƒu a fost suspendat din reÈ›eaua KSDA.</p>
</div>

<!-- HEADER -->
<div class="header-container">
    <header>
        <a href="index.html" class="logo">
            <img src="https://iili.io/fXvBEiB.png" alt="KSDA Logo" style="height: 40px;">
        </a>
        <nav>
            <a href="index.html">AcasÄƒ</a>
            <a href="Wall.html">Wall</a>
            <a href="galerie.html" style="color: var(--primary);">Galerie</a>
            <a href="recenzii.html">Recenzii</a>
            <button id="headerLoginBtn" class="login-btn-header">
                <img id="headerUserImg" src="" class="user-avatar-small">
                <span id="headerLoginText">LOGIN</span>
            </button>
        </nav>
        <button id="menuBtn" class="hamburger">â˜°</button>
    </header>
</div>

<!-- SIDE MENU -->
<aside id="sideMenu">
    <div class="menu-header">
        <div class="logo">KSDA</div>
        <button id="closeMenu" class="closeBtn">âœ•</button>
    </div>
    <div class="menu-links">
        <a href="index.html">AcasÄƒ</a>
        <a href="Wall.html">Community Wall</a>
        <a href="galerie.html">Galerie</a>
        <a href="recenzii.html">Recenzii</a>
        <button id="mobileLoginBtn" class="side-menu-login-btn">
            <i class="fas fa-user-circle"></i> ACCOUNT
        </button>
    </div>
</aside>

<!-- MAIN CONTAINER -->
<main class="container">
    <h1 class="metallic-title">Galerie Portrete</h1>
    <p style="text-align:center; color: var(--text-muted); max-width: 700px; margin-top: 10px;">
        ExploreazÄƒ colecÈ›ia noastrÄƒ de creaÈ›ii digitale. LogheazÄƒ-te pentru a aprecia È™i a comenta lucrÄƒrile preferate.
    </p>

    <!-- GALLERY GRID -->
    <div class="gallery-grid" id="galleryGrid">
        <!-- Imaginile vor fi injectate prin JavaScript pentru a permite sistemul de comentarii/like pe fiecare -->
    </div>
</main>

<!-- LIGHTBOX -->
<div id="lightbox" class="lightbox">
    <span class="close-lightbox" id="closeLightbox">&times;</span>
    <img class="lightbox-content" id="lightboxImg">
</div>

<footer>
    <div class="footer-content">
        <div class="logo" style="font-size: 20px;">KSDA</div>
        <div class="made-by-wrapper">
            <img src="https://iili.io/f1ddIfe.png" class="footer-pfp-img">
            <p style="font-size:12px; opacity:0.5;">&copy; 2026 KSDAPromovari</p>
        </div>
    </div>
</footer>

<!-- FIREBASE LOGIC -->
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc, updateDoc, collection, query, orderBy, onSnapshot, serverTimestamp, increment } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDoH80kffNrzFAcyRqsTVdifs-whUhwH9A",
        authDomain: "ksda-7546f.firebaseapp.com",
        projectId: "ksda-7546f",
        storageBucket: "ksda-7546f.firebasestorage.app",
        messagingSenderId: "306437513808",
        appId: "1:306437513808:web:28479810e3fdf71b32e755"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const provider = new GoogleAuthProvider();

    // DOM Elements
    const galleryGrid = document.getElementById('galleryGrid');
    const headerLoginBtn = document.getElementById('headerLoginBtn');
    const headerLoginText = document.getElementById('headerLoginText');
    const headerUserImg = document.getElementById('headerUserImg');
    const mobileLoginBtn = document.getElementById('mobileLoginBtn');
    const accountModal = document.getElementById('accountModal');
    const closeAccountPop = document.getElementById('closeAccountPop');
    const popLogoutBtn = document.getElementById('popLogoutBtn');

    let userIP = null;
    fetch('https://api.ipify.org?format=json').then(r => r.json()).then(d => userIP = d.ip);

    // List of images (Originals + New ones)
    const galleryImages = [
        "https://iili.io/f0GxswB.md.jpg", "https://iili.io/f0GxLZP.md.jpg", "https://iili.io/f0GxtMF.md.jpg",
        "https://iili.io/f0GxZn1.md.jpg", "https://iili.io/f0GxD6g.md.jpg", "https://iili.io/f0GxmFa.md.jpg",
        "https://iili.io/f0GxpcJ.md.jpg", "https://iili.io/f0Gxy8v.md.jpg", "https://iili.io/f0GzH9R.md.jpg",
        "https://iili.io/f0GzJup.md.jpg", "https://iili.io/f0GzdwN.md.jpg", "https://iili.io/f0Gz2tI.md.jpg",
        "https://iili.io/f0GzFnt.md.jpg", "https://iili.io/f0GzKMX.md.jpg", "https://iili.io/f0GzBFs.md.jpg",
        "https://iili.io/f0GzCcG.md.jpg", "https://iili.io/f0Gzx94.md.jpg", "https://iili.io/f0GzzAl.md.jpg",
        "https://iili.io/f0GzIN2.md.jpg", "https://iili.io/f0GzTtS.md.jpg", "https://iili.io/f1UOktS.jpg",
        "https://iili.io/f1UOSV9.jpg", "https://iili.io/f1UOOAl.jpg", "https://iili.io/f1UOhcG.jpg",
        "https://iili.io/f1UO4cb.jpg", "https://iili.io/f1UOiHx.jpg",
        // New Batch requested
        "https://iili.io/fhP29Tv.md.jpg", "https://iili.io/fhPdpyJ.md.jpg", "https://iili.io/fhPdmva.md.jpg",
        "https://iili.io/fhPdbYg.md.jpg", "https://iili.io/fhP2HjR.md.jpg", "https://iili.io/fhP2JQp.md.jpg",
        "https://iili.io/fhP22CN.md.jpg", "https://iili.io/fhP2F4t.md.jpg", "https://iili.io/fhP2f3X.md.jpg",
        "https://iili.io/fhP2qan.md.jpg", "https://iili.io/fhP2Bvs.md.jpg", "https://iili.io/fhP2CyG.md.jpg",
        "https://iili.io/fhP2xj4.md.jpg", "https://iili.io/fhP2zZl.md.jpg", "https://iili.io/fhP2ouf.md.jpg",
        "https://iili.io/fhP2Tn2.md.jpg", "https://iili.io/fhP2uGS.md.jpg", "https://iili.io/fhP2A67.md.jpg",
        "https://iili.io/fhP25F9.md.jpg", "https://iili.io/fhP27ae.md.jpg", "https://iili.io/fhP2Y8u.md.jpg",
        "https://iili.io/fhP2luj.md.jpg", "https://iili.io/fhP20wx.md.jpg", "https://iili.io/fhP2GnV.md.jpg",
        "https://iili.io/fhP2MMB.md.jpg", "https://iili.io/fhP2V6P.md.jpg", "https://iili.io/fhP2XF1.md.jpg",
        "https://iili.io/fhP2hcF.md.jpg", "https://iili.io/fhP2N9a.md.jpg", "https://iili.io/fhP2OAJ.md.jpg",
        "https://iili.io/fhP2ewv.md.jpg", "https://iili.io/fhP2ktR.md.jpg", "https://iili.io/fhP2SMN.md.jpg",
        "https://iili.io/fhP2UPI.md.jpg", "https://iili.io/fhP24cX.md.jpg", "https://iili.io/fhP26Sn.md.jpg",
        "https://iili.io/fhP2i9s.md.jpg", "https://iili.io/fhP2LNf.md.jpg", "https://iili.io/fhP2sAG.jpg",
        "https://iili.io/fhP2Qt4.md.jpg", "https://iili.io/fhP2tol.md.jpg", "https://iili.io/fhP2DV2.md.jpg",
        "https://iili.io/fhP2bPS.md.jpg", "https://iili.io/fhP2pK7.md.jpg", "https://iili.io/fhP2yl9.md.jpg",
        "https://iili.io/fhP39Se.md.jpg", "https://iili.io/fhP3JHu.jpg", "https://iili.io/fhP3dAb.jpg",
        "https://iili.io/fhP32Nj.jpg", "https://iili.io/fhP33Dx.jpg", "https://iili.io/fhP3KoQ.jpg",
        "https://iili.io/fhP3fVV.jpg", "https://iili.io/fhP3qiB.jpg", "https://iili.io/fhP3CKP.jpg",
        "https://iili.io/fhP3nl1.jpg", "https://iili.io/fhP3oUF.jpg", "https://iili.io/fhP3zHg.jpg",
        "https://iili.io/fhP3IRa.jpg", "https://iili.io/fhP3TOJ.jpg", "https://iili.io/fhP3uDv.jpg",
        "https://iili.io/fhP3RxR.jpg", "https://iili.io/fhP35Vp.jpg", "https://iili.io/fhP37iN.jpg",
        "https://iili.io/fhP3afI.jpg", "https://iili.io/fhP3clt.jpg", "https://iili.io/fhP3lUX.jpg",
        "https://iili.io/fhP31Jn.jpg", "https://iili.io/fhP3ERs.jpg", "https://iili.io/fhP3GOG.jpg",
        "https://iili.io/fhP3Mbf.jpg", "https://iili.io/fhP3Wx4.jpg", "https://iili.io/fhP3XWl.jpg",
        "https://iili.io/fhP3hs2.jpg", "https://iili.io/fhP3wfS.jpg", "https://iili.io/fhP3kJe.jpg",
        "https://iili.io/fhP3v5u.jpg", "https://iili.io/fhP38Ob.jpg", "https://iili.io/fhP3Sbj.jpg",
        "https://iili.io/fhP3rWQ.jpg", "https://iili.io/fhP34sV.jpg", "https://iili.io/fhP3i0P.md.jpg",
        "https://iili.io/fhP3PqB.md.jpg", "https://iili.io/fhP3sg1.md.jpg", "https://iili.io/fhP3QdF.md.jpg",
        "https://iili.io/fhP3Z5g.md.jpg", "https://iili.io/fhP3tea.md.jpg", "https://iili.io/fhP3DmJ.md.jpg",
        "https://iili.io/fhP3mzv.md.jpg", "https://iili.io/fhP3pXR.md.jpg", "https://iili.io/fhP3ysp.md.jpg",
        "https://iili.io/fhPFdgt.md.jpg", "https://iili.io/fhPFKes.md.jpg", "https://iili.io/fhPFBIf.md.jpg",
        "https://iili.io/fhPFfmG.md.jpg", "https://iili.io/fhPFCX4.md.jpg", "https://iili.io/fhPFxB2.md.jpg",
        "https://iili.io/fhPFz1S.md.jpg", "https://iili.io/fhPFIr7.md.jpg", "https://iili.io/fhPFu29.md.jpg",
        "https://iili.io/fhPF5mb.md.jpg", "https://iili.io/fhPFYIj.md.jpg", "https://iili.io/fhPFcLQ.md.jpg",
        "https://iili.io/fhPF0BV.md.jpg", "https://iili.io/fhPF1EB.md.jpg", "https://iili.io/fhPFErP.jpg",
        "https://iili.io/fhPFM21.jpg", "https://iili.io/fhPFVYF.jpg", "https://iili.io/fhPFXpa.jpg",
        "https://iili.io/fhPFjTJ.md.jpg", "https://iili.io/fhPFwhv.md.jpg", "https://iili.io/fhPFNQR.md.jpg",
        "https://iili.io/fhPFeBp.md.jpg", "https://iili.io/fhPFkEN.md.jpg", "https://iili.io/fhPFv4I.md.jpg",
        "https://iili.io/fhPFUYX.md.jpg", "https://iili.io/fhPFgvn.md.jpg", "https://iili.io/fhPF6TG.md.jpg",
        "https://iili.io/fhPFPjf.md.jpg", "https://iili.io/fhPFiQ4.md.jpg", "https://iili.io/fhPFLCl.md.jpg",
        "https://iili.io/fhPFQG2.md.jpg", "https://iili.io/fhPFZ4S.md.jpg", "https://iili.io/fhPFD37.md.jpg",
        "https://iili.io/fhPFmve.jpg", "https://iili.io/fhPK9Tb.md.jpg", "https://iili.io/fhPKJZx.md.jpg",
        "https://iili.io/fhPK2CQ.md.jpg", "https://iili.io/fhPK3GV.md.jpg", "https://iili.io/fhPKF6B.md.jpg",
        "https://iili.io/fhPKqa1.md.jpg", "https://iili.io/fhPKB8F.md.jpg", "https://iili.io/fhPKCyg.md.jpg",
        "https://iili.io/fhPKxwJ.md.jpg", "https://iili.io/fhPKzZv.md.jpg", "https://iili.io/fhPKTnR.md.jpg",
        "https://iili.io/fhPKuGp.md.jpg", "https://iili.io/fhPK7at.md.jpg", "https://iili.io/fhPKY8X.md.jpg"
    ];

    // Auth Logic
    async function handleLogin() {
        try {
            const result = await signInWithPopup(auth, provider);
            const user = result.user;
            const userRef = doc(db, "accounts", user.uid);
            const snap = await getDoc(userRef);
            if (!snap.exists()) {
                await setDoc(userRef, { uid: user.uid, username: user.displayName, email: user.email, image: user.photoURL, coins: 250, streak: 0, ip: userIP || "unknown", joinedAt: new Date() });
            }
        } catch (e) { console.error(e); }
    }

    headerLoginBtn.onclick = () => { if (!auth.currentUser) handleLogin(); else accountModal.classList.add('active'); };
    mobileLoginBtn.onclick = () => { if (!auth.currentUser) handleLogin(); else accountModal.classList.add('active'); };
    closeAccountPop.onclick = () => accountModal.classList.remove('active');
    popLogoutBtn.onclick = () => signOut(auth).then(() => location.reload());

    onAuthStateChanged(auth, async (user) => {
        if (user) {
            headerLoginText.innerText = "ACCOUNT";
            headerUserImg.src = user.photoURL; headerUserImg.style.display = "block";
            
            if (userIP) {
                const banSnap = await getDoc(doc(db, "banned_ips", userIP));
                if (banSnap.exists()) { document.getElementById('bannedOverlay').style.display = 'flex'; return; }
            }

            onSnapshot(doc(db, "accounts", user.uid), (snap) => {
                if (snap.exists()) {
                    const d = snap.data();
                    document.getElementById('popUserImg').src = d.image;
                    document.getElementById('popUserName').innerText = d.username;
                    document.getElementById('popUserEmail').innerText = d.email;
                    document.getElementById('popUserCoins').innerText = d.coins || 0;
                    document.querySelector('.streak-txt').innerText = `Daily Streak: ${d.streak || 0}`;
                }
            });
        } else {
            headerLoginText.innerText = "LOGIN"; headerUserImg.style.display = "none";
        }
        renderGallery();
    });

    // Gallery & Interactions Logic
    function renderGallery() {
        galleryGrid.innerHTML = "";
        galleryImages.forEach((url, index) => {
            const itemId = "gal_" + index;
            const itemDiv = document.createElement('div');
            itemDiv.className = 'gallery-item';
            itemDiv.innerHTML = `
                <img src="${url}" class="gallery-img" onclick="openLightbox('${url}')">
                <div class="item-actions">
                    <div style="display:flex; gap:8px;">
                        <button onclick="voteItem('${itemId}', 1)" id="like-${itemId}" class="vote-btn"><i class="fas fa-thumbs-up"></i> <span id="likes-cnt-${itemId}">0</span></button>
                        <button onclick="voteItem('${itemId}', -1)" id="dislike-${itemId}" class="vote-btn"><i class="fas fa-thumbs-down"></i> <span id="dislikes-cnt-${itemId}">0</span></button>
                    </div>
                    <button onclick="toggleComments('${itemId}')" class="vote-btn"><i class="fas fa-comment"></i> Comentarii</button>
                </div>
                <div id="comments-${itemId}" class="comments-section">
                    <div id="list-${itemId}" class="comment-list"></div>
                    <div class="comment-input-area">
                        <input type="text" id="input-${itemId}" class="com-input" placeholder="Scrie un comentariu...">
                        <button onclick="postComment('${itemId}')" class="com-send-btn"><i class="fas fa-paper-plane"></i></button>
                    </div>
                </div>
            `;
            galleryGrid.appendChild(itemDiv);
            syncInteractions(itemId);
        });
    }

    // Sync likes/dislikes from Firestore
    window.syncInteractions = (itemId) => {
        onSnapshot(doc(db, "gallery_interactions", itemId), (snap) => {
            let likes = 0, dislikes = 0;
            if (snap.exists()) {
                const votes = snap.data().votes || {};
                Object.values(votes).forEach(v => { if (v === 1) likes++; if (v === -1) dislikes++; });
                const myVote = auth.currentUser ? votes[auth.currentUser.uid] : null;
                
                document.getElementById(`likes-cnt-${itemId}`).innerText = likes;
                document.getElementById(`dislikes-cnt-${itemId}`).innerText = dislikes;
                
                document.getElementById(`like-${itemId}`).classList.toggle('active-like', myVote === 1);
                document.getElementById(`dislike-${itemId}`).classList.toggle('active-dislike', myVote === -1);
            }
        });
    };

    window.voteItem = async (itemId, type) => {
        if (!auth.currentUser) return alert("Trebuie sÄƒ te loghezi pentru a vota!");
        const ref = doc(db, "gallery_interactions", itemId);
        const snap = await getDoc(ref);
        let votes = snap.exists() ? snap.data().votes || {} : {};
        
        if (votes[auth.currentUser.uid] === type) delete votes[auth.currentUser.uid];
        else votes[auth.currentUser.uid] = type;
        
        await setDoc(ref, { votes }, { merge: true });
    };

    window.toggleComments = (itemId) => {
        const sec = document.getElementById(`comments-${itemId}`);
        if (sec.style.display === 'block') sec.style.display = 'none';
        else {
            sec.style.display = 'block';
            loadComments(itemId);
        }
    };

    window.loadComments = (itemId) => {
        const list = document.getElementById(`list-${itemId}`);
        const q = query(collection(db, `gallery_interactions/${itemId}/comments`), orderBy("createdAt", "asc"));
        onSnapshot(q, (snap) => {
            list.innerHTML = "";
            snap.forEach(d => {
                const data = d.data();
                const div = document.createElement('div');
                div.className = 'comment-item';
                div.innerHTML = `<img src="${data.photo}" class="com-pfp"><div><span class="com-name">${data.name}</span>${data.text}</div>`;
                list.appendChild(div);
            });
        });
    };

    window.postComment = async (itemId) => {
        if (!auth.currentUser) return alert("LogheazÄƒ-te pentru a comenta!");
        const input = document.getElementById(`input-${itemId}`);
        const text = input.value.trim();
        if (!text) return;

        await setDoc(doc(db, `gallery_interactions/${itemId}/comments/${auth.currentUser.uid}`), {
            text, name: auth.currentUser.displayName, photo: auth.currentUser.photoURL, uid: auth.currentUser.uid, createdAt: serverTimestamp()
        });
        input.value = "";
        document.getElementById('rewardModal').classList.add('active'); // Pop-up-ul special de mulÈ›umire
    };

    // Lightbox Logic
    window.openLightbox = (url) => {
        document.getElementById('lightboxImg').src = url;
        document.getElementById('lightbox').style.display = 'flex';
        document.body.style.overflow = 'hidden';
    };
    document.getElementById('closeLightbox').onclick = () => {
        document.getElementById('lightbox').style.display = 'none';
        document.body.style.overflow = 'auto';
    };

    // Hamburger Logic
    document.getElementById('menuBtn').onclick = () => document.getElementById('sideMenu').classList.add('open');
    document.getElementById('closeMenu').onclick = () => document.getElementById('sideMenu').classList.remove('open');
</script>

</body>
</html>
