<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KEVINUȚĂ - Joc</title>
 <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet">

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-database-compat.js"></script>
 

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBihv3wYvDUo6DejSLec9U0DfOiR6g7VuQ",
    authDomain: "kevin-game-f9cf8.firebaseapp.com",
    databaseURL: "https://kevin-game-f9cf8-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "kevin-game-f9cf8",
    storageBucket: "kevin-game-f9cf8.firebasestorage.app",
    messagingSenderId: "867549783547",
    appId: "1:867549783547:web:b12b915b2ed3129907175e"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();


// 🔆 Inject rainbow animation CSS
const rainbowStyle = document.createElement("style");
rainbowStyle.textContent = `
@keyframes rainbowCycle {
  0% { background: red; }
  14% { background: orange; }
  28% { background: yellow; }
  42% { background: green; }
  57% { background: blue; }
  71% { background: indigo; }
  85% { background: violet; }
  100% { background: red; }
}
#rainbowOverlay {
  position: fixed;
  top: 0; left: 0;
  width: 100vw;
  height: 100vh;  
  pointer-events: none;
  z-index: 99998;
  opacity: 0.4;
  mix-blend-mode: screen;
  animation: rainbowCycle 0.3s infinite linear;
}
`;
document.head.appendChild(rainbowStyle);

const globalMsgRef = db.ref("globalMessage");
window.username = localStorage.getItem("username") || "Anonim";

let equippedPets = []; // Holds currently equipped pets

function updateEquippedCounter() {
  const counter = document.getElementById("equippedCounter");
  if (counter) {
    counter.textContent = `${equippedPets.length}/2 echipați`;
  } else {
    console.warn("⚠️ equippedCounter element not found.");
  }
}

function applyEquippedPetEffects() {
  // 🧹 Reset all pet-related globals
  window.boticBoost = false;

  if (window.versaceInterval) {
    clearInterval(window.versaceInterval);
    window.versaceInterval = null;
  }

  if (window.jerryInterval) {
    clearInterval(window.jerryInterval);
    window.jerryInterval = null;
  }

  // 🔁 Apply effects for each equipped pet
  equippedPets.forEach(pet => {
    const effectFn = petEffects[pet.id];
    if (typeof effectFn === "function") {
      effectFn(); // Activate pet's boost
    }
  });
}

 
let isGamePaused = false;
const trapIntervals = new Map();
window.inventorySellMode = false; // When true, inventory is in sell mode
window.boticBoost = false; // true when Botic is equipped


 
const emojiDetails = { 
  "⚡": {
  name: "Fulger",
  type: "rau",
  effect: "Îți oferă un boost... direct spre eșec. Scorul tău scade cu 25, iar părul tău e acum permanent în flăcări.",
  score: -25,
  funny: "E ca o baterie stricată: promite mult, oferă NIMIC."
},

"🪓": {
  name: "Toporul Nebun",
  type: "rau",
  effect: "Un topor începe să se învârtă haotic și ricoșează de pereți până Te lovește . Fiecare lovitură scade 10 puncte. Poate ricoșa de până la 10 ori.",
  score: -10 ,
  funny: "E ca un boomerang, dar mai răzbunător și fără regrete.",
},

"💵": {
  name: "Bani lui Putin",
  type: "rau",
  effect: "Touché! În 3 secunde, un tanc rusesc cade din cer și îți șterge scorul. Putin apare și spune 'privet' înainte să explodeze tot.",
  score: -75,
  funny: "Acest emoji e interzis în 39 de țări. Și în camera ta."
},

  "🔥": {
    name: "Foc",
    type: "rau",
    effect: "Arde 10 puncte.",
    score: -10,
    funny: "Perfect pentru gătit... sau haos."
  },
"🧩": {
  name: "Puzzle al Destinului",
  type: "bun",
  effect: "Pornește un joc de memorie. Dacă câștigi, primești 25 puncte. Dacă pierzi... pierzi 75 scor, casa, mașina și sensul vieții.",
  score: 25,
  funny: "E doar un joc... "
},

  "🛰": {
    name: "Satelit",
    type: "rau",
    effect: "Detectează cele mai bune alegeri.",
    score: 10,
    funny: "Conectat direct la norocul tău."
  },
 "🍀": {
  name: "Trifoiul Mediocru",
  type: "bun",
  effect: "Pretinde că îți aduce noroc. În realitate... primești 25 puncte și o iluzie de speranță.",
  score: 25,
  funny: "Norocul tău a crescut cu 0.00001%. Felicitări, campionule."
},

"🖱️": {
  name: "Mouse Federal",
  type: "bun",
  effect: "Activează un autoclicker pentru 10 secunde. Apoi apar autoritățile pixelate și te bagă în pușcărie pentru clicuri ilegale.",
  score: 50,
  funny: "Felicitări! Ai câștigat 50 scor și o vizită în celulă. Nu scăpa săpunul🧼."
},

"👽": {
  name: "Extraterestru Șomer",
  type: "rau",
  effect: "Nu face nimic. Plimbă obiectele prin inventar ca să pară ocupat.",
  score: 0,
  funny: "Caută un loc de muncă în aplicația ta. CV disponibil la cerere."
},

"👾": {
  name: "Invadator Spațial",
  type: "bun",
  effect: "Pornește un joc de memorie... în spațiu. Dacă îl câștigi, primești 25 puncte. Dacă pierzi, te absoarbe într-o gaură neagră digitală și pierzi 75.",
  score: 25,
  funny: "E ca puzzle-ul, dar cu gravitație zero și șanse sub 1% să scapi viu."
},

"🚀": {
  name: "Rachetă Șomeră",
  type: "bun",
  effect: "Ar fi trebuit să te ducă în top scor… dar de când KevinUta a încercat s-o încalece, nu mai pornește.",
  score: 0,
  funny: "E pe concediu tehnic. Se caută șurub lipsă și încredere în sine."
},

"🧠": {
  name: "Creierul Suprem",
  type: "bun",
  effect: "Activează gândirea logică pentru 0.2 secunde. Doar cei cu coeficient peste IQ 9000 îl pot înțelege.",
  score: 15,
  funny: "Haterii de pe TikTok încă încearcă să găsească unul. Tu deja îl ai. Felicitări, legendă."
},

"✈️": {
  name: "Avionul lui Kevinută",
  type: "bun",
  effect: "Kevinută zboară cu avionul și aruncă bonusuri din cer. Din neatenție (sau nu), își aruncă și moderatorii TikTok. Sperăm că au parașută.",
  score: 2,
  funny: "A zis că doar testează gravitația. Acum 3 moderatori sunt offline... permanent."
},

"🛰️": {
  name: "Satelit Inutil",
  type: "bun",
  effect: "Te conectează la absolut nimic. Pierzi semnal, prieteni și voința de a continua. Nu câștigi și nu pierzi nimic... în afară de speranță.",
  score: 0,
  funny: "A promis conexiune 8G și internet nelimitat..."
},


 "🎰": { 
  name: "Păcănele Blestemate",
  type: "bun",
  effect: "Îți joacă punctele la noroc. 1% șansă să câștigi mare. 99% șansă să pierzi tot și să-ți promită că 'data viitoare merge'.",
  score: 0,
  funny: "E ca dragostea: te prinde frumos, apoi îți golește portofelul."
},

"💪": {
  name: "Forță Lunatică",
  type: "bun",
  effect: "Kevinuță devine invincibil pentru 20 secunde! Meteorii se topesc la atingere (999 DMG).",
  score: 0,
  funny: "E ca și cum ai combina proteină cu magie lunară."
},

"🪐": {
  name: "Quizul lui Saturn",
  type: "bun",
  effect: "Un test spațial cu 5 întrebări. Dacă răspunzi corect la toate, câștigi 50 puncte. Dacă greșești... pierzi 150 și ești teleportat într-un colț uitat al galaxiei.",
  score: 150,
  funny: "Cine știa că Saturn e fan Kahoot? Noroc, astronautule!"
},

};


const shopOffers = [
  { emoji: "🍀", price: 3, funny: "Un trifoi aproape norocos.", id: "luck" },
  { emoji: "🖱️", price: 10, funny: "Un mouse cu clicuri infinite...", id: "mouse" },
  { emoji: "🧠", price: 4, funny: "Creier semi-funcțional.", id: "brain" },
  { emoji: "📢", price: 10, funny: "Trimite un mesaj global tuturor jucătorilor.", id: "globalmsg" },
  {
    emoji: "😎",
    price: 8,
    funny: "Kevinuță își ia skin de firmă pentru 1 minut. Cineva are rubine!",
    id: "coolKev"
  },
  {
    emoji: "💱",
    price: 0,
    funny: "Schimbă 25 scor pe 1 rubin. Ideal pentru investitori!",
    id: "buyRubysForScore"
  },
{
  emoji: "🌀",
  price: 7,
  funny: "Ești confuz? Perfect. Așa și trebuie.",
  id: "invertScreen"
},
{
  emoji: "😁",
  price: 50,
  funny: "Cadou... sau nu? O SURPRIZĂ pentru toată lumea!",
  id: "rickGift"
},

{
  emoji: "🥚",
  price: 1,
  funny: "Un ou misterios... ce ascunde în el?",
  id: "mysteryEgg"
},

];


const petPool = [
  {
    id: "putin",
    name: "Putin",
    rarity: "Common",
    chance: 25,
    image: "https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/a3fd85e1-2d27-42c4-a885-60b01deccc9d/putin.png?format=500w",
    description: "E mereu cu ochii pe tine.",
    effect: "Nimic special."
  },
  {
    id: "zelensky",
    name: "Zelensky",
    rarity: "Uncommon",
    chance: 20,
    image: "https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/0ccb69ea-d93d-47cb-b675-0bce44bc7f4e/zelenski-removebg-preview.png?format=500w",
    description: "Rezistă ca nimeni altul.",
    effect: "Scade cooldown-ul acțiunilor."
  },
  {
    id: "eliot",
    name: "Eliot",
    rarity: "Rare",
    chance: 15,
    image: "https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/09828534-ca14-4338-b073-837e317e38d2/ELIOT.png?format=500w",
    description: "Nu-l întreba ce face.",
    effect: "Crește șansele de critici."
  },
  {
    id: "jerry",
    name: "Jerry",
    rarity: "Rare",
    chance: 15,
    image: "https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/68b95222-20e6-46b5-b96f-7dd072ab4b56/jerry.png?format=500w",
    description: "Haosul reîncarnat.",
   effect: "Nu știe dacă vrea să te ajute sau să te distrugă."
  },
  { 
    id: "panda",
    name: "Panda",
    rarity: "Epic",
    chance: 10,
    image: "https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/e7f2fd4e-6c4d-4238-b62a-8e90ffd27de2/panda-removebg-preview.png?format=500w",
    description: "Zen, dar mortal.",
    effect: "Crește drop rate-ul itemelor rare."
  },
  {
    id: "negri",
    name: "Negri",
    rarity: "Epic",
    chance: 10,
    image: "https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/576fe158-cb1a-4904-b629-ea9a2a10a1b7/negrut.png?format=500w",
    description: "E genul care sperie mai tare decât capcanele.",
    effect: "Are 50% șansă să sperie capcanele și să le facă să fugă de Kevinuța."
  },
  {
    id: "versace",
    name: "Versace",
    rarity: "Epic",
    chance: 8,
    image: "https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/6d29705a-57e6-474e-99b5-e3229522a9eb/Versace.png?format=500w",
    description: "Luxul întruchipat.",
    effect: "Crește venitul pasiv."
  },
  {
    id: "tonto",
    name: "Tonto",
    rarity: "Legendary",
    chance: 5,
    image: "https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/5c20441e-522c-456d-b552-6fc67ea2dce5/Tonto.png?format=500w",
    description: "Face ce vrea el.",
    effect: "Activează efecte aleatorii."
  },
  {
    id: "alpi",
    name: "Alpi",
    rarity: "Legendary",
    chance: 5,
    image: "https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/d25fc36b-1609-454b-a1c1-818d3e2c2e51/alpi-removebg-preview.png?format=500w",
    description: "Nimeni nu știe cine e.",
    effect: "Te ascunde din leaderboard."
  },
  {
    id: "botic",
    name: "Botic",
    rarity: "Mythical",
    chance: 1,
    image: "https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/c58dbb25-0daa-44cf-9b06-dac19c74e560/botic.png?format=500w",
    description: "Legendarul dintre legende.",
    effect: "Dublează tot ce câștigi."
  }
];

// 🧠 Pet effect system — only runs if a pet is equipped
const petEffects = {
  botic: () => {
    window.boticBoost = true;
    console.log("✨ Botic echipat — toate câștigurile sunt dublate!");
  },

negri: () => {
  console.log("😼 Negri activ: 50% șansă să sperie capcanele.");
  window.negriScareCheck = true;
},


  versace: () => {
    if (window.versaceInterval) clearInterval(window.versaceInterval);

    window.versaceInterval = setInterval(() => {
      if (window.username) {
        console.log("💎 Versace bonus activ: +1 ruby la fiecare 2 minute");
        addRubys(1);

        const msg = document.createElement("div");
        msg.textContent = "+1 RUBIN de la Versace 💼";
        Object.assign(msg.style, {
          position: "fixed",
          bottom: "80px",
          left: "50%",
          transform: "translateX(-50%)",
          background: "#222",
          color: "#ff66aa",
          padding: "8px 16px",
          borderRadius: "8px",
          fontWeight: "bold",
          fontSize: "16px",
          zIndex: 9999
        });
        document.body.appendChild(msg);
        setTimeout(() => msg.remove(), 3000);
      }
    }, 2 * 60 * 1000);
  },

jerry: () => {
  if (window.jerryInterval) clearInterval(window.jerryInterval);

  window.jerryInterval = setInterval(() => {
    console.log("🧪 Jerry ticked — giving a gift...");

    const roll = Math.random();

    if (roll < 0.4) { 
      const amount = Math.floor(Math.random() * 200) + 1;
      updateScore(amount);
      showGiftMessage(`🎁 Jerry ți-a adus +${amount} scor!`);

    } else if (roll < 0.7) {
      const rubies = Math.floor(Math.random() * 3) + 3; // 3–5
      addRubys(rubies);
      showGiftMessage(`💎 Jerry ți-a adus ${rubies} rubine!`);

    } else if (roll < 0.9) {
      const junkItems = [
        { emoji: "💩", msg: "Pentru că miroși suspect..." },
        { emoji: "🧻", msg: "În caz de urgență." },
        { emoji: "🪳", msg: "Compania perfectă pentru tine!" },
        { emoji: "🪱", msg: "Prieten nou pentru buzunarul tău." },
        { emoji: "🩲", msg: "Ți-au căzut pantalonii?" },
        { emoji: "🪦", msg: "Cadou... de la cineva mort?" },
        { emoji: "🧴", msg: "Șampon. Serios, chiar era nevoie." }
      ];
      const chosen = junkItems[Math.floor(Math.random() * junkItems.length)];
      showGiftMessage(`🗑 Jerry ți-a adus: ${chosen.emoji} — ${chosen.msg}`);

    } else {
      const funnyTraps = [
        { emoji: "🧀", msg: "Mucegai... delicios? Jerry! -50 scor ", effect: () => updateScore(-50) },
        { emoji: "🐍", msg: "Jerry ți-a lăsat un prieten... cu colți -150 scor.", effect: () => updateScore(-150) },
        { emoji: "🍆", msg: "Total inutil. Dar agresiv -30 scor.", effect: () => updateScore(-30) },
        { emoji: "👠", msg: "Un toc de 3kg zboară spre tine -80 scor.", effect: () => updateScore(-80) },
        { emoji: "💋", msg: "Un sărut... mortal -70.", effect: () => updateScore(-70) },
        { emoji: "🦷", msg: "Te-a prins la carii. -100 scor.", effect: () => updateScore(-100) },
        { emoji: "📞", msg: "Suna Vodafone. Nu răspunde! -60 scor", effect: () => updateScore(-60) },
        { emoji: "🦠", msg: "Jerry a scăpat o gripă virtuală -7 rubine.", effect: () => addRubys(-7) }
      ];

      const chosen = funnyTraps[Math.floor(Math.random() * funnyTraps.length)];
      spawnEmoji(chosen.emoji);
      showGiftMessage(`💣 Jerry a eliberat: ${chosen.emoji} — ${chosen.msg}`);
      chosen.effect();
    }

    // 🌕 Meteor shower if on the Moon
if (window.isOnMoon && !window.jerryMeteorActive) { 
  console.log("🌑 Jerry declanșează o ploaie de meteoriți!");

  showGiftMessage("🧲 Jerry a înghițit un magnet și a atras o ploaie de meteoriți spre tine. 📞 Sună-ți familia și spune-le că îi iubești.");

  window.jerryMeteorActive = true; // 🚫 prevent retrigger

  let count = 0;
  const meteorInterval = setInterval(() => {
    spawnMeteorite("☄️");
    count++;
    if (count >= 10) {
      clearInterval(meteorInterval);
      window.jerryMeteorActive = false; // ✅ allow future storms
    }
  }, 1000);
}


  }, 40000); // Every 3 seconds (test)
}

};



function getRandomPet() {
  const totalChance = petPool.reduce((acc, p) => acc + p.chance, 0);
  const roll = Math.random() * totalChance;
  let sum = 0;

  for (const pet of petPool) {
    sum += pet.chance;
    if (roll <= sum) return pet;
  }
  return petPool[0]; // fallback
}

function getRarityColor(rarity) {
  switch (rarity.toLowerCase()) {
    case "common": return "#aaaaaa";
    case "uncommon": return "#00cc00";
    case "rare": return "#00ccff";
    case "epic": return "#ff66cc"; // simplificăm pentru suport
    case "legendary": return "#ffaa00";
    case "mythical": return "#ff0000";
    default: return "#ffffff";
  }
}



function spawnPetFollower(pet) {
  const img = document.createElement("img");
  img.src = pet.image;
  img.alt = pet.name;
  img.className = "pet-follower";
  img.dataset.petId = pet.id; // 🔑 for matching later
  img.style.position = "absolute";
  img.style.width = "80px";
  img.style.zIndex = "1";
const gameArea = document.getElementById("gameArea");
if (gameArea) {
  gameArea.appendChild(img);
} else {
  document.body.appendChild(img); // fallback
}

  pet.dom = img; // still okay to keep for positioning
}




function removePetFollower(pet) {
  // Look for any pet image with matching pet ID
  const allPetImages = document.querySelectorAll(".pet-follower");

  allPetImages.forEach(el => {
    if (el.dataset.petId === pet.id) {
      el.remove();
    }
  });
}





function updatePetFollowerPosition(pet) {
  const kevin = document.getElementById("kevin");
  if (!kevin || !pet.dom) return;

  const kevinRect = kevin.getBoundingClientRect();
  const petRect = pet.dom.getBoundingClientRect();

  // Offset target position near Kevin
  const targetX = kevinRect.left + 60 + equippedPets.indexOf(pet) * 80;
  const targetY = kevinRect.top + 20;

  const currentX = petRect.left;
  const currentY = petRect.top;

  const dx = targetX - currentX;
  const dy = targetY - currentY;
  const distance = Math.sqrt(dx * dx + dy * dy);
  if (distance < 1) return;

  const speed = 12;
  const moveX = (dx / distance) * speed;
  const moveY = (dy / distance) * speed;

  pet.dom.style.left = `${currentX + moveX}px`;
  pet.dom.style.top = `${currentY + moveY}px`;

  // ✅ Pet should face Kevinuta
  if (kevinRect.left > petRect.left) {
    pet.dom.style.transform = "scaleX(-1)"; // Face right
  } else {
    pet.dom.style.transform = "scaleX(1)"; // Face left
  }
}




// — Firebase deja inițializat → const db = firebase.database();

// 1) Preia serverTimeOffset
async function fetchServerTimeMs() {
  const snap   = await db.ref(".info/serverTimeOffset").once("value");
  const offset = snap.val() || 0;
  return Date.now() + offset;
}
  
// 2) Ora București (0–23)
async function fetchBucharestHour() {
  const ms   = await fetchServerTimeMs();
  const date = new Date(ms);
  const fmt  = new Intl.DateTimeFormat("en-US", {
    timeZone: "Europe/Bucharest",
    hour12: false,
    hour: "2-digit"
  });
  return parseInt(fmt.format(date), 10);
}

// 3) URL PNG full-size
function pickBackgroundUrl(h) {
  // Morning: 6–11
  if (h >= 6 && h <= 11) {
    return "https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/e7c37518-746f-42d6-9ea6-e3f7b028ffdb/ChatGPT+Image+Jun+16%2C+2025%2C+10_03_26+PM.png";
  }
  // Noon: 12–17
  if (h >= 12 && h <= 17) {
    return "https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/7ecb7a41-6c85-4bae-922c-5ccde9e09cb7/ChatGPT+Image+Jun+16%2C+2025%2C+10_17_02+PM.png";
  }
  // Evening: 18–21
  if (h >= 18 && h <= 21) {
    return "https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/ea8cf05f-ac93-40f4-8686-e59e32ae94dc/ChatGPT+Image+Jun+16%2C+2025%2C+10_03_21+PM.png";
  }
  // Night: 22–23 & 0–5
  if (h >= 22 || h <= 5) {
    return "https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/147ce7dc-acfb-4e46-9530-38543788feef/Moonlit+Museum+Street+Scene.png";
  }
  // fallback
  console.warn("Ora invalida:", h);
  return "";
}


// 4) Preload & set dacă s-a schimbat
function setBackground(url) {
  const el = document.getElementById("gameArea");
  if (el.dataset.bg === url) return;
  const img = new Image();
  img.onload = () => {
    el.style.backgroundImage = `url('${url}')`;
    el.dataset.bg = url;
  };
  img.src = url + (url.includes('?') ? '&' : '?') + '_t=' + Date.now();
}

// → Override de test pentru oră
window.__testHour = null;    // null = foloseşte ora reală
window.isOnMoon = false;  // Dacă ești pe lună, fundalul normal NU se mai schimbă
window.testTime = function(h) {
  window.__testHour = h;     // setează ora de test (0–23)
  updateBackground();        // forţează update imediat
};

// Apoi, modifică fetchBucharestHour() astfel:
async function fetchBucharestHour() {
  if (typeof window.__testHour === 'number') {
    return window.__testHour; // override pentru test
  }
  const ms   = await fetchServerTimeMs();
  const date = new Date(ms);
  const fmt  = new Intl.DateTimeFormat("en-US", {
    timeZone: "Europe/Bucharest",
    hour12: false,
    hour: "2-digit"
  });
  return parseInt(fmt.format(date), 10);
}

// 5) Update rutina
async function updateBackground() {
  if (window.isOnMoon) return;  // Dacă ești pe lună, nu schimba fundalul

  try { 
    const hour = await fetchBucharestHour();
    setBackground(pickBackgroundUrl(hour));
  } catch (err) { 
    console.error("Eroare oră server:", err);  
  }
}

function enterMoonZone() {
  window.isOnMoon = true;
  setBackground("https://link-catre-fundalul-lunii.png");  // Înlocuiește cu linkul tău real pentru fundalul de pe lună
}

function exitMoonZone() {
  window.isOnMoon = false;
  updateBackground();  // Când ieși de pe lună, fundalul normal se aplică la loc
}


function showCombo(x, y, count) {
  if (window.boticBoost) count *= 2;
  const el = document.createElement("div");
  el.textContent = `x${count}`;
  el.style.position = "absolute";
  el.style.left = `${x}px`;
  el.style.top = `${y}px`;
  el.style.color = "#00d4ff"; 
  el.style.fontSize = "32px";
  el.style.fontWeight = "bold";
  el.style.zIndex = 9999;
  el.style.textShadow = "0 0 6px #00d4ff, 0 0 12px #00d4ff";
  el.style.pointerEvents = "none";
  el.style.transform = "translate(-50%, -50%)";
  el.style.opacity = "1";
  el.style.transition = "transform 1.5s ease-out, opacity 1.5s ease-out";

  document.body.appendChild(el);

  setTimeout(() => {
    el.style.transform = "translate(-50%, -150%) scale(1.5)";
    el.style.opacity = "0";
  }, 10);
 
  setTimeout(() => {
    el.remove();
  }, 1600);

  checkComboMilestones(count);
}


function showGlobalMessage(text, sender = "Anonim", duration = 10000) {
  const banner = document.getElementById("globalMessageBanner");
  banner.innerHTML = `
    <div class="global-label">📢 Mesaj Global de la <b>${sender}</b></div>
    <div class="global-text">${text}</div>
  `;
  banner.style.display = "block";
  banner.style.opacity = "1";
  banner.style.transform = "translateX(-50%) translateY(0)";
  banner.style.transition = "none";

  setTimeout(() => {
    banner.style.transition = "opacity 0.5s, transform 0.5s";
    banner.style.opacity = "0";
    banner.style.transform = "translateX(-50%) translateY(-20px)";
  }, duration - 500);

  setTimeout(() => {
    banner.style.display = "none";
  }, duration); 
}






function checkComboMilestones(count) {
  const milestones = {
    10: "🍼 Abia ai început... dar bravo, ai dat 10 clicuri.",
    50: "🔥 Rapid ca fulgerul!",
    75: "⚡ Deja simți că-ți crapă degetul? Perfect.",
    150: "💥 Nu ești legendă, dar măcar îți ruinezi mouse-ul.",
    200: "🚀 Bun venit în clubul 'Am prea mult timp liber'.",
    400: "🌟 Deja e clar că nu te mai poți opri, nu?",
    600: "👑 Ai câștigat titlul de 'Regele Obsesiei'.",
    800: "💀 Ți-ai vândut sufletul pentru clicuri. Respect.",
    1000: "🖱️ 1500 de clicuri? Hmm... sigur n-ai băgat un autoclicker pe furiș?"
  };

  const milestoneSounds = {
    10: "https://ksdapromovarii.squarespace.com/s/De-Abia-ai-inceput.opus",
    50: "https://ksdapromovarii.squarespace.com/s/radpid-ca-fulgerul.opus",
    75: "https://ksdapromovarii.squarespace.com/s/deja-este-clar.opus",
    150: "https://ksdapromovarii.squarespace.com/s/nu-esti-o-legenda.opus",
    200: "https://ksdapromovarii.squarespace.com/s/bun-venit-in-clubul-am-prea-mult-timp-liber.opus",
    400: "https://ksdapromovarii.squarespace.com/s/deja-este-clar-xj2z.opus",
    600: "https://ksdapromovarii.squarespace.com/s/regele-oboseli.opus",
    800: "https://ksdapromovarii.squarespace.com/s/ti-ai-vandut-sufletl-pentru-clickuri.opus",
    1000: "https://ksdapromovarii.squarespace.com/s/10000.opus"
  };

  if (milestones[count]) {
    const msgEl = document.createElement("div");
    msgEl.textContent = milestones[count];
    msgEl.style.position = "fixed";
    msgEl.style.top = "50%";
    msgEl.style.left = "50%";
    msgEl.style.transform = "translate(-50%, -50%)";
    msgEl.style.color = "#ffffff";
    msgEl.style.fontSize = "22px";
    msgEl.style.fontWeight = "bold";
    msgEl.style.padding = "10px 20px";
    msgEl.style.background = "rgba(0, 0, 0, 0.7)";
    msgEl.style.border = "1px solid #00d4ff"; 
    msgEl.style.borderRadius = "8px";
    msgEl.style.textShadow = "0 0 6px #00d4ff, 0 0 12px #00d4ff";
    msgEl.style.zIndex = 10000;
    msgEl.style.opacity = "1";
    msgEl.style.transition = "transform 2s ease, opacity 2s ease";

    document.body.appendChild(msgEl);

    setTimeout(() => {
      msgEl.style.transform = "translate(-50%, -150%) scale(1.2)";
      msgEl.style.opacity = "0";
    }, 2000);

    setTimeout(() => {
      msgEl.remove();
    }, 4000);

    if (milestoneSounds[count]) {
      const audio = new Audio(milestoneSounds[count]);
      audio.play().catch(err => console.warn("Eroare audio:", err));
    }
  }

  // ✅ Give rubys at 250, 500, 750, etc. with animation
  if (count > 0 && count % 150 === 0) {
 triggerRubyDiscovery(1); 
    addRubys(1);

    // 🎯 Show ruby scoreboard if hidden
    const rubyBoard = document.getElementById("rubyBoard");
    if (rubyBoard && rubyBoard.style.display !== "flex") {
      rubyBoard.style.display = "flex";
      setTimeout(() => rubyBoard.style.opacity = "1", 50);
    }

    // 💎 Launch flying ruby animation
    if (typeof launchFlyingRuby === "function") {
      setTimeout(() => launchFlyingRuby(1), 300);
    }
  }
}
 


function followKevinuta(trap) {
  const interval = setInterval(() => {
    const kevin = document.getElementById('kevin');
    if (!kevin || !trap) return;

    const kRect = kevin.getBoundingClientRect();
    const tRect = trap.getBoundingClientRect();
    const dx = (kRect.left + kRect.width / 2) - (tRect.left + tRect.width / 2);
    const dy = (kRect.top + kRect.height / 2) - (tRect.top + tRect.height / 2);
    const dist = Math.hypot(dx, dy);

    if (dist < 2) return;

    const speed = 100;
    const isScared = trap.classList.contains("negri-scared");
    const moveX = (dx / dist) * speed * (isScared ? -1 : 1);
    const moveY = (dy / dist) * speed * (isScared ? -1 : 1);

    trap.style.left = `${trap.offsetLeft + moveX}px`;
    trap.style.top = `${trap.offsetTop + moveY}px`;

    // 🗨️ Make the bubble follow the trap
    if (isScared && trap.bubble) {
      const tNow = trap.getBoundingClientRect();
      trap.bubble.style.left = `${tNow.left + tNow.width / 2}px`;
      trap.bubble.style.top = `${tNow.top - 20}px`;
    }

    // ⛔ Do NOT trigger trap if it's scared
    if (!isScared) {
      const tNow = trap.getBoundingClientRect();
      if (
        tNow.left < kRect.right && tNow.right > kRect.left &&
        tNow.top < kRect.bottom && tNow.bottom > kRect.top
      ) {
        activateTrap(trap);
        clearInterval(interval);
        trapIntervals.delete(trap);
        if (trap.bubble) trap.bubble.remove(); // clean up bubble too
      }
    }

  }, 30);

  return interval;
}



function activateTrap(trap) {
  if (!trap || trap.dataset.activated === "true") return;
  trap.dataset.activated = "true";

  const emoji = trap.textContent.trim();
addToInventory(emoji);
  trap.remove(); // remove from screen

  startEscapeMiniGame(emoji); // 🧠 play mini-game instead of auto-activating
}


function startEscapeMiniGame(emoji) {
  const miniGame = document.getElementById("escapeMiniGame");
  const progressBar = document.getElementById("escapeProgress");
  const emojiInBar = document.getElementById("escapeEmojiInBar");
  const clickBtn = document.getElementById("escapeClickBtn");

  let progress = 50;
  let interval = null;

  emojiInBar.textContent = emoji;
  miniGame.style.display = "flex";
  updateUI();

  function updateUI() {
    progressBar.style.width = `${progress}%`;
    emojiInBar.style.left = `${progress}%`;

    if (progress >= 90) {
      progressBar.style.animation = "pulseBar 0.4s infinite alternate";
    } else {
      progressBar.style.animation = "none";
    }
  }

function updateBar() {
const decayRate = window.isOnMoon ? 2.2 : 1.5;
  progress -= decayRate;

  if (progress <= 0) {
    endMiniGame(false);
  } else if (progress >= 100) {
    endMiniGame(true);
  } else {
    updateUI();
  }
}


function onClick() {
  let boost = 5;
  if (window.boticBoost) boost *= 2;

  progress += boost;

  if (progress >= 100) {
    progress = 100;
    updateUI();
    endMiniGame(true);
    return;
  }

  updateUI();
}

  interval = setInterval(updateBar, 100);
  if (clickBtn) clickBtn.addEventListener("click", onClick); // ✅ corect — doar butonul

  function endMiniGame(success) {
    clearInterval(interval);
    if (clickBtn) clickBtn.removeEventListener("click", onClick);
    miniGame.style.display = "none";

    const msg = document.createElement("div");
    msg.textContent = success ? "✅ AI SCĂPAT!" : " GHINION! NU AI SCĂPAT!";
    msg.style.position = "fixed";
    msg.style.bottom = "120px";
    msg.style.left = "50%";
    msg.style.transform = "translateX(-50%)";
    msg.style.color = success ? "#00ff88" : "#ff4444";
    msg.style.fontSize = "20px";
    msg.style.fontWeight = "bold";
    msg.style.zIndex = 10060;
    document.body.appendChild(msg);
    setTimeout(() => msg.remove(), 1500);

    if (!success && emojiEvents[emoji]?.effect) {
      emojiEvents[emoji].effect();
    }
  }
}



function startMemoryGame() {
  const game = document.getElementById('memoryGame');
  const grid = document.getElementById('memoryGrid');
  const timer = document.getElementById('memoryTimer');

  // Create or clear result message
  let resultMsg = document.getElementById('memoryResult');
  if (!resultMsg) {
    resultMsg = document.createElement('div');
    resultMsg.id = 'memoryResult';
    resultMsg.style.marginTop = '12px';
    resultMsg.style.fontSize = '18px';
    resultMsg.style.fontWeight = 'bold';
    resultMsg.style.textAlign = 'center';
    game.appendChild(resultMsg);
  }
  resultMsg.textContent = '';

  game.style.display = 'flex';

  const emojis = ['🌌', '🪐', '🛸', '👽', '🚀', '🌠']; // 6 pairs = 12 cards
  const pairs = [...emojis, ...emojis];
  const shuffled = pairs.sort(() => Math.random() - 0.5);

  let flipped = [];
  let matched = 0;
let seconds = 30;

  grid.innerHTML = '';
  timer.textContent = `⏱️ ${seconds}`;

  shuffled.forEach((symbol) => {
    const card = document.createElement('div');
    card.classList.add('memory-card');
    card.dataset.symbol = symbol;
    card.textContent = '?';

    card.addEventListener('click', () => {
      if (card.classList.contains('matched') || flipped.includes(card)) return;

      card.textContent = symbol;
      card.classList.add('revealed');
      flipped.push(card);

      if (flipped.length === 2) {
        const [a, b] = flipped;
        if (a.dataset.symbol === b.dataset.symbol) {
          a.classList.add('matched');
          b.classList.add('matched');
          matched += 2;
        } else {
          setTimeout(() => {
            a.textContent = '?';
            b.textContent = '?';
            a.classList.remove('revealed');
            b.classList.remove('revealed');
          }, 600);
        }
        flipped = [];
      }

      if (matched === 12) {
        endMemoryGame(true);
      }
    });

    grid.appendChild(card);
  });

  const countdown = setInterval(() => {
    seconds--;
    timer.textContent = `⏱️ ${seconds}`;
    if (seconds <= 0) {
      clearInterval(countdown);
      endMemoryGame(false);
    }
  }, 1000);

  function endMemoryGame(win) {
    clearInterval(countdown);

    // Show result message
    if (win) {
      resultMsg.textContent = "✅ AI CÂȘTIGAT +35 PUNCTE!";
      resultMsg.style.color = "#00ff88";
      updateScore(35);
    } else {
      resultMsg.textContent = "❌ AI PIERDUT -100 PUNCTE!";
      resultMsg.style.color = "#ff4444";
      updateScore(-100);
    }

    // Optional: Add a close button or hide after delay
    setTimeout(() => {
      game.style.display = 'none';
      resultMsg.textContent = '';
    }, 3000);
  }
}



function startMemoryGameClassic() {
  const game = document.getElementById('memoryGameClassic');
  const grid = document.getElementById('memoryGridClassic');
  const timer = document.getElementById('memoryTimerClassic');
  const resultMsg = document.getElementById('memoryResultClassic');

  game.style.display = 'flex';
  resultMsg.textContent = '';

  const emojis = ['🍎', '🍌', '🍓', '🍇', '🍉', '🥝']; // Classic food emojis
  const pairs = [...emojis, ...emojis];
  const shuffled = pairs.sort(() => Math.random() - 0.5);

  let flipped = [];
  let matched = 0;
  let seconds = 30;

  grid.innerHTML = '';
  timer.textContent = `⏱️ ${seconds}`;

  shuffled.forEach(symbol => {
    const card = document.createElement('div');
    card.classList.add('memory-card');
    card.dataset.symbol = symbol;
    card.textContent = '?';

    card.addEventListener('click', () => {
      if (card.classList.contains('matched') || flipped.includes(card)) return;

      card.textContent = symbol;
      card.classList.add('revealed');
      flipped.push(card);

      if (flipped.length === 2) {
        const [a, b] = flipped;
        if (a.dataset.symbol === b.dataset.symbol) {
          a.classList.add('matched');
          b.classList.add('matched');
          matched += 2;
        } else {
          setTimeout(() => {
            a.textContent = '?';
            b.textContent = '?';
            a.classList.remove('revealed');
            b.classList.remove('revealed');
          }, 600);
        }
        flipped = [];
      }

      if (matched === 12) {
        endGame(true);
      }
    });

    grid.appendChild(card);
  });

  const countdown = setInterval(() => {
    seconds--;
    timer.textContent = `⏱️ ${seconds}`;
    if (seconds <= 0) {
      clearInterval(countdown);
      endGame(false);
    }
  }, 1000);

  function endGame(win) {
    clearInterval(countdown);
    resultMsg.textContent = win
      ? "✅ AI CÂȘTIGAT +20 PUNCTE!"
      : "❌ AI PIERDUT -50 PUNCTE!";
    resultMsg.style.color = win ? "#00ff88" : "#ff4444";
    updateScore(win ? 20 : -50);
    setTimeout(() => {
      game.style.display = 'none';
      resultMsg.textContent = '';
    }, 3000);
  }
}


// 6) Execuție la load și la interval de 5’
window.addEventListener("load", () => {
  // ⏰ Dynamic background updates
  updateBackground();
  setInterval(updateBackground, 5 * 60 * 1000);

  // 🌀 Global invert screen handler
  window.lastInvertTimestamp = 0;

  firebase.database().ref("globalEffects/invertScreen").on("value", snapshot => {
    const data = snapshot.val();
    if (!data) return;

    if (data.timestamp <= window.lastInvertTimestamp) return;
    window.lastInvertTimestamp = data.timestamp;

    // Show global message
    showGlobalMessage(`🌀 ${data.triggeredBy} a întors lumea cu susul în jos!`, "Sistem", 5000);

    // ROTATE screen
    document.body.style.transition = "transform 0.8s ease";
    document.body.style.transform = "rotate(180deg)";

    setTimeout(() => {
      document.body.style.transform = "rotate(0deg)";
    }, 10000); // revert after 10 seconds
  });

  // 🎁 RickGift global handler
  let lastRickGiftTime = 0;

  firebase.database().ref("globalEffects/rickGift").on("value", snapshot => {
    const data = snapshot.val();
    if (!data) return;

    if (data.timestamp <= lastRickGiftTime) return;
    lastRickGiftTime = data.timestamp;

    showRickGiftPopup(data.by);
setTimeout(() => {
  firebase.database().ref("globalEffects/rickGift").remove();
}, 5000);

  });
  // 🐾 Move equipped pets to follow Kevinuta
  setInterval(() => {
    equippedPets.forEach(pet => updatePetFollowerPosition(pet));
  }, 100);

});




// ✅ Add rubys and trigger discovery if it's the first time
function addRubys(amount) {
  if (!username) return;
  if (window.boticBoost) amount *= 2;


  const ref = firebase.database().ref(`users/${username}/rubys`);

  ref.transaction(current => {
    const isFirstTime = !current || current === 0;
    const newTotal = (current || 0) + amount;

    if (isFirstTime) {
      triggerRubyDiscovery(amount);
    }

    return newTotal;
  });
}

function showGiftMessage(text) {
  const msg = document.createElement("div");
  msg.textContent = text;
  Object.assign(msg.style, {
    position: "fixed",
    bottom: "80px",
    left: "50%",
    transform: "translateX(-50%)",
    background: "#222",
    color: "#ff66aa",
    padding: "8px 16px",
    borderRadius: "8px",
    fontWeight: "bold",
    fontSize: "16px",
    zIndex: 9999
  });
  document.body.appendChild(msg);
  setTimeout(() => msg.remove(), 4000);
}


// ✅ FUNCTION B: Save pet to Firebase inventory
function addPetToInventory(pet) {
  if (!username || !pet || !pet.id) return;
  const userPetsRef = firebase.database().ref(`users/${username}/pets/${pet.id}`);
  userPetsRef.set({
    name: pet.name,
    image: pet.image,
    rarity: pet.rarity,
    obtainedAt: Date.now()
  });
}


// ✅ Spend rubys (if enough)
function spendRubys(amount) {
  if (!username) return;

  const ref = firebase.database().ref(`users/${username}/rubys`);

  ref.transaction(current => {
    if ((current || 0) >= amount) {
      return (current || 0) - amount;
    } else {
      return current; // not enough
    }
  }); 
}

function triggerRubyDiscovery(amount) {
  if (username) {
    firebase.database().ref(`users/${username}/rubyDiscovered`).set(true);
  }

  // ✅ Show discovery message properly
  showRubyDiscoveryOverlay("O forță antică a fost trezită... Rubinele au fost descoperite!");

  const board = document.getElementById("rubyBoard");
  setTimeout(() => {
    board.style.display = "flex";
    setTimeout(() => board.style.opacity = "1", 50);
  }, 800);

  setTimeout(() => launchFlyingRuby(amount), 900);
}


function createRainbowOverlay() {
  const existing = document.getElementById("rainbowOverlay");
  if (existing) existing.remove(); // Avoid duplicates

  const overlay = document.createElement("div");
  overlay.id = "rainbowOverlay";
  document.body.appendChild(overlay);

  // Auto-remove after 8 seconds
  setTimeout(() => overlay.remove(), 8000);
}


function showRickGiftPopup(by) {
  const popup = document.createElement("div");
  popup.innerHTML = `
    <div style="
      position:fixed;top:0;left:0;width:100vw;height:100vh;
      background:rgba(0,0,0,0.85);color:white;display:flex;
      flex-direction:column;justify-content:center;align-items:center;
      z-index:100000;font-size:20px;font-family:sans-serif;
      text-align:center;gap:20px;">
      <div><b>${by}</b> a oferit <span style="color:#ff66aa">50 Rubine</span> tuturor jucătorilor!</div>
      <button id="claimRickGift" style="
        padding:12px 24px;background:#ff66aa;border:none;border-radius:8px;
        color:white;font-size:18px;cursor:pointer;box-shadow:0 0 12px #ff66aa;">
        🎁 CLAIM 🎁
      </button>
    </div>
  `;
  document.body.appendChild(popup);

  const claimBtn = popup.querySelector("#claimRickGift");
claimBtn.addEventListener("click", () => {
  // 🔊 Manual Rickroll play
  const audio = new Audio("https://ksdapromovarii.squarespace.com/s/rick-roll-bass-boosted_ZPqkNIT.mp3");
  audio.volume = 1;
  audio.play().catch(err => console.warn("Audio play failed:", err));

  // 🌀 Screen shake
  const shakeInterval = setInterval(() => {
    const x = Math.random() * 30 - 15;
    const y = Math.random() * 30 - 15;
    document.body.style.transform = `translate(${x}px, ${y}px)`;
  }, 50);

  setTimeout(() => {
    clearInterval(shakeInterval);
    document.body.style.transform = "";
  }, 8000);

  // 🌈 Rainbow overlay
  createRainbowOverlay();


  // ❌ Remove popup
  popup.remove();
});


}



// ✅ Animate ruby flying to scoreboard
function launchFlyingRuby(amount = 1) {
  const icon = document.createElement("img");
  icon.src = "https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/6601e0a9-5671-4016-a4f3-cb9b2d3d70ab/diamond+red.png?format=500w";
  icon.style.position = "fixed";
  icon.style.width = "36px";
  icon.style.height = "36px";
  icon.style.zIndex = 9999;

  const startX = window.innerWidth / 2;
  const startY = window.innerHeight / 2;
  icon.style.left = `${startX}px`;
  icon.style.top = `${startY}px`;
  icon.style.transition = "all 0.9s ease-in-out";
  icon.style.transform = "scale(1.2)";
  document.body.appendChild(icon);

  const rubyBox = document.getElementById("rubyBoard");
  const rect = rubyBox.getBoundingClientRect();
  const destX = rect.left + rect.width / 2;
  const destY = rect.top + rect.height / 2;

  setTimeout(() => {
    icon.style.left = `${destX}px`;
    icon.style.top = `${destY}px`;
    icon.style.opacity = "0";
    icon.style.transform = "scale(0.4)";
  }, 20);

  setTimeout(() => {
    icon.remove();
    rubyBox.classList.remove("ruby-impact");
    void rubyBox.offsetWidth;
    rubyBox.classList.add("ruby-impact");
  }, 1000);
}

// ✅ Show ruby scoreboard on page load if player has rubys
window.addEventListener("load", () => {
  if (username) {
    const rubyRef = firebase.database().ref(`users/${username}/rubys`);

    rubyRef.on("value", snapshot => {
      const rubys = snapshot.val() || 0;
      const rubyCount = document.getElementById("rubyCount");
      if (rubyCount) rubyCount.textContent = rubys;

      if (rubys > 0) {
        const rubyBoard = document.getElementById("rubyBoard");
        rubyBoard.style.display = "flex";
        setTimeout(() => rubyBoard.style.opacity = "1", 50);
      }
    });
  }
});


function showRubyDiscoveryOverlay(text = " O forță antică a fost trezită... Rubinele au fost descoperite!") {
  // Create the full overlay
  const overlay = document.createElement("div");
  overlay.id = "rubyOverlay";
  Object.assign(overlay.style, {
    position: "fixed",
    top: "0",
    left: "0",
    width: "100vw",
    height: "100vh",
    backgroundColor: "rgba(0, 0, 0, 0.9)",
    display: "flex",
    flexDirection: "column",
    justifyContent: "center",
    alignItems: "center",
    zIndex: "99999",
    opacity: "0",
    transition: "opacity 0.6s ease"
  });

  // Create ruby icon
  const rubyImg = document.createElement("img");
  rubyImg.src = "https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/6601e0a9-5671-4016-a4f3-cb9b2d3d70ab/diamond+red.png?format=500w";
  rubyImg.alt = "Ruby";
  rubyImg.style.width = "100px";
  rubyImg.style.marginBottom = "20px";
  rubyImg.style.opacity = "0";
  rubyImg.style.transition = "opacity 1s ease";

  // Create text
  const msg = document.createElement("div");
  msg.textContent = text;
  msg.style.color = "#ff66aa";
  msg.style.fontSize = "24px";
  msg.style.textAlign = "center";
  msg.style.maxWidth = "80%";
  msg.style.marginBottom = "30px";
  msg.style.opacity = "0";
  msg.style.transition = "opacity 1s ease";

  // Create OK button
  const okBtn = document.createElement("button");
  okBtn.textContent = "OK";
  Object.assign(okBtn.style, {
    padding: "12px 30px",
    fontSize: "18px",
    fontWeight: "bold",
    backgroundColor: "#ff66aa",
    color: "white",
    border: "none",
    borderRadius: "8px",
    cursor: "pointer",
    boxShadow: "0 0 10px #ff66aa",
    opacity: "0",
    transition: "opacity 1s ease"
  });

  okBtn.onclick = () => { 
    overlay.style.opacity = "0";
    setTimeout(() => overlay.remove(), 600);
  };

  overlay.appendChild(rubyImg);
  overlay.appendChild(msg);
  overlay.appendChild(okBtn);
  document.body.appendChild(overlay);

  // Animate in
  requestAnimationFrame(() => {
    overlay.style.opacity = "1";
    setTimeout(() => {
      rubyImg.style.opacity = "1";
      msg.style.opacity = "1";
      okBtn.style.opacity = "1";
    }, 400);
  });
}

function showEggOverlay() {
  let clickCount = 0;

  const overlay = document.createElement("div");
  overlay.id = "eggOverlay";
  Object.assign(overlay.style, {
    position: "fixed",
    top: "0",
    left: "0",
    width: "100vw",
    height: "100vh",
    backgroundColor: "rgba(0, 0, 0, 0.88)",
    display: "flex",
    flexDirection: "column",
    justifyContent: "center",
    alignItems: "center",
    zIndex: "99999",
    opacity: "0",
    transition: "opacity 0.5s ease"
  });

  const messages = [
    "Ce ou ciudat... 🤨",
    "Oare ce ascunde?",
    "Se crapă! Ține-te bine!"
  ];

  const title = document.createElement("div");
  title.textContent = messages[0];
  Object.assign(title.style, {
    color: "#ffffff",
    fontSize: "26px",
    marginBottom: "10px",
    textAlign: "center",
    textShadow: "0 0 6px #ffffff",
    minHeight: "30px"
  });

  const counter = document.createElement("div");
  counter.textContent = `Clickuri: 0/3`;
  Object.assign(counter.style, {
    color: "#bbbbbb",
    fontSize: "16px",
    marginBottom: "20px"
  });

  const eggImg = document.createElement("img");
  eggImg.src = "https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/2ddff3f8-f72b-4d49-b956-90120491d8be/3e2d9e26-2fc5-4974-ad6f-792624a1cf41_removalai_preview.png?format=500w";
  eggImg.style.width = "120px";
  eggImg.style.cursor = "pointer";
  eggImg.style.transition = "transform 0.2s";

  // ✅ Declare OK button once, outside the condition
  const okBtn = document.createElement("button");
  okBtn.textContent = "OK";
  Object.assign(okBtn.style, {
    marginTop: "20px",
    padding: "6px 14px",
    fontSize: "16px",
    cursor: "pointer"
  });

  let closed = false;
  function closeOverlay() {
    if (closed) return;
    closed = true;
    overlay.style.opacity = "0";
    setTimeout(() => overlay.remove(), 500);
  }
  okBtn.onclick = closeOverlay;

  eggImg.addEventListener("click", () => {
    if (clickCount >= 3) return;

    clickCount++;
    eggImg.style.transform = "scale(1.1)";
    setTimeout(() => eggImg.style.transform = "scale(1)", 1000);

    if (clickCount < 3) {
      title.textContent = messages[clickCount] || "";
    }

    counter.textContent = `Clickuri: ${clickCount}/3`;

    if (clickCount === 3) {
      title.textContent = "🥚 Oul s-a spart!";
      overlay.style.opacity = "1"; // keep visible

      const pet = getRandomPet();
      addPetToInventory(pet);

      title.textContent = `🎉 Ai primit: ${pet.name}`;
      eggImg.src = pet.image;

      if (counter) counter.remove();

      const rarityText = document.createElement("div");
      rarityText.textContent = `${pet.rarity} — ${pet.chance}/100`;
      Object.assign(rarityText.style, {
        marginTop: "10px",
        fontSize: "20px",
        color: getRarityColor(pet.rarity),
        textShadow: "0 0 6px black"
      });

      overlay.appendChild(rarityText);
      overlay.appendChild(okBtn);
    }
  });

  overlay.appendChild(title);
  overlay.appendChild(counter);
  overlay.appendChild(eggImg);
  document.body.appendChild(overlay);

  requestAnimationFrame(() => overlay.style.opacity = "1");
}





window.addEventListener("load", () => {
  const toggleBtn = document.getElementById("toggleUIBtn");
  const fullscreenBtn = document.getElementById("fullscreenBtn");
  const pauseBtn = document.getElementById("pauseBtn");

  document.getElementById("dialogBar").style.display = "none";
  document.getElementById("dialogAvatar").style.display = "none";

  pauseBtn.addEventListener("click", () => {
    window.isGamePaused = !window.isGamePaused;
    console.log(window.isGamePaused ? "⏸️ Game paused" : "▶️ Game resumed");
  });

  const soundBtn = document.getElementById("openSoundBtn");
  const top100Btn = document.getElementById("top100Btn");
  const musicToggle = document.getElementById("musicToggle");
  const kevinToggle = document.getElementById("kevinSoundToggle");
  const inventoryBtn = document.getElementById("inventoryBtn");

  const buttons = [fullscreenBtn, pauseBtn, soundBtn, top100Btn, inventoryBtn];

inventoryBtn.addEventListener("click", () => {
  const popup = document.getElementById("inventoryPopup");
  if (!popup) {
    console.warn("⚠️ inventoryPopup not found");
    return;
  }

  popup.style.display = "flex";

  // 🐾 Also show the Pets tab by default
  const tabItems = document.getElementById("tabItems");
  const tabPets = document.getElementById("tabPets");
  const itemsSection = document.getElementById("itemsSection");
  const petsSection = document.getElementById("petsSection");

if (tabPets && tabItems && petsSection && itemsSection) {
  tabPets.classList.add("active");
  tabItems.classList.remove("active");
  petsSection.style.display = "block";
  itemsSection.style.display = "none";
}

// 🚨 Încărcăm animalele indiferent de tab-ul inițial
setTimeout(() => {
  loadPetsIntoInventory();
}, 100);

});


  window.musicEnabled = localStorage.getItem("musicEnabled") === "true";
  window.kevinSoundsEnabled = localStorage.getItem("kevinSoundsEnabled") === "true";
  musicToggle.checked = window.musicEnabled;
  kevinToggle.checked = window.kevinSoundsEnabled;

  musicToggle.addEventListener("change", function () {
    window.musicEnabled = this.checked;
    localStorage.setItem("musicEnabled", window.musicEnabled);
  });

  kevinToggle.addEventListener("change", function () {
    window.kevinSoundsEnabled = this.checked;
    localStorage.setItem("kevinSoundsEnabled", window.kevinSoundsEnabled);
  });

  buttons.forEach(btn => btn.style.display = "none");

  let uiVisible = false;

  toggleBtn.addEventListener("click", () => {
    const toggleRect = toggleBtn.getBoundingClientRect();

    buttons.forEach(btn => {
      const btnRect = btn.getBoundingClientRect();
      const dx = toggleRect.left - btnRect.left;
      const dy = toggleRect.top - btnRect.top;

      btn.style.setProperty('--dx', `${dx}px`);
      btn.style.setProperty('--dy', `${dy}px`);

      if (!uiVisible) {
        btn.style.display = "block";
        btn.classList.remove("ui-animate-out");
        btn.classList.add("ui-animate-in");
      } else {
        btn.classList.remove("ui-animate-in");
        btn.classList.add("ui-animate-out");
        btn.addEventListener("animationend", function handler() {
          btn.style.display = "none";
          btn.removeEventListener("animationend", handler);
        });
      }
    });

    uiVisible = !uiVisible;
  });

  // ✅ PETS/ITEMS TAB HANDLER
  const tabItems = document.getElementById("tabItems");
  const tabPets = document.getElementById("tabPets");
  const itemsSection = document.getElementById("itemsSection");
  const petsSection = document.getElementById("petsSection");

tabPets.addEventListener('click', () => {
  tabPets.classList.add("active");
  tabItems.classList.remove("active");

  itemsSection.style.display = "none";
  petsSection.style.display = "block";

  // Always reload pets when switching back
  setTimeout(() => {
    loadPetsIntoInventory();
  }, 50);
});







// ✅ This version prevents the crash and stacks pets
function loadPetsIntoInventory() {
  // ✅ Inject fixed 4-column CSS grid style
  if (!document.getElementById("inventoryGridStyle")) {
    const style = document.createElement("style");
    style.id = "inventoryGridStyle";
style.textContent = `
  .inventory-grid {
    display: grid !important;
    grid-template-columns: repeat(3, 1fr) !important;
    gap: 12px;
    padding: 12px;
    justify-items: center;
    box-sizing: border-box;
  }

  .inventory-card {
    width: 70px;
    height: 70px;
    background: #1a1a1a;
    border-radius: 12px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    box-sizing: border-box;
    cursor: pointer;
    border: 2px solid #444;
    box-shadow: 0 0 6px rgba(0,0,0,0.4);
  }

  .inventory-card img {
    width: 36px;
    height: 36px;
  }

  .inventory-card div {
    margin-top: 4px;
    font-size: 13px;
    color: white;
  }
`;

    document.head.appendChild(style);
  }

  let container = document.getElementById("petInventoryContainer");

  if (!container) {
    const petsSection = document.getElementById("petsSection");
    if (!petsSection) {
      console.error("❌ petsSection lipsește din DOM!");
      alert("❌ Eroare critică: petsSection lipsește din HTML!");
      return;
    }

    container = document.createElement("div");
    container.id = "petInventoryContainer";
    container.className = "inventory-grid"; // force class
    petsSection.appendChild(container);
  } else {
    container.innerHTML = "";
    container.classList.add("inventory-grid"); // reapply just in case
  }

  fixPetGrid(); // apply correct grid styles

  container.innerHTML = "<div class='loading-pets'>Se încarcă animalele de companie...</div>";

  if (!username) {
    console.warn("❌ Username is missing");
    container.innerHTML = "<div class='error-pets'>Eroare: nu ești autentificat.</div>";
    return;
  }

  setTimeout(() => {
    const userPetsRef = firebase.database().ref(`users/${username}/pets`);

    userPetsRef.once("value", (snapshot) => {
      const pets = snapshot.val();

      if (!pets) {
        container.innerHTML = "<div class='empty-pets'>Niciun animal de companie deocamdată 🐣</div>";
        return;
      }

      const groupedPets = {};
      Object.entries(pets).forEach(([petId]) => {
        const full = petPool.find(p => p.id === petId);
        if (!full) return;

        const key = full.name;

        if (!groupedPets[key]) {
          groupedPets[key] = { ...full, count: 1 };
        } else {
          groupedPets[key].count += 1;
        }
      });

      container.innerHTML = "";

      Object.values(groupedPets).forEach((pet) => {
        const rarityColor = getRarityColor(pet.rarity);

        const petCard = document.createElement("div");
        petCard.classList.add("inventory-card");
        Object.assign(petCard.style, {
          display: "flex",
          flexDirection: "column",
          alignItems: "center",
          justifyContent: "center",
          width: "70px",
          height: "70px",
          background: "#1a1a1a",
          border: `2px solid ${rarityColor}`,
          borderRadius: "12px",
          boxShadow: `0 0 8px ${rarityColor}`,
          cursor: "pointer"
        });

        const img = document.createElement("img");
        img.src = pet.image;
        img.alt = pet.name;
        img.style.width = "36px";
        img.style.height = "36px";

        const label = document.createElement("div");
        label.textContent = `x${pet.count}`;
        label.style.color = "#fff";
        label.style.fontSize = "13px";
        label.style.marginTop = "4px";

        petCard.appendChild(img);
        petCard.appendChild(label);
        petCard.addEventListener("click", () => showPetDetailsPopup(pet));
        container.appendChild(petCard);
      });

      // ✅ Final grid correction after rendering
      setTimeout(fixPetGrid, 50);
    }, (error) => {
      console.error("❌ Eroare la citirea animalelor:", error);
      container.innerHTML = "<div class='error-pets'>Eroare la încărcarea animalelor 🐾</div>";
    });
  }, 150);
}




function fixPetGrid() {
  const cont = document.getElementById("petInventoryContainer");
  if (!cont) return;

  cont.classList.add("inventory-grid"); // force class
  cont.style.display = "grid";
  cont.style.gridTemplateColumns = "repeat(4, 1fr)";
  cont.style.gap = "12px";
  cont.style.width = "100%";
  cont.style.maxWidth = "100%";
  cont.style.margin = "0 auto";
  cont.style.justifyItems = "center";
}











  // ✅ GLOBAL MESSAGE
  let lastGlobalMsgTime = 0;
  globalMsgRef.on("value", snapshot => {
    const data = snapshot.val();
    if (data && data.text && data.timestamp > lastGlobalMsgTime) {
      lastGlobalMsgTime = data.timestamp;
      showGlobalMessage(data.text, data.sender);
    }
  });

  // 🧙 Merchant NPC System
  function handleMerchantClick() {
    document.getElementById("dialogContainer").style.display = "block";
    currentLine = 0;
    showDialogLine();
  }

  function spawnMerchant() {
    if (window.isOnMoon) {
      console.log("🚫 Merchantul nu apare pe Lună.");
      return;
    }

    const merchant = document.getElementById("merchantContainer");
    const gameArea = document.getElementById("gameArea");
    const sprite = document.getElementById("merchantSprite");

    if (!merchant || !gameArea || !sprite) return;

    const x = Math.random() * (gameArea.offsetWidth - 100);
    const y = Math.random() * (gameArea.offsetHeight - 100);

    merchant.style.left = `${x}px`;
    merchant.style.top = `${y}px`;
    merchant.style.display = "block";

    sprite.replaceWith(sprite.cloneNode(true));
    const newSprite = document.getElementById("merchantSprite");
    newSprite.addEventListener("click", handleMerchantClick);
  }

  setInterval(spawnMerchant, 10000);

  const dialogLines = [
    "Salut, călătorule!",
    "Am obiecte rare... și unele ilegale.",
    "Te interesează un schimb?",
    "Alege ce vrei să faci:"
  ];

  let currentLine = 0;

  document.getElementById("merchantSprite").addEventListener("click", () => {
    currentLine = 0;
    showDialogLine();
  });

  function showDialogLine() {
    const dialogBar = document.getElementById("dialogBar");
    const dialogText = document.getElementById("dialogText");
    const dialogOptions = document.getElementById("dialogOptions");
    const dialogAvatar = document.getElementById("dialogAvatar");

    if (dialogBar.style.display !== "flex") {
      dialogBar.style.display = "flex";
      dialogAvatar.style.display = "block";
    }

    dialogOptions.innerHTML = "";

    if (currentLine < dialogLines.length - 1) {
      dialogText.textContent = dialogLines[currentLine];
      currentLine++;
      dialogBar.onclick = showDialogLine;
    } else {
      dialogText.textContent = dialogLines[currentLine];
      dialogBar.onclick = null;
      showDialogOptions();
    }
  }

  function showDialogOptions() {
    const dialogOptions = document.getElementById("dialogOptions");

    const btn1 = createDialogButton("🛒 Cumpără", () => {
      document.getElementById("shopPopup").style.display = "flex";
    });

    const btn2 = createDialogButton("💰 Vinde", () => {
      window.inventorySellMode = true;
      document.getElementById("inventoryPopup").style.display = "flex";
    });

    const btn3 = createDialogButton("❌ Lasă-mă", () => {
      closeDialog();
    });

    dialogOptions.appendChild(btn1);
    dialogOptions.appendChild(btn2);
    dialogOptions.appendChild(btn3);
  }

  function createDialogButton(text, onClick) {
    const btn = document.createElement("button");
    btn.textContent = text;
    btn.style.padding = "6px 12px";
    btn.style.fontSize = "14px";
    btn.style.border = "1px solid #555";
    btn.style.background = "#444";
    btn.style.color = "white";
    btn.style.borderRadius = "4px";
    btn.style.cursor = "pointer";
    btn.onclick = onClick;
    return btn;
  }

  function closeDialog() {
    document.getElementById("dialogContainer").style.display = "none";
    document.getElementById("merchantContainer").style.display = "none";
  }
});




  

  const chatRef = firebase.database().ref("chatMessages");

function normalize(text) {
  return text
    .normalize("NFD")
    .replace(/[\u0300-\u036f]/g, '') // remove diacritics
    .replace(/[^a-z0-9]/gi, '')      // remove special characters
    .toLowerCase();
}

const bannedWords = [
  // Cuvinte explicite și variații
  'pula', 'pule', 'p u l a', 'p.ula', 'p*la', 'p|a', 'p1a', 'pu|a',
  'pizda', 'pizde', 'p1zda', 'pizd@', 'p*zda', 'p i z d a',
  'muie', 'mui', 'mue', 'm.u.i.e', 'm u i e', 'mu1e', 'm*ie',
  'futu', 'fut', 'futai', 'futut', 'f.u.t', 'f.u.t.u.t', 'f u t u t', 'phutut',
  'sugi', 'suge', 'sugi-mi', 'sugi-mi-o', 'sugi-o', 'sugeti', 'sugi-mi-o-n',
  'bagami', 'baga-mi', 'bagamias', 'băgami', 'băgamias', 'b@gami', 'b@g@mias',
  'caca', 'kkt', 'c4c4t', 'k@k@',
  'zdreanta', 'zdreanță', 'zdre@nta', 'zdr3a',
  'panarama', 'panaramă',
  'mortii', 'morții', 'mortilor', 'morti',
  'matii', 'mătii', 'ma-tii', 'mati-tii', 'fmm', 'fmm-tii', 'fmm mati',
  'dumnezeii', 'dumnezeu', 'dumnezo', 'dumnezeule',
  'doamne-fereste', 'd0amne', 'isuse', 'isus', 'i.s.u.s',
  'hristos', 'cristos', 'h.ristos', 'hr1st0s',
  'dracu', 'dr@q', 'drq', 'dreq', 'dreacu', 'd.r.e.q', 'd.r.e.a.c.u',
  'naibii', 'satana', 'diavolul', 'afurisit', 'aldracului',
  'jidan', 'țigan', 'tigan', 'tzigan', 'tz1gan', 'tig@n', 'gipsan', 'g*psan',
  'cioara', 'cioară', 'c10ara',
  'negrotei', 'bozgor', 'bou', 'boul', 'javra', 'javră', 'porc', 'porcule', 'porcoi',
  'retard', 'handicapat', 'idiot', 'prost', 'cretin', 'imbecil', 'sclav',
  'dobitoc', 'tembel', 'oligofren', 'dement', 'analfabet', 'netot', 'puturos',
  'gay', 'homo', 'f@g', 'f@ggot', 'f4g', 'fa99ot',
  'homalau', 'homalău', 'pedala', 'pedală', 'pederast', 'lesbiana', 'trava',
  'fuck', 'f*ck', 'f.u.c.k', 'f#ck', 'fu(k', 'phuck',
  'shit', 'sh*t', 'sh1t', 's.h.i.t',
  'bitch', 'b*tch', 'b1tch', 'b!tch', 'b.i.t.c.h',
  'slut', 'slvt', 's1ut', 's!ut', 's.l.u.t',
  'asshole', '@sshole', 'a$$hole', 'a.s.s.h.o.l.e',
  'cock', 'c0ck', 'c*ck', 'c.o.c.k', 'kawk',
  'dick', 'd1ck', 'd!ck', 'd*ck', 'd.i.c.k',
  'pussy', 'pus5y', 'pu55y', 'p*ssy', 'p.u.s.s.y',
  's3x', 's.e.x', 'p0rn', 'pr0n', 'p*rn',
  'hitler', 'heil', 'nazi', 'ss', 'auschwitz',
  'Sloboz', 'sloboz', 'Slobozel', 'slo', 'SLO', 'SLOBOZ', 'S L O B O Z', 'Boz',
  'puta', 'laba', 'labă', 'Labă', 'l1ba',

  // Nume/troll tags

  // Simboluri individuale
  '.', ',', '/', '\\', '-', '_', '|', '@', '*', '&', '^', '%', '$', '#', '!', '?', '+', '=', '~', '`', '(', ')', '[', ']', '{', '}', '<', '>', 'ț', 'ă', 'î', 'â', 'ș'
];



// throttle chat so one message every 10s
let lastMessageTimestamp = 0;
let replyTarget = null;
let lastChatClosedAt = Date.now();

function sendMessage() {
  const input = document.getElementById("chatInput");
  const indicator = document.getElementById("recordIndicator");
  const message = input.value.trim();
  const now = Date.now();

  if (!username) return;

  firebase.database().ref(`mutes/${normalize(username)}`).once("value", snapshot => {
    const data = snapshot.val();
if (data && data.until > Date.now()) {
  const popup = document.getElementById("mutePopup");
  const reason = data.reason || "necunoscut";
  const until = data.until;

  // curăță orice countdown anterior
  if (window.muteInterval) clearInterval(window.muteInterval);
  if (window.muteTimeout) clearTimeout(window.muteTimeout);

  popup.style.display = "block";

  function updateMuteCountdown() {
    const msLeft = until - Date.now();
    if (msLeft <= 0) {
      popup.style.display = "none";
      clearInterval(window.muteInterval);
      return;
    }
    const seconds = Math.floor(msLeft / 1000);
    const minutes = Math.floor(seconds / 60);
    const sec = seconds % 60;
    popup.textContent = `Ești mutat pentru: ${reason} (${minutes}m ${sec}s rămase)`;
  }

  updateMuteCountdown(); // prima actualizare
  window.muteInterval = setInterval(updateMuteCountdown, 1000);

  // 🔴 închide popup-ul după 10 secunde, chiar dacă mute-ul încă e activ
  window.muteTimeout = setTimeout(() => {
    popup.style.display = "none";
    clearInterval(window.muteInterval);
  }, 10_000);

  return;
}

 

    // TOT ce era mai jos se mută aici în interiorul callback-ului
    if (recordedAudio) {
      const reader = new FileReader();
      reader.onloadend = () => {
        const base64Audio = reader.result;
        chatRef.push({
          user: username,
          audio: base64Audio,
          timestamp: now,
          special: username === "Lost_Soul_ZZZ"
        });
        lastMessageTimestamp = now;
        recordedAudio = null;
        indicator.style.display = "none";
        input.style.display = "inline-block";
      };
      reader.readAsDataURL(recordedAudio);
      return;
    }

    if (!message) return;

  if (!input.dataset.editing && now - lastMessageTimestamp < 5_000) {
  const wait = Math.ceil((5_000 - (now - lastMessageTimestamp)) / 1000);

  const popup = document.getElementById("mutePopup");
  popup.style.display = "block";
  popup.textContent = `Mai așteaptă ${wait}s înainte de următorul mesaj.`;

  // Curăță orice timer anterior
  if (window.cooldownTimeout) clearTimeout(window.cooldownTimeout);

  // Ascunde popup după 5 secunde
  window.cooldownTimeout = setTimeout(() => {
    popup.style.display = "none";
  }, 5000);

  return;
}


    if (/https?:\/\/\S+|www\.\S+/i.test(message)) {
      alert("Link-urile nu sunt permise.");
      return;
    }

    const norm = normalize(message);
    if (bannedWords.some(bad => norm.includes(bad))) {
      alert("Mesajul conține cuvinte interzise.");
      return;
    }

    const editingKey = input.dataset.editing;
    if (editingKey) {
      chatRef.child(editingKey).update({
        text: message,
        timestamp: now
      });
      input.dataset.editing = '';
      input.value = '';
      input.placeholder = 'Scrie un mesaj…';
      document.getElementById("cancelEditBtn").style.display = "none";
      return;
    }

    const messageData = {
      user: username,
      text: message,
      timestamp: now,
      special: username === "Lost_Soul_ZZZ"
    };

    if (replyTarget) {
      messageData.replyTo = { ...replyTarget };
      replyTarget = null;
      input.placeholder = "Scrie un mesaj…";
    }

    chatRef.push(messageData);
    lastMessageTimestamp = now;
    input.value = '';
    document.getElementById("cancelEditBtn").style.display = "none";
  });
}



let isRecording = false;
let recordedAudio = null;
let mediaRecorder;
let audioChunks = [];


function sendGlobalMessageToEveryone(text) {
  if (!text || typeof text !== "string") return;

  const timestamp = Date.now();

  globalMsgRef.set({
    text: text,
    sender: username || "Anonim",
    timestamp: timestamp
  });

  setTimeout(() => {
    globalMsgRef.remove();
  }, 10_000);
}


function showVoiceUI() {
  document.getElementById("chatInput").style.display = "none";
  document.getElementById("sendTextBtn").style.display = "none";
  document.getElementById("voiceUI").style.display = "flex";
}

function resetVoiceUI() {
  document.getElementById("chatInput").style.display = "inline-block";
  document.getElementById("sendTextBtn").style.display = "inline-block";
  document.getElementById("voiceUI").style.display = "none";
  document.getElementById("recordBtn").textContent = "⏺️ Înregistrează";
  document.getElementById("audioPreview").style.display = "none";
  document.getElementById("imagePreview").style.display = "none";
  document.getElementById("sendAudioBtn").style.display = "none";
  document.getElementById("deleteAudioBtn").style.display = "none";
  recordedAudio = null;
  isRecording = false;
}


function toggleRecord() {
  if (!isRecording) {
    navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
      mediaRecorder = new MediaRecorder(stream);
      audioChunks = [];

      mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
      mediaRecorder.onstop = () => {
        recordedAudio = new Blob(audioChunks, { type: 'audio/webm' });
        const audioURL = URL.createObjectURL(recordedAudio);
        const audioPreview = document.getElementById("audioPreview");
        audioPreview.src = audioURL;
        audioPreview.style.display = "inline-block";
        document.getElementById("sendAudioBtn").style.display = "inline-block";
        document.getElementById("deleteAudioBtn").style.display = "inline-block";
      };

      mediaRecorder.start();
      isRecording = true;
      document.getElementById("recordBtn").textContent = "⏹️ Oprește";
    }).catch(err => alert("Eroare la accesarea microfonului."));
  } else {
    mediaRecorder.stop();
    isRecording = false;
    document.getElementById("recordBtn").textContent = "⏺️ Înregistrează";
  }
}
function cancelEdit() {
  const input = document.getElementById("chatInput");
  input.value = '';
  input.placeholder = 'Scrie un mesaj…';
  delete input.dataset.editing;
  replyTarget = null;
  document.getElementById("cancelEditBtn").style.display = "none";
}


function sendVoiceMessage() {
  if (!username) return;

  const now = Date.now();

  // 1. Trimite imagine dacă există una selectată


  // 2. Trimite audio dacă există înregistrare
  if (!recordedAudio) return;

  const reader = new FileReader();
  reader.onloadend = () => {
    const base64Audio = reader.result;
    chatRef.push({
      user: username,
      audio: base64Audio,
      timestamp: now,
      special: username === "Lost_Soul_ZZZ"
    });
    lastMessageTimestamp = now;
    resetVoiceUI();
  };
  reader.readAsDataURL(recordedAudio);
}




function displayMessage(data) {
  const msg = data.val(); 
  const key = data.key;
  const container = document.getElementById("chatMessages");

  // ✅ Remove existing DOM if re-rendering (edit case)
  const existing = document.querySelector(`[data-key="${key}"]`);
  if (existing) container.removeChild(existing);

  const isMine = msg.user === username;

  // Wrapper
  const wrapper = document.createElement("div");
  wrapper.setAttribute("data-key", key);
  wrapper.style.display = "flex";
  wrapper.style.alignItems = "center";
  wrapper.style.justifyContent = isMine ? "flex-end" : "flex-start";
  wrapper.style.gap = "6px";
  wrapper.style.position = "relative";

  // Bubble
  const bubble = document.createElement("div");
  bubble.classList.add("message-bubble");

  if (msg.special) {
    bubble.classList.add("special-lost-soul");
  } else {
    bubble.classList.add(isMine ? "mine" : "other");
  }

  // Rank color
  if (msg.rank) {
    switch (msg.rank) {
      case 1: bubble.classList.add("gradient-gold"); break;
      case 2: bubble.classList.add("gradient-silver"); break;
      case 3: bubble.classList.add("gradient-bronze"); break;
      case 4: bubble.classList.add("gradient-blue"); break;
      case 5: bubble.classList.add("gradient-green"); break;
    }
  }

  const time = new Date(msg.timestamp).toLocaleTimeString("ro-RO", {
    hour: "2-digit",
    minute: "2-digit",
  });

  // Reply tag
  if (msg.replyTo) {
    const replyTag = document.createElement("div");
    replyTag.style.fontSize = "12px";
    replyTag.style.opacity = "0.75";
    replyTag.style.marginBottom = "4px";
    replyTag.textContent = `Replied to ${msg.replyTo.user}: "${msg.replyTo.text}"`;
    bubble.appendChild(replyTag);
  }

  // Message content
  const nameDisplay = msg.special ? "🛠️ " + msg.user : msg.user;
  if (msg.audio) {
    const audio = document.createElement("audio");
    audio.controls = true;
    audio.src = msg.audio;
    bubble.appendChild(document.createTextNode(`${nameDisplay}: `));
    bubble.appendChild(audio);
} else {
  const msgSpan = document.createElement("span");
  msgSpan.textContent = `${nameDisplay}: ${msg.text}`;
  bubble.appendChild(msgSpan);
}


  // Dots menu
  const menuBtn = document.createElement("div");
  menuBtn.className = "dot-menu";
  for (let i = 0; i < 3; i++) {
    const dot = document.createElement("div");
    dot.className = "dot";
    menuBtn.appendChild(dot);
  }

  // Popup
  const popup = document.createElement("div");
  popup.innerHTML = "";
  popup.style.position = "absolute";
  popup.style.background = "#222";
  popup.style.color = "#fff";
  popup.style.padding = "4px 8px";
  popup.style.borderRadius = "6px";
  popup.style.fontSize = "13px";
  popup.style.boxShadow = "0 0 6px rgba(0,0,0,0.3)";
  popup.style.display = "none";
  popup.style.cursor = "pointer";
  popup.style.zIndex = 9999;

  // Reply option
  const replyOption = document.createElement("div");
  replyOption.textContent = "↩️ Răspunde";
  replyOption.onclick = () => {
    const input = document.getElementById("chatInput");
    replyTarget = {
      user: msg.user,
      text: msg.text || "[audio/img]",
    };
    input.placeholder = `Răspunde lui ${replyTarget.user}: "${replyTarget.text}"`;
    input.focus();
    document.getElementById("cancelEditBtn").style.display = "inline-block";
    popup.style.display = "none";
  };
  popup.appendChild(replyOption);

  // Admin tools
  if (username === "Lost_Soul_ZZZ") {
    const muteOption = document.createElement("div");
    muteOption.textContent = "🔇 Mute";
    muteOption.onclick = () => handleAdminAction("mute", msg.user);
    popup.appendChild(muteOption);

    const blockOption = document.createElement("div");
    blockOption.textContent = "🚫 Block";
    blockOption.onclick = () => handleAdminAction("block", msg.user);
    popup.appendChild(blockOption);
  }

  // Edit option
  if (isMine && msg.text) {
    const editOption = document.createElement("div");
    editOption.textContent = "✏️ Editează";
    editOption.onclick = () => {
      const input = document.getElementById("chatInput");
      input.value = msg.text;
      input.dataset.editing = key;
      input.focus();
      document.getElementById("cancelEditBtn").style.display = "inline-block";
      popup.style.display = "none";
    };
    popup.appendChild(editOption);
  }

  // Menu button toggle
  menuBtn.onclick = (e) => {
    e.stopPropagation();
    popup.style.display = popup.style.display === "none" ? "block" : "none";
  };

  // Layout
  if (isMine) {
    wrapper.appendChild(menuBtn);
    wrapper.appendChild(bubble);
    popup.style.left = "0";
  } else {
    wrapper.appendChild(bubble);
    wrapper.appendChild(menuBtn);
    popup.style.right = "0";
  }

  wrapper.appendChild(popup);
  container.appendChild(wrapper);
  container.scrollTop = container.scrollHeight;

  // 🔴 Notificare dacă e închis chat-ul
  if (!isMine && !document.getElementById("chatSlider").checked && msg.timestamp > lastChatClosedAt) {
    const label = document.getElementById("chatSliderLabel");
    const badge = document.getElementById("chatNotif");

    if (badge) badge.style.display = "inline-block";

    if (label && !label.classList.contains("new-msg")) {
      label.classList.add("new-msg");
      setTimeout(() => {
        label.classList.remove("new-msg");
        if (badge) badge.style.display = "none";
      }, 5000);
    }
  }
}


chatRef.limitToLast(50).on("child_added", displayMessage);
chatRef.on("child_changed", displayMessage);


window.addEventListener("load", () => {
  const toggleBtn = document.getElementById("toggleLeaderboardBtn");
  const leaderboard = document.getElementById("leaderboard");

  toggleBtn.addEventListener("click", () => {
    if (leaderboard.style.display === "none" || leaderboard.style.opacity === "0" || leaderboard.style.display === "") {
      leaderboard.style.display = "block";
      leaderboard.classList.remove("animate-up");
      leaderboard.classList.add("animate-down");

      // Mută butonul sub leaderboard după o mică întârziere
      setTimeout(() => {
        toggleBtn.style.position = "absolute";
        toggleBtn.style.top = (leaderboard.offsetTop + leaderboard.offsetHeight + 10) + "px";
        toggleBtn.style.right = "10px";
      }, 500); // cât durează animația
    } else {
      leaderboard.classList.remove("animate-down");
      leaderboard.classList.add("animate-up");

      leaderboard.addEventListener("animationend", function handler() {
        leaderboard.style.display = "none";
        leaderboard.removeEventListener("animationend", handler);

        // Pune butonul înapoi în colț
        toggleBtn.style.position = "absolute";
        toggleBtn.style.top = "10px";
        toggleBtn.style.right = "10px";
      });
    }
  });
});

window.addEventListener("load", () => {
  const inventoryBtn = document.getElementById("inventoryBtn");
  const inventoryPopup = document.getElementById("inventoryPopup");
  const closeInventoryBtn = document.getElementById("closeInventoryBtn");
  const tabItems = document.getElementById("tabItems");
  const tabPets = document.getElementById("tabPets");
  const itemsSection = document.getElementById("itemsSection");
  const petsSection = document.getElementById("petsSection");

  if (  
    inventoryBtn && inventoryPopup &&
    closeInventoryBtn && tabItems && tabPets &&
    itemsSection && petsSection
  ) {
    // 🔓 Open inventory
    inventoryBtn.onclick = () => {
      inventoryPopup.style.display = "flex";
    };

    // ❌ Close inventory
   closeInventoryBtn.onclick = () => {
  inventoryPopup.style.display = "none";
  window.inventorySellMode = false; // Reset mode when inventory closes
};


    // 📦 ITEMS TAB
    tabItems.onclick = () => {
      tabItems.classList.add("active");
      tabPets.classList.remove("active");

      petsSection.style.display = "none";
      itemsSection.style.display = "grid";       // ✅ Enforce grid layout
      itemsSection.innerHTML = "";               // ✅ Clear only, don't remove

      const ref = firebase.database().ref(`users/${username}/inventory`);
      ref.once("value").then(snapshot => {
        const inventory = snapshot.val() || [];
        renderInventory(inventory);              // ✅ Already safe
      });
    };

    // 🐾 PETS TAB
    tabPets.onclick = () => {
      tabPets.classList.add("active");
      tabItems.classList.remove("active");

      itemsSection.style.display = "none";
      petsSection.style.display = "grid";        // ✅ Match layout
      petsSection.innerHTML = "";                // ✅ Clear old pets

      const ref = firebase.database().ref(`users/${username}/pets`);
      ref.once("value").then(snapshot => {
        const pets = snapshot.val() || [];

        if (pets.length === 0) {
          petsSection.innerHTML = "<p style='text-align:center; font-size:12px;'>Niciun animal de companie încă 🐾</p>";
          return;
        }

        const counts = {};
        pets.forEach(p => counts[p] = (counts[p] || 0) + 1);

        Object.entries(counts).forEach(([emoji, count]) => {
          const slot = document.createElement("div");
          slot.className = "inventory-slot";
          slot.innerHTML = `
            <div class="slot-bg">
              <div class="slot-icon">${emoji}</div>
              ${count > 1 ? `<div class="slot-count">x${count}</div>` : ''}
            </div>
          `;
          slot.style.fontSize = "30px";
          petsSection.appendChild(slot);
        });
      });
    };
  }
});




window.addEventListener("load", () => {
  const closeShopBtn = document.getElementById("closeShopBtn");
  const offersSection = document.getElementById("offersSection");

  if (closeShopBtn) {
    closeShopBtn.onclick = () => {
      document.getElementById("shopPopup").style.display = "none";
    };
  }

if (offersSection) {
  offersSection.innerHTML = "";
  shopOffers.forEach(offer => {
    const slot = document.createElement("div");
    slot.className = "inventory-slot";
    slot.innerHTML = `
      <div class="slot-bg">
        <div class="slot-icon">${offer.emoji}</div>
        <div class="slot-count shop-price">
          <img src="https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/6871f7f0-a214-4018-8fc8-f243c7cf6cd3/red_gem.png?format=500w" alt="ruby" class="shop-ruby-icon">
          <span>${offer.price}</span>
        </div>
      </div>
    `;

slot.addEventListener("click", () => {
  const userRef = firebase.database().ref(`users/${username}/rubys`);
  userRef.once("value").then(snapshot => {
    const rubys = snapshot.val() || 0;

    if (rubys >= offer.price) {
      showShopOfferPopup(offer);
    } else {
      const popup = document.getElementById("mutePopup");
      popup.textContent = "❌ Nu ai suficiente rubine pentru această achiziție.";
      popup.style.display = "block";

      if (window.popupTimeout) clearTimeout(window.popupTimeout);
      window.popupTimeout = setTimeout(() => {
        popup.style.display = "none";
      }, 4000);
    }
  });
});



    offersSection.appendChild(slot);
  });
}

});



window.addEventListener("load", () => {
  if (!username) return;

  const ref = firebase.database().ref(`users/${username}/inventory`);
  ref.once("value").then(snapshot => {
    const inventory = snapshot.val() || [];
    renderInventory(inventory); // ✅ uses the one that sets up click events
  });
});



function addToInventory(emoji) {
  if (!username) return;

  const ref = firebase.database().ref(`users/${username}/inventory`);

  ref.transaction(current => {
    const list = Array.isArray(current) ? [...current] : [];
    list.push(emoji);
    return list;
  }).then(result => {
    if (result.committed && result.snapshot.exists()) {
      renderInventory(result.snapshot.val());
    }
  });
}




function renderInventory(list) {
  const container = document.getElementById("itemsSection");
  container.innerHTML = "";
// Force reflow hack (just once)
container.offsetHeight;


  const counts = {};
  list.forEach(emoji => {
    counts[emoji] = (counts[emoji] || 0) + 1;
  });

  Object.entries(counts).forEach(([emoji, count]) => {
    const slot = document.createElement("div");
    slot.className = "inventory-slot";
    slot.innerHTML = `
      <div class="slot-bg">
        <div class="slot-icon">${emoji}</div>
        ${count > 1 ? `<div class="slot-count">x${count}</div>` : ''}
      </div>
    `;

    // 👇 Asta adaugă clickul pe slot
    slot.addEventListener("click", () => {
      showEmojiPopup(emoji);
    });

    container.appendChild(slot);
  });
}


firebase.database().ref(`users/${username}/pets`).once("value", snap => {
  const pets = snap.val();
  if (!pets) return;

  for (const id in pets) {
    const pet = pets[id];
    const img = document.createElement("img");
    img.src = pet.image;
    img.style.width = "64px";
    img.style.cursor = "pointer";
    img.style.margin = "5px";

    img.onclick = () => showPetDetailsPopup(pet);
    inventory.appendChild(img);
  }
});


function showEmojiPopup(emoji) {
  const popup = document.getElementById("emojiInfoPopup");
  const details = emojiDetails[emoji];

  document.getElementById("popupEmoji").textContent = emoji;
  document.getElementById("popupName").textContent = details?.name || "Necunoscut";
  document.getElementById("popupType").textContent = details?.type === "rau" ? "RĂU" : "BUN";
  document.getElementById("popupEffect").textContent = details?.effect || "Fără efect.";
  document.getElementById("popupScore").textContent =
    (details?.score >= 0 ? "+" : "") + details?.score + " puncte";
  document.getElementById("popupFunny").textContent =
    details?.funny || "Acest emoji preferă să rămână misterios.";

  const typeEl = document.getElementById("popupType");
  typeEl.classList.remove("good", "bad");
  typeEl.classList.add(details?.type === "rau" ? "bad" : "good");

  // 👉 Handle Single Sell Button
  const sellBtn = document.getElementById("sellEmojiBtn");
  if (window.inventorySellMode) {
    sellBtn.style.display = "inline-block";
    sellBtn.onclick = () => {
      sellInventoryEmoji(emoji, 1); // always 1 point
    };
  } else {
    sellBtn.style.display = "none";
    sellBtn.onclick = null;
  }

  // 👉 Handle Sell All Button
  const sellAllBtn = document.getElementById("sellAllEmojiBtn");
  if (window.inventorySellMode) {
    sellAllBtn.style.display = "inline-block";
    sellAllBtn.onclick = () => {
      sellAllOfEmoji(emoji);
    };
  } else {
    sellAllBtn.style.display = "none";
    sellAllBtn.onclick = null;
  }

  popup.style.display = "flex";
}

function showPetDetailsPopup(pet) {
  const overlay = document.createElement("div");
  overlay.className = "item-detail-overlay";

  let isEquipped = equippedPets.some(p => p.id === pet.id);

  overlay.innerHTML = `
    <div class="item-popup" style="font-family: 'Rubik', sans-serif;">
      <img src="${pet.image}" alt="${pet.name}" class="item-img" />
      <div class="item-title">${pet.name}</div>
      <div class="item-type" style="background:${getRarityColor(pet.rarity)}">${pet.rarity.toUpperCase()}</div>
      <div class="item-effect">${pet.description}</div>
      <div class="item-score" style="color:#ff0">🎲 ${pet.chance}% șansă</div>
      <div class="item-funny">${pet.effect}</div>

      <button id="equipToggleBtn" style="
        margin-top: 12px;
        background-color: ${isEquipped ? '#ff4444' : '#ffe600'};
        color: black;
        font-weight: bold;
        padding: 8px 16px;
        border-radius: 8px;
        cursor: pointer;">
        ${isEquipped ? '❌ Dezactivează' : '✅ Echipează'}
      </button>

      <button onclick="this.closest('.item-detail-overlay').remove()" style="
        margin-top: 10px;
        background-color: #222;
        color: white;
        padding: 6px 14px;
        border-radius: 8px;
        border: 1px solid #555;
        cursor: pointer;">
        OK
      </button>
    </div>
  `;

  document.body.appendChild(overlay);

  setTimeout(() => {
    const btn = overlay.querySelector("#equipToggleBtn");
    if (!btn) return;

    btn.addEventListener("click", () => {
      const newState = !isEquipped;

      // Instantly update button appearance
      btn.textContent = newState ? "❌ Dezactivează" : "✅ Echipează";
      btn.style.backgroundColor = newState ? "#ff4444" : "#ffe600";

if (newState) {
  if (equippedPets.length >= 2) {
    alert("⛔ Poți avea maxim 2 animale echipate.");
    btn.textContent = "✅ Echipează";
    btn.style.backgroundColor = "#ffe600";
    return;
  }

  equippedPets.push(pet);
  spawnPetFollower(pet);

} else {
  equippedPets = equippedPets.filter(p => p.id !== pet.id);
  removePetFollower(pet);

  // ❌ Deactivate effects
  switch (pet.id) {
    case "versace":
      clearInterval(window.versaceInterval);
      window.versaceInterval = null;
      break;

    case "jerry":
      clearInterval(window.jerryInterval);
      window.jerryInterval = null;
      window.jerryMeteorActive = false;
      break;

    case "negri":
      window.negriScareCheck = false;
      break;

    case "botic":
      window.boticBoost = false;
      break;
  }
}

updateEquippedCounter();
applyEquippedPetEffects();
isEquipped = newState;

    });
  }, 20);
} 








function showShopOfferPopup(offer) {
  document.getElementById("shopOfferEmoji").textContent = offer.emoji;
  document.getElementById("shopOfferFunny").textContent = offer.funny;
  document.getElementById("shopOfferCost").textContent = `Cost: ${offer.price}💎`;

  const buyBtn = document.getElementById("buyOfferBtn");
  buyBtn.onclick = () => {
    attemptPurchase(offer);
  };

  document.getElementById("shopOfferPopup").style.display = "flex";
}

function sellInventoryEmoji(emoji, scoreAmount) {
  if (!username) {
    alert("⚠️ Numele jucătorului nu este setat!");
    return;
  }

  const invRef = firebase.database().ref(`users/${username}/inventory`);
  const leaderboardRef = firebase.database().ref(`leaderboard/${username}/score`);

  console.log("💰 Vânzare începută:", emoji, "→", scoreAmount, "puncte");

  invRef.transaction(items => {
    if (!Array.isArray(items)) return items;
    const idx = items.indexOf(emoji);
    if (idx !== -1) {
      items.splice(idx, 1);
      return items;
    } else {
      return items;
    }
  }).then(result => {
    if (result.committed) {
      leaderboardRef.transaction(current => (current || 0) + scoreAmount);

      if (typeof updateScore === "function") {
        updateScore(scoreAmount);
      } else {
        window.score = (window.score || 0) + scoreAmount;
        updateScoreDisplay?.();
        localStorage.setItem(`score_${username}`, window.score.toString());
      }

      closeEmojiPopup();
      window.inventorySellMode = false;

      firebase.database().ref(`users/${username}/inventory`).once("value").then(snapshot => {
        const updatedInventory = snapshot.val() || [];
        renderInventory(updatedInventory);
      });

      // 🧙 Merchant spune mulțumesc și dispare
      const dialogText = document.getElementById("dialogText");
      const dialogContainer = document.getElementById("dialogContainer");
      const merchantContainer = document.getElementById("merchantContainer");

      if (dialogText && dialogContainer && merchantContainer) {
        dialogText.textContent = "💰 Mulțumesc pentru afacere!";
        dialogContainer.style.display = "block";
        setTimeout(() => {
          dialogContainer.style.display = "none";
          merchantContainer.style.display = "none";
        }, 2000);
      }

      const toast = document.createElement("div");
      toast.textContent = `✅ Ai vândut ${emoji} pentru ${scoreAmount} puncte!`;
      Object.assign(toast.style, {
        position: "fixed",
        bottom: "100px",
        left: "50%",
        transform: "translateX(-50%)",
        background: "#00cc88",
        color: "white",
        padding: "10px 20px",
        borderRadius: "6px",
        fontSize: "16px",
        zIndex: 99999, 
      });
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 2000);
    }
  }).catch(err => {
    console.error("🔥 Eroare Firebase:", err.message);
  });
}

function attemptPurchase(offer) {
  const dialogText = document.getElementById("dialogText");
  const dialogContainer = document.getElementById("dialogContainer");
  const merchantContainer = document.getElementById("merchantContainer");
  const shopPopup = document.getElementById("shopPopup");
  const popup = document.getElementById("shopOfferPopup");

  function showDialogMessage(message, duration = 2000) {
    if (dialogText && dialogContainer) {
      dialogText.textContent = message;
      dialogContainer.style.display = "block";
      setTimeout(() => dialogContainer.style.display = "none", duration);
    }
  }

  // 💱 Score ➜ Rubies
  if (offer.id === "buyRubysForScore") {
    openScoreToRubyPopup((amount) => {
      if (isNaN(amount) || amount <= 0) {
        showDialogMessage("❌ Valoare invalidă.");
        return;
      }
      if (amount > 100) {
        showDialogMessage("⚠️ Poți cumpăra maxim 100 rubine o dată.");
        return;
      }

      const totalCost = amount * 25;
      if (score < totalCost) {
        showDialogMessage(`❌ Ai nevoie de ${totalCost} scor pentru ${amount} rubin(e).`);
        return;
      }

      score -= totalCost;
      updateScore(0);

      const ref = firebase.database().ref(`users/${username}/rubys`);
      ref.transaction(current => (current || 0) + amount);

      if (popup) popup.style.display = "none";
      if (dialogText && dialogContainer && merchantContainer) {
        dialogText.textContent = `🔁 Ai schimbat ${totalCost} scor pentru ${amount} rubin(e)!`;
        dialogContainer.style.display = "block";

        setTimeout(() => {
          dialogContainer.style.display = "none";
          merchantContainer.style.display = "none";
          if (shopPopup) shopPopup.style.display = "none";
        }, 2000);
      }
    });

    return;
  }

if (offer.id === "rickGift") {
  const ref = firebase.database().ref(`users/${username}/rubys`);
  ref.transaction(current => {
    if ((current || 0) >= offer.price) {
      return (current || 0) - offer.price;
    } else {
      showDialogMessage("💎 Nu ai suficiente rubine!");
      return current;
    }
  }).then(result => {
    if (result.committed) {
      firebase.database().ref("globalEffects/rickGift").set({
        by: username,
        timestamp: Date.now()
      });

      if (popup) popup.style.display = "none";

      if (dialogText && dialogContainer && merchantContainer) {
        dialogText.textContent = "🎁 Cadoul a fost trimis tuturor!";
        dialogContainer.style.display = "block";

        setTimeout(() => {
          dialogContainer.style.display = "none";
          merchantContainer.style.display = "none";
          if (shopPopup) shopPopup.style.display = "none";
        }, 2000);
      }
    }
  });

  return; // 🔴 This is MANDATORY — prevents fallback logic from running
}


if (offer.id === "mysteryEgg") {
  const ref = firebase.database().ref(`users/${username}/rubys`);
  ref.transaction(current => {
    if ((current || 0) >= offer.price) {
      return (current || 0) - offer.price;
    } else {
      showDialogMessage("💎 Nu ai suficiente rubine!");
      return current;
    }
  }).then(result => {
    if (result.committed) {
      showEggOverlay(); // 🥚 funcția pe care ai definit-o

      if (popup) popup.style.display = "none";

      if (dialogText && dialogContainer && merchantContainer) {
        dialogText.textContent = "🥚 Ai cumpărat un ou misterios!";
        dialogContainer.style.display = "block";

        setTimeout(() => {
          dialogContainer.style.display = "none";
          merchantContainer.style.display = "none";
          if (shopPopup) shopPopup.style.display = "none";
        }, 1500);
      }
    }
  });

  return; // 🔴 Oprește fallback-ul
}



  // 📢 Global message
  if (offer.id === "globalmsg") {
    const userMsg = prompt("📣 Scrie mesajul tău global (max 100 caractere):");
    if (!userMsg || userMsg.trim().length === 0) {
      showDialogMessage("❌ Mesajul nu poate fi gol.");
      return;
    }
    if (userMsg.length > 100) {
      showDialogMessage("❌ Mesajul e prea lung.");
      return;
    }

    const ref = firebase.database().ref(`users/${username}/rubys`);
    ref.transaction(current => {
      if ((current || 0) >= offer.price) {
        return (current || 0) - offer.price;
      } else {
        showDialogMessage("💎 Nu ai suficiente rubine!");
        return current;
      }
    }).then(result => {
      if (result.committed) {
        sendGlobalMessageToEveryone(userMsg);
        if (popup) popup.style.display = "none";

        if (dialogText && dialogContainer && merchantContainer) {
          dialogText.textContent = "📨 Mesajul tău a fost trimis!";
          dialogContainer.style.display = "block";

          setTimeout(() => {
            dialogContainer.style.display = "none";
            merchantContainer.style.display = "none";
            if (shopPopup) shopPopup.style.display = "none";
          }, 1000);
        }
      }
    });

    return;
  }

  // 🛍️ Normal shop purchases (including invertScreen)
  const ref = firebase.database().ref(`users/${username}/rubys`);
  ref.transaction(current => {
    if ((current || 0) >= offer.price) {
      addToInventory(offer.emoji);
      runShopOfferEffect(offer);

      // ✅ Broadcast invert screen effect and auto-remove it
      if (offer.id === "invertScreen") {
        const invertRef = firebase.database().ref("globalEffects/invertScreen");
        invertRef.set({
          triggeredBy: username,
          timestamp: Date.now()
        });

        // Auto-remove after 5 seconds so new users don't replay the effect
        setTimeout(() => {
          invertRef.remove();
        }, 5000);
      }

      return (current || 0) - offer.price;
    } else {
      showDialogMessage("💎 Nu ai suficiente rubine!");
      return current;
    }
  }).then(() => {
    if (popup) popup.style.display = "none";

    if (dialogText && dialogContainer && merchantContainer) {
      dialogText.textContent = "💰 Plăcerea a fost de partea mea!";
      dialogContainer.style.display = "block";

      setTimeout(() => {
        dialogContainer.style.display = "none";
        merchantContainer.style.display = "none";
        if (shopPopup) shopPopup.style.display = "none";
      }, 1000);
    }
  });
}
 









function runShopOfferEffect(offer) {
  if (offer.id === "mouse") {
    runExtendedMouseEvent(25); // 25 seconds mouse event
  }

if (offer.id === "coolKev") {
  const kevin = document.getElementById("kevin");
  if (!kevin) return;

  // 🧠 Detect current image (normal or tired)
  const currentImage = kevin.style.backgroundImage;

  // 🧊 Switch to cool Kevinuță background
  kevin.style.backgroundImage = `url("https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/0bdff38c-ec3a-46a1-844b-477c5a22300f/Design-Studio-2025-07-03+%281%29.png?format=500w")`;

  // ⏱ Revert after 60 seconds
  setTimeout(() => {
    kevin.style.backgroundImage = currentImage;
  }, 60000);
}
if (offer.id === "invertScreen") {
  const gameWrapper = document.getElementById("gameArea") || document.body;

  // Adaugă clasa pentru rotire
  gameWrapper.classList.add("flipped-screen");

  // Dezactivează după 5 secunde
  setTimeout(() => {
    gameWrapper.classList.remove("flipped-screen");
  }, 5000);
}

  // You can add more effects for other offers here
}

 

function runExtendedMouseEvent(durationInSeconds) {
  const mouse = document.getElementById('mouseFollower');
  const target = kevin;
  const clickIntervalMs = 200;
  let clicks = 0;
  const maxClicks = Math.floor((durationInSeconds * 1000) / clickIntervalMs);

  mouse.style.display = 'block';

  function clickAnimation() {
    mouse.style.transform = 'scale(0.8)';
    setTimeout(() => {
      mouse.style.transform = 'scale(1)';
    }, 100);
  }

  function moveMouse() {
    const mouseRect = mouse.getBoundingClientRect();
    const targetRect = target.getBoundingClientRect();

    const mouseX = mouseRect.left + mouseRect.width / 2;
    const mouseY = mouseRect.top + mouseRect.height / 2;
    const targetX = targetRect.left + targetRect.width / 2;
    const targetY = targetRect.top + targetRect.height / 2;

    const dx = targetX - mouseX;
    const dy = targetY - mouseY;

    const moveSpeed = 1;
    const newX = mouseRect.left + dx * moveSpeed;
    const newY = mouseRect.top + dy * moveSpeed;

    const gameAreaRect = gameArea.getBoundingClientRect();
    const leftPos = newX - gameAreaRect.left;
    const topPos = newY - gameAreaRect.top;

    mouse.style.left = `${leftPos}px`;
    mouse.style.top = `${topPos}px`;
  }

  const initialLeft = target.offsetLeft + target.offsetWidth + 20;
  const initialTop = target.offsetTop + target.offsetHeight / 2;
  mouse.style.left = `${initialLeft}px`;
  mouse.style.top = `${initialTop}px`;

  const interval = setInterval(() => {
    moveMouse();
    clickAnimation();

    const mouseRect = mouse.getBoundingClientRect();
    const targetRect = target.getBoundingClientRect();

    const isColliding = !(
      mouseRect.right < targetRect.left ||
      mouseRect.left > targetRect.right ||
      mouseRect.bottom < targetRect.top ||
      mouseRect.top > targetRect.bottom
    );

    if (isColliding) {
      updateScore(1);
    }

    clicks++;
    if (clicks >= maxClicks) {
      clearInterval(interval);
      mouse.style.display = 'none';
      mouse.style.transform = 'scale(1)';
    }
  }, clickIntervalMs);
}

function sellAllOfEmoji(emoji) {
  if (!username) return;

  const invRef = firebase.database().ref(`users/${username}/inventory`);
  const leaderboardRef = firebase.database().ref(`leaderboard/${username}/score`);

  let countToSell = 0;

  invRef.transaction(items => {
    if (!Array.isArray(items)) return items;
    countToSell = items.filter(e => e === emoji).length;
    return items.filter(e => e !== emoji);
  }).then(result => {
    if (result.committed && countToSell > 0) {
      const totalScore = countToSell;

      leaderboardRef.transaction(current => (current || 0) + totalScore);

      if (typeof updateScore === "function") {
        updateScore(totalScore);
      } else {
        window.score = (window.score || 0) + totalScore;
        updateScoreDisplay?.();
        localStorage.setItem(`score_${username}`, window.score.toString());
      }

      closeEmojiPopup();
      window.inventorySellMode = false;

      firebase.database().ref(`users/${username}/inventory`).once("value").then(snapshot => {
        const updatedInventory = snapshot.val() || [];
        renderInventory(updatedInventory);
      });

      // 🧙 Merchant spune mulțumesc și dispare
      const dialogText = document.getElementById("dialogText");
      const dialogContainer = document.getElementById("dialogContainer");
      const merchantContainer = document.getElementById("merchantContainer");

      if (dialogText && dialogContainer && merchantContainer) {
        dialogText.textContent = "💰 Mulțumesc pentru toate!";
        dialogContainer.style.display = "block";
        setTimeout(() => {
          dialogContainer.style.display = "none";
          merchantContainer.style.display = "none";
        }, 2000);
      }

      const toast = document.createElement("div");
      toast.textContent = `✅ Ai vândut toate ${emoji} x${countToSell} pentru ${totalScore} puncte!`;
      Object.assign(toast.style, {
        position: "fixed",
        bottom: "100px",
        left: "50%",
        transform: "translateX(-50%)",
        background: "#ffaa00",
        color: "#000",
        padding: "10px 20px",
        borderRadius: "6px",
        fontSize: "16px",
        zIndex: 99999,
      });
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 2000);
    }
  }).catch(err => {
    console.error("🔥 Eroare la vânzarea totală:", err.message);
  });
}


function closeEmojiPopup() {
  document.getElementById("emojiInfoPopup").style.display = "none";
}

 
let top100Data = [];
let currentTop100Filter = 'all'; // default filter

let updateTop100Timeout;
firebase.database().ref("leaderboard").on("value", snapshot => {
  const data = snapshot.val() || {};
top100Data = Object.values(data)
  .filter(entry => entry && typeof entry.score === 'number' && entry.username) // ✅ ensure clean
  .sort((a, b) => b.score - a.score) 
  .slice(0, 100);
  
  clearTimeout(updateTop100Timeout); // reset delay
  updateTop100Timeout = setTimeout(() => {
    updateTop100List(currentTop100Filter);
  }, 100); // wait 100ms before re-rendering
});



function updateTop100List(filter = 'all') {
  const list = document.getElementById("top100List");
  list.innerHTML = '';

  const filteredData = (filter === 'online')
    ? top100Data.filter(entry => entry.lastActive && Date.now() - entry.lastActive < 5 * 60 * 1000)
    : top100Data;

  console.log("Filtered data (" + filter + "):", filteredData);

  filteredData.forEach((entry, index) => {
    const rank = index + 1;
    const div = document.createElement("div");
    let emoji = '';
    let className = ''; 

    switch (rank) {
      case 1:
        emoji = '<img src="https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/a7d4def4-4669-47c4-8f32-69fd1a5957f7/1.png?format=500w" class="top100-img">';
        className = 'top-1';
        break;
      case 2:
        emoji = '<img src="https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/218fd9b0-4601-4562-8e6e-5ac51ade338d/2.png?format=500w" class="top100-img">';
        className = 'top-2';
        break;
      case 3:
        emoji = '<img src="https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/87ebbbe1-2c57-4ede-94db-c9149439d12f/3.png?format=500w" class="top100-img">';
        className = 'top-3';
        break;
      case 4:
        emoji = '<img src="https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/7b792ffd-0171-4f0a-986c-57405951b30e/4.png?format=500w" class="top100-img">';
        className = 'top-4';
        break;
      case 5:
        emoji = '<img src="https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/7c1579c9-1700-4809-a5ca-28a4028be473/5.png?format=500w" class="top100-img">';
        className = 'top-5';
        break;
      default:
        emoji = '🔹';
    }

    div.className = `top-entry ${className}`;
    const isOnline = entry.lastActive && Date.now() - entry.lastActive < 5 * 60 * 1000;
    const statusDot = `<span class="status-indicator ${isOnline ? "online" : "offline"}"></span>`;

    div.innerHTML = `
      ${emoji} ${statusDot}
      <span style="margin-left: 8px;">
        ${rank}. <strong>${entry.username}</strong>: ${entry.score}
        <img src="https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/3838e9be-f08a-4e78-815f-4b1688594e17/ce291931-bdae-4385-a65e-fea28b922266_removalai_preview.png?format=500w"
             alt="click icon"
             style="height: 22px; margin-left: 6px; vertical-align: middle;" />
      </span>
    `;

    list.appendChild(div);
  });
}







function openTop100() {
  const popup = document.getElementById("top100Popup");
  popup.style.display = 'block';
  updateTop100List(currentTop100Filter); // ✅ use current filter, no reset
}



function closeTop100() {
  document.getElementById("top100Popup").style.display = 'none';
}

function filterTop100(mode) {
  currentTop100Filter = mode;
  updateTop100List(mode);

  // Visual highlight
  document.getElementById("showAllBtn").classList.remove("active");
  document.getElementById("showOnlineBtn").classList.remove("active");

  if (mode === 'all') {
    document.getElementById("showAllBtn").classList.add("active");
  } else {
    document.getElementById("showOnlineBtn").classList.add("active");
  }
}




function finalizeSendMessage() {
  const input = document.getElementById("chatInput");
  const message = input.value.trim();
  const now = Date.now();

  const messageData = {
    user: username,
    text: message,
    timestamp: now,
    special: username === "Lost_Soul_ZZZ"
  };

  if (replyTarget) {
    messageData.replyTo = { ...replyTarget };
    replyTarget = null;
    input.placeholder = "Scrie un mesaj…";
  }

  chatRef.push(messageData);
  lastMessageTimestamp = now;
  input.value = '';
  document.getElementById("cancelEditBtn").style.display = "none";
}

 
function handleAdminAction(action, targetUser) {
  const password = prompt(`Introdu parola de admin pentru ${action.toUpperCase()}:`);
  if (password !== "admin123") {
    alert("Parolă incorectă!");
    return;
  }

  if (action === "mute") {
    const minutes = prompt("Pentru câte minute să fie mutat?");
    const reason = prompt("Motivul mute-ului:");
    const until = Date.now() + parseInt(minutes || 0) * 60 * 1000;
firebase.database().ref(`mutes/${normalize(targetUser)}`).set({ until, reason });
const minutesLeft = Math.ceil((until - Date.now()) / 60000);
chatRef.push({
  user: "Lost_Soul_ZZZ",
  text: `l-a mutat pe ${targetUser} pentru: ${reason} (${minutesLeft} minute rămase)`,
  timestamp: Date.now(),
  special: true
});
  }

  if (action === "block") {
    firebase.database().ref(`ipBans/${targetUser}`).set({ banned: true, timestamp: Date.now() });
    alert(`${targetUser} a fost banat.`);
  }
}

</script>

  <style>
    html, body { 
  margin: 0;   
  padding: 0; 
  overflow-x: hidden; /* Optional: hides horizontal scroll */
  overflow-y: auto;   /* Enables vertical scroll */
  width: 100%;
  height: auto; /* Allow height to expand with content */
}

 .plane-flyer {
  position: absolute;
  top: 20px;
  left: -240px;
  height: 100px;
  transition: left 5s linear;
  z-index: 20;
  pointer-events: none;
}

  img.plane-photo {
    position: absolute;
    width: 60px;
    border-radius: 50%;
    z-index: 9998;
    transition: top 3s ease-in;
    pointer-events: auto;
  }




   #gameArea {
  position: relative;
  width: 100%;
  height: 100vh;
  /* background-image: url(...);  ← lasă asta comentat sau scoate-l */
  background-size: cover;
  background-position: center;
  overflow: hidden;
  z-index: 0;
  transition: background-image 1s ease-in-out;
}

    #kevin {
  position: absolute;
  width: 120px;
  height: 120px;
  background-image: url('https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/192e30da-bdaa-47cc-9de6-472d696fa466/KEVINUTA+13-Photoroom.png?format=500w');
  background-size: contain;
  background-repeat: no-repeat;
  background-position: center;
  transition: left 0.3s ease, top 0.3s ease, width 0.3s ease, height 0.3s ease;
  z-index: 9999; /* 🔥 Adăugat: îl pune în față */
}

#inventoryBtn {
  position: fixed;
  bottom: 310px; /* 👈 just above top100Btn (255px) with ~65px spacing */
  right: 15px;   /* 👈 same right alignment as Top100 */
  width: 72px;
  height: 72px;
  background: none;
  border: none;
  cursor: pointer;
  z-index: 105000;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

#inventoryBtn:hover {
  transform: scale(1.07); /* ✅ clean scale effect */
}



#inventoryPopup {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 400px;
  max-width: 90vw;
  height: auto;
  max-height: calc(100vh - 32px);
  padding: 20px;
  background: linear-gradient(145deg, #1a1a1a, #2e2e2e);
  border: 2px solid #facc15;
  border-radius: 16px;
  display: flex;
  flex-direction: column;
  overflow: hidden; /* ❌ disables scrolling here */
  box-shadow: 0 0 12px #facc15, 0 0 24px #facc15;
  color: #f8f8f8; 
  font-family: 'Press Start 2P', monospace;
  box-sizing: border-box;
  z-index: 100001;
}




@media (max-width: 500px) {
  #inventoryPopup {
    width: 90vw;
    padding: 12px;
    transform: translate(-50%, -50%) scale(0.85); /* shrink visually */
  }

  .inventory-slot {
    transform: scale(0.9); /* optional: shrink slots slightly */
  }
}


#inventoryHeader {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-weight: bold;
  font-size: 14px;
  color: #facc15;
  margin-bottom: 10px;
  border-bottom: 1px solid #444;
  padding-bottom: 6px;
}


#closeInventoryBtn {
  background: none;
  border: none;
  font-size: 18px;
  color: #facc15; 
  cursor: pointer;
  transition: transform 0.2s;
}

#closeInventoryBtn:hover {
  transform: scale(1.2);
}


#inventoryTabs {
  display: flex;
  gap: 10px;
  margin-bottom: 10px;
}

#inventoryTabs button {
  flex: 1;
  padding: 6px;
  border: none;
  border-radius: 8px;
  background-color: #2d2d2d;
  color: #fff;
  font-weight: bold;
  cursor: pointer;
  transition: background 0.2s;
  box-shadow: 0 0 5px #111;
}

#inventoryTabs button.active {
  background-color: #facc15;
  color: #000;
  box-shadow: 0 0 10px #facc15;
}




.inventory-section {
  display: grid;
  grid-template-columns: repeat(auto-fit, 72px);
  gap: 20px;
  width: 100%;
  height: 100%;
  padding: 16px;              /* keep if you want inner spacing */
  margin: 0;
  background: rgba(0, 0, 0, 0.5);  /* black bg */
  border-radius: 16px;
  box-sizing: border-box;
  overflow-y: auto;
  scrollbar-width: none;
  justify-content: center;
}




.inventory-section::-webkit-scrollbar {
  display: none;
}

.inventory-section {
  scrollbar-width: none; /* Firefox */
}



    @keyframes goldGlow {
  0% {
    box-shadow:
      0 0 0 3px #f5a623,
      0 0 15px rgba(255, 184, 0, 0.7),
      inset 0 0 8px rgba(255, 215, 0, 0.5);
  }
  50% {
    box-shadow:
      0 0 0 3px #ffd700,
      0 0 25px rgba(255, 215, 0, 1),
      inset 0 0 15px rgba(255, 255, 0, 0.8);
  }
  100% {
    box-shadow:
      0 0 0 3px #f5a623,
      0 0 15px rgba(255, 184, 0, 0.7),
      inset 0 0 8px rgba(255, 215, 0, 0.5);
  }
}

#scoreBoard {
  position: absolute;
  top: 10px;
  left: 10px;
  color: white;
  font-size: 24px;
  background-color: rgba(0, 0, 0, 0.5);
  padding: 10px;
  border-radius: 8px;
  z-index: 10;

  /* Glowing gold border */
  border: 4px solid #ffd700;
  animation: goldGlow 2s infinite ease-in-out;

  /* ✅ Match rubyBoard text style */
  font-weight: bold;
  text-shadow: 0 0 2px #fff3f3;
}


    .emoji {
      position: absolute;
      font-size: 40px;
      cursor: pointer;
      transition: top 0.3s ease, left 0.3s ease;
    }
    #modeMenu {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 20px;
      z-index: 100;
    }
    #modeMenu button {
      padding: 15px 30px;
      font-size: 24px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      background-color: #fff;
      color: #000;
      transition: transform 0.2s;
    }
    #modeMenu button:hover {
      transform: scale(1.1);
    }
    #modeMenu input {
      padding: 15px;
      font-size: 20px;
      border-radius: 10px;
      border: none;
      width: 250px;
    }
    /* Phone Popup */
    #phonePopup {
      display: none;
      position: absolute;
      top: 25%;
      left: 50%;
      transform: translate(-50%, -25%);
      width: 250px;
      height: 450px;
      background: #333;
      border-radius: 30px;
      box-shadow: 0 0 20px rgba(0,0,0,0.8);
      z-index: 10002;
      overflow: hidden;
      border: 4px solid #666;
    }
    #phoneHeader {
      background: #111;
      color: white;
      padding: 10px;
      text-align: center;
      font-weight: bold;
    }
    #phoneBody {
      padding: 20px;
      color: white;
      font-size: 16px;
      height: 300px;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
    }
    .phone-buttons {
      display: flex;
      justify-content: space-around;
      padding: 10px;
    }
    .phone-buttons button {
      padding: 10px 20px;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      cursor: pointer;
    }
    .btn-green {
      background: #4caf50;
      color: white;
    }
    .btn-red {
      background: #f44336;
      color: white;
    }
    #closePopup {
      position: absolute;
      top: 5px;
      right: 10px;
      color: white;
      font-size: 20px; 
      cursor: pointer;
    } 
 @keyframes goldGlow {
  0% {
    box-shadow:
      0 0 0 3px #f5a623,
      0 0 15px rgba(255, 184, 0, 0.7),
      inset 0 0 8px rgba(255, 215, 0, 0.5);
  }
  50% {
    box-shadow:
      0 0 0 3px #ffd700,
      0 0 25px rgba(255, 215, 0, 1),
      inset 0 0 15px rgba(255, 255, 0, 0.8);
  }
  100% {
    box-shadow:
      0 0 0 3px #f5a623,
      0 0 15px rgba(255, 184, 0, 0.7),
      inset 0 0 8px rgba(255, 215, 0, 0.5);
  }
}

@keyframes goldGlow {
  0% {
    box-shadow:
      0 0 0 3px #f5a623,
      0 0 15px rgba(255, 184, 0, 0.7),
      inset 0 0 8px rgba(255, 215, 0, 0.5);
  }
  50% {
    box-shadow:
      0 0 0 3px #ffd700,
      0 0 25px rgba(255, 215, 0, 1),
      inset 0 0 15px rgba(255, 255, 0, 0.8);
  }
  100% {
    box-shadow:
      0 0 0 3px #f5a623,
      0 0 15px rgba(255, 184, 0, 0.7),
      inset 0 0 8px rgba(255, 215, 0, 0.5);
  }
}

#leaderboard {
  position: absolute;
  top: 10px;
  right: 10px;
  background: rgba(0, 0, 0, 0.6);
  color: white;
  padding: 12px;
  border: 4px solid #ffb800;
  border-radius: 14px;
  animation: goldGlow 2s ease-in-out infinite;
  backdrop-filter: blur(4px);
  text-shadow: 1px 1px 2px black;

  font-size: 14px;
  max-width: 260px;
  width: fit-content;
  z-index: 10;
}

#leaderboard h3 {
  margin: 0 0 10px 0;
  text-align: center;
  font-size: 16px;
  color: #ffd700;
}

#leaderboard .entry {
  display: flex;
  gap: 6px;
  align-items: center;
  margin-bottom: 6px;
  white-space: nowrap;
}

#leaderboard .entry:last-child {
  margin-bottom: 0;
}

/* Mobile tweaks */
@media (max-width: 480px) {
  #leaderboard {
    top: 5px;
    right: 5px;
    padding: 8px;
    font-size: 12px;
    max-width: 90vw;
    width: auto;
  }

  #leaderboard h3 {
    font-size: 14px;
  }
}


@keyframes flyPutin {
  0% {
    top: 100%;
    left: -200px;
    transform: rotate(-20deg);
  }
  50% {
    top: 30%;
    left: 50%;
    transform: rotate(0deg);
  }
  100% {
    top: 60px;
    left: 50%;
    transform: rotate(5deg);
  }
}

#slotPopup {
  position: fixed;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%);
  background: #222;
  border: 3px solid #ffcc00;
  border-radius: 15px;
  padding: 20px;
  width: 320px;
  z-index: 10001;
  font-family: monospace, monospace;
  color: white;
  text-align: center;
  display: none; /* hidden by default */
}
#slotPopup h3 {
  margin: 0 0 10px 0;
  font-weight: normal;
}
#slotPopup .instructions {
  font-size: 14px;
  margin-bottom: 15px;
  line-height: 1.3;
  text-align: left;
}
#slotGrid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  grid-gap: 8px;
  margin-bottom: 15px;
}
.slotCell {
  background: #333;
  border-radius: 8px;
  font-size: 28px;
  padding: 12px 0;
  color: white;
  box-shadow: inset 0 0 5px #000;
  user-select: none;
  transition: background-color 0.3s ease;
}
.spinAnimation {
  animation: spinFlash 0.8s ease-in-out 3;
}
@keyframes spinFlash {
  0%, 100% { background-color: #333; }
  50% { background-color: #ffcc00; }
}
.matchHighlight {
  background-color: #44cc44 !important;
  box-shadow: 0 0 10px #44cc44;
}
#closeSlotBtn {
  cursor: pointer;
  position: absolute;
  top: 8px;
  right: 10px;
  font-weight: bold;
  font-size: 22px;
  color: #ff4444;
  user-select: none;
  border: none;
  background: transparent;
}
#resultMessage {
  font-weight: bold;
  margin-top: 10px;
  min-height: 24px;
}
#spinSlotBtn {
  padding: 8px 20px;
  font-size: 16px;
  border-radius: 10px;
  border: none;
  background: #ffcc00;
  cursor: pointer;
}
#gameModeMenu {
  display: flex;
  justify-content: center;
  gap: 30px;
  margin-top: 30px;
  z-index: 999;
  position: relative;
}

#modeMenu {
  position: absolute;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background-color: rgba(0, 0, 0, 0.8);
  z-index: 9999;

  display: flex;
  flex-direction: column;
  justify-content: center;  /* vertical centering */
  align-items: center;      /* horizontal centering */
  gap: 20px;                /* spacing between elements */
  padding: 0 20px;          /* side padding for small screens */
  box-sizing: border-box;
}

#modeMenu h1 {
  color: white;
  margin: 0 0 10px 0;
  text-align: center;
  font-size: 28px;
  user-select: none;
}

#usernameInput {
  width: 80vw;
  max-width: 300px;
  height: 60px;
  background-image: url('https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/80113c2a-1f48-43c7-a584-fd51f5d1fd91/89522989-98aa-48c4-a724-7658620a0dd6_removalai_preview.png?format=1000w');
  background-size: 100% 100%;
  background-repeat: no-repeat;
  background-position: center;
  background-color: transparent !important;
  border: none;
  outline: none;
  padding: 18px 25px;
  font-size: 20px;
  color: white;
  font-weight: bold;
  box-sizing: border-box;
  text-align: left;
  margin: 0 auto; /* center input */
}

.mode-button {
  width: 25vw;
  max-width: 120px;
  aspect-ratio: 1.5 / 1;
  background-size: contain;
  background-repeat: no-repeat;
  background-position: center;
  background-color: transparent !important;
  border: none;
  outline: none;
  margin: 0 8px;
  padding: 0;
  display: inline-block;
  cursor: pointer;
  user-select: none;
  transition: transform 0.2s;
}

.mode-button:hover {
  transform: scale(1.05);
}

#modeButtonsContainer {
  display: flex;
  justify-content: center;
  gap: 10px;
  flex-wrap: nowrap;
  width: 100%;
  padding: 10px;
  box-sizing: border-box;
  overflow-x: auto; /* allows horizontal scroll if absolutely needed */
}

.mode-button {
  flex: 1 1 auto;
  width: 80px;
  padding: 10px;
  font-size: 14px;
  text-align: center;
  box-sizing: border-box;
}

/* MOBILE FIX: Shrink buttons more for very small screens */
@media (max-width: 480px) {
  .mode-button {
    width: 70px;
    padding: 8px;
    font-size: 13px;
  }
}




  #usernameInput {
    width: 90vw;
    max-width: 280px;
  }
}


html, body {
  width: 100%;
  height: 100%;
  margin: 0;
  padding: 0;
  overflow: hidden;
}


/* Lock the button to bottom-right corner of the screen */
#fullscreenBtn {
  position: fixed;
  bottom: 60px;
  right: 20px;
  width: 64px;
  height: 64px;
  background: none;
  border: none;
  cursor: pointer;
  z-index: 99998; /* Very high to stay on top */
  padding: 0;
}

#fullscreenBtn img {
  width: 100%;
  height: auto;
  display: block;
  pointer-events: none; /* So click targets button, not the image */
}

#fullscreenBtn:hover img {
  transform: scale(1.1);
}




.meteor-trail {
  position: absolute;
  width: 100%;
  height: 100%;
  background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, transparent 80%);
  border-radius: 50%;
  animation: trailFade 0.5s linear forwards;
  pointer-events: none;
}

@keyframes trailFade {
  from {
    transform: scale(1);
    opacity: 1;
  }
  to {
    transform: scale(2);
    opacity: 0;
  }
}


.particle {
  position: absolute;
  width: 10px;
  height: 10px;
  opacity: 1;
  border-radius: 2px;
  box-shadow: 0 0 8px rgba(255, 100, 0, 0.9);
  animation: explodePixel 900ms ease-out forwards;
  pointer-events: none;
  z-index: 9999;
}

@keyframes explodePixel {
  0% { 
    transform: translate(0, 0) scale(1);
    opacity: 1;
  }
  100% {
    transform: translate(var(--dx), var(--dy)) scale(1.5);
    opacity: 0;
  }
}
  #rememberMe:checked::after {
    content: '✔';
    color: #ffd700;
    font-weight: bold;
    font-size: 22px;
    position: absolute;
    top: -2px;
    left: 5px;
  }
@keyframes redGlow {
  0% { text-shadow: 0 0 5px #ff0000, 0 0 10px #aa0000; }
  50% { text-shadow: 0 0 20px #ff3333, 0 0 30px #cc0000; }
  100% { text-shadow: 0 0 5px #ff0000, 0 0 10px #aa0000; }
}


#mainMenuOverlay {
  position: fixed;
  z-index: 99998;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
background: radial-gradient(circle at center, #0f0c29, #302b63, #24243e);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 30px;
} 

#titleImage {
  width: 250px;
  animation: flyCrash 2s ease-out forwards;
}

@keyframes flyCrash {
  0% {
    transform: translateY(-100vh) rotate(-15deg) scale(1.2);
    opacity: 0;
  }
  60% {
    transform: translateY(10px) rotate(3deg);
    opacity: 1;
  }
  100% {
    transform: translateY(0) rotate(0deg);
  }
}

#mainButtons {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  justify-content: center;
  align-items: center;
}

.mainBtn {
  background: none;
  border: none;
  padding: 0;
  margin: 0;
  width: 80px;
  aspect-ratio: 1;
  cursor: pointer;
  transition: transform 0.2s;
}

.mainBtn img {
  width: 100%;
  height: auto;
  display: block;
}

.mainBtn:hover {
  transform: scale(1.05);
}

/* Responsive: stack on mobile */
@media (max-width: 600px) {
  #mainButtons {
    flex-direction: column;
    gap: 10px;
  }
  .mainBtn {
    width: 100px;
  }
}

.popupWindow {
  position: fixed;
  z-index: 1000000;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: #1a1a1a;
  color: white; /* force white text */
  border: 3px solid #ffd700;
  border-radius: 12px;
  padding: 20px;
  width: 90vw;
  max-width: 360px;
  max-height: 75vh;
  overflow-y: auto;
  text-align: left;
  box-shadow: 0 0 10px #ffd700, 0 0 20px #ffea00, 0 0 30px #ffd700;
  animation: goldGlow 2s ease-in-out infinite;
}

/* Fix nested list bullets and indentation */
.popupWindow ul {
  padding-left: 12px;  /* reduce left padding from 20px to 12px */
  margin-left: 0;      /* remove margin to avoid extra space */
  margin-bottom: 1em;
}

.popupWindow ul ul {
  padding-left: 16px;  /* nested lists slightly more indented */
  margin-left: 0;
  list-style-type: disc !important;
  color: white;
}




.popupClose {
  position: absolute;
  top: 6px;
  right: 10px;
  font-size: 22px;
  font-weight: bold;
  color: red;
  cursor: pointer;
  user-select: none;
}


#ageGateOverlay {
  position: fixed;
  top: 0; left: 0;
  width: 100vw; height: 100vh;
  background: rgba(0, 0, 0, 0.95);
  color: white;
  z-index: 100000;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  padding: 30px 20px;
  text-align: center;
  font-family: sans-serif;
  box-sizing: border-box;
}

#ageGateOverlay h2 {
  font-size: 28px;
  color: #ffcc00;
  margin-bottom: 20px;
}

#ageGateOverlay p {
  max-width: 700px;
  font-size: 16px;
  line-height: 1.6;
  margin: 0 auto 30px auto;
}

#ageGateOverlay button {
  background-color: #00aa00;
  color: white;
  padding: 15px 25px;
  font-size: 16px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  max-width: 300px;
  margin: 10px;
}

#ageGateOverlay button:nth-child(2) {
  background-color: #aa0000;
}

#underageMessage {
  display: none;
  margin-top: 30px;
  color: #ff4444;
  font-weight: bold;
  font-size: 18px;
}

/* Responsive tweak for mobile screens */
@media (max-width: 480px) {
  #ageGateOverlay h2 {
    font-size: 22px;
  }

  #ageGateOverlay p {
    font-size: 14px;
  }

  #ageGateOverlay button {
    width: 100%;
    max-width: 100%;
    font-size: 15px;
    padding: 12px;
  }

  #underageMessage {
    font-size: 16px;
  } 
}


.top-entry {
  display: flex;
  align-items: center;
  padding: 10px;
  border-radius: 12px;
  margin-bottom: 8px;
  font-weight: bold;
  font-size: 16px;
  transition: transform 0.2s;
}
.top-entry:hover {
  transform: scale(1.03);
}
.top-1 {
  background: linear-gradient(to right, gold, #8B4513);
  box-shadow: 0 0 12px gold;
  border: 3px solid gold;
  color: white;
}
.top-2 {
  background: linear-gradient(to right, silver, gray);
  box-shadow: 0 0 12px white;
  border: 3px solid silver;
  color: black;
}
.top-3 {
  background: linear-gradient(to right, #cd7f32, #8b5a2b);
  box-shadow: 0 0 12px #cd7f32;
  border: 3px solid #cd7f32;
  color: white;
}
.top-4 {
  background: linear-gradient(to right, #0f52ba, #1e3f66);
  box-shadow: 0 0 12px #3399ff;
  border: 3px solid #0f52ba;
  color: white;
}
.top-5 {
  background: linear-gradient(to right, #0f9d58, #064e3b);
  box-shadow: 0 0 12px #00ff88;
  border: 3px solid #0f9d58;
  color: white;
}

.top-entry:not(.top-1):not(.top-2):not(.top-3):not(.top-4):not(.top-5) {
  outline: 1px solid gray;
  outline-offset: -1px;
}


#top100Popup {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: #1a1a1a;
  color: white;
  border: 3px solid #ffd700;
  border-radius: 12px;
  padding: 20px;
  width: 90vw;
  max-width: 360px;
  max-height: 75vh;
  overflow-y: auto;
  text-align: left;
  box-shadow: 0 0 10px #ffd700, 0 0 20px #ffea00, 0 0 30px #ffd700;
  animation: goldGlow 2s ease-in-out infinite;
  display: none; /* hidden by default */
  z-index: 105000;
}


#gameOverPopup {
  position: fixed;
  top: 0; left: 0;
  width: 100vw;
  height: 100vh;
  background-color: rgba(0, 0, 0, 0.9);
  z-index: 9999;
  display: none;
  justify-content: center;
  align-items: center;
  flex-direction: column;
}

.blood-overlay {
  position: absolute;
  top: 0; left: 0;
  width: 100%;
  height: 100%;
  background-image: url('https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/d9fd4a98-241a-4f49-a019-ef9733646a20/blood_overlay_transparent.png?format=1000w');
  background-size: cover;
  background-repeat: no-repeat;
  background-position: center;
  opacity: 0.85;
  pointer-events: none;
  z-index: 10000;
}

.game-over-image {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  max-height: 90vh;
  width: auto;
  height: auto;
  object-fit: contain;
  z-index: 10001;
  pointer-events: none;
}

.game-over-content {
  text-align: center;
  z-index: 10002;
  position: relative;
  margin-top: 250px;
}

.game-over-content h1 {
  font-size: 56px;
  color: #cc0000;
  font-family: 'Arial Black', sans-serif;
  text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.5);
  margin: 0;
}

.game-over-content button {
  margin-top: 30px;
  font-size: 24px;
  padding: 12px 24px;
  background-color: black;
  color: white;
  border: 3px solid red;
  border-radius: 10px;
  cursor: pointer;
  box-shadow: 0 0 10px red;
  transition: transform 0.2s;
}

.game-over-content button:hover {
  transform: scale(1.1);
}


.status-indicator {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  display: inline-block;
  margin-right: 6px;
  box-shadow: 0 0 6px rgba(0,0,0,0.4);
}

.online {
  background-color: #00ff00;
  box-shadow: 0 0 6px #00ff00, 0 0 12px #00ff00;
}

.offline {
  background-color: #ff0000;
  box-shadow: 0 0 6px #ff0000, 0 0 12px #ff0000;
}

#pauseBtn { 
  position: fixed;
  bottom: 120px;
  right: 20px;
  width: 64px;
  height: 64px;
  background: none;
  border: none;
  cursor: pointer;
  z-index: 99998;
  padding: 0;
}

#pauseBtn img {
  width: 100%;
  height: auto;
  display: block;
  pointer-events: none;
  transition: transform 0.2s;
}

#pauseBtn:hover img {
  transform: scale(1.1);
}

#pauseOverlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  backdrop-filter: blur(10px);
  background-color: rgba(0, 0, 0, 0.6);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 10001;
  overflow: hidden;
  /* Removed invalid 'display: absolute;' */
}

.pauseContent {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center; 
}

/* Desktop: Add margin only on larger screens */
@media (min-width: 769px) {
  .pauseContent {
    margin-top: 300px;
  }
}

.pauseText {
  font-size: 2rem;
  color: white;
  margin-bottom: 20px;
  text-align: center;
}

.pauseMenuButtons {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 20px;
}

.pauseButtonImage {
  width: 150px;
  height: auto;
  cursor: pointer;
}

@media (max-width: 768px) {
  .pauseMenuButtons {
    flex-direction: column;
    align-items: center;
    gap: 1px; /* Reduce vertical space */
  }

  .pauseButtonImage { 
    width: 120px;
  }

  /* Adjust margin for mobile */
  .pauseContent {
    margin-top: 60px; /* <-- adjust value as needed */
  }
}

.pauseTextImage {
  max-width: 100%;
  width: 200px; /* Adjust as needed */
  height: auto;
  display: block;
}

   /* Desktop only: adjust pause text image size */
@media (min-width: 769px) {
  .pauseTextImage {
    width: 300px; /* or whatever size you want on PC */
  }
}


/* 1) Outer “phone” shell */
.phone-shell {
  position: fixed;
  bottom: 20px;
  left: 20px;
  width: 260px;
  height: 460px;
  background: #1f1e36;            /* very dark purple */
  border: 3px solid #4a3f8c;       /* subtle purple bezel */
  border-radius: 32px;
  box-shadow: 0 6px 14px rgba(0,0,0,0.4);
  overflow: hidden;
    z-index: 15000;
  display: flex;
  flex-direction: column;
}

/* 2) Fake notch */
.phone-notch {
  height: 25px;
  width: 80px;
  margin: 6px auto;
  background: #1f1e36;
  border-radius: 3px;
  box-shadow: inset 0 1px 2px rgba(0,0,0,0.3);
}

/* 3) Screen area */
#chatContainer {
  flex: 1;
  background: #2b2a4d;   /* dark purple screen */
  display: flex;
  flex-direction: column;
}

/* 4) Message viewport */
#chatMessages {
  flex: 1;
  padding: 10px;
  overflow-y: auto;
  color: #e0e0f8;       /* light lavender */
  font-size: 14px;
  line-height: 1.4;
}

/* 5) Footer bar */
.chat-footer {
  flex: 0 0 56px;
  display: flex;
  align-items: center;
  padding: 0 8px;
  background: #312f57;   /* slightly lighter purple */
  gap: 6px;
}


#chatInput::placeholder {
  color: #bbb;
}

/* Send arrow */
.send-btn {
  width: 36px;
  height: 36px;
  border: none;
  border-radius: 50%;
  background: #ffd700;  /* gold button */
  color: #2b2a4d;
  font-size: 18px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* Hover states */
.emoji-btn:hover { background: #7a6ddc; }
.send-btn:hover  { background: #e6c200; }

/* 1) ensure the container fills its parent and uses flex */
#chatContainer {
  position: relative;      /* for absolute children */
  display: flex;
  flex-direction: column;
  height: 100%;            /* fill .phone-shell */
}

/* 2) make messages scrollable, with a bottom padding so nothing is hidden */
#chatMessages {
  flex: 1;                 /* take all available space above footer */
  overflow-y: auto;
  padding-bottom: 56px;    /* ≥ height of .chat-footer to avoid overlap */
}

/* 3) pin the footer to the bottom of #chatContainer */
/* move the footer up 16px */
/* lift input bar 8px off the bottom */
.chat-footer {
  position: absolute;
  bottom: 6px;
  left: 0;
  right: 0;
  height: 70px;
  display: flex;
  align-items: center;
  padding: 0 8px;
  background: #312f57;
  gap: 6px;
  z-index: 1;
}

#chatMessages {
  position: absolute;
  top: 0;
  bottom: 62px;
  left: 0;
  right: 0;
  padding: 10px;
  overflow-y: auto;
  /* scrollbar hidden rules… */
}



/* hide scrollbar in WebKit browsers (Chrome, Safari, Opera) */
#chatMessages::-webkit-scrollbar {
  display: none;
}

/* hide the checkbox itself */
#chatSlider {
  display: none;
}

/* the purple handle on the left edge */
#chatSliderLabel {
  position: fixed;
  top: 50%;
  left: 0;
  /* only translateY now */
  transform: translateY(-50%);
  width: 40px;
  height: 80px;
  background: #6557b7;
  border-radius: 0 12px 12px 0; 
  cursor: pointer;
  z-index: 10002;
} 

/* put an icon in it */
#chatSliderLabel::after {
  content: '💬';
  display: block;
  width: 100%;
  height: 100%;
  line-height: 80px;
  text-align: center;
  font-size: 24px;
  color: #fff;
  transition: transform 0.3s;
}
/* rotate when open */
#chatSlider:checked + #chatSliderLabel::after {
  transform: rotate(180deg);
}

/* slide the chat off-screen by default */
.phone-shell {
  position: fixed;
  bottom: 20px;
  left: 20px;
  width: 260px;
  height: 460px;
  transition: transform 0.3s ease;
  transform: translateX(-300px);
  z-index: 15000; /* same as before */
}

/* when the box is checked, slide it back in */
#chatSlider:checked ~ .phone-shell {
  transform: translateX(0);
}

/* style the × button */
.phone-shell .chat-close {
  position: absolute;
  top: 8px;
  right: 8px;
  background: transparent;
  border: none;
  font-size: 24px;
  color: white;
  cursor: pointer;
  z-index: 20001;
  line-height: 1;
}

/* optional hover state */
.phone-shell .chat-close:hover {
  color: #ffd700;
}

/* chat message bubbles */
#chatMessages .message-bubble {
  display: inline-block;          /* shrink to fit text */
  background-color: rgba(101,87,183,0.9); /* semi-opaque purple */
  color: #fff;
  border-radius: 12px;
  padding: 6px 10px;
  margin-bottom: 6px;
  max-width: 80%;                 /* never full width */
  word-wrap: break-word;
  line-height: 1.3;
}

 /* ─── Make messages stack one-per-line ───────────────── */
 #chatMessages {
  display: flex;
  flex-direction: column;
  gap: 4px;                 /* space between message bubbles */
  padding: 10px 10px 80px;  /* ⬅ bottom padding added */
  overflow-y: auto;         /* make sure scrolling works */
}


  /* ─── Base bubble styling ───────────────────────────── */
  #chatMessages .message-bubble {
    /* flex children shrink-to-fit by default */
    max-width: 80%;
    padding: 6px 10px;
    border-radius: 12px;
    color: #fff;
    word-wrap: break-word;
    line-height: 1.3;
  }

  /* ─── Other players ──────────────────────────────────── */
  #chatMessages .message-bubble.other {
    align-self: flex-start;  /* left side */
    background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
  }

  /* ─── Your messages ─────────────────────────────────── */
  #chatMessages .message-bubble.mine {
    align-self: flex-end;    /* right side */
    background: #3498db;     /* solid blue */
  }


.chat-overlay {
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.7);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1001;
}

.chat-overlay__box {
  background: #222;
  padding: 16px;
  border-radius: 8px;
  text-align: center;
  color: #fff;
}

.chat-overlay__btns {
  margin-top: 12px;
  display: flex;
  flex-direction: column;  /* stack vertically */
  gap: 10px;
  align-items: center;     /* center the buttons */
}

.btn-green {
  background: #4caf50;
  color: #fff;
  padding: 8px 16px;
  border: none;
  border-radius: 4px;
}

.btn-red {
  background: #f44336;
  color: #fff;
  padding: 8px 16px;
  border: none;
  border-radius: 4px;
}

/* shake animation */
@keyframes shake {
  0%,100% { transform: translateY(-50%) rotate(0deg); }
  20% { transform: translateY(-50%) rotate(-5deg); }
  40% { transform: translateY(-50%) rotate(5deg); }
  60% { transform: translateY(-50%) rotate(-5deg); }
  80% { transform: translateY(-50%) rotate(5deg); }
}

/* glowing red outline */
#chatSliderLabel.new-msg::after {
  text-shadow:
    0 0 5px #ff0000,
    0 0 10px #ff0000,
    0 0 20px #ff4444;
  animation: shake 0.5s ease-in-out infinite;
}

.message-bubble.top-1 {
  background: linear-gradient(to right, gold, #8B4513) !important;
  box-shadow: 0 0 12px gold !important;
  border: 3px solid gold !important;
  color: white !important;
}

.message-bubble.top-2 {
  background: linear-gradient(to right, silver, gray) !important;
  box-shadow: 0 0 12px white !important;
  border: 3px solid silver !important;
  color: black !important;
}

.message-bubble.top-3 {
  background: linear-gradient(to right, #cd7f32, #8b5a2b) !important;
  box-shadow: 0 0 12px #cd7f32 !important;
  border: 3px solid #cd7f32 !important;
  color: white !important;
}

.message-bubble.top-4 {
  background: linear-gradient(to right, #0f52ba, #1e3f66) !important;
  box-shadow: 0 0 12px #3399ff !important;
  border: 3px solid #0f52ba !important;
  color: white !important;
}

.message-bubble.top-5 {
  background: linear-gradient(to right, #0f9d58, #064e3b) !important;
  box-shadow: 0 0 12px #00ff88 !important;
  border: 3px solid #0f9d58 !important;
  color: white !important;
}


.chat-opacity {
  position: absolute;
  top: 8px;
  left: 8px;
  background: transparent;
  border: none;
  font-size: 22px;
  color: white;
  cursor: pointer;
  z-index: 20001;
}

.chat-opacity:hover {
  color: #ffd700;
}

.transparent-chat {
  opacity: 0.4;
  pointer-events: none; /* clicks go through */
  transition: opacity 0.3s ease-in-out;
}

/* Allow interactions in the message area and the dot menu */
.transparent-chat .chat-opacity,
.transparent-chat .chat-footer,
.transparent-chat .chat-footer *,
.transparent-chat .message-bubble,
.transparent-chat .dot-menu,
.transparent-chat .dot-menu * {
  pointer-events: auto;
  z-index: 10; /* or higher if needed */
}

.chat-input-group {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-top: 6px; /* adjust this value to move it lower */
}

.chat-footer {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 6px 8px;
  background: #312f57;
  gap: 6px;
  height: auto;
}

.chat-icons-row {
  display: flex;
  gap: 6px;
  justify-content: center;
}

.icon-btn {
  width: 28px;
  height: 28px;
  border: none;
  border-radius: 50%;
  background: #6557b7;
  color: white;
  font-size: 16px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0;
}

.icon-btn:hover {
  background: #7a6ddc;
}

.chat-input-row {
  display: flex;
  width: 100%;
  gap: 6px;
}

#chatInput {
  flex: 1;
  height: 32px;
  font-size: 14px;
  padding: 0 10px;
  border-radius: 16px;
  border: none;
}

.send-btn {
  width: 36px;
  height: 36px;
  border: none;
  border-radius: 50%;
  background: #ffd700;
  color: #2b2a4d;
  font-size: 18px;
  cursor: pointer;
}


#voiceUI {
  display: flex;
  justify-content: center;  /* center horizontally */
  align-items: center;
  flex-wrap: wrap;
  gap: 6px;
  background: #2b2a4d;
  padding: 4px;
  border-radius: 10px;
  width: 100%;
  box-sizing: border-box;
}


#recordBtn,
#sendAudioBtn,
#deleteAudioBtn {
  padding: 4px 10px;
  font-size: 13px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  background-color: #6557b7;
  color: white;
}

#recordBtn:hover,
#sendAudioBtn:hover,
#deleteAudioBtn:hover {
  background-color: #666;
}

#audioPreview {
  width: 120px;
  height: 28px;
  border-radius: 6px;
  background: #444;
}

.message-bubble audio {
  width: 140px;
  height: 28px;
  margin: 4px 0 0 0; /* only top margin */
  border-radius: 6px;
  background-color: transparent;
  color-scheme: dark;
  display: block;
}


.message-bubble {
  position: relative;
}

.icon-btn {
  background: transparent;
  border: none;
  font-size: 16px;
  color: white;
  cursor: pointer;
}

.dot-menu {
  display: flex;
  flex-direction: column;
  justify-content: center;  /* ✨ This centers the 3 dots vertically */
  align-items: center;
  gap: 2px;
  cursor: pointer;
  padding: 4px;
  height: 100%; /* ✨ Makes sure it matches bubble height */
}

.dot {
  width: 4px;
  height: 4px;
  background-color: white;
  border-radius: 50%;
}

#cancelEditBtn {
  position: absolute;
  right: 7px;  /* adjust based on your layout */
  bottom: 50px; /* position above send button */
  font-size: 18px;
  background: transparent;
  border: none;
  color: white;
  cursor: pointer;
  display: none;
  z-index: 2;
}

#cancelEditBtn:hover {
  color: #7a6ddc;
}

#cancelRecordBtn {
  background-color:#7a6ddc;
  color: white;
  border: none;
  padding: 6px 12px;
  border-radius: 6px;
  cursor: pointer;
}

#cancelRecordBtn:hover {
  background-color: #666;
}

.notif-badge {
  position: absolute;
  top: -6px;
  right: -6px;
  background: red;
  color: white;
  font-size: 14px;
  font-weight: bold;
  padding: 0px 6px;
  border-radius: 50%;
  box-shadow: 0 0 12px 2px red;
  pointer-events: none;
  z-index: 9999;
  display: none; /* hidden by default */
}

#chatSliderLabel.shake {
  animation: shake 0.4s ease;
}

@keyframes shake {
  0% { transform: translate(0, 0); }
  25% { transform: translate(2px, -2px); }
  50% { transform: translate(-2px, 2px); }
  75% { transform: translate(2px, 2px); }
  100% { transform: translate(0, 0); }
}
#chatSliderLabel.new-msg {
  box-shadow: 0 0 10px red;
  animation: pulse 1s infinite;
}
@keyframes pulse {
  0% { box-shadow: 0 0 5px red; }
  50% { box-shadow: 0 0 15px red; }
  100% { box-shadow: 0 0 5px red; }
}

@keyframes pulseDev {
  0% { box-shadow: 0 0 12px #ff33cc; }
  50% { box-shadow: 0 0 24px #ff33cc; }
  100% { box-shadow: 0 0 12px #ff33cc; }
}

.special-lost-soul {
  background: linear-gradient(to right, #191970, #000000); /* dark blue to black */
  color: #00d4ff;
  font-weight: bold;
  padding: 10px 16px;
  border-radius: 10px;
  box-shadow: 0 0 8px #00d4ff, 0 0 16px #00d4ff;
  max-width: 70%;
  word-wrap: break-word;
}


@keyframes devPulse {
  0%   { color: #ffffff; text-shadow: 0 0 6px #00e0ff; }
  50%  { color: #00e0ff; text-shadow: 0 0 12px #00e0ff; }
  100% { color: #ffffff; text-shadow: 0 0 6px #00e0ff; }
}

.message-bubble.special-lost-soul span {
  animation: devPulse 1.5s ease-in-out infinite;
  font-weight: bold;
}

#top100Popup {
  /* ...stilurile existente... */
  overflow-y: scroll; /* sau auto, dacă preferi */
  scrollbar-width: none; /* Firefox */
}

#top100Popup::-webkit-scrollbar {
  display: none; /* Chrome, Safari */
}

@media (max-width: 480px) {
  #modeMenu {
    justify-content: flex-start;
    padding-top: 80px; /* împinge totul mai sus spre mijloc */
    gap: 16px;
  }

  #usernameInput {
    margin-top: 0; /* anulăm margin inutil */
  }

  #modeButtonsContainer {
    margin-top: 0;
  }
}

/* ─── Switch muzică ─────────────────────────────────── */
.music-switch{
  position:fixed;
  top:20px;
  right:20px;
  width:60px;           /* lungimea track-ului */
  height:32px;          /* grosimea */
  z-index:9999;
}
.music-switch input{
  opacity:0;            /* ascunde checkbox-ul nativ */
  width:0; height:0;
}
.music-switch .slider{
  position:absolute;
  inset:0;
  border-radius:32px;
  background:#e74c3c;   /* roșu – OFF */
  cursor:pointer;
  transition:background .3s;
}
.music-switch .slider::before{
  content:"";
  position:absolute;
  height:24px; width:24px;
  top:4px; left:4px;           /* poziția bilei în OFF */
  border-radius:50%;
  background:#fff;
  box-shadow:0 0 6px rgba(0,0,0,.35);
  transition:transform .3s;
}
.music-switch input:checked + .slider{
  background:#2ecc71;   /* verde – ON */
}
.music-switch input:checked + .slider::before{
  transform:translateX(28px);  /* mută bila la dreapta */
}

.music-switch-wrapper {
  position: fixed;
  top: 10px;
  right: 20px;
  z-index: 9999;
  text-align: center;
  font-family: sans-serif;
  font-size: 14px;
  color: white;
}
.music-label {
  display: block;
  margin-bottom: 4px;
  font-weight: bold;
}


/* Buton deschidere sunet */
/* ───── Buton "Sunet" ───── */
.sound-btn {
  position: fixed;
  bottom: 180px;
  right: 23px;
  width: 64px;
  height: 64px;
  background: url('https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/79d093fe-5060-4d27-af89-2f065017a570/9336289a-5cb0-46f8-b72b-f841eec61619_removalai_preview.png?format=300w') no-repeat center center;
  background-size: cover;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  z-index: 105000;
  transition: transform 0.2s ease;
}

.sound-btn:hover {
  transform: scale(1.1);
}


/* ───── Popup Overlay ───── */
#soundPopup {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: #1a1a1a;
  color: white;
  border: 3px solid #ffd700;
  border-radius: 12px;
  padding: 20px;
  width: 90vw;
  max-width: 260px;
  max-height: 260px;
  overflow-y: auto;
  text-align: left;
  box-shadow: 0 0 10px #ffd700, 0 0 20px #ffea00, 0 0 30px #ffd700;
  animation: goldGlow 2s ease-in-out infinite;
  display: none;
  z-index: 15000;
}
}

/* ───── Conținut Popup – Stil Clasamant ───── */
.sound-content {
  background: rgba(0, 0, 0, 0.95);
  color: white;
  width: 320px;
  margin: 100px auto;
  padding: 20px 20px 30px 20px;
  border-radius: 12px;
  position: relative;
  box-shadow: 0 0 12px #FFD700, 0 0 25px rgba(255, 215, 0, 0.5);
  text-align: center;
  font-family: 'Verdana', sans-serif;
  border: 2px solid gold;
}

/* ───── Titlu popup ───── */
.sound-content h3 {
  margin-top: 0;
  margin-bottom: 10px;
  font-size: 20px;
  font-weight: bold;
}

/* ───── Buton Închidere (X) ───── */
.close-btn {
  position: absolute;
  top: 8px;
  right: 12px;
  font-size: 22px;
  color: red;
  cursor: pointer;
  font-weight: bold;
}
.close-btn:hover {
  color: white;
}

/* ───── Switch Muzică ───── */
.music-switch {
  width: 60px;
  height: 32px;
  position: relative;
  display: inline-block;
}
.music-switch input {
  opacity: 0;
  width: 0;
  height: 0;
}
.slider {
  position: absolute;
  inset: 0;
  background-color: #e74c3c; /* roșu = oprit */
  border-radius: 32px;
  transition: 0.3s;
  cursor: pointer;
}
.slider::before {
  content: "";
  position: absolute;
  height: 24px;
  width: 24px;
  top: 4px;
  left: 4px;
  background-color: white;
  border-radius: 50%;
  transition: transform 0.3s;
  box-shadow: 0 0 6px rgba(0,0,0,0.4);
}
input:checked + .slider {
  background-color: #2ecc71; /* verde = pornit */
}
input:checked + .slider::before {
  transform: translateX(28px);
}

.music-switch-wrapper-in-popup {
  margin-top: 50px;
  display: flex;
  flex-direction: column;
  align-items: center; /* centru pe orizontală */
}


.music-label {
  display: block;
  margin-bottom: 8px;
  font-weight: bold;
  font-size: 15px;
}

.music-switch {
  margin-left: 30px; /* alternativă dacă nu vrei să folosești transform */
}

.emoji {
  position: absolute;
  font-size: 40px;
  cursor: pointer;
  transition: top 0.3s ease, left 0.3s ease;
  z-index: 100; /* sau orice peste 10 */
}


  .image-button {
    padding: 8px 16px;
    background: #ffd700;
    color: #2b2a4d;
    border: none;
    border-radius: 8px;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.2s, transform 0.1s;
  }

  .image-button:hover {
    background: #e6c200;
    transform: scale(1.05);
  }

  .image-button.cancel {
    background: #f44336;
    color: white;
  }

  .image-button.cancel:hover {
    background: #d32f2f;
  }



#loadingBarContainer {
  position: absolute;
  top: 80px; /* Mai jos decât 20px */
  left: 50%;
  transform: translateX(-50%);
  width: 300px;
  background: rgba(0, 0, 0, 0.85);
  border: 2px solid #ffd700;
  border-radius: 8px;
  padding: 10px;
  display: none;
  z-index: 100000;
  text-align: center;
  box-shadow: 0 0 10px #ffd700;
}


#loadingBar {
  width: 0%;
  height: 8px;
  background: #00d4ff;
  border-radius: 4px;
  margin-bottom: 8px;
  transition: width 10s linear;
}

#loadingText {
  color: white;
  font-size: 14px;
}

#leaderboard {
  display: none;
}

@keyframes slideDown {
  from { transform: translateY(-150%); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}

@keyframes slideUp {
  from { transform: translateY(0); opacity: 1; }
  to { transform: translateY(-150%); opacity: 0; }
}

#leaderboard.animate-down {
  animation: slideDown 0.5s ease forwards;
}

#leaderboard.animate-up {
  animation: slideUp 0.5s ease forwards;
}

#toggleLeaderboardBtn:hover {
  transform: scale(1.08);
  box-shadow: 0 0 15px rgba(255, 200, 0, 0.9);
}

@keyframes popOutFromToggle {
  from {
    transform: translate(var(--dx), var(--dy)) scale(0.3);
    opacity: 0;
  }
  to {
    transform: translate(0, 0); /* ✅ REMOVE scale(1) */
    opacity: 1;
  }
}

@keyframes popInToToggle {
  from {
    transform: translate(0, 0); /* ✅ REMOVE scale(1) */
    opacity: 1;
  }
  to {
    transform: translate(var(--dx), var(--dy)) scale(0.3);
    opacity: 0;
  }
}


.ui-animate-in {
  animation: popOutFromToggle 0.4s ease-out forwards;
}

.ui-animate-out {
  animation: popInToToggle 0.4s ease-in forwards;
}



#top100Btn:hover img {
  transform: scale(1.1);
}

#fullscreenBtn,
#pauseBtn,
#openSoundBtn,
#top100Btn,
#inventoryBtn {
  display: none;
}





#openSoundBtn {
  position: fixed;
  bottom: 180px;
  right: 23px;
  width: 64px;
  height: 64px;
  background: none;
  border: none;
  cursor: pointer;
  z-index: 105000;
  padding: 0;
}

#openSoundBtn img {
  width: 100%;
  height: auto;
  display: block;
  pointer-events: none;
  transition: transform 0.2s;
}

#openSoundBtn:hover img {
  transform: scale(1.1);
}

.popupWindow,
#slotPopup,
#top100Popup,
#mutePopup,
#gameOverPopup,
#pauseOverlay,
#resultMessage,
.popupWindow *:not(button):not(input):not(select),
#slotPopup *:not(button):not(input):not(select),
#top100Popup *:not(button):not(input):not(select),
#mutePopup *:not(button):not(input):not(select),
#pauseOverlay *:not(button):not(input):not(select),
#resultMessage *:not(button):not(input):not(select) {
  color: white !important;
}

#escapeMiniGame {
  position: absolute;
  bottom: 60px;
  left: 50%;
  transform: translateX(-50%);
  width: 320px;
  z-index: 10050;
  display: flex;
  flex-direction: column;
  align-items: center;
}

#escapeBar {
  width: 100%;
  height: 30px;
  background: linear-gradient(to right, #d00000, #fca311, #2dc653);
  border: 3px solid #000;
  border-radius: 12px;
  position: relative;
  overflow: hidden;
}

#escapeProgress {
  position: absolute;
  top: 0;
  left: 0;
  height: 100%;
  width: 50%;
  background-color: rgba(255, 255, 255, 0.15);
  transition: width 0.05s linear;
  z-index: 1;
}

#escapeEmojiInBar {
  position: absolute;
  top: 50%;
  transform: translate(-50%, -50%);
  font-size: 24px;
  z-index: 2;
  pointer-events: none;
}

@keyframes pulseBar {
  from {
    transform: scaleX(1);
    box-shadow: 0 0 6px limegreen;
  }
  to {
    transform: scaleX(1.03);
    box-shadow: 0 0 14px limegreen;
  }
}

#globalMessageBanner {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: linear-gradient(to right, #191970, #000000); /* ca special-lost-soul */
  color: #00d4ff;
  font-size: 20px;
  font-weight: bold;
  padding: 12px 24px;
  border-radius: 10px;
  box-shadow: 0 0 8px #00d4ff, 0 0 16px #00d4ff;
  z-index: 999999;
  text-align: center;
  max-width: 90vw;
  opacity: 0;
  transition: opacity 0.5s ease, transform 0.5s ease;
}

    
#globalMessageBanner {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: linear-gradient(to right, #0a1a40, #000010);
  color: #00d4ff;
  padding: 8px 14px;
  border-radius: 12px;
  font-size: 13px;
  font-weight: bold;
  line-height: 1.4;
  max-width: 90vw;
  width: fit-content;
  text-align: center;
  z-index: 9999;
  box-shadow: 0 0 8px #00d4ff;
  display: inline-block;
  word-break: break-word;
  white-space: normal; /* allow wrap if needed */
}


.global-label {
  font-size: 22px;
  animation: pulseLabel 1.4s ease-in-out infinite;
  color: #00ffff;
}

.global-text {
  margin-top: 6px;
  font-size: 20px;
  color: #00d4ff;
}

@keyframes pulseLabel {
  0%, 100% { text-shadow: 0 0 6px #00ffff, 0 0 12px #00ffff; }
  50%      { text-shadow: 0 0 18px #00ffff, 0 0 28px #00d4ff; }
}

@media (max-width: 480px) {
  #globalMessageBanner {
    font-size: 12px;
    padding: 6px 10px;
    line-height: 1.3;
  }
}

.global-label {
  font-size: 18px;
  margin-bottom: 8px;
  color: cyan;
  text-shadow: 0 0 6px #00ffff;
}
.global-text {
  font-size: inherit;
}

@media (min-width: 768px) {
  .global-text {
    font-size: 22px !important; /* or any size you prefer */
  }
}

@media (min-width: 768px) {
  .global-label {
    font-size: 28px !important;
    font-weight: bold;
  }

  .global-text {
    font-size: 20px !important;
  }
}

@media (max-width: 767px) {
  #globalMessageBanner {
    top: 120px !important;
    position: fixed !important;
    left: 50% !important;
    transform: translateX(-50%) !important;
    z-index: 9999 !important;
  }
}


.filter-btn {
  background-color: #222;
  color: white;
  border: 2px solid #ffd700;
  padding: 8px 16px;
  margin: 4px;
  border-radius: 10px;
  font-weight: bold;
  cursor: pointer;
  transition: background-color 0.2s, transform 0.15s;
}

.filter-btn:hover {
  background-color: #333;
  transform: scale(1.05);
}

.filter-btn.active {
  background-color: #ffd700;
  color: black;
  box-shadow: 0 0 6px #ffea00, 0 0 12px #ffd700;
}


#soundPopup {
  z-index: 105000; /* sau orice valoare vrei */
  position: relative; /* sau absolute/fixed, dacă vrei să funcționeze z-index */
}

.top-img {
  width: 24px;
  height: 24px;
  vertical-align: middle;
  margin-right: 8px;
  border-radius: 6px;
  object-fit: contain;
}


.top100-img {
  width: 35px; /* sau orice vrei */
  height: 35px;
  vertical-align: middle;
  margin-right: 6px;
  border-radius: 4px;
  object-fit: contain;
}
#leaderboardList {
  list-style: none;
  padding-left: 0;
  margin-left: 0;
}

@keyframes rubyGlow {
  0% {
    box-shadow:
      0 0 0 3px #ff4444,
      0 0 15px rgba(255, 50, 90, 0.7),
      inset 0 0 8px rgba(255, 100, 120, 0.5);
  }
  50% {
    box-shadow:
      0 0 0 3px #ff6666,
      0 0 25px rgba(255, 80, 100, 1),
      inset 0 0 15px rgba(255, 120, 140, 0.8);
  }
  100% {
    box-shadow:
      0 0 0 3px #ff4444,
      0 0 15px rgba(255, 50, 90, 0.7),
      inset 0 0 8px rgba(255, 100, 120, 0.5);
  }
}

@keyframes rubyPop {
  0%   { transform: scale(1); box-shadow: none; }
  50%  { transform: scale(1.2); box-shadow: 0 0 15px #ff4488, 0 0 25px #ff88aa; }
  100% { transform: scale(1); box-shadow: none; }
}

.ruby-impact {
  animation: rubyPop 0.4s ease-in-out;
}

#rubyBoard {
  position: absolute;
  top: 80px;
  left: 10px;
  display: none; /* hidden until discovered */
  opacity: 0;
  transition: opacity 1s ease;

  display: flex;
  align-items: center;
  gap: 6px;

  font-size: 24px;
  font-weight: bold;
  color: white;

  padding: 6px 12px;
  background-color: rgba(0, 0, 0, 0.5);
  border: 4px solid #ff4444;
  border-radius: 8px;
  z-index: 10;

  animation: rubyGlow 2s infinite ease-in-out;
  text-shadow: 0 0 2px #fff3f3;
}

.ruby-icon {
  height: 24px;
  vertical-align: middle;
  pointer-events: none;
}

#noSignalOverlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: black;
  z-index: 105001;
  overflow: hidden;
  pointer-events: none;
}

.glitch-text {
  font-size: 40px;
  font-family: monospace;
  color: white;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  white-space: nowrap;
  z-index: 10;
  text-shadow:
    2px 0 red,
    -2px 0 cyan;
  animation: glitch 1s infinite;
}

.glitch-text::before,
.glitch-text::after {
  content: attr(data-text);
  position: absolute;
  left: 0;
  width: 100%;
  overflow: hidden;
  color: white;
  clip: rect(0, 0, 0, 0);
}

.glitch-text::before {
  animation: glitchTop 1s infinite;
  color: #f0f;
  z-index: 11;
}

.glitch-text::after {
  animation: glitchBottom 1s infinite;
  color: #0ff;
  z-index: 9;
}

.scanlines {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: repeating-linear-gradient(
    to bottom,
    rgba(255, 255, 255, 0.03) 0px,
    rgba(255, 255, 255, 0.03) 1px,
    transparent 1px,
    transparent 2px
  );
  z-index: 5;
  animation: flicker 0.1s infinite;
}

.noise {
  position: absolute;
  width: 100%;
  height: 100%;
  background: url('https://media.giphy.com/media/oEI9uBYSzLpBK/giphy.gif') repeat;
  opacity: 0.08;
  animation: shake 0.2s steps(2) infinite;
  z-index: 6;
}

@keyframes glitch {
  0% { transform: translate(-50%, -50%); }
  20% { transform: translate(-51%, -49%); }
  40% { transform: translate(-49%, -52%); }
  60% { transform: translate(-50%, -50%); }
  80% { transform: translate(-52%, -48%); }
  100% { transform: translate(-50%, -50%); }
}

@keyframes glitchTop {
  0% { clip: rect(0, 9999px, 0, 0); }
  10% { clip: rect(0, 9999px, 10px, 0); }
  20% { clip: rect(0, 9999px, 0, 0); }
  30% { clip: rect(5px, 9999px, 15px, 0); }
  100% { clip: rect(0, 9999px, 0, 0); }
}

@keyframes glitchBottom {
  0% { clip: rect(0, 9999px, 0, 0); }
  10% { clip: rect(20px, 9999px, 40px, 0); }
  20% { clip: rect(0, 9999px, 0, 0); }
  30% { clip: rect(25px, 9999px, 45px, 0); }
  100% { clip: rect(0, 9999px, 0, 0); }
}

@keyframes flicker {
  0%, 100% { opacity: 0.05; }
  50% { opacity: 0.15; }
}

@keyframes shake {
  0% { transform: translate(0px, 0px); }
  25% { transform: translate(1px, -1px); }
  50% { transform: translate(-1px, 1px); }
  75% { transform: translate(1px, 1px); }
  100% { transform: translate(-1px, -1px); }
}




#memoryTimer {
  font-size: 18px;
  margin-bottom: 12px;
  font-family: monospace;
  color: #0ff;
}

#memoryGrid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
  gap: 10px;
  width: 100%;
  max-width: 420px;
}

.memory-card {
  width: 100%;
  aspect-ratio: 1 / 1;
  background: #222;
  font-size: 26px;
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  user-select: none;
  border: 2px solid #555;
  border-radius: 8px;
  transition: 0.2s ease-in-out;
}

.memory-card.revealed {
  background: #444;
}

.memory-card.matched {
  background: #00c776;
  color: #fff;
  pointer-events: none;
  border: 2px solid lime;
}


#memoryGame.popup,
#memoryGame.popup * {
  font-weight: bold;
  font-family: 'Share Tech Mono', monospace;
  color: #0ff;
  text-shadow: 0 0 3px #0ff;
}


#memoryGame,
#memoryGameClassic { 
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 92vw;
  max-width: 380px;
  max-height: 90vh;
  overflow-y: auto;
  background: linear-gradient(145deg, #1e1e1e, #2e2e2e);
  box-shadow: 0 0 20px 4px var(--theme-glow, #0ff);
  border: 2px solid var(--theme-border, #0ff);
  color: var(--theme-color, #cceeff);
  font-family: 'Share Tech Mono', monospace;
  z-index: 20001;
  padding: 16px;
  border-radius: 12px;
  display: flex;
  flex-direction: column;
  align-items: center;
  box-sizing: border-box;
}



#memoryGridClassic {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
  gap: 10px;
  width: 100%;
  max-width: 360px;
}

 
#memoryTimerClassic {
  font-size: 18px;
  margin-bottom: 12px;
  font-weight: bold; 
  color: #ffcc00;
  text-shadow: 0 0 4px #ffd700;
  font-family: 'Share Tech Mono', monospace;
}

#mainButtons {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 12px;
}

/* Mobile layout: 2 smaller buttons per row */
@media (max-width: 600px) {
  #mainButtons {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    padding: 0 10px;
  }

  .mainBtn {
    width: 100%;
    max-width: 120px;     /* 🔽 tighter max-width */
    font-size: 13px;       /* 🔽 smaller text */
    padding: 6px 8px;      /* 🔽 smaller padding */
  }
}

/* Hide scrollbar for WebKit (Chrome, Safari, Edge) */
#updateLogPopup::-webkit-scrollbar {
  display: none;
}

/* Hide scrollbar for Firefox */
#updateLogPopup {
  scrollbar-width: none;       /* Firefox */
  -ms-overflow-style: none;    /* IE/Edge */
}


/* Modern game-style inventory grid */
.inventory-slot {
  width: 72px;
  height: 72px;
}



.inventory-slot:hover {
  transform: scale(1.1);
}

.slot-bg {
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, #1e1e1e, #3a3a3a);
  border: 2px solid #ffd700;
  border-radius: 12px;
  box-shadow: 0 0 10px #facc15, inset 0 0 6px #000;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  font-size: 36px;
}

.slot-icon {
  z-index: 1;
  filter: drop-shadow(0 0 2px white);
}

.slot-count {
  position: absolute;
  bottom: 4px;
  right: 6px;
  background: rgba(255, 255, 255, 0.9);
  color: #000;
  font-size: 12px;
  font-weight: bold;
  padding: 2px 6px;
  border-radius: 6px;
  box-shadow: 0 0 4px rgba(0,0,0,0.5);
  z-index: 2;
}


.popup-overlay {
  position: fixed;
  top: 0; left: 0;
  width: 100vw; height: 100vh;
  background: rgba(0, 0, 0, 0.8);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 100004;
}

.popup-content {
  background: linear-gradient(145deg, #1a1a1a, #2a2a2a);
  border: 2px solid #facc15;
  border-radius: 16px;
  padding: 30px 20px;
  color: white;
  text-align: center;
  font-family: 'Press Start 2P', monospace;
  width: 100%;
  max-width: 300px;
  min-height: 400px;
  box-shadow:
    0 0 12px #facc15,
    0 0 20px #facc15,
    0 0 40px #facc15;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  gap: 16px;
  box-sizing: border-box;
}


.popup-emoji {
  font-size: 48px;
  margin-bottom: 10px;
}

.popup-name {
  font-size: 18px;
  margin-bottom: 6px;
}

.popup-type {
  font-size: 14px;
  margin-bottom: 6px;
  font-weight: bold;
}

.popup-type.good {
  color: #00ff88;
}

.popup-type.bad {
  color: #ff5555;
}

.popup-effect {
  font-size: 13px;
  margin-bottom: 6px;
}

.popup-score {
  font-size: 16px;
  font-weight: bold;
  margin-bottom: 10px;
}


#emojiInfoPopup .popup-content {
  width: 400px;                        /* slightly wider */
  min-height: 500px;                   /* taller for space */
  background: linear-gradient(145deg, #1a1a1a, #2e2e2e);
  border: 2px solid #facc15;
  border-radius: 16px;
  padding: 24px;                       /* more breathing room */
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  box-shadow:
    0 0 10px #facc15,
    0 0 25px #facc15,
    0 0 40px #facc15;
  font-family: 'Press Start 2P', monospace;
  color: #f8f8f8;
  text-align: center;
  gap: 16px;                           /* spacing between lines */
}

.popup-emoji {
  font-size: 64px;                     /* big emoji */
}

.popup-name {
  font-size: 16px;
  font-weight: bold;
}

.popup-type.good {
  color: #00ff99;
}

.popup-type.bad {
  color: #ff4444;
}

.popup-effect,
.popup-score,
.popup-funny {
  font-size: 12px;
  line-height: 1.4;
  color: #ccc;
}


.popup-content button {
  background: #facc15; /* golden */
  color: #1a1a1a; /* dark text on gold */
  border: none;
  padding: 10px 20px;
  font-family: 'Press Start 2P', monospace;
  font-size: 12px;
  border-radius: 12px;
  box-shadow:
    0 0 6px #facc15,
    0 0 12px #facc15;
  cursor: pointer;
  transition: background 0.2s, transform 0.2s;
  text-align: center;
}

.popup-content button:hover {
  background: #ffe45e; /* lighter gold on hover */
  transform: scale(1.03);
}

.popup-emoji {
  font-size: 72px;
  text-shadow: 0 0 8px #ffffffaa;
}

.popup-name {
  font-size: 18px;
  font-weight: 700;
  color: #fff;
  text-transform: uppercase;
  text-shadow: 0 0 4px #facc15;
  letter-spacing: 1.5px;
}

.popup-type {
  font-size: 14px;
  font-weight: bold;
  text-transform: uppercase;
  letter-spacing: 1px;
  padding: 4px 12px;
  border-radius: 10px;
  background: #222;
  text-shadow: 0 0 4px #000;
}

.popup-type.good {
  color: #00ff99;
  box-shadow: 0 0 6px #00ff99aa;
}

.popup-type.bad {
  color: #ff4444;
  box-shadow: 0 0 6px #ff4444aa;
}

.popup-effect {
  font-size: 14px;
  color: #dddddd;
  font-weight: 600;
  text-shadow: 0 0 4px #ffffff33;
}

.popup-score {
  font-size: 16px;
  font-weight: bold;
  color: #facc15;
  text-shadow: 0 0 6px #facc15;
}

.popup-funny {
  font-size: 12px;
  font-style: italic;
  color: #cccccc;
  text-shadow: 0 0 2px #888;
}

.popup-content button {
  background: #facc15;
  color: #111;
  border: none;
  padding: 12px 24px;
  font-size: 12px;
  font-family: 'Press Start 2P', monospace;
  border-radius: 12px;
  box-shadow: 0 0 10px #facc15, 0 0 20px #facc15;
  cursor: pointer;
  margin-top: 16px;
  text-transform: uppercase;
  transition: transform 0.2s;
}

.popup-content button:hover {
  transform: scale(1.05);
  background: #ffe45e;
}

#dialogOptions button {
  background: linear-gradient(to bottom, #444, #222);
  border: 1px solid rgba(255, 255, 255, 0.15);
  color: #fff;
  font-size: 16px;
  font-family: 'Segoe UI', sans-serif;
  padding: 10px 20px;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s ease;
  box-shadow: 0 2px 5px rgba(0,0,0,0.3);
  text-shadow: 0 1px 1px rgba(0,0,0,0.4);
}

#dialogOptions button:hover {
  background: linear-gradient(to bottom, #555, #333);
  transform: scale(1.05);
  box-shadow: 0 4px 10px rgba(0,0,0,0.4);
}

#dialogOptions button:active {
  transform: scale(0.96);
  background: linear-gradient(to bottom, #333, #111);
}

/* 🧱 Container */
#dialogContainer {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  z-index: 9999;
  display: none;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  pointer-events: none;
  animation: fadeInUp 0.3s ease forwards;
}

/* 🧍 Avatar */
#dialogAvatar {
  width: 100px;
  height: auto;
  margin-left: -10px;
  margin-bottom: -12px;
  z-index: 105002;
  pointer-events: none;
  filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.6));
  transform: translateY(-5px);
  opacity: 0;
  animation: fadeIn 0.3s ease forwards 0.1s;
}

/* 💬 Dialog Bar */
#dialogBar {
  width: 100%;
  background: linear-gradient(to top, rgba(25, 25, 25, 0.95), rgba(45, 45, 45, 0.9));
  backdrop-filter: blur(12px) saturate(130%);
  color: #fefefe;
  padding: 24px 32px;
  font-size: 18px;
  font-family: 'Segoe UI', sans-serif;
  display: flex;
  align-items: center;
  min-height: 110px;
  border-top: 2px solid rgba(255, 255, 255, 0.12);
  box-shadow: 0 -8px 24px rgba(0, 0, 0, 0.5);
  border-radius: 18px 18px 0 0;
  pointer-events: auto;
  transform: translateY(100%);
  opacity: 0;
  animation: slideUpFade 0.3s ease forwards 0.1s;
}

/* 💬 Text */
#dialogText {
  margin-bottom: 12px;
  line-height: 1.5;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
  font-weight: 500;
}

/* 🔘 Options */
#dialogOptions {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
}

/* 🎨 Button Styles (same as before) */
#dialogOptions button {
  background: linear-gradient(to bottom, #444, #222);
  border: 1px solid rgba(255, 255, 255, 0.15);
  color: #fff;
  font-size: 16px;
  font-family: 'Segoe UI', sans-serif;
  padding: 10px 20px;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s ease;
  box-shadow: 0 2px 5px rgba(0,0,0,0.3);
  text-shadow: 0 1px 1px rgba(0,0,0,0.4);
}

#dialogOptions button:hover {
  background: linear-gradient(to bottom, #555, #333);
  transform: scale(1.05);
  box-shadow: 0 4px 10px rgba(0,0,0,0.4);
}

#dialogOptions button:active {
  transform: scale(0.96);
  background: linear-gradient(to bottom, #333, #111);
}

/* 🔁 Animation Keyframes */
@keyframes slideUpFade {
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

@keyframes fadeInUp {
  from {
    transform: translateY(30px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

@keyframes fadeIn { 
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.popup-container {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: #111;
  border: 2px solid #ffcc00;
  border-radius: 12px;
  box-shadow: 0 0 20px #ffcc00;
  padding: 20px;
  z-index: 20002;
  display: none;
}

.popup-inner {
  display: flex;
  flex-direction: column;
  align-items: center;
}


.tab-row button {
  background: #222;
  color: #fff;
  border: none;
  padding: 10px 16px;
  margin: 4px;
  border-radius: 6px;
  font-weight: bold;
  cursor: pointer;
}

.tab-row button.active {
  background: #ffcc00;
  color: #000;
}

#offersSection {
  display: grid;
  grid-template-columns: repeat(3, 1fr); /* ← 3 columns */
  gap: 12px;                              /* ← spacing between */
  padding: 10px;
  justify-items: center;
}

.popup-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  width: 100%;
  margin-bottom: 10px;
}

.popup-title {
  font-size: 20px;
  font-weight: bold;
  color: #fff;
  display: flex;
  align-items: center;
  gap: 6px;
}

.popup-close {
  background: #ff4444;
  color: white;
  border: none;
  font-size: 18px;
  padding: 6px 12px;
  border-radius: 6px;
  cursor: pointer;
  transition: background 0.2s ease;
}

.popup-close:hover {
  background: #ff2222;
}

.shop-ruby-icon {
  width: 12px;
  height: 12px;
  display: inline-block;
  object-fit: contain;
  margin-left: 2px;
}

.shop-price {
  background: rgba(255, 0, 0, 0.9); /* deep red */
  color: white;
  box-shadow: 0 0 6px rgba(255, 0, 0, 0.9); /* red glow */
  border-radius: 8px;
  padding: 2px 6px;
  display: flex;
  align-items: center;
  font-weight: bold;
  font-size: 12px;
  gap: 4px;
  position: absolute;
  bottom: 4px;
  right: 4px;
}
.flipped-screen {
  transform: rotate(180deg);
  transition: transform 0.5s ease-in-out;
}


@keyframes rainbowFlash {
  0%   { background-color: red; }
  20%  { background-color: orange; }
  40%  { background-color: yellow; }
  60%  { background-color: green; }
  80%  { background-color: blue; }
  100% { background-color: violet; }
}

.rainbow-flash {
  animation: rainbowFlash 0.3s infinite;
  transition: none !important;
}

#space-quiz-popup {
  position: fixed;
  top: 0; left: 0;
  width: 100vw; height: 100vh;
  background: transparent;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 99999;
  color: white;
  font-family: 'Orbitron', sans-serif;
}

.space-quiz-window {
  background: #111930;
  border: 2px solid #00f0ff;
  border-radius: 16px;
  padding: 30px;
  max-width: 600px;
  width: 90%;
  box-shadow: 0 0 20px #00f0ff;
  text-align: center;
  animation: pulseShadow 1.5s infinite alternate;
}

@keyframes pulseShadow {
  0% { box-shadow: 0 0 10px #00f0ff; }
  100% { box-shadow: 0 0 25px #00f0ff; }
}

.space-question {
  font-size: 20px;
  margin-bottom: 20px;
}

.space-options {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.space-option-btn {
  background: #1f273d;
  border: 2px solid #00f0ff;
  border-radius: 8px;
  padding: 12px;
  font-size: 16px;
  color: white;
  cursor: pointer;
  transition: 0.2s ease;
}

.space-option-btn:hover {
  background: #2a334a;
}

.space-feedback {
  margin-top: 15px;
  font-weight: bold;
  color: #ff6666;
}

#space-quiz-popup {
  font-family: 'Orbitron', sans-serif;
}

#powerTimer {
  display: none;
  position: absolute;
  top: 90px; /* adjust if needed */
  left: 10px;
  padding: 4px 12px;
  font-size: 16px;
  font-weight: bold;
  color: #00d4ff;
  background: rgba(0, 0, 0, 0.6);
  border: 2px solid #00d4ff;
  border-radius: 8px;
  box-shadow: 0 0 10px #00d4ff, 0 0 20px #00d4ff;
  text-shadow: 0 0 4px #000;
  z-index: 9999;
  transition: all 0.3s ease;
}

#powerTimer {
  transition: all 0.3s ease;
}

#powerTimer.pulsing {
  animation: pulse-red 1s infinite;
  color: red !important;
  text-shadow: 0 0 6px red, 0 0 12px red;
}

@keyframes pulse-red {
  0% {
    transform: scale(1);
    opacity: 1;
  }
  50% {
    transform: scale(1.1);
    opacity: 0.8;
  }
  100% {
    transform: scale(1);
    opacity: 1;
  }
}


.inventory-grid {
  display: grid !important;
  grid-template-columns: repeat(4, 80px) !important;
  gap: 12px;
  padding: 12px;
  justify-content: center;
}

.item-detail-overlay {
  position: fixed;
  top: 0; left: 0;
  width: 100vw; height: 100vh;
  background: rgba(0, 0, 0, 0.85);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 99999;
}

.item-popup {
  background: #1c1c1c;
  color: white;
  padding: 24px;
  width: 300px;
  border-radius: 18px;
  text-align: center;
font-family: 'Segoe UI', 'Helvetica Neue', sans-serif;
  box-shadow: 0 0 20px #ffcc00;
  position: relative;
}

.item-img {
  width: 72px;
  margin-bottom: 10px;
}

.item-title {
  font-size: 22px;
  font-weight: bold;
  margin-bottom: 8px;
  color: #ffff88;
}

.item-type {
  display: inline-block;
  padding: 4px 12px;
  border-radius: 12px;
  margin-bottom: 14px;
  font-size: 12px;
  background: #666;
  color: white;
}

.item-effect {
  font-size: 14px;
  margin-bottom: 12px;
}

.item-score {
  font-size: 16px;
  font-weight: bold;
  margin-bottom: 10px;
}

.item-funny {
  font-size: 13px;
  font-style: italic;
  opacity: 0.8;
  margin-bottom: 16px;
}

.item-popup button {
  background: #ffcc00;
  border: none;
  border-radius: 10px;
  padding: 10px 24px;
  font-weight: bold;
  font-size: 14px;
  color: black;
  cursor: pointer;
}


.item-detail-overlay {
  position: fixed;
  top: 0; left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0, 0, 0, 0.88);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 99999;
  padding: 20px; /* ca să nu se taie pe mobil */
  box-sizing: border-box;
}

.item-popup {
  background: #1c1c1c;
  color: white;
  padding: 24px 20px;
  max-width: 320px;
  width: 100%;
  border-radius: 18px;
  text-align: center;
  font-family: 'Orbitron', sans-serif;
  box-shadow: 0 0 20px #ffcc00;
  overflow-y: auto;
  max-height: 95vh; /* important! */
  box-sizing: border-box;
  position: relative;
}




.pet-follower {
  transition: left 0.05s linear, top 0.05s linear;
  position: absolute;
  pointer-events: none;
  z-index: 999;
}

  </style>
</head>
<body>  
<div id="modeMenu" style="display: none;">
  <img src="https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/449320c0-9960-4b26-9c96-a544c858cd78/ChatGPT+Image+May+30%2C+2025%2C+12_48_36+PM.png?format=300w" alt="Alege modul de joc">
  
  <input type="text" id="usernameInput" placeholder="Numele tău">
  
  <label style="
  display: flex;
  align-items: center;
  gap: 10px;
  justify-content: center;
  margin: 10px 0;
  cursor: pointer;
">
  <input type="checkbox" id="rememberMe" style="
    width: 28px;
    height: 28px;
    background-color: black;
    border: 3px solid #ffd700;
    border-radius: 6px;
    appearance: none;
    position: relative;
    cursor: pointer;
    margin: 0;
  ">

  <img src="https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/cf1c7f31-322a-4a19-939d-7edea75be812/tine-ma-minte-transparent.png?format=300w"
       alt="Ține-mă minte"
       style="height: 100px; pointer-events: none;">
</label>


  


 
  <div>
    <button class="mode-button" style="background-image: url('https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/d2cd8753-cad5-43cd-93bf-517866184b42/usor.png?format=500w');" onclick="attemptStart('usor')"></button>

    <button class="mode-button" style="background-image: url('https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/95e44287-03e4-425d-b5a4-5452347c3418/greu.png?format=500w');" onclick="attemptStart('greu')"></button>

    <button class="mode-button" style="background-image: url('https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/b33bcce9-d107-4d2d-943c-5b54d6f17ad8/turbo.png?format=500w');" onclick="attemptStart('turbo')"></button>
  </div>
</div>

<div id="loadingBarContainer">
  <div id="loadingBar"></div>
  <span id="loadingText">Jocul se încarcă, te rog așteaptă...</span>
</div>

<div id="gameArea">
  
  <div id="scoreBoard">Scor: 0</div>
<img
  id="inventoryBtn"
  src="https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/023b1271-86e4-412f-b897-bedcc58a6da2/ChatGPT+Image+Jun+26%2C+2025%2C+01_28_21+AM.png?format=500w"
/>


<div id="rubyBoard">
  <img
    src="https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/6601e0a9-5671-4016-a4f3-cb9b2d3d70ab/diamond+red.png?format=500w"
    alt="Rubine"
    class="ruby-icon"
  />
  <span id="rubyCount">0</span>
</div> 


  <button id="toggleLeaderboardBtn" style="
    position: absolute;
    top: 10px;
    right: 10px;
    z-index: 1000;
    background: linear-gradient(135deg, #ffcc00, #ffaa00);
    border: 2px solid #b37800;
    border-radius: 10px;
    padding: 8px 16px;
    color: #222;
    font-weight: bold;
    font-size: 15px;
    box-shadow: 0 0 8px rgba(255, 200, 0, 0.7);
    cursor: pointer;
    transition: transform 0.2s, box-shadow 0.2s;
    text-shadow: 1px 1px 2px rgba(255,255,255,0.3);
  ">
    🏆 Top 5
  </button>

  <div id="leaderboard">
    <h3>🏆 Top Jucători</h3>
    <ol id="leaderboardList"></ol> 
  </div>


  <div id="kevin"></div>




<div id="escapeMiniGame" style="display: none; position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%); flex-direction: column; align-items: center; gap: 16px; z-index: 10000;">
  <div style="width: 320px; height: 28px; background-color: #222; border: 3px solid #555; border-radius: 20px; overflow: hidden; position: relative;">
    <!-- Gradient bar wrapper -->
    <div id="escapeProgressWrapper" style="height: 100%; width: 100%; position: absolute; top: 0; left: 0;">
      <div id="escapeProgress" style="
        height: 100%;
        width: 50%;
        background: linear-gradient(to right, red, yellow, limegreen);
        border-radius: 20px 0 0 20px;
        transition: width 0.1s ease;
      "></div>
    </div>
    <!-- Emoji inside bar -->
    <div id="escapeEmojiInBar" style="
      position: absolute;
      top: 50%;
      transform: translate(-50%, -50%);
      font-size: 24px;
    "></div>
  </div>

  <!-- KEEPING your original button style -->
  <button id="escapeClickBtn" style="
    padding: 12px 28px;
    font-size: 18px;
    font-weight: bold;
    background-color: #00ff88;
    border: none;
    border-radius: 12px;
    color: black;
    cursor: pointer;
    box-shadow: 0 0 10px #00ff88, 0 0 20px #00ff88;
    transition: transform 0.2s;
  ">
    🖱️ Click Rapid să Scapi!
  </button>
</div>





<!-- 1) the hidden checkbox -->
<input type="checkbox" id="chatSlider" />

<!-- 2) wrapper for label + badge -->
<div id="chatToggleWrapper" style="position: relative; display: inline-block;">
  <label for="chatSlider" id="chatSliderLabel"></label>
  <span id="chatNotif" class="notif-badge" style="display: none;">!</span>
</div>

<!-- PHONE-STYLE CHAT CONTAINER -->
<div class="phone-shell">
<button onclick="toggleChatOpacity()" class="chat-opacity" title="Transparență chat">☁️</button>
<button class="chat-close" onclick="document.getElementById('chatSlider').checked = false">×</button>
  <div class="phone-notch"></div>

<!-- 🎨 COLOR PALETTE POPUP -->
<div id="colorPalettePopup" style="
  position: absolute;
  inset: 0;
  background: #222;
  color: white;
  padding: 16px;
  z-index: 10002;
  display: none;
  flex-direction: column;
  overflow-y: auto;
  box-sizing: border-box;
">
  <button onclick="toggleColorPopup()" style="
    position: absolute;
    top: 6px;
    right: 10px;
    background: none;
    border: none;
    font-size: 22px;
    color: white;
    cursor: pointer;
    z-index: 10003;
  ">×</button>

  <h4 style="margin: 0 0 12px 0; text-align: center;">🎨 Personalizează Culorile</h4>

  <div style="display: flex; flex-direction: column; gap: 12px;">
    <label>Header</label>
    <input type="color" id="colorHeader" style="width: 100%; height: 32px;">

    <label>Shell (fundal în spate)</label>
    <input type="color" id="colorShell" style="width: 100%; height: 32px;">

    <label>Footer</label>
    <input type="color" id="colorFooter" style="width: 100%; height: 32px;">

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
      <div>
        <label style="font-size: 12px;">Bula Ta (1)</label>
        <input type="color" id="myBubble1" style="width: 100%; height: 32px;">
      </div>
      <div>
        <label style="font-size: 12px;">Bula Ta (2)</label>
        <input type="color" id="myBubble2" style="width: 100%; height: 32px;">
      </div>
      <div>
        <label style="font-size: 12px;">Altă Persoană (1)</label>
        <input type="color" id="otherBubble1" style="width: 100%; height: 32px;">
      </div>
      <div>
        <label style="font-size: 12px;">Altă Persoană (2)</label>
        <input type="color" id="otherBubble2" style="width: 100%; height: 32px;">
      </div>
    </div>

    <div style="display: flex; justify-content: space-around; margin-top: 10px;">
      <button onclick="applyChatColors()" style="background: #4caf50; color: white; padding: 8px 16px; border: none; border-radius: 6px;">Aplică</button>
      <button onclick="resetChatColors()" style="background: #f44336; color: white; padding: 8px 16px; border: none; border-radius: 6px;">Resetează</button>
    </div>
  </div>
</div>


  <!-- ─── ADD THIS OVERLAY ────────────────────────────────── -->
<!-- CHAT ACCESS OVERLAY -->
<!-- CHAT ACCESS OVERLAY -->
<div id="chatAccessOverlay" style="
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.95);
    color: white;
    z-index: 10003;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 30px 20px;
    box-sizing: border-box;
    text-align: center;
">
  <h2 style="font-size: 28px; color: #ffcc00; margin-bottom: 20px;">
    🚫 Acces Chat Restricționat
  </h2>
  <p style="max-width: 80%; margin-bottom: 30px;">
    Pentru a folosi chat-ul, cumpără accesul cu 500 de puncte.
  </p>
  <!-- Changed flex-direction to column here -->
  <div style="display: flex; flex-direction: column; gap: 20px; width: 100%; max-width: 300px;">
    <button id="buyChat" style="
      background-color: #00aa00;
      color: white;
      padding: 12px 24px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      width: 100%;
    ">
      ✅ Cumpără pentru 500 scor
    </button>
    <button id="laterChat" style="
      background-color: #aa0000;
      color: white;
      padding: 12px 24px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      width: 100%;
    ">
      ❌ Poate mai târziu
    </button>
  </div>
</div>


  <div id="chatContainer">
    <div id="chatMessages"></div>
    <div class="chat-footer">
<button id="cancelEditBtn" style="display: none;" onclick="cancelEdit()">❌</button>
  <div class="chat-icons-row">
<button class="icon-btn" title="Culoare" onclick="toggleColorPopup()">🎨</button>
<button class="icon-btn" title="Microfon" onclick="showVoiceUI()">🎤</button>


  </div>
 <div class="chat-input-row">
  <!-- Text input mode -->
<input id="chatInput" type="text" placeholder="Scrie un mesaj…" />

<!-- UI pentru IMAGINI -->
<!-- UI pentru IMAGINI -->
<div id="imageUI" style="display: none; flex-direction: column; align-items: center; gap: 10px; margin-top: 10px;">
  <img id="imagePreview" style="max-width: 100%; border-radius: 8px;" />

  <div style="display: flex; gap: 10px;">
    <button id="sendImageBtn" class="image-button" onclick="sendImageFromPreview()">✅ Trimite</button>
    <button class="image-button cancel" onclick="resetVoiceUI()">❌ Anulează</button>
  </div>
</div>



<!-- UI pentru VOICE -->
<div id="voiceUI" style="display: none; gap: 10px; align-items: center;">
  <button id="recordBtn" onclick="toggleRecord()">⏺️ Înregistrează</button>
  <button id="cancelRecordBtn" onclick="resetVoiceUI()">❌ Anulează</button>
  <audio id="audioPreview" controls style="display: none;"></audio>
  <button id="sendAudioBtn" onclick="sendVoiceMessage()" style="display: none;">Trimite</button>
  <button id="deleteAudioBtn" onclick="resetVoiceUI()" style="display: none;">Șterge</button>
</div>

<button id="sendTextBtn" onclick="sendMessage()" class="send-btn">→</button>

</div>
</div>
  </div>
</div>


<img id="mouseFollower" src="https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/3b32cda0-aad8-424e-93a9-cea594f798f4/pngimg.com+-+cursor_PNG45.png?format=500w" style="
  position: absolute;
  display: none;
  width: 40px;
  height: 40px;
  z-index: 10002;
  pointer-events: none;
  transition: left 0.15s ease, top 0.15s ease;
" />

<!-- Ink splash overlay -->
<div id="ink-splash"></div>



<div id="slotPopup">
  <button id="closeSlotBtn">×</button>
  <h3>🎰 Slot Machine - Câștigă sau pierzi puncte 🎰</h3>
  <div class="instructions">
    <div><span style="color:#ff4444;">777</span> - Scorul se dublează</div>
    <div>❌❌❌ - Scor înjumătățit</div>
    <div>💯💯💯 - +75 puncte</div>
    <div>💎💎💎 - +100 puncte</div>
    <div>💰💰💰 - +150 puncte</div>
    <div>😭😭😭 - Pierzi tot scorul</div>
    <div>🤣🤣🤣 - Fără câștig</div>
  </div>
  <div id="slotGrid"></div>
  <button id="spinSlotBtn">Încearcă norocul!</button>
  <div id="resultMessage"></div>
</div>

<div id="quiz-popup" style="
  display:none;
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%, -50%);
  width: 300px;
  background: #2a5d34;
  border: 12px solid #8b5a2b;
  border-radius: 12px;
  padding: 20px 25px;
  box-shadow: 0 6px 12px rgba(0,0,0,0.5);
  font-family: 'Courier New', Courier, monospace;
  color: white;
  text-shadow:
    0 0 1px #fff,
    0 0 3px #fff,
    0 0 5px #a9f0a9;
  user-select: none;
  z-index: 10005;
">

  <h3 id="quiz-question" style="
    font-size: 22px;
    margin-bottom: 20px;
    text-align: center;
    letter-spacing: 1.5px;
    text-shadow:
      0 0 2px #fff,
      0 0 5px #ccffcc;">
    Întrebare...
  </h3>
  <div id="quiz-options" style="
    display: flex;
    flex-direction: column;
    gap: 12px;
  "></div>
  <p id="quiz-feedback" style="
    margin-top: 20px;
    font-weight: bold;
    text-align: center;
    font-size: 18px;
    letter-spacing: 1.2px;
    min-height: 28px;
  "></p> 
</div> 
 

<!-- Popup sunet -->
<div id="soundPopup" class="sound-popup">
  <div class="sound-content">
    <span id="closeSoundBtn" class="close-btn">&times;</span>
    <h3>Sunet</h3>

    <div class="music-switch-wrapper-in-popup">
      <span class="music-label">Muzică de fundal</span>
      <label class="music-switch">
        <input type="checkbox" id="musicToggle" checked>
        <span class="slider"></span>
      </label>
    </div>

    <div class="music-switch-wrapper-in-popup">
      <span class="music-label">Sunetele Kevin</span>
      <label class="music-switch">
        <input type="checkbox" id="kevinSoundToggle" checked>
        <span class="slider"></span>
      </label>
    </div>

  </div>
</div>

<button id="fullscreenBtn" onclick="toggleFullscreen()" title="Toggle Fullscreen">
  <img src="https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/965cbd76-c9dc-47af-ac47-3f7973398267/253f34bd-4201-457a-8f16-798155826c5c_removalai_preview.png?format=500w" alt="Fullscreen" />
</button> 
 
<button id="pauseBtn" onclick="togglePause()" title="Pauză joc">
  <img src="https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/8ebf9248-31af-4e2c-ab6f-e65e02bfbc5e/b4142f9f-da1f-4d78-83b1-8c68afa7490e_removalai_preview.png?format=1000w" alt="Pause">
</button>  
 
<!-- Pause Overlay -->
<div id="pauseOverlay" style="display:none;">
  <div class="pauseContent">
    <div class="pauseText">
      <img src="https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/044cead1-eae3-43cb-9a3c-164007dc0024/Joc+%C3%8ENTRERUPT+%C3%AEn+Auriu.png?format=500w" 
           alt="Joc întrerupt" 
           class="pauseTextImage">
    </div>
    <div class="pauseMenuButtons">

      <img src="https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/95b08a5e-5da7-461d-b1ff-efae392a73eb/4ae9cced-a4ad-433b-815e-828b109d38aa_removalai_preview.png?format=500w" 
           alt="Continuă" 
           class="pauseButtonImage"
           onclick="togglePause()">

      <img src="https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/e8d55656-d307-4302-a273-96af829f5766/ea592cf6-49f2-4987-899c-fb8a861fda65_removalai_preview.png?format=500w" 
           alt="Meniu Principal" 
           class="pauseButtonImage"
           onclick="restartToMainMenu()">

      <img src="https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/8e468407-7038-451c-9d67-9e0a992c4132/9fde7d88-6f32-4ae2-86c0-8f274e3a0845_removalai_preview.png?format=300w" 
           alt="Setări" 
           class="pauseButtonImage"
           onclick="togglePopup('settingsPopup')">

      <img src="https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/c7f7bc75-256c-4cb8-ab19-d5b292f3bc0b/fa4c9b28-804f-4f3b-a19b-8aec15e80c1a_removalai_preview.png?format=500w" 
           alt="Ieșire" 
           class="pauseButtonImage"
           onclick="closeGame()">
    </div>
  </div>
</div>



<div id="ageGateOverlay" style="
  position: fixed;
  top: 0; left: 0;
  width: 100vw; height: 100vh;
  background: rgba(0,0,0,0.95);
  color: white;
  z-index: 100000;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  padding: 30px;
  text-align: center;
  font-family: sans-serif;
">
  <h2 style="font-size: 32px; color: #ffcc00;">⚠️ Avertisment de conținut</h2>
  <p style="max-width: 700px; font-size: 18px; line-height: 1.6; margin: 20px auto;">
    Acest joc conține limbaj vulgar, scene de violență și conținut posibil deranjant.<br>
    Prin continuarea jocului, confirmați că aveți vârsta legală și acceptați să jucați pe propria răspundere.<br>
    Dezvoltatorii nu își asumă responsabilitatea pentru eventualul impact negativ asupra jucătorilor.
  </p>

  <div style="display: flex; gap: 20px; flex-wrap: wrap; justify-content: center; margin-top: 30px;">
    <button onclick="confirmAge()" style="
      background-color: #00aa00;
      color: white;
      padding: 15px 25px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      max-width: 300px;
    ">
      ✅ Am 18 ani
    </button>

    <button onclick="denyAge()" style="
      background-color: #aa0000;
      color: white;
      padding: 15px 25px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      max-width: 300px;
    ">
      ❌ Nu am 18 ani
    </button>
  </div>

  <div id="underageMessage" style="display:none; margin-top: 30px; color: #ff4444; font-weight: bold; font-size: 20px;">
    Dute, fă-ți temele!<br>
    Nu ai 18 ani? N-ai ce căuta aici.<br>
    Revino când ești mare și înțelegi ce-i aia responsabilitate.<br>
    Până atunci, dute și fă-ți temele.
  </div>
</div>

<!-- 1. Adaugă asta în HTML, de exemplu în <body>: -->
<!-- Toggle muzică -->
<!-- Buton sunet -->
<button id="openSoundBtn" class="sound-btn" onclick="document.getElementById('soundPopup').style.display='block'">
  <img src="https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/79d093fe-5060-4d27-af89-2f065017a570/9336289a-5cb0-46f8-b72b-f841eec61619_removalai_preview.png?format=750w" alt="Sunet">
</button>



 <!-- 💰 SELL POPUP -->
<div id="sellPopup" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%,-50%);
  background: #222; color: white; padding: 20px; border-radius: 8px; z-index: 99999; width: 300px; max-height: 80vh; overflow-y: auto;">
  <h3 style="text-align: center;">💰 Vinde Emojis</h3>
  <div id="sellList"></div>
  <button onclick="closeSellPopup()" style="margin-top: 10px; width: 100%; background: #ff6666; border: none; padding: 8px; border-radius: 4px; color: white;">Închide</button>
</div>

  <script> 


   let ringtoneAudio = null;
    let currentMode;
    const modes = {
      usor: { speedMultiplier: 1, randomMovement: false, resize: false },
      greu: { speedMultiplier: 1.3, randomMovement: true, resize: false },
      turbo: { speedMultiplier: 1.7, randomMovement: true, resize: true }
    };

const baseInterval = 2000; // for usor
const intervalTimes = {
  usor: baseInterval,
  greu: baseInterval / 5,
  turbo: baseInterval / 7
};

function beginGame(modeKey) { 
  currentMode = modes[modeKey];
  document.getElementById('modeMenu').style.display = 'none';

  if (moveKevinInterval) clearInterval(moveKevinInterval);

  moveKevinInterval = setInterval(() => {
    moveKevinAway();
  }, intervalTimes[modeKey]);

  spawnEmojiRandomly();
  moveKevinAway();
  renderLeaderboard();
} 


    const kevin = document.getElementById('kevin');
kevin.addEventListener("click", (e) => {
  comboCount++;

  const rect = kevin.getBoundingClientRect();
  const centerX = rect.left + rect.width / 2;
  const centerY = rect.top;

  showCombo(centerX, centerY, comboCount);

  if (comboTimer) clearTimeout(comboTimer);

  comboTimer = setTimeout(() => {
    comboCount = 0;
  }, COMBO_TIMEOUT);
});

    const gameArea = document.getElementById('gameArea');
    const scoreBoard = document.getElementById('scoreBoard');

    const phonePopup = document.getElementById('phonePopup');
    const phoneBody = document.querySelector('#phoneBody p');
    const phoneButtons = document.querySelector('.phone-buttons');
let comboCount = 0;
let comboTimer = null;
const COMBO_TIMEOUT = 10000; // 2 secunde
let isBoostActive = false;
let boostTimeout = null;
let isCoolKevActive = false;
    let score = 0;
    let username = '';
let lastActiveUpdate = 0; // prevents constant Firebase writes
   let isInitialLoad = true; // NEW FLAG
    let isOnMoon = false;
let isShieldActive = false;
let meteoriteInterval = null; 
let emojiSpawnInterval = null;
const moonEmojis = ['👾', '💪', '🛰️', '🪐'];
let isKevinTired = false;
const tiredKevinImage = "https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/0b5ac0f4-618a-4346-9684-8c1f3c0a5fcb/20716c49-4365-417d-97e9-fc8601ae5403_removalai_preview.png?format=500w";
const normalKevinImage = "https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/192e30da-bdaa-47cc-9de6-472d696fa466/KEVINUTA+13-Photoroom.png?format=500w";


const moonNormalImage = "https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/08fa54f1-0994-4cf0-8287-37942115c219/upscalemedia-transformed.png?format=300w";
const moonTiredImage = "https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/58d1e86c-0d35-4ea9-bd84-c839befe1b0c/9bd6bf5a-34a1-4a1b-bc17-aae1e0981c7b_removalai_preview.png?format=500w";


// ✅ Used for in-game confirmation box
function openScoreToRubyPopup(onConfirm) {
  const dialog = document.getElementById("scoreToRubyDialog");
  const input = document.getElementById("scoreInputField");
  const okBtn = document.getElementById("scoreSubmitBtn");
  const cancelBtn = document.getElementById("scoreCancelBtn");

  dialog.style.display = "block";
  input.value = "";

  okBtn.onclick = () => {
    const val = parseInt(input.value);
    dialog.style.display = "none";
    onConfirm(val);
  };

  cancelBtn.onclick = () => {
    dialog.style.display = "none";
  };
}


window.addEventListener('DOMContentLoaded', () => {
  const savedUsername = localStorage.getItem('rememberedUsername');
  const savedScore = parseInt(localStorage.getItem(`score_${savedUsername}`) || '0', 10);

  if (savedUsername) {
    document.getElementById('usernameInput').value = savedUsername;
    score = savedScore;
    username = savedUsername;
    updateScoreDisplay();
  }

  isInitialLoad = false;

  // === CHAT ACCESS OVERLAY LOGIC ===
  const chatOverlay = document.getElementById("chatAccessOverlay");

  if (localStorage.getItem("chatUnlocked") === "true") {
    chatOverlay.style.display = "none";
  }

  document.getElementById("buyChat").addEventListener("click", () => {
    if (score >= 500) {
      score -= 500;
      updateScoreDisplay();
      localStorage.setItem("chatUnlocked", "true");
      chatOverlay.style.display = "none";
    } else {
      alert("Nu ai suficiente puncte!"); 
    }
  });

  document.getElementById("laterChat").addEventListener("click", () => {
    document.getElementById('chatSlider').checked = false;
  });

  // === ENTER TO SEND CHAT ===
  const chatInput = document.getElementById("chatInput");
  if (chatInput) {
    chatInput.addEventListener("keydown", (event) => {
      if (event.key === "Enter") {
        event.preventDefault();
        sendMessage();
      }
    });
  }

  // === SETTINGS UI CACHE & LOGIC ===
  const soundToggle         = document.getElementById('soundToggle');
  const soundVolume         = document.getElementById('soundVolume');
  const musicToggle         = document.getElementById('musicToggle');
  const musicVolume         = document.getElementById('musicVolume');
  const darkModeToggle      = document.getElementById('darkModeToggle');
  const tutorialTextSize    = document.getElementById('tutorialTextSize');
  const changeUsernameInput = document.getElementById('changeUsernameInput');
  const resetScoreBtn       = document.getElementById('resetScoreBtn');
  const feedbackText        = document.getElementById('feedbackText');
  const sendFeedbackBtn     = document.getElementById('sendFeedbackBtn');
  const resetGameBtn        = document.getElementById('resetGameBtn');

  function loadSettings() {
    if (soundToggle)      soundToggle.checked      = localStorage.getItem('soundToggle')      !== 'false';
    if (soundVolume)      soundVolume.value        = localStorage.getItem('soundVolume')       || 1;
    if (musicToggle)      musicToggle.checked      = localStorage.getItem('musicToggle')      !== 'false';
    if (musicVolume)      musicVolume.value        = localStorage.getItem('musicVolume')       || 0.01;
    if (darkModeToggle)   darkModeToggle.checked   = localStorage.getItem('darkModeToggle')   === 'true';
    if (tutorialTextSize) tutorialTextSize.value   = localStorage.getItem('tutorialTextSize')  || 16;
    applySettings();
  }

  function applySettings() {
    if (darkModeToggle.checked) document.body.classList.add('dark-mode');
    else                         document.body.classList.remove('dark-mode');

    const tutorialPopup = document.getElementById('tutorialPopup');
    if (tutorialPopup) tutorialPopup.style.fontSize = tutorialTextSize.value + 'px';
  }

  [soundToggle, soundVolume, musicToggle, musicVolume, darkModeToggle, tutorialTextSize]
    .forEach(el => {
      if (!el) return;
      el.addEventListener('change', () => {
        localStorage.setItem(el.id, el.type === 'checkbox' ? el.checked : el.value);
        applySettings();
      });
    });

  if (changeUsernameInput) {
    changeUsernameInput.addEventListener('change', () => {
      const newName = changeUsernameInput.value.trim();
      if (!newName) {
        alert('Introdu un nume valid.');
        return;
      }
      if (!isCleanUsername(newName)) {
        alert('Numele conține cuvinte interzise.');
        return;
      }
      username = newName;
      localStorage.setItem('rememberedUsername', username);
      alert('Nume utilizator schimbat la: ' + username);
    });
  }

  if (resetScoreBtn) {
    resetScoreBtn.addEventListener('click', () => {
      if (confirm('Ești sigur că vrei să resetezi scorul?')) {
        score = 0;
        updateScoreDisplay();
        localStorage.setItem(`score_${username}`, '0');
        alert('Scor resetat.');
      }
    });
  }

function showPopup(msg, type = 'success') {
  const popup = document.getElementById("customPopup");
  popup.textContent = msg;

  popup.style.background = type === 'error' ? '#c62828' : '#2e7d32'; // roșu / verde
  popup.style.display = 'block';
  popup.style.opacity = '1';

  clearTimeout(window.__popupTimer);
  window.__popupTimer = setTimeout(() => {
    popup.style.opacity = '0';
    setTimeout(() => popup.style.display = 'none', 300);
  }, 3000);
}


if (sendFeedbackBtn) {
  sendFeedbackBtn.addEventListener('click', () => {
    const fb = feedbackText.value.trim();
    if (!fb) {
      showPopup('Scrie ceva înainte să trimiți.', 'error');
      return;
    }
    firebase.database().ref('feedbacks/' + (username || 'anonymous'))
      .push({ text: fb, timestamp: Date.now() })
      .then(() => {
        showPopup('Mulțumim pentru feedback!', 'success');
        feedbackText.value = '';
      })
      .catch(() => showPopup('Eroare la trimiterea feedback-ului.', 'error'));
  });
}



  if (resetGameBtn) {
    resetGameBtn.addEventListener('click', () => {
      if (confirm('Ești sigur că vrei să resetezi progresul complet? Se vor șterge toate datele locale.')) {
        localStorage.clear();
        alert('Progres resetat. Reîncarcă pagina pentru a începe de la zero.');
        location.reload();
      }
    });
  }

  loadSettings();
});


  
function saveProgress() {
  localStorage.setItem('rememberedUsername', username);
  localStorage.setItem(`score_${username}`, score.toString());
}


    const leaderboardKey = 'kevin_leaderboard';

    function getLeaderboard() {
      return JSON.parse(localStorage.getItem(leaderboardKey)) || [];
    }

    function updateLeaderboard(newEntry) {
  if (!newEntry.username) return;
   firebase.database().ref("leaderboard/" + newEntry.username).set({
    username: newEntry.username,
    score: newEntry.score
  });
}
function renderLeaderboard() {
  const rankImages = [
    'https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/a7d4def4-4669-47c4-8f32-69fd1a5957f7/1.png?format=500w', // top 1
    'https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/218fd9b0-4601-4562-8e6e-5ac51ade338d/2.png?format=500w', // top 2
    'https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/87ebbbe1-2c57-4ede-94db-c9149439d12f/3.png?format=500w', // top 3
    'https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/7b792ffd-0171-4f0a-986c-57405951b30e/4.png?format=500w', // top 4
    'https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/7c1579c9-1700-4809-a5ca-28a4028be473/5.png?format=500w', // top 5
  ];

  const list = document.getElementById('leaderboardList');

  firebase.database().ref("leaderboard").on("value", (snapshot) => {
    const data = snapshot.val();

    const sorted = Object.values(data || {})
      .map(entry => ({
        ...entry,
        score: Number(entry.score || 0)
      }))
      .filter(entry => entry.username && !isNaN(entry.score))
      .sort((a, b) => b.score - a.score)
      .slice(0, 5);

    list.innerHTML = '';
    sorted.forEach((entry, index) => {
      const li = document.createElement('li');
      const img = rankImages[index]
        ? `<img src="${rankImages[index]}" class="top-img">`
        : '';
      li.innerHTML = `
        ${img}
        <strong>${entry.username}</strong>: ${entry.score}
      `;
      list.appendChild(li);
    });
  });
}



    const sounds = [
      'https://ksdapromovarii.squarespace.com/s/haha-nu-mai-prins-osa-mai-incerci.opus',
      'https://ksdapromovarii.squarespace.com/s/cf-ma-2.opus',
      'https://ksdapromovarii.squarespace.com/s/cf-ma.opus',
      'https://ksdapromovarii.squarespace.com/s/vreu-o-minune.opus',
      'https://ksdapromovarii.squarespace.com/s/florico-asta-nu-reuseste-fa-sa-ma-prinda.mp3',
      'https://ksdapromovarii.squarespace.com/s/imi-dai-si-mie-un-leu-1.mp3',
      'https://ksdapromovarii.squarespace.com/s/dela-1-la-10.mp3',
      'https://ksdapromovarii.squarespace.com/s/bai-chiar-ma-bucur.mp3',
      'https://ksdapromovarii.squarespace.com/s/hey-hey-hey-stai-asa-vad-ca-iti-place-sa-te-joci.mp3',
      'https://ksdapromovarii.squarespace.com/s/lele-vulpe-fi-cumnite.mp3',
      'https://ksdapromovarii.squarespace.com/s/multi-ani.mp3'
    ];



const spaceQuestions = [
  {
    q: "Care este cea mai fierbinte planetă din sistemul solar?",
    correct: "Venus",
    options: ["Mercur", "Jupiter", "Neptun"]
  },
  {
    q: "Ce planetă are o zi mai lungă decât anul ei?",
    correct: "Venus",
    options: ["Marte", "Mercur", "Jupiter"]
  },
  {
    q: "Care este planeta cu cei mai mulți sateliți?",
    correct: "Saturn",
    options: ["Jupiter", "Uranus", "Neptun"]
  },
  {
    q: "Ce este un pulsar?",
    correct: "Stea care emite unde radio regulate",
    options: ["Planetoid", "Stea în formare", "Galaxie pitică"]
  },
  {
    q: "Ce stea este cea mai apropiată de Pământ?",
    correct: "Soarele",
    options: ["Proxima Centauri", "Sirius", "Betelgeuse"]
  },
  {
    q: "Ce este Calea Lactee?",
    correct: "Galaxia în care se află Pământul",
    options: ["O constelație", "Un nor cosmic", "Un satelit natural"]
  },
  {
    q: "Care este cel mai mare vulcan cunoscut din sistemul solar?",
    correct: "Olympus Mons (Marte)",
    options: ["Everest", "Mauna Loa", "Mons Huygens"]
  },
  {
    q: "Ce planetă este cunoscută ca planeta roșie?",
    correct: "Marte",
    options: ["Venus", "Jupiter", "Saturn"]
  },
  {
    q: "Ce planetă are cei mai puternici vânturi?",
    correct: "Neptun",
    options: ["Uranus", "Jupiter", "Saturn"]
  },
  {
    q: "Ce este un asteroid?",
    correct: "Corp stâncos mic ce orbitează Soarele",
    options: ["Stea pitică", "Satelit natural", "Nor de gaz"]
  },
  {
    q: "Câte planete sunt în sistemul nostru solar?",
    correct: "8",
    options: ["7", "9", "10"]
  },
  {
    q: "Ce planetă are un inel spectaculos vizibil?",
    correct: "Saturn",
    options: ["Jupiter", "Neptun", "Uranus"]
  },
  {
    q: "Cum se numește cea mai mare lună a lui Jupiter?",
    correct: "Ganimede",
    options: ["Io", "Callisto", "Europa"]
  },
  {
    q: "Cum se numește cea mai mare planetă din sistemul solar?",
    correct: "Jupiter",
    options: ["Saturn", "Neptun", "Uranus"]
  },
  {
    q: "Care este planeta cea mai apropiată de Soare?",
    correct: "Mercur",
    options: ["Venus", "Pământ", "Marte"]
  },
  {
    q: "Cum se numește cea mai apropiată galaxie mare de Calea Lactee?",
    correct: "Andromeda",
    options: ["Triangulum", "Sagittarius", "Centaurus A"]
  },
  {
    q: "Ce este o supernovă?",
    correct: "Explozia unei stele masive",
    options: ["Formarea unei stele", "Coliziunea galaxiilor", "Nașterea unei planete"]
  },
  {
    q: "Ce planetă are cea mai mare furtună permanentă?",
    correct: "Jupiter",
    options: ["Saturn", "Uranus", "Neptun"]
  },
  {
    q: "Ce este o cometă?",
    correct: "Corp de gheață și praf ce orbitează Soarele",
    options: ["Stea pitică", "Sateliți artificiali", "Fragment de planetă"]
  },
  {
    q: "Câte luni are Pământul?",
    correct: "1",
    options: ["2", "3", "4"]
  },
  {
    q: "Ce planetă este înclinată pe o parte, rotindu-se aproape pe orizontală?",
    correct: "Uranus",
    options: ["Neptun", "Saturn", "Marte"]
  },
  {
    q: "Cât durează o rotație completă a Pământului în jurul Soarelui?",
    correct: "365 zile",
    options: ["24 ore", "30 zile", "12 luni"]
  },
  {
    q: "Ce instrument este folosit pentru a observa obiecte îndepărtate din spațiu?",
    correct: "Telescop",
    options: ["Microscop", "Binoclu", "Periscop"]
  },
  {
    q: "Care este numele primului om pe Lună?",
    correct: "Neil Armstrong",
    options: ["Yuri Gagarin", "Buzz Aldrin", "Alan Shepard"]
  },
  {
    q: "Ce planetă este acoperită cu nori groși de acid sulfuric?",
    correct: "Venus",
    options: ["Mercur", "Saturn", "Uranus"]
  },
  {
    q: "Cum se numește satelitul natural al Pământului?",
    correct: "Luna",
    options: ["Europa", "Titan", "Io"]
  },
  {
    q: "Ce misiune a dus pentru prima dată oameni pe Lună?",
    correct: "Apollo 11",
    options: ["Apollo 13", "Gemini 4", "Soyuz 1"]
  },
  {
    q: "Care este cea mai mică planetă din sistemul solar?",
    correct: "Mercur",
    options: ["Marte", "Uranus", "Neptun"]
  },
  {
    q: "Care planetă are un sistem de inele slab vizibil?",
    correct: "Jupiter",
    options: ["Venus", "Mercur", "Pământ"]
  },
  {
    q: "Cum se numește efectul prin care lumina unei stele este deviată de gravitație?",
    correct: "Lentilă gravitațională",
    options: ["Refracție", "Difracție", "Interferență"]
  },
  {
    q: "Ce este o gaură neagră?",
    correct: "Regiune cu gravitație extremă ce nu lasă nimic să scape",
    options: ["Stea pitică", "Satelit artificial", "Supernovă"]
  },
  {
    q: "Ce temperatură are spațiul cosmic profund?",
    correct: "Aproximativ -270°C",
    options: ["0°C", "-100°C", "100°C"]
  },
  {
    q: "Ce este ISS (Stația Spațială Internațională)?",
    correct: "Laborator orbital pentru cercetare",
    options: ["Satelit militar", "Stație de combustibil", "Navetă spațială"]
  },
  {
    q: "Cine a fost primul om în spațiu?",
    correct: "Yuri Gagarin",
    options: ["Neil Armstrong", "Buzz Aldrin", "John Glenn"]
  },
  {
    q: "Ce planetă are o mare pată întunecată, similară cu Marea Pată Roșie a lui Jupiter?",
    correct: "Neptun",
    options: ["Saturn", "Uranus", "Venus"]
  },
  {
    q: "Cum se numește faza Lunii când este complet luminată?",
    correct: "Lună plină",
    options: ["Lună nouă", "Primul pătrar", "Ultimul pătrar"]
  },
  {
    q: "Ce este o exoplanetă?",
    correct: "Planetă care orbitează o altă stea",
    options: ["Lună îndepărtată", "A doua planetă Pământ", "Planetoid interstelar"]
  },
  {
    q: "Cum se numește steaua din centrul sistemului nostru solar?",
    correct: "Soarele",
    options: ["Sirius", "Betelgeuse", "Proxima Centauri"]
  },
  {
    q: "Care este principalul gaz din atmosfera lui Marte?",
    correct: "Dioxid de carbon",
    options: ["Oxigen", "Azot", "Heliu"]
  },
  {
    q: "Cum se numește regiunea dintre Marte și Jupiter plină cu asteroizi?",
    correct: "Centura de asteroizi",
    options: ["Calea Lactee", "Norul Oort", "Zona Kuiper"]
  },
 
];
 

    
    const emojiEvents = {
     '💵': {
  effect: () => {
    // COUNTDOWN
    const countdown = document.createElement('div');
    countdown.style.position = 'absolute';
    countdown.style.top = '40%';
    countdown.style.left = '50%';
    countdown.style.transform = 'translate(-50%, -50%)';
    countdown.style.fontSize = '80px';
    countdown.style.fontWeight = 'bold';
    countdown.style.color = 'red';
    countdown.style.zIndex = '1000';
    gameArea.appendChild(countdown);

    let seconds = 5;
    countdown.innerText = seconds;
    const countdownInterval = setInterval(() => {
      seconds--;
      if (seconds > 0) {
        countdown.innerText = seconds;
      } else {
        clearInterval(countdownInterval);
        gameArea.removeChild(countdown);

        // PUTIN IMAGE
        const putinImg = document.createElement('img');
        putinImg.src = 'https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/30e3da50-1c45-4bce-a44c-dff7a4bebb95/692bac01-d77e-4a91-99bc-84d7ddbf47d2_removalai_preview.png?format=500w';
        putinImg.style.position = 'absolute';
        putinImg.style.width = '250px';
        putinImg.style.top = '100%';
        putinImg.style.left = '-200px';
        putinImg.style.zIndex = '999';
        putinImg.style.animation = 'flyPutin 3s forwards ease-in-out';
        gameArea.appendChild(putinImg);

        // BOMB
        const bombImg = document.createElement('img');
        bombImg.src = 'https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/e3e4b6e2-7d32-4d19-b5e6-5c2f981718f3/16e226d7-b5f8-4ecc-95e8-ebef0cab8ddb_removalai_preview.png?format=100w';
        bombImg.style.position = 'absolute';
        bombImg.style.width = '50px';
        bombImg.style.left = `${gameArea.clientWidth / 2 - 40}px`;
        bombImg.style.top = '-100px';
        bombImg.style.transition = 'top 1.5s linear';
        bombImg.style.zIndex = '1000';

        // Drop bomb after Putin finishes flying in
        setTimeout(() => {
          gameArea.appendChild(bombImg);
          bombImg.style.top = `${kevin.offsetTop + 30}px`;

          // Impact
          setTimeout(() => {
            const boomSound = new Audio('https://ksdapromovarii.squarespace.com/s/BOMBA-NUCLEARA.mp3');
            boomSound.play();
            score -= 75;
            updateScore(0);
            // Clean up
            gameArea.removeChild(putinImg);
            gameArea.removeChild(bombImg);
          }, 1500);
        }, 3000);
      }
    }, 1000);
  },
  sound: '' // we trigger sound manually
},


      '🔥': {
        effect: () => {
          score -= 50;
          updateScore(0);
          new Audio('https://ksdapromovarii.squarespace.com/s/Ambulanta-sunet.mp3').play();
        },
        sound: 'https://ksdapromovarii.squarespace.com/s/Ambulanta-sunet.mp3'
      },
      '🪓': {
  effect: () => {
    const axe = document.createElement('div');
    axe.textContent = '🪓';
    axe.classList.add('emoji');
    axe.style.fontSize = '60px';
    axe.style.left = `${Math.random() * (gameArea.clientWidth - 60)}px`;
    axe.style.top = `${Math.random() * (gameArea.clientHeight - 60)}px`;
    axe.style.transition = 'none';
    gameArea.appendChild(axe);

    let dx = (Math.random() > 0.5 ? 1 : -1) * 10;
    let dy = (Math.random() > 0.5 ? 1 : -1) * 10;
    let bounces = 0;
    let recentlyHit = false;

    const shakeScreen = () => {
      gameArea.style.transition = 'transform 0.1s';
      gameArea.style.transform = `translate(${Math.random() * 10 - 5}px, ${Math.random() * 10 - 5}px)`;
      setTimeout(() => {
        gameArea.style.transform = 'translate(0, 0)';
      }, 100);
    };

    const rotateInterval = setInterval(() => {
      axe.style.transform = `rotate(${performance.now() / 3}deg)`;
    }, 30);

    const moveInterval = setInterval(() => {
      let axeX = axe.offsetLeft + dx;
      let axeY = axe.offsetTop + dy;

      // Bounce off walls
      if (axeX <= 0 || axeX + 60 >= gameArea.clientWidth) {
        dx *= -1;
        bounces++;
        shakeScreen();
      }
      if (axeY <= 0 || axeY + 60 >= gameArea.clientHeight) {
        dy *= -1;
        bounces++;
        shakeScreen();
      }

      // Update position
      axe.style.left = `${axe.offsetLeft + dx}px`;
      axe.style.top = `${axe.offsetTop + dy}px`;

      // Check collision with Kevinuță
      const axeRect = axe.getBoundingClientRect();
      const kevinRect = kevin.getBoundingClientRect();

      if (
        axeRect.left < kevinRect.right &&
        axeRect.right > kevinRect.left &&
        axeRect.top < kevinRect.bottom &&
        axeRect.bottom > kevinRect.top
      ) {
        if (!recentlyHit) {
          updateScore(-10);
          recentlyHit = true;
          setTimeout(() => {
            recentlyHit = false;
          }, 500); // cooldown to prevent spam
        }
      }

      if (bounces >= 10) {
        clearInterval(moveInterval);
        clearInterval(rotateInterval);
        gameArea.removeChild(axe);
      }
    }, 30);
  },
  sound: '' // Add axe impact or bounce sound here if desired
},

      '⚡': {
        effect: () => {
          score -= 25;
          updateScore(0);
          new Audio('https://ksdapromovarii.squarespace.com/s/Thunder-Sound-effect.mp3').play();
        },
        sound: 'https://ksdapromovarii.squarespace.com/s/Thunder-Sound-effect.mp3'
      },
 
};
  
emojiEvents['🍀'] = {
  effect: () => { 
    updateScore(25);
  },
  sound: ''
}; 



emojiEvents['💪'] = {
  effect: () => {
    window.kevinutaSuperStrength = true;

    const msg = document.createElement("div");
msg.innerHTML = "<div style='text-align:center;'>💪 SUPER PUTERE ACTIVATĂ!</div>";
    Object.assign(msg.style, {
      position: "fixed",
      top: "50%",
      left: "50%",
      transform: "translate(-50%, -50%)",
      fontSize: "32px",
      fontWeight: "bold",
      color: "#00d4ff",
      zIndex: 9999,
      background: "rgba(0,0,0,0.7)",
      padding: "10px 20px",
      border: "2px solid #00d4ff",
      borderRadius: "10px",
      boxShadow: "0 0 12px #00d4ff",
      textShadow: "0 0 6px #000"
    });
    document.body.appendChild(msg);
    setTimeout(() => msg.remove(), 2500);

    // Show the timer
    const timerEl = document.getElementById("powerTimer");
    if (timerEl) {
      timerEl.style.display = "block";
      timerEl.classList.remove("pulsing");
      let remaining = 60;
      timerEl.textContent = `💪 ${remaining}s`;

      const countdown = setInterval(() => {
        remaining--;
        timerEl.textContent = `💪 ${remaining}s`;

        if (remaining === 10) {
          timerEl.classList.add("pulsing");
          timerEl.style.borderColor = "red";
          timerEl.style.background = "rgba(255, 0, 0, 0.1)";
        }

        if (remaining <= 0) {
          clearInterval(countdown);
          timerEl.style.display = "none";
          timerEl.classList.remove("pulsing");

          // 🔔 Power expired message
          const endMsg = document.createElement("div");
endMsg.innerHTML = "<div style='text-align:center;'>😵 Superputerea a expirat!<br>Ești din nou vulnerabil.</div>";
          Object.assign(endMsg.style, {
            position: "fixed",
            top: "50%",
            left: "50%",
            transform: "translate(-50%, -50%)",
            fontSize: "28px",
            fontWeight: "bold",
            color: "red",
            background: "rgba(0,0,0,0.7)",
            padding: "10px 20px",
            border: "2px solid red",
            borderRadius: "10px",
            boxShadow: "0 0 12px red",
            zIndex: 9999,
            textShadow: "0 0 6px #000"
          });
          document.body.appendChild(endMsg);
          setTimeout(() => endMsg.remove(), 3000);
        }
      }, 1000);
    }

    setTimeout(() => {
      window.kevinutaSuperStrength = false;
    }, 60000);
  },
  sound: ''
};



emojiEvents['🧩'] = {
  effect: () => {
    startMemoryGameClassic();
  },
  sound: '' // you can add a sound here if you'd like
};


emojiEvents['👾'] = {
  effect: () => {
    startMemoryGame(); // 🔗 triggers the mini-game
  },
  sound: '' // Optional: Add a sound later
};

  

emojiEvents['🛰️'] = {
  effect: () => {
    const overlay = document.getElementById("noSignalOverlay");
    if (!overlay) return;

    // Show overlay
    overlay.style.display = "block";

    // Play glitch sound
    const glitchSound = new Audio("https://ksdapromovarii.squarespace.com/s/no-signal-effect.mp3");
    glitchSound.volume = 0.8; // optional: adjust volume
    glitchSound.play().catch(err => console.warn("Audio play blocked:", err));

    // Hide overlay after 4.5 seconds (or adjust as needed)
    setTimeout(() => {
      overlay.style.display = "none";
      glitchSound.pause();
      glitchSound.currentTime = 0;
    }, 4500);
  },
  sound: '' // still keep this here if other parts rely on it
};




 
emojiEvents['🧠'] = { 
  effect: () => {
    const questions = [
      {
        q: "Care este capitala Portugaliei?",
        correct: "Lisabona",
        options: ["Madrid", "Roma", "Atena"]
      },
      {
        q: "Cine a scris piesa de teatru „Romeo și Julieta”?",
        correct: "William Shakespeare",
        options: ["Mihai Eminescu", "Ion Creangă", "Victor Hugo"]
      },
      {
        q: "Ce planetă este cunoscută ca „Planeta Roșie”?",
        correct: "Marte",
        options: ["Venus", "Jupiter", "Mercur"]
      },
      {
        q: "Câte continente există pe Pământ?",
        correct: "7",
        options: ["5", "6", "8"]
      },
      {
        q: "Ce element chimic are simbolul „O”?",
        correct: "Oxigen",
        options: ["Aur", "Osmiu", "Oțel"]
      },
      {
        q: "Care este cel mai lung fluviu din lume?",
        correct: "Nil",
        options: ["Amazon", "Dunărea", "Mississippi"]
      },
      {
        q: "Cine a pictat „Mona Lisa”?",
        correct: "Leonardo da Vinci",
        options: ["Pablo Picasso", "Vincent van Gogh", "Michelangelo"]
      },
      {
        q: "În ce țară se află Marele Zid?",
        correct: "China",
        options: ["Japonia", "Coreea de Sud", "India"]
      },
      {
        q: "Ce organ este responsabil pentru pomparea sângelui în corp?",
        correct: "Inima",
        options: ["Ficatul", "Plămânii", "Rinichii"]
      },
      {
        q: "Cine a fost primul om care a pășit pe Lună?",
        correct: "Neil Armstrong",
        options: ["Yuri Gagarin", "Buzz Lightyear", "Albert Einstein"]
      },
      {
        q: "Care este cea mai populată țară din lume?",
        correct: "China",
        options: ["Rusia", "Statele Unite", "Brazilia"]
      },
      {
        q: "Ce culoare obții prin amestecarea roșului cu galben?",
        correct: "Portocaliu",
        options: ["Verde", "Albastru", "Mov"]
      },
      {
        q: "Ce animal este cunoscut drept „Regele junglei”?",
        correct: "Leul",
        options: ["Tigrul", "Elefantul", "Ursul"]
      },
      {
        q: "Ce limbă se vorbește în Brazilia?",
        correct: "Portugheză",
        options: ["Spaniolă", "Franceză", "Engleză"]
      },
      {
        q: "Ce planetă este cea mai apropiată de Soare?",
        correct: "Mercur",
        options: ["Venus", "Pământ", "Marte"]
      },
      {
        q: "În ce oraș se află Turnul Eiffel?",
        correct: "Paris",
        options: ["Londra", "Roma", "Berlin"]
      },
      {
        q: "Cine a compus „Simfonia a 9-a”?",
        correct: "Ludwig van Beethoven",
        options: ["Wolfgang Amadeus Mozart", "Johann Sebastian Bach", "Frédéric Chopin"]
      },
      { 
        q: "Care este cel mai mare ocean de pe Pământ?",
        correct: "Oceanul Pacific",
        options: ["Oceanul Atlantic", "Oceanul Indian", "Oceanul Arctic"]
      },
      {
        q: "Ce țară are formă de cizmă pe hartă?",
        correct: "Italia",
        options: ["Grecia", "Spania", "Croația"]
      }, 
      {
        q: "Ce parte a corpului produce insulina?",
        correct: "Pancreasul",
        options: ["Ficatul", "Rinichii", "Inima"]
      },
      {
        q: "Ce gaz respirăm pentru a trăi?",
        correct: "Oxigen",
        options: ["Hidrogen", "Dioxid de carbon", "Azot"]
      },
      {
        q: "Cine este autorul romanului „Moromeții”?",
        correct: "Marin Preda",
        options: ["Mircea Eliade", "Liviu Rebreanu", "Ion Luca Caragiale"]
      },
      {
        q: "Care este cel mai mare mamifer terestru?",
        correct: "Elefantul african",
        options: ["Rinocerul", "Ursul polar", "Girafa"]
      },
      {
        q: "Unde se află piramidele din Giza?",
        correct: "Egipt",
        options: ["Mexic", "India", "Peru"]
      },
      {
        q: "Câte luni au 28 de zile?",
        correct: "Toate",
        options: ["Doar februarie", "Una", "Niciuna"]
      },
      {
        q: "Dacă ai doar un chibrit și intri într-o cameră unde este o lumânare, un șemineu și o lampă, ce aprinzi prima dată?",
        correct: "Chibritul",
        options: ["Lumânarea", "Lampa", "Șemineul"]
      },
      {
        q: "Un tren electric merge spre est. În ce direcție merge fumul?",
        correct: "Nu are fum – e tren electric",
        options: ["Spre est", "Spre vest", "În sus"]
      },
      {
        q: "Un cocoș stă pe acoperișul unei case și ouă un ou. În ce parte cade oul?",
        correct: "Cocoșii nu fac ouă",
        options: ["În stânga", "În dreapta", "Nu cade"]
      },
      {
        q: "Ce este mai greu: un kilogram de fier sau un kilogram de puf?",
        correct: "Sunt la fel",
        options: ["Fierul", "Puful", "Depinde de volum"]
      },
      {
        q: "Un avion se prăbușește fix pe granița dintre România și Ungaria. Unde sunt îngropați supraviețuitorii?",
        correct: "Nicăieri – supraviețuitorii nu se îngroapă",
        options: ["În România", "În Ungaria", "La graniță"]
      },
      {
        q: "Dacă un om trăiește în București, dar s-a născut în tren, în ce țară s-a născut?",
        correct: "Depinde unde era trenul",
        options: ["România", "Germania", "Nu contează"]
      },
      {
        q: "Câte animale a luat Moise pe arcă?",
        correct: "Niciunul – Noe a luat animalele",
        options: ["Două din fiecare", "40", "7 perechi"]
      },
      {
        q: "Care este cea mai fierbinte planetă din sistemul solar?",
        correct: "Venus",
        options: ["Mercur", "Marte", "Jupiter"]
      },
      {
        q: "Câte planete au inele în jurul lor?",
        correct: "4 (Jupiter, Saturn, Uranus, Neptun)",
        options: ["1 (doar Saturn)", "2", "8"]
      },
      {
        q: "Ce planetă are o zi mai lungă decât anul ei?",
        correct: "Venus",
        options: ["Marte", "Mercur", "Jupiter"]
      },
      {
        q: "Dacă ai sta pe Jupiter, ai putea sări în sus?",
        correct: "Nu – nu are suprafață solidă",
        options: ["Da, dar foarte greu", "Da, dacă ai costum special", "Nu – gravitația te ține jos"]
      },
      {
        q: "Care este planeta cu cei mai mulți sateliți naturali cunoscuți?",
        correct: "Saturn",
        options: ["Jupiter", "Marte", "Uranus"]
      },
      {
        q: "Care este cel mai înalt munte din sistemul solar?",
        correct: "Olympus Mons (pe Marte)",
        options: ["Everest (pe Pământ)", "Mauna Kea (Hawaii)", "Mons Huygens (Lună)"]
      }
    ];
 

    const soundCorrect = new Audio('https://ksdapromovarii.squarespace.com/s/Correct-Answer-sound-effect.mp3');
    const soundWrong = new Audio('https://ksdapromovarii.squarespace.com/s/Wrong-Answer-Sound-effect.mp3');

    const quiz = questions[Math.floor(Math.random() * questions.length)];
    const allOptions = [...quiz.options, quiz.correct].sort(() => 0.5 - Math.random());

    const popup = document.getElementById("quiz-popup");
    const questionEl = document.getElementById("quiz-question");
    const optionsEl = document.getElementById("quiz-options");
    const feedbackEl = document.getElementById("quiz-feedback");

    questionEl.textContent = quiz.q;
    optionsEl.innerHTML = "";
    feedbackEl.textContent = "";  

    allOptions.forEach(option => {
      const btn = document.createElement("button");
      btn.textContent = option;
      btn.style = "margin:5px; padding:10px 20px; border:none; border-radius:8px; cursor:pointer; background:#eee; font-size:16px;";
      btn.onclick = () => {
        // Disable all buttons
        optionsEl.querySelectorAll("button").forEach(b => b.disabled = true);
        if (option === quiz.correct) {
          btn.style.backgroundColor = "limegreen";
          updateScore(20);
          feedbackEl.textContent = "✅ Corect! +20 puncte";
          soundCorrect.play();
        } else {
          btn.style.backgroundColor = "crimson";
          updateScore(-10);
          feedbackEl.textContent = "❌ Incorect! -10 puncte";
          soundWrong.play();
        }
        setTimeout(() => popup.style.display = "none", 4000);
      };
      optionsEl.appendChild(btn);
    });

    popup.style.display = "block";
  },
  sound: 'https://example.com/quiz-tone.mp3' // Optional sound, can remove if unused
};



 emojiEvents['🖱️'] = {
  effect: () => {
    const mouse = document.getElementById('mouseFollower');
    const target = kevin; // Using your existing  element
    
    mouse.style.display = 'block';

    let clicks = 0;
    const maxClicks = 50; // 5 clicks per second * 10 seconds = 50
    const clickIntervalMs = 200; // 5 times per second

    // Animate mouse click by scaling it down and back up
    function clickAnimation() {
      mouse.style.transform = 'scale(0.8)';
      setTimeout(() => {
        mouse.style.transform = 'scale(1)';
      }, 100);
    }

    // Move mouse toward Kevin gradually
    function moveMouse() {
      const mouseRect = mouse.getBoundingClientRect();
      const targetRect = target.getBoundingClientRect();

      // Calculate center positions
      const mouseX = mouseRect.left + mouseRect.width / 2;
      const mouseY = mouseRect.top + mouseRect.height / 2;
      const targetX = targetRect.left + targetRect.width / 2;
      const targetY = targetRect.top + targetRect.height / 2;

      // Calculate vector toward target
      const dx = targetX - mouseX;
      const dy = targetY - mouseY;

      // Move a fraction toward Kevin to create smooth movement
      const moveSpeed = 1; // smaller is slower, 1 is teleport
      const newX = mouseRect.left + dx * moveSpeed;
      const newY = mouseRect.top + dy * moveSpeed;

      // Set new position relative to gameArea
      const gameAreaRect = gameArea.getBoundingClientRect();
      const leftPos = newX - gameAreaRect.left;
      const topPos = newY - gameAreaRect.top;

      mouse.style.left = `${leftPos}px`;
      mouse.style.top = `${topPos}px`;
    }

    // Initialize mouse at a random position near Kevin
    const initialLeft = target.offsetLeft + target.offsetWidth + 20;
    const initialTop = target.offsetTop + target.offsetHeight / 2;
    mouse.style.left = `${initialLeft}px`;
    mouse.style.top = `${initialTop}px`;

    // Interval to do the clicking and movement
    const interval = setInterval(() => {
      moveMouse();
      clickAnimation();

      // Check collision between mouse and Kevin
      const mouseRect = mouse.getBoundingClientRect();
      const targetRect = target.getBoundingClientRect();

      const isColliding = !(
        mouseRect.right < targetRect.left ||
        mouseRect.left > targetRect.right ||
        mouseRect.bottom < targetRect.top ||
        mouseRect.top > targetRect.bottom
      );

      if (isColliding) {
        updateScore(1);
      }

      clicks++;
      if (clicks >= maxClicks) {
        clearInterval(interval);
        mouse.style.display = 'none';
        mouse.style.transform = 'scale(1)';
      }
    }, clickIntervalMs);
  },
  sound: '' // no sound for now
}; 

emojiEvents['🪐'] = {
  effect: () => {
    const questionPool = [...spaceQuestions];
    const selected = [];

    while (selected.length < 5 && questionPool.length > 0) {
      const idx = Math.floor(Math.random() * questionPool.length);
      selected.push(questionPool.splice(idx, 1)[0]);
    }

    let current = 0;
    const popup = document.getElementById("space-quiz-popup");
    const questionEl = document.getElementById("space-question");
    const optionsEl = document.getElementById("space-options");
    const feedbackEl = document.getElementById("space-feedback");

    popup.style.display = "flex";

    function showNext() {
      if (current >= selected.length) {
        // ✅ All correct: reward player
        feedbackEl.innerHTML = "<div style='text-align:center;'>✅ Răspunsuri Corecte!<br>+100 scor și 1 Rubin 💎</div>";
        updateScore(100);
        addRubys(1);               // Actually gives the ruby
        triggerRubyDiscovery(1);   // Shows ruby animation
        setTimeout(() => popup.style.display = "none", 2500);
        return;
      }

      const q = selected[current];
      const allOptions = [...q.options, q.correct].sort(() => 0.5 - Math.random());

      questionEl.textContent = `🌌 Întrebarea ${current + 1}/5: ${q.q}`;
      optionsEl.innerHTML = "";
      feedbackEl.textContent = "";

      allOptions.forEach(opt => {
        const btn = document.createElement("button");
        btn.textContent = opt;
        btn.className = "space-option-btn";
        btn.onclick = () => {
          optionsEl.querySelectorAll("button").forEach(b => b.disabled = true);
          if (opt === q.correct) {
            btn.style.backgroundColor = "#28a745";
            current++;
            setTimeout(showNext, 1000);
          } else {
            btn.style.backgroundColor = "#c0392b";
            feedbackEl.innerHTML = "<div style='text-align:center;'>❌ Răspuns Incorect!<br>-75 scor</div>";
            updateScore(-75);
            setTimeout(() => popup.style.display = "none", 2000);
          }
        };
        optionsEl.appendChild(btn);
      });
    }

    showNext();
  },
  sound: ''
};


emojiEvents['✈️'] = {
  effect: () => {
    const plane = document.createElement('img');
    plane.src = "https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/4de5b84f-1c64-4e9b-8cda-46561fc62cea/AVION++CU+ADINA.2.png?format=500w";
    plane.className = 'plane-flyer'; 
document.getElementById('gameArea').appendChild(plane);

    const photoUrls = [
      "https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/16f1508d-f717-43c4-8959-04c42366a64f/Bobby+Bogdanel.jpeg?format=500w",
      "https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/85f91206-9372-4327-a46e-2a96b807eaa8/BENNY.jpeg?format=500w",
      "https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/5866d5ed-9656-4780-aa0f-dd478216a290/Adina+Gabriela+Sirlincan+1.jpeg?format=500w",
      "https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/5130291c-c7d3-41e7-922a-35de8eed6f65/%F0%9F%87%AC%F0%9F%87%A7%F0%9F%A6%84Narcisamarylena333%F0%9F%A6%84%F0%9F%87%B7%F0%9F%87%B4.jpeg?format=500w",
      "https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/94602895-d578-4eef-b0df-54baca3ba63f/adina+sirlincan.jpeg?format=500w",
      "https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/dc13dc81-6d25-4c61-b42c-5061c2360083/C%C4%83t%C4%83lina+C%C4%83t%C4%83%F0%9F%92%99%F0%9F%92%9B%E2%9D%A4%EF%B8%8F2.jpeg?format=500w",
      "https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/0b8c21e4-ce29-42a2-9569-a373e1a4db91/%F0%9F%8C%BF+Amira+%F0%9F%8C%BF2.jpeg?format=500w",
      "https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/513b8f3c-6a7b-4a90-a826-e8c3358ae90c/Lency-Antoanela.jpeg?format=500w",
      "https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/c99e5312-8612-451e-b688-6c8ce4e42240/AishaDBA.jpeg?format=500w",
      "https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/39954be4-d20b-47e5-9790-ca9fe22265df/%F0%9F%95%8A%EF%B8%8F%F0%9F%8F%B3%EF%B8%8FGED+Pro-B+%28Art%29%F0%9F%87%B7%F0%9F%87%B4%F0%9F%8F%B3%EF%B8%8F.jpeg?format=500w",
      "https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/236a9148-bd05-42d9-9215-5974ed477c46/Amalia.jpeg?format=500w",
      "https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/b1dff91a-bda4-42ea-ae0b-9b4c469a3420/%F0%9F%A7%BFTamara+Ghetu%C8%9Be+Hand+Made+%F0%9F%A7%BF.jpeg?format=500w",
      "https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/ac7834e7-b10c-4493-af99-ffd0b46c52ae/Bianca+Biencutza.jpeg?format=500w",
      "https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/152c3370-e19a-4d70-a4ce-9cf693cc6978/SJA+Daia.jpeg?format=500w",
      "https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/f2d2a5c5-b439-4641-8a91-47b3b2037a12/%F0%9F%A9%B5Teo%F0%9F%A9%B5.jpeg?format=500w",
      "https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/9b49f9ea-ce99-424a-8b82-6519f616b1d7/Daniel+Adrian.jpeg?format=500w",
      "https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/4c259d06-ffcb-4498-ab37-0176292a9e39/ad586200e3b66fa91d44e09cc3160f7a%7Etplv-tiktokx-cropcenter_1080_1080.jpeg?format=500w",
      "https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/1028563a-1467-45af-ac48-b568c0d1caab/Bella%E2%99%A5%EF%B8%8FLola%E2%99%A5%EF%B8%8FToto.jpeg?format=500w",
      "https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/453f4aa9-8b24-4fc2-994c-15ff1639115b/Elena+art+%28portrete%29+%F0%9F%8E%A8%F0%9F%8E%A8%F0%9F%8E%A8.jpeg?format=500w",
      "https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/b79efb50-cac0-48d6-9211-f781ad962551/5d1ee8055c4334afc6f5ba648efc0d12%7Etplv-tiktokx-cropcenter_1080_1080.jpeg?format=500w",
      "https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/cc0b64ae-7614-4ee6-af8f-6b7abdac381f/5469701968f6bc5548999df5521f4a0f%7Etplv-tiktokx-cropcenter_1080_1080.jpeg?format=500w"
    ];

    let flyCount = 0;

   function dropImage() {
  if (photoUrls.length === 0) return;
  const img = document.createElement('img');
  img.src = photoUrls.shift();
  img.className = 'plane-photo';
  img.style.left = plane.offsetLeft + 60 + 'px';
  img.style.top = '20px';

  document.getElementById('gameArea').appendChild(img);

  setTimeout(() => {
img.style.top = `${window.innerHeight * 0.65}px`;
  }, 100);

  img.addEventListener('click', () => {
    updateScore(3);
    img.remove();
  });

  setTimeout(() => img.remove(), 5000);
}

    function flyPlane() {
      if (flyCount >= 4) return plane.remove();

      const leftToRight = flyCount % 2 === 0;
      plane.style.left = leftToRight ? '-240px' : '100vw';
      plane.style.transform = leftToRight ? 'scaleX(1)' : 'scaleX(-1)';

      requestAnimationFrame(() => {
        setTimeout(() => {
          plane.style.left = leftToRight ? '100vw' : '-240px';
        }, 50); 

        let drops = 0;
        const dropInterval = setInterval(() => {
          dropImage();
          drops++;
          if (drops >= 5) clearInterval(dropInterval);
        }, 800);

        setTimeout(() => {
          flyCount++;
          flyPlane();
        }, 5500);
      });
    }

    flyPlane();
  },
  sound: ''
};


emojiEvents['🎰'] = {
  effect: () => {
    showSlotMachine();
  },
  sound: ''
};

const slotSymbols = [
  { emoji: '777', color: '#ff4444', effect: (score) => score * 2, text: 'Scorul se dublează' },
  { emoji: '❌', color: '#ff4444', effect: (score) => Math.floor(score / 2), text: 'Scor înjumătățit' },
  { emoji: '💯', color: '#ffcc00', effect: (score) => score + 75, text: '+75 puncte' },
  { emoji: '💎', color: '#00ccff', effect: (score) => score + 100, text: '+100 puncte' },
  { emoji: '💰', color: '#44cc44', effect: (score) => score + 150, text: '+150 puncte' },
  { emoji: '😭', color: '#888', effect: (_) => 0, text: 'Pierzi tot scorul' },
  { emoji: '🤣', color: '#cccccc', effect: (score) => score, text: 'Fără câștig' }
];

const spinSound = new Audio('https://ksdapromovarii.squarespace.com/s/Game-Wheel-Spin-Sound-Effect.mp3');
const winSound = new Audio('https://ksdapromovarii.squarespace.com/s/Slot-Machine-Jackpot-Casino-Win-Sound-Effect.mp3');

function showSlotMachine() {
  const popup = document.getElementById('slotPopup');
  const grid = document.getElementById('slotGrid');
  const result = document.getElementById('resultMessage');
  const spinBtn = document.getElementById('spinSlotBtn');
  if (!popup || !grid || !result || !spinBtn) return;

  popup.style.display = 'block';
  result.textContent = '';
  spinBtn.disabled = false;
  spinBtn.textContent = 'Încearcă norocul!';

  if (grid.children.length === 0) {
    for (let i = 0; i < 9; i++) {
      const cell = document.createElement('div');
      cell.className = 'slotCell';
      cell.textContent = '❔';
      grid.appendChild(cell);
    }
  }

  const cells = Array.from(grid.children);
  let hasSpun = false;

  spinBtn.onclick = () => {
    if (hasSpun) return; // Prevent multiple spins
    hasSpun = true;
    spinBtn.disabled = true;
    spinBtn.textContent = 'Se învârte... 🎰';
    result.textContent = '';

    spinSound.currentTime = 0;
    spinSound.play();

    let spinCount = 0;
    const spinInterval = setInterval(() => {
      cells.forEach(cell => {
        const randomSymbol = slotSymbols[Math.floor(Math.random() * slotSymbols.length)];
        cell.textContent = randomSymbol.emoji;
        cell.style.color = randomSymbol.color;
        cell.classList.add('spinAnimation');
      });
      spinCount++;
      if (spinCount >= 35) {
        clearInterval(spinInterval);
        cells.forEach(cell => cell.classList.remove('spinAnimation'));
        const matched = resolveSpin(cells, result);

        spinSound.pause();
        spinSound.currentTime = 0;

        if (matched) {
          winSound.currentTime = 0;
          winSound.play();
        }

        // Auto-close popup after 3 seconds
        setTimeout(() => {
          popup.style.display = 'none';
        }, 3000);
      }
    }, 100); 
  };

  document.getElementById('closeSlotBtn').onclick = () => {
    popup.style.display = 'none';
  };
}

function resolveSpin(cells, result) {
  const gridSize = 3;
  const symbolsGrid = [];
  for (let i = 0; i < gridSize; i++) {
    symbolsGrid[i] = [];
    for (let j = 0; j < gridSize; j++) {
      symbolsGrid[i][j] = cells[i * gridSize + j].textContent;
    }
  }

  function findSymbol(emoji) {
    return slotSymbols.find(s => s.emoji === emoji);
  }

  const lines = [
    [[0,0],[0,1],[0,2]],
    [[1,0],[1,1],[1,2]],
    [[2,0],[2,1],[2,2]],
    [[0,0],[1,0],[2,0]],
    [[0,1],[1,1],[2,1]],
    [[0,2],[1,2],[2,2]],
    [[0,0],[1,1],[2,2]],
    [[0,2],[1,1],[2,0]]
  ];

  let anyWin = false;
  let winningLineIndices = [];
  for (const line of lines) {
    const emojis = line.map(([r,c]) => symbolsGrid[r][c]);
    if (emojis.every(e => e === emojis[0])) {
      anyWin = true;
      winningLineIndices = line;
      break;
    }
  }

  if (anyWin) {
    const symbol = findSymbol(symbolsGrid[winningLineIndices[0][0]][winningLineIndices[0][1]]);
    winningLineIndices.forEach(([r,c]) => {
      const cellIndex = r * 3 + c;
      cells[cellIndex].classList.add('matchHighlight');
    });

    const currentScore = window.currentScore || 100;

    let scoreChange = 0;
    if (symbol.emoji === '777') {
      scoreChange = currentScore; // double = add current score
    } else if (symbol.emoji === '❌') {
      scoreChange = -Math.floor(currentScore / 2);
    } else if (symbol.emoji === '😭') {
      scoreChange = -currentScore;
    } else {
      scoreChange = symbol.effect(0);
    }

    updateScore(scoreChange);
    result.textContent = `Ai obținut 3x ${symbol.emoji}! ${symbol.text}.`;
    return true;
  } else {
    result.textContent = 'Ghinion! Încearcă din nou data viitoare.';
    return false;
  }
}
 

    function closePhone() {
  if (ringtoneAudio) {
    ringtoneAudio.pause();
    ringtoneAudio.currentTime = 0;
  }

  phonePopup.style.display = 'none';
  phoneBody.textContent = "Răspunde la apel?";
  phoneButtons.style.display = "flex";
}

function updateScore(change) {
  if (window.boticBoost) change *= 2; // ✅ Fix: use correct variable

  const maxAllowedIncrement = 10000;

  if (!isInitialLoad && change > maxAllowedIncrement) {
    firebase.database().ref("bans/" + username).set(true);

    fetch('https://api.ipify.org?format=json')
      .then(res => res.json())
      .then(data => { 
        const ipKey = data.ip.replace(/\./g, "_");
        firebase.database().ref("banned_ips/" + ipKey).set(true);
      })
      .catch(err => console.error("Failed to fetch IP for ban:", err));

    alert("Ai fost banat pentru scor suspect.");
    location.reload();
    return;
  }

  // ✅ Update score
  score += change;
  updateScoreDisplay();

  // ✅ 🔴 CHECK for Game Over
  if (score <= -1000) {
    triggerGameOver();
    return;
  }

  // ✅ Save + update
  if (username) {
    updateLeaderboard({ username, score });

    // 🔵 UPDATE ACTIVITY TIMESTAMP
    if (typeof updateScore.lastActiveUpdate === "undefined") {
      updateScore.lastActiveUpdate = 0; // ✅ safely scoped inside
    }

    const now = Date.now();
    if (now - updateScore.lastActiveUpdate > 60000) {
      firebase.database().ref("leaderboard/" + username).update({
        lastActive: now
      });
      updateScore.lastActiveUpdate = now;
    }

    saveProgress();
  }

  if (score % 250 === 0 && score !== 0 && window.kevinSoundsEnabled) {
    playRandomSound();
  }

  // ✅ Moon mode
  if (score >= 2500 && !isOnMoon) {
    isOnMoon = true;
    startMoonSequence();
  }
}


if (score < 2500 && window.isOnMoon) {
    window.isOnMoon = false;
    updateBackground();
}


function updateScoreDisplay() {
  scoreBoard.innerHTML = `
    <div style="display: flex; align-items: center; justify-content: center;">
      <img src="https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/3838e9be-f08a-4e78-815f-4b1688594e17/ce291931-bdae-4385-a65e-fea28b922266_removalai_preview.png?format=500w"
           alt="click icon"
           style="height: 25px; margin-right: 6px;" />
      <span style="font-size: 25px;">${score}</span>
    </div>
  `;
}





    function playRandomSound() {
      const audio = new Audio(sounds[Math.floor(Math.random() * sounds.length)]);
      audio.play();
    }
 
function moveKevinAway() {
  if (isKevinTired) return; // Kevin doesn't move if tired

  const maxX = gameArea.clientWidth - kevin.offsetWidth;
  const maxY = gameArea.clientHeight - kevin.offsetHeight;
  let newX = Math.random() * maxX;
  let newY = Math.random() * maxY;

  if (currentMode.resize) {
    const maxSize = 120; // original size
    const minSize = 80;  // minimum size
    const newSize = Math.random() * (maxSize - minSize) + minSize;
    kevin.style.width = `${newSize}px`;
    kevin.style.height = `${newSize}px`;
  }

  kevin.style.left = `${newX}px`;
  kevin.style.top = `${newY}px`;
}

function startMoonSequence() {
  // Teleport Kevin to middle
  kevin.style.left = `${gameArea.clientWidth / 2 - kevin.offsetWidth / 2}px`;
  kevin.style.top = `${gameArea.clientHeight / 2 - kevin.offsetHeight / 2}px`;

  // Rocket element
  const rocket = document.createElement('img');
  rocket.src = 'https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/6a874b5e-193a-4ca2-93bf-a29aefc411c7/Design-Studio-2025-05-20.png?format=500w';
  rocket.style.position = 'absolute';
  rocket.style.left = kevin.style.left;
  rocket.style.top = kevin.style.top;
  rocket.style.width = '120px';
  rocket.style.transition = 'top 4s ease-in-out';
  rocket.style.zIndex = '1000';
  gameArea.appendChild(rocket);

  // Fly rocket up
  setTimeout(() => {
    rocket.style.top = '-200px';
    kevin.style.display = 'none';
  }, 100);

  // Enter moon mode directly
  setTimeout(() => {
    rocket.remove();
    enterMoonMode();
  }, 4000);
}
 


function enterMoonMode() {
  // Change background
  gameArea.style.backgroundImage = "url('https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/a69e0293-1ef0-441a-8094-e1dba2c7697b/upscalemedia-transformed.jpeg?format=750w')";

window.isOnMoon = true;

  // Folosește variabila globală pentru imagine
  kevin.style.backgroundImage = `url('${moonNormalImage}')`;
  kevin.style.display = 'block';

  if (moveKevinInterval) clearInterval(moveKevinInterval);
  moveKevinInterval = setInterval(() => moveKevinAway(true), 3000);

  clearInterval(emojiSpawnInterval);
  meteoriteInterval = setInterval(spawnMeteorite, 10000);
}



// ─── INSERȚIE #1: Funcție helper sus în fișier, înainte de orice altă funcție ───
function getMeteorImageByHP(hp) {
  if (hp > 8) {
    return 'https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/f2c9da07-7d8d-4004-9571-87332be812b0/Meteroite.png?format=750w';
  } else if (hp > 6) {
    return 'https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/d7c602ca-9b78-47ed-98ca-f4b4b4e2cf35/Meteroite+cracked+1.png?format=750w';
  } else if (hp > 4) {
    return 'https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/fe81eb54-864a-42d2-8a8d-23eaa00cd140/Meteroite+cracked+2.png?format=500w';
  } else {
    return 'https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/61136379-82d8-4bf4-9d34-7244a202bc74/meteorite+crack+3..png?format=750w';
  }
}


function createShardExplosion(cx, cy) {
  const shardUrls = [
    'https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/c03e373e-705e-4a8a-8be9-aae58c26565f/Meteorite+Shards+1.png?format=2500w',
    'https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/da040bb3-5c65-4014-bb53-44e89fbb4e32/Meteorite+Shards+2.png?format=2500w',
    'https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/6a8573fc-d8b9-4ad5-a1c9-213d71d31c12/Meteorite+Shards+3.png?format=1000w',
    'https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/e1a3296b-8698-49d1-9c23-5ee76f59d8bd/Meteorite+Shards+4.png?format=2500w',
    'https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/8fc9120f-b8a8-4014-ae58-533f9fb6e862/Meteorite+Shards+5.png?format=1500w',
    'https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/77ea6e8f-4911-4da1-8df3-9b686fdc6e57/Meteorite+Shards+6.png?format=2500w',
    'https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/4e59f5aa-d936-4c89-aa56-b19f8756a33b/Meteorite+Shards+7.png?format=1500w',
    'https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/545f4e18-a63f-43ff-9370-1c8eab2cadc5/Meteorite+Shards+8.png?format=2500w',
    'https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/a63b0c28-87da-474d-a5fd-e345399ed9b6/Meteorite+Shards+9.png?format=1500w',
    'https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/19a9e041-4382-4eb1-9f1b-55327c8bc35a/Meteorite+Shards+10.png?format=1500w'
  ];
  shardUrls.forEach(url => {
    const shard = document.createElement('img');
    shard.src = url;
    shard.style.position = 'absolute';
    shard.style.width = '20px';
    shard.style.left = `${cx}px`;
    shard.style.top = `${cy}px`;
    shard.style.zIndex = 1002;
    gameArea.appendChild(shard);

    // unghi aleator și viteză mai mare pentru distanță mai mare
    const angle = Math.random() * Math.PI * 2;
    const speed = 4 + Math.random() * 6; // 4–10px per tick
    let vx = Math.cos(angle) * speed;
    let vy = Math.sin(angle) * speed;

    // animare
    const shInterval = setInterval(() => {
      shard.style.left = `${parseFloat(shard.style.left) + vx}px`;
      shard.style.top = `${parseFloat(shard.style.top) + vy}px`;
      // gravitație ușoară
      vy += 0.05;
    }, 30);

    // prelungim durata de viață la 3s
    setTimeout(() => {
      clearInterval(shInterval);
      shard.remove();
    }, 3000);
  });
}



function spawnMeteorite() {
  if (isGamePaused) return;

  const meteor = document.createElement('img');

  const MIN_SIZE = 10;
  const MAX_SIZE = 185;
  const MIN_HP = 2;
  const MAX_HP = 10;

  const size = Math.floor(Math.random() * (MAX_SIZE - MIN_SIZE + 1)) + MIN_SIZE;
  meteor.style.width = `${size}px`;
  meteor.hp = Math.ceil(((size - MIN_SIZE) / (MAX_SIZE - MIN_SIZE)) * (MAX_HP - MIN_HP) + MIN_HP);

  meteor.src = getMeteorImageByHP(meteor.hp);
  meteor.style.position = 'absolute';
  meteor.style.zIndex = 1001;

  let x, y, dx = 0, dy = 0;
  const edge = ['top', 'left', 'right'][Math.floor(Math.random() * 3)];
  if (edge === 'top') {
    x = Math.random() * gameArea.clientWidth;
    y = -100;
    dy = 5;
  } else if (edge === 'left') {
    x = -100;
    y = Math.random() * gameArea.clientHeight;
    dx = 5;
  } else {
    x = gameArea.clientWidth + 100;
    y = Math.random() * gameArea.clientHeight;
    dx = -5;
  }

  meteor.style.left = `${x}px`;
  meteor.style.top = `${y}px`;
  gameArea.appendChild(meteor);

  meteor.style.cursor = 'pointer';
  let destroyed = false;
  let lastHitTime = 0;
  const HIT_COOLDOWN = 500;

  const interval = setInterval(() => {
    x += dx;
    y += dy;
    meteor.style.left = `${x}px`;
    meteor.style.top = `${y}px`;

    // Trail
    const trail = document.createElement('div');
    trail.className = 'meteor-trail';
    trail.style.left = meteor.style.left;
    trail.style.top = meteor.style.top;
    trail.style.width = `${size}px`;
    trail.style.height = `${size}px`;
    trail.style.background = 'linear-gradient(to bottom, red, yellow, red)';
    gameArea.appendChild(trail);
    setTimeout(() => trail.remove(), 500);

    // Collision with Kevinuță
    const mR = meteor.getBoundingClientRect();
    const kR = kevin.getBoundingClientRect();
    if (
      mR.left < kR.right && mR.right > kR.left &&
      mR.top  < kR.bottom && mR.bottom > kR.top
    ) {
      updateScore(-15);
      clearInterval(interval);
      const cx = x + size / 2;
      const cy = y + size / 2;
      createPixelExplosion(cx, cy);
      createShardExplosion(cx, cy);
      new Audio('https://ksdapromovarii.squarespace.com/s/Bomb-distant-explosion-Sound-Effect.mp3').play();
      meteor.remove();
    }

    // Off-screen cleanup
    if (x < -200 || x > gameArea.clientWidth + 200 || y > gameArea.clientHeight + 200) {
      clearInterval(interval);
      meteor.remove();
    }
  }, 30);

meteor.addEventListener('click', () => {
  if (destroyed) return;

  if (window.kevinutaSuperStrength) {
    meteor.hp = 0; // distruge instant
  } else {
    meteor.hp--;
  }

  if (meteor.hp > 0) {
    meteor.src = getMeteorImageByHP(meteor.hp);
    updateScore(1);
  } else {
    destroyed = true;
    clearInterval(interval);
    const rect = meteor.getBoundingClientRect();
    const cx = rect.left + rect.width / 2;
    const cy = rect.top + rect.height / 2;
    createPixelExplosion(cx, cy);
    createShardExplosion(cx, cy);
    new Audio('https://ksdapromovarii.squarespace.com/s/Bomb-distant-explosion-Sound-Effect.mp3').play();
    meteor.remove();
    updateScore(10);
  }
});

}








function createPixelExplosion(x, y) {
  const colors = ['#ff0000', '#ffa500', '#ffff00'];  // paleta minimă
  const particleCount = 10;        // de la 20 → 10 particule
  const speedFactor = 80;          // de la 200 → 80 pentru traiectorii mai scurte
  
  for (let i = 0; i < particleCount; i++) {
    const p = document.createElement('div');
    p.className = 'particle';
    p.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
    p.style.left = `${x}px`;
    p.style.top = `${y}px`;
    
    // particule mai mici
    p.style.width = '3px';
    p.style.height = '3px';
 
    // traiectorii mai scurte
    const dx = (Math.random() - 0.5) * speedFactor + 'px';
    const dy = (Math.random() - 0.5) * speedFactor + 'px';
    p.style.setProperty('--dx', dx);
    p.style.setProperty('--dy', dy);

    gameArea.appendChild(p);
    setTimeout(() => p.remove(), 800);  // dispar puţin mai rapid
  }
}


function spawnTrapEmoji() {
  const trapList = ["🪤", "🔥", "💀", "💣", "🪓", "Putin"];
  const chosen = trapList[Math.floor(Math.random() * trapList.length)];

  spawnEmoji(chosen, true); // ✅ isTrap = true
}
    

 
function spawnEmoji() {
  const emojiKeys = isOnMoon
    ? moonEmojis
    : Object.keys(emojiEvents).filter(e => !moonEmojis.includes(e));

  const emoji = emojiKeys[Math.floor(Math.random() * emojiKeys.length)];

  if (!isOnMoon && moonEmojis.includes(emoji)) return;

  const emojiDiv = document.createElement('div');
  emojiDiv.classList.add('emoji');
  emojiDiv.textContent = emoji;

  const isTrap = ['💵', '🪓', '⚡', '🔥', '🛞'].includes(emoji);

  // 🐈‍⬛ Negri effect: scare 50% of trap emojis
if (window.negriScareCheck && isTrap && Math.random() < 0.5) {
  console.log(`😼 Negri a speriat ${emoji}!`);
  showGiftMessage(`👁️‍🗨️ Negri a speriat ${emoji} și l-a făcut să fugă!`);
  emojiDiv.style.transform += " scaleX(-1)";
  emojiDiv.style.filter = "grayscale(100%) brightness(1.8)";
  emojiDiv.classList.add('negri-scared');

  // 🗨️ Bubble text
  const bubble = document.createElement("div");
  const panicLines = [
  "💀 mamaaaa!",
  "😭 fugeee!",
  "💩 ajutor!",
  "😱 scapă cine poate!",
  "😿 Negri mă urmărește!",
  "💢 nu semnez nimic!",
  "🧼 jur că m-am spălat!",
  "🕳 intru în pământ!",
  "👋 eu ies din schimb!",
  "🚪 demisionez!",
  "😤 nu sunt plătit destul pt asta!",
  "🧠 panică tehnică!",
  "💸 n-am asigurare de capcană!",
  "🎭 vreau înapoi la teatru!",
  "🧍‍♂️ jobul ăsta nu merită!",
  "😖 nu mi-e frică… ba da!",
  "🦶 ce-i mirosul ăsta?!",
  "🐈‍⬛ blestemul lui Negri!",
  "🍽️ e ora de pauză, paaa!",
  "📉 motivație dispărută!",
  "🤬 îmi dau demisia!",
  "🤡 am fost păcălit!",
  "🎒 îmi fac bagajele!",
  "👀 Gata boss, am plecat!",
  "🧍‍♂️ Negri? Asta e de-a lu’ Nicușor… nu mă bag!"
];

  bubble.textContent = panicLines[Math.floor(Math.random() * panicLines.length)];

  Object.assign(bubble.style, {
    position: "absolute",
    background: "#fff",
    color: "#000",
    padding: "2px 6px",
    borderRadius: "6px",
    fontSize: "12px",
    fontWeight: "bold",
    pointerEvents: "none",
    zIndex: 9999
  });

  emojiDiv.bubble = bubble;
  document.body.appendChild(bubble);
}


  if (isTrap) {
    emojiDiv.classList.add('trap');

    if (!isGamePaused) {
      const interval = followKevinuta(emojiDiv);
      trapIntervals.set(emojiDiv, interval);
    } else {
      trapIntervals.set(emojiDiv, null);
    }
  }

  const maxX = gameArea.clientWidth - 50;
  const maxY = gameArea.clientHeight - 50;
  emojiDiv.style.left = `${Math.random() * maxX}px`;
  emojiDiv.style.top = `${Math.random() * maxY}px`;
  gameArea.appendChild(emojiDiv);

  emojiDiv.addEventListener('click', () => {
    if (emojiEvents[emoji]) {
      emojiEvents[emoji].effect?.();
      if (emojiEvents[emoji].sound) {
        const sound = new Audio(emojiEvents[emoji].sound);
        sound.play();
      }
    }

    addToInventory(emoji);
    gameArea.removeChild(emojiDiv);
  });

setTimeout(() => {
  if (gameArea.contains(emojiDiv)) {
    gameArea.removeChild(emojiDiv);
    if (emojiDiv.bubble) emojiDiv.bubble.remove();
  }
}, 5000);

}


  


    function spawnEmojiRandomly() {
      if (currentMode.randomMovement) {
        setInterval(spawnEmoji, 5000);
      }
    } 

function isCleanUsername(name) {
  const clean = normalize(name);
  return !bannedWords.some(bad => clean.includes(bad));
} 

function attemptStart(modeKey) {

  const inputName = document.getElementById('usernameInput').value.trim();
  const previousName = localStorage.getItem('rememberedUsername');

  if (previousName && inputName !== previousName) {
    alert(`Numele tău este deja setat ca '${previousName}'. Nu îl poți schimba.`);
    hideLoadingPopup();
    return;
  }

  if (!inputName) {
    alert("Te rog introdu un nume de utilizator înainte să începi jocul!");
    hideLoadingPopup();
    return;
  }

  if (inputName.length < 4 || inputName.length > 20) {
    alert("Numele trebuie să aibă între 4 și 20 de caractere.");
    hideLoadingPopup();
    return;
  }

  if (!isCleanUsername(inputName)) {
    alert("Numele tău conține cuvinte interzise. Te rog alege un nume diferit.");
    hideLoadingPopup();
    return;
  }

  // 🔒 Verificare ban
  firebase.database().ref("bans/" + inputName).once("value")
    .then(snapshot => {
      if (snapshot.exists()) {
        localStorage.setItem('banned', 'true');
        document.getElementById('modeMenu').innerHTML = `...`; // (ban screen)
        hideLoadingPopup();
        return;
      }

      localStorage.removeItem('banned');

      // ✅ Verificare nume duplicat
// ✅ Verificare și salvare nume
firebase.database().ref("leaderboard/" + inputName).once("value")
  .then(snapshot => {
    const exists = snapshot.exists();

    // ✅ Salvează numele indiferent dacă există sau nu
    localStorage.setItem('rememberedUsername', inputName);

    // ✅ Dacă nu există, îl adăugăm în leaderboard
    const promise = exists
      ? Promise.resolve() // nimic de făcut
      : firebase.database().ref("leaderboard/" + inputName).set({
          username: inputName,
          score: 0,
          lastActive: Date.now()
        });

    // ✅ După ce (eventual) setăm datele, pornim jocul
    return promise.then(() => {
      startGame(modeKey);
    });
  })
  .catch(error => {
    console.error("Firebase leaderboard check failed:", error);
    alert("Eroare la verificarea numelui. Încearcă din nou.");
    hideLoadingPopup();
  }); 

    })
    .catch(error => {
      console.error("Firebase ban check failed:", error);
      alert("Eroare la verificarea ban-urilor. Încearcă din nou.");
    });
}


 



function startGame(modeKey) {
  const rememberMe = document.getElementById('rememberMe').checked;
  username = document.getElementById('usernameInput').value.trim();
firebase.database().ref(`ipBans/${normalize(username)}`).once("value", snap => {
  if (snap.exists()) {
    alert("Ai fost banat.");
    location.reload(); // sau poți pune return direct
  }
});

 
  // 🚫 Block banned users early
  if (localStorage.getItem('banned') === 'true') {
    alert("Ești banat. Nu ai voie să te joci.");
    return;
  }
 
 if (username.length < 4 || username.length > 20) {
  alert("Numele trebuie să aibă între 4 și 10 de caractere.");
  return;
}


  if (!isCleanUsername(username)) {
    alert("Numele tău conține cuvinte interzise. Te rog alege un nume diferit.");
    return;
  }

  const previousUsername = localStorage.getItem('rememberedUsername');

  if (rememberMe) {
    localStorage.setItem('rememberedUsername', username);
  }

  if (username !== previousUsername) {
    score = 0; // reset score for new username
    localStorage.setItem(`score_${username}`, '0');
  }

  // Clear old local ban flag in case it's wrong
  localStorage.removeItem('banned');

  // Fetch IP and save player info + check ban before continuing
  fetch('https://api.ipify.org?format=json')
    .then(res => res.json())
    .then(data => {
      const ip = data.ip;
      const ipKey = ip.replace(/\./g, "_");

      // Save player info in Firebase
      return firebase.database().ref("players/" + username).set({
        ip: ip,
        ipKey: ipKey,
        username: username,
        lastSeen: Date.now(),
        score: score
      }).then(() => ipKey);
    })
    .then(ipKey => {
      // Check banned IP
      return firebase.database().ref("banned_ips/" + ipKey).once("value");
    })
    .then(snap => {
      if (snap.exists() && snap.val() === true) {
        localStorage.setItem('banned', 'true');

        // Show ban popup overlay for IP ban (same style as username ban)
        document.getElementById('modeMenu').innerHTML = `
          <div style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
                      background: rgba(0,0,0,0.85); z-index: 9999; display: flex;
                      flex-direction: column; justify-content: center; align-items: center;">
            <div style="text-align: center; display: flex; flex-direction: column; align-items: center;">
              <img src="https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/d6e4c709-9ca9-4bcb-b3cb-038ec5f075f8/ChatGPT_Image_Jun_1__2025__04_54_26_AM-removebg-preview.png?format=500w"
                   alt="Ban Icon"
                   style="max-width: 220px; margin-bottom: -40px; margin-top: -30px;" />
              <h1 style=" 
                font-size: 36px;
                color: #cc0000;
                font-weight: bold;
                font-family: 'Courier New', monospace;
                text-shadow: 0 0 5px #ff0000, 0 0 10px #aa0000, 0 0 15px #ff0000;
                animation: redGlow 1.5s infinite;
                line-height: 1.3;
                margin: 0;
                text-align: center;
              ">
                Oops! IP-ul tău este banat.<br>Nu încerca să trișezi data viitoare.
              </h1> 
              <p style="color:white;font-size:18px;margin:25px 0 10px;">
                Vrei să fii iertat? Trimite 5 RON:
              </p>
              <a href="https://revolut.me/florinnica83" target="_blank" style="
                display: inline-block;
                padding: 12px 24px;
                font-size: 18px;
                font-weight: bold;
                color: white;
                background-color: #cc0000;
                border: 2px solid #ff0000;
                border-radius: 10px;
                text-decoration: none;
                box-shadow: 0 0 10px red;
                transition: all 0.3s ease;
                margin-bottom: 10px;
              " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                💸 Unban via Revolut
              </a>
              <p style="color:#aaa;margin-top:5px;font-size:14px;">
                (verificare manuală – după plată trimite username-ul și te scoatem de la ban)
              </p>
            </div>
          </div>
        `;
        // Make sure modeMenu is visible
        document.getElementById('modeMenu').style.display = 'block';

        // Stop game start by rejecting promise chain
        return Promise.reject(new Error("Banned IP"));
      } 

      // Proceed with game setup

      // Fullscreen logic
      const requestFullscreen = () => {
        const element = document.documentElement;
        if (element.requestFullscreen) {
          element.requestFullscreen();
        } else if (element.webkitRequestFullscreen) {
          element.webkitRequestFullscreen();
        } else if (element.msRequestFullscreen) {
          element.msRequestFullscreen();
        }
      };
      requestFullscreen();

// 2. Muzica de fundal - vizibilă global
// Muzica de fundal
const backgroundMusic = new Audio('https://ksdapromovarii.squarespace.com/s/Clip-audio-WhatsApp-2025-05-16-la-084743_f3794377.mp3');
backgroundMusic.loop = true;
backgroundMusic.volume = 0.01;

// Toggle muzică
const musicToggle = document.getElementById("musicToggle");
musicToggle.addEventListener("change", () => {
  if (musicToggle.checked) {
    backgroundMusic.play().catch(() => {});
  } else {
    backgroundMusic.pause();
  }
});
document.addEventListener("click", () => {
  if (musicToggle.checked && backgroundMusic.paused) {
    backgroundMusic.play().catch(() => {});
  }
}, { once: true });

// Buton și popup
const openBtn = document.getElementById("openSoundBtn");
const closeBtn = document.getElementById("closeSoundBtn");
const popup = document.getElementById("soundPopup");

openBtn.addEventListener("click", () => {
  popup.style.display = "block";
});
closeBtn.addEventListener("click", () => {
  popup.style.display = "none";
});
window.addEventListener("click", (e) => {
  if (e.target === popup) {
    popup.style.display = "none";
  }
});

// Pornește jocul
beginGame(modeKey);

backgroundMusic.play().catch(() => {}); // în caz că autoplay-ul e blocat

      backgroundMusic.play();
    })
    .catch(err => {
      if (err.message !== "Banned IP") {
        console.error("IP check or saving failed:", err);
        alert("Eroare la verificarea IP-ului. Încearcă din nou.");
      }
      // Otherwise banned error already handled by ban popup
    });
}

const musicToggle = document.getElementById("musicToggle");
const musicToggleLabel = document.getElementById("musicToggleLabel");

musicToggle.addEventListener("change", () => {
  if (musicToggle.checked) {
    backgroundMusic.play();
    musicToggleLabel.textContent = "🔊 Muzică";
  } else {
    backgroundMusic.pause();
    musicToggleLabel.textContent = "🔇 Mut";
  }
});


function toggleFullscreen() {
  const elem = document.documentElement;
  if (!document.fullscreenElement) {
    elem.requestFullscreen().catch(err => {
      console.error("Fullscreen request failed:", err);
    });
  } else {
    document.exitFullscreen().catch(err => {
      console.error("Exit fullscreen failed:", err);
    });
  }
}

 
function exitFullscreen() {
  if (document.exitFullscreen) {
    document.exitFullscreen();
  } else if (document.webkitExitFullscreen) {
    document.webkitExitFullscreen();
  } else if (document.msExitFullscreen) {
    document.msExitFullscreen();
  }
}
 


    function beginGame(modeKey) {
      currentMode = modes[modeKey];
      document.getElementById('modeMenu').style.display = 'none';
      spawnEmojiRandomly();
      moveKevinAway();
      renderLeaderboard();
      
    }

 let canClickKevin = true;

kevin.addEventListener('click', (e) => {
  e.stopPropagation();

  if (!canClickKevin) return; // ✅ allow clicks even when tired

  canClickKevin = false;
  updateScore(1);
  moveKevinAway();

  setTimeout(() => {
    canClickKevin = true;
  }, 300);
});

gameArea.addEventListener('click', e => {
  // dacă ţinta exactă a click-ului e chiar gameArea, nu un element interior
  if (e.target === gameArea) {
    updateScore(-1);
    moveKevinAway();
  }
});


    renderLeaderboard();


function shakeScreen() {
  gameArea.style.transition = 'transform 0.1s';
  gameArea.style.transform = 'translate(5px, 5px)';
  setTimeout(() => {
    gameArea.style.transform = 'translate(-5px, -5px)';
  }, 50);
  setTimeout(() => {
    gameArea.style.transform = 'translate(0, 0)';
  }, 100);
}


let moveKevinInterval;

function beginGame(modeKey) {
  currentMode = modes[modeKey];
  document.getElementById('modeMenu').style.display = 'none';

  if (moveKevinInterval) clearInterval(moveKevinInterval);

  // Calculate interval time based on speedMultiplier
  let intervalTime = 2000 / currentMode.speedMultiplier;

  // Set interval to move Kevin randomly
  moveKevinInterval = setInterval(() => {
    moveKevinAway();
  }, intervalTime);

  spawnEmojiRandomly();
  moveKevinAway(); 
  renderLeaderboard();
  

  // ✅ Start tired cycle
function startTiredCycle() {
  function tiredPhase() {
    isKevinTired = true;

    const imgTired = isOnMoon ? moonTiredImage : tiredKevinImage;
    const imgNormal = isOnMoon ? moonNormalImage : normalKevinImage;

    kevin.style.backgroundImage = `url('${imgTired}')`;

    setTimeout(() => {
      isKevinTired = false;
      kevin.style.backgroundImage = `url('${imgNormal}')`;

      // 🔁 Wait 60s before getting tired again
      setTimeout(tiredPhase, 60000);
    }, 5000); // 😴 tired duration: 5s
  }

  // 🔁 Start first tired phase after 60s
  setTimeout(tiredPhase, 60000);
}
 


  startTiredCycle();
} 


 document.getElementById("easyBtn").style.backgroundImage = "url('https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/d2cd8753-cad5-43cd-93bf-517866184b42/usor.png?format=500w')";
  document.getElementById("hardBtn").style.backgroundImage = "url('https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/95e44287-03e4-425d-b5a4-5452347c3418/greu.png?format=500w')";
  document.getElementById("turboBtn").style.backgroundImage = "url('https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/b33bcce9-d107-4d2d-943c-5b54d6f17ad8/turbo.png?format=500w')";

 

avatarInput.addEventListener("change", () => {
  avatarInput.style.pointerEvents = "none";  // Disable clicks on avatar input after selection
  avatarInput.style.opacity = "0.5";          // Optional: make it look disabled
});


function openModeMenu() {
  document.getElementById('mainMenuOverlay').style.display = 'none';
  document.getElementById('modeMenu').style.display = 'flex';
}

function togglePopup(id) {
  closeAllPopups();
  const popup = document.getElementById(id);
  if (popup) popup.style.display = 'block';
} 
 
function closeAllPopups() {
  document.querySelectorAll('.popupWindow').forEach(p => p.style.display = 'none');
}

window.addEventListener("DOMContentLoaded", () => {
  console.log("DOMContentLoaded fired");

  // Ascundem toate popup-urile
  ['aboutPopup', 'settingsPopup', 'tutorialPopup'].forEach(id => {
    const popup = document.getElementById(id);
    if (popup) {
      popup.style.display = 'none'; 
      console.log(`${id} ascuns`);
    }
  }); 

  const seenTutorial = localStorage.getItem('hasSeenTutorial');
  console.log("hasSeenTutorial:", seenTutorial);

  if (!seenTutorial) {
    console.log("NU a mai văzut tutorialul – îl deschidem");
    togglePopup('tutorialPopup');
    localStorage.setItem('hasSeenTutorial', 'true');
    console.log("Tutorial marcat ca văzut");
  } else {
    console.log("A mai văzut tutorialul – nu facem nimic");
  }

  // 🔒 Blochează modificarea numelui dacă a fost deja setat
  const savedUsername = localStorage.getItem('rememberedUsername');
  if (savedUsername) {
    const inputField = document.getElementById('usernameInput');
    const rememberCheckbox = document.getElementById('rememberMe');

    if (inputField) {
      inputField.value = savedUsername;
      inputField.disabled = true;
      console.log(`Username blocat: ${savedUsername}`);
    }

    if (rememberCheckbox) {
      rememberCheckbox.checked = true;
      rememberCheckbox.disabled = true;
    }
  }
});




function confirmAge() {
  localStorage.setItem('ageConfirmed', 'true');
  document.getElementById('ageGateOverlay').style.display = 'none';
  document.getElementById('mainMenuOverlay').style.display = 'flex';
}

function denyAge() {
  const msg = document.getElementById('underageMessage');
  const confirmBtn = document.querySelector('#ageGateOverlay button[onclick="confirmAge()"]');
  const denyBtn = document.querySelector('#ageGateOverlay button[onclick="denyAge()"]');

  if (msg) msg.style.display = 'block';

  // Disable both buttons
  confirmBtn.disabled = true;
  denyBtn.disabled = true;

  // Optionally, style disabled state
  confirmBtn.style.opacity = 0.5;
  confirmBtn.style.cursor = "not-allowed";
  denyBtn.style.opacity = 0.5;
  denyBtn.style.cursor = "not-allowed";
}
 





function openTop100() {
  const popup = document.getElementById("top100Popup");
  popup.style.display = 'block';
  updateTop100List(); // use cached live data
}

function closeTop100() {
  document.getElementById("top100Popup").style.display = 'none';
}


function triggerGameOver() {
  console.log("Game Over Triggered");

  clearInterval(moveKevinInterval);
  clearInterval(emojiSpawnInterval);
  clearInterval(meteoriteInterval);

  kevin.style.display = 'none';

  const popup = document.getElementById('gameOverPopup');
  if (popup) popup.style.display = 'flex';

  score = 0;
  localStorage.setItem(`score_${username}`, 0);
}


function restartToMainMenu() {
  document.getElementById('gameOverPopup').style.display = 'none';
  document.getElementById('mainMenuOverlay').style.display = 'flex';
  document.getElementById('pauseOverlay').style.display = 'none'; // <-- ADD THIS LINE

  score = 0;
  updateScoreDisplay();
  localStorage.setItem(`score_${username}`, 0);

  kevin.style.display = 'block';
  gameArea.style.backgroundImage = "url('https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/04bd9b21-712c-436e-b9eb-a201629ae479/Imagine+WhatsApp+2025-05-06+la+12.47.58_4927d2c6.jpg?format=750w')";

  isOnMoon = false;
}


let isPaused = false;
let pauseBackup = {
  moveKevin: null,
  emojiSpawn: null
};

function togglePause() {
  const pauseOverlay = document.getElementById('pauseOverlay');
  isGamePaused = !isGamePaused;

  if (isGamePaused) {
    pauseOverlay.style.display = 'flex';

    // Stop trap emojis
    for (const [trap, interval] of trapIntervals.entries()) {
      if (interval) {
        clearInterval(interval);
        trapIntervals.set(trap, null); // Mark it as stopped
      }
    }

    console.log("⏸️ Game paused: traps frozen.");
  } else {
    pauseOverlay.style.display = 'none';

    // Resume only paused or newly-added traps
    for (const [trap, interval] of trapIntervals.entries()) {
      if (!interval) {
        const newInterval = followKevinuta(trap);
        trapIntervals.set(trap, newInterval);
      }
    }

    console.log("▶️ Game resumed: traps chasing again.");
  }
}


 

function closeGame() {
  if (confirm("Ești sigur că vrei să închizi jocul?")) {
    // If in a browser, simulate quitting
    window.location.href = "about:blank";
  }
}


(function(){
  const slider = document.getElementById('chatSlider');
  let scrollY = 0;

  function preventScroll(e){
    e.preventDefault();
  }

  slider.addEventListener('change', () => {
    if (slider.checked) {
      // 1) record where we were
      scrollY = window.scrollY;

      // 2) lock the viewport  
      document.documentElement.style.overflow = 'hidden';
      document.body.style.overflow             = 'hidden';

      // 3) disable all touch‐drag on the document
      document.addEventListener('touchmove', preventScroll, { passive: false });

      // (optional) keep you pinned
      document.documentElement.style.position = 'fixed';
      document.documentElement.style.top      = `-${scrollY}px`;
    } else {
      // restore everything
      document.documentElement.style.overflow = '';
      document.body.style.overflow            = '';

      document.removeEventListener('touchmove', preventScroll);

      document.documentElement.style.position = '';
      document.documentElement.style.top      = '';

      // put you right back
      window.scrollTo(0, scrollY);
    }
  });
})();




function toggleChatOpacity() {
  const chatShell = document.querySelector('.phone-shell');
  chatShell.classList.toggle('transparent-chat');
}

  // Optional: hide picker if click outside
  document.addEventListener('click', (e) => {
    if (!emojiPicker.contains(e.target) && !emojiBtn.contains(e.target)) {
      emojiPicker.classList.remove('visible');
    }
  });


function toggleColorPopup() {
  const popup = document.getElementById("colorPalettePopup");
  popup.style.display = popup.style.display === "none" ? "flex" : "none";
}

function applyChatColors() {
  const header = document.getElementById("colorHeader").value;
  const shell = document.getElementById("colorShell").value;
  const footer = document.getElementById("colorFooter").value;
  const my1 = document.getElementById("myBubble1").value;
  const my2 = document.getElementById("myBubble2").value;
  const other1 = document.getElementById("otherBubble1").value;
  const other2 = document.getElementById("otherBubble2").value;

  const headerEl = document.getElementById("phoneHeader");
  const shellEl = document.getElementById("chatContainer");
  const footerEl = document.querySelector(".chat-footer");

  if (headerEl) headerEl.style.backgroundColor = header;
  if (shellEl) shellEl.style.backgroundColor = shell;
  if (footerEl) footerEl.style.backgroundColor = footer;

  let styleEl = document.getElementById("customChatStyle");
  if (!styleEl) {
    styleEl = document.createElement("style");
    styleEl.id = "customChatStyle";
    document.head.appendChild(styleEl);
  }

  styleEl.innerHTML = `
    .message-bubble.mine {
      background: linear-gradient(to right, ${my1}, ${my2}) !important;
    }
    .message-bubble.other {
      background: linear-gradient(to right, ${other1}, ${other2}) !important;
    }
  `;

  // 🔒 Save to localStorage
  localStorage.setItem("chatColors", JSON.stringify({
    header,
    shell,
    footer,
    my1,
    my2,
    other1,
    other2
  })); 

  // 👇 Close the popup after applying
  document.getElementById("colorPalettePopup").style.display = "none";
}

function resetChatColors() {
  console.log("✅ resetChatColors a fost apelată");

  try {
    // 1. Reset stiluri vizuale principale
    document.getElementById("chatContainer").style.backgroundColor = "#2b2a4d";
    document.querySelector(".chat-footer").style.backgroundColor = "#312f57";

    console.log("🎨 Culori generale resetate");

    // 2. Elimină stiluri custom dacă există
    const styleEl = document.getElementById("customChatStyle");
    if (styleEl) {
      styleEl.remove();
      console.log("❌ Stil personalizat eliminat");
    }

    // 3. Reset inputuri de culoare la valorile DEFAULT
    const colorDefaults = {
      colorHeader: "#6557b7",
      colorShell: "#2b2a4d",
      colorFooter: "#312f57",
      myBubble1: "#4a90e2",
      myBubble2: "#357ABD",
      otherBubble1: "#555555",
      otherBubble2: "#333333"
    };

    for (const [id, color] of Object.entries(colorDefaults)) {
      const input = document.getElementById(id);
      if (input) {
        input.value = color;
        console.log(`🔁 ${id} setat la ${color}`);
      } else {
        console.warn(`⚠️ Input cu id '${id}' nu a fost găsit`);
      }
    }

    // 4. Aplică noile culori
    if (typeof applyChatColors === "function") {
      applyChatColors();
      console.log("✅ applyChatColors() apelată");
    } else {
      console.warn("❌ applyChatColors NU e definită");
    }

    // 5. Închide popup-ul
    document.getElementById("colorPalettePopup").style.display = "none";
    console.log("✅ Paleta închisă");

  } catch (e) {
    console.error("💥 Eroare în resetChatColors:", e);
  }
}



window.addEventListener("DOMContentLoaded", loadChatColorsFromStorage);
 
  </script> 
<div id="mainMenuOverlay">
  <img id="titleImage" src="https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/449320c0-9960-4b26-9c96-a544c858cd78/ChatGPT+Image+May+30%2C+2025%2C+12_48_36+PM.png?format=300w" alt="Game Title">

  <div id="mainButtons">
    <button class="mainBtn" onclick="openModeMenu()">
      <img src="https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/4313d128-0f4e-442a-8413-7e208c56ff69/ChatGPT+Image+May+30%2C+2025%2C+11_51_44+AM.png?format=300w" alt="Play">
    </button>
    <button class="mainBtn" onclick="togglePopup('settingsPopup')">
      <img src="https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/b3bc6d29-e795-4554-985f-686e438aff38/ee-removebg-preview.png?format=300w" alt="Settings">
    </button>
<!-- INSIDE #mainButtons -->
<button class="mainBtn" onclick="togglePopup('supportPopup')">
  <img src="https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/330930e2-c4ba-4589-860a-28553a3b2666/d044a593-8948-4171-bf81-2f82e03d7e42_removalai_preview.png?format=500w" alt="Susține Dezvoltatorul">
</button>
    <button class="mainBtn" onclick="togglePopup('aboutPopup')">
      <img src="https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/853e24b4-e746-40c6-9f75-662669b78e70/ChatGPT+Image+May+30%2C+2025%2C+11_53_11+AM.png?format=300w" alt="About">
    </button> 
    <button class="mainBtn" onclick="togglePopup('tutorialPopup')">
      <img src="https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/7491a4f1-1575-43bb-b24f-79370cc9a5fe/ChatGPT+Image+May+30%2C+2025%2C+11_53_52+AM.png?format=300w" alt="Tutorial">
    </button>

<button class="mainBtn" onclick="togglePopup('updateLogPopup')">
  <img src="https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/fb8b9979-5fcd-4d79-a52c-4f35e87aa288/ChatGPT_Image_29_iun._2025__20_02_43-removebg-preview.png?format=500w" alt="Update Log">
</button>

  </div> 
</div> 
 

<button id="top100Btn" onclick="openTop100()" title="Vezi Top 100" style="
  position: fixed;
  bottom: 255px; /* modifici poziția să nu se suprapună cu celelalte */
  right: 26px;
  width: 50px;
  height: 51px;
  background: none;
  border: none;
  cursor: pointer;
  z-index: 105000;
  padding: 0;
">
  <img src="https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/0d5ad6e7-7fcd-44d1-99b1-e8d9128bf4de/cced44c2-312c-4b11-9147-d4edd3ec017a_removalai_preview.png?format=300w" 
       alt="Top 100" 
       style="width: 100%; height: auto; display: block;">
</button>



<!-- Generic Popups -->
<div class="popupWindow" id="settingsPopup" style="display: none;">
  <div class="popupClose" onclick="closeAllPopups()">⭘</div>
  <h2>Setări</h2>

  <section>   
    <h3>🔊 Sunet și Muzică</h3>
    <label>
      <input type="checkbox" id="soundToggle" checked> Sunet ON/OFF
    </label><br>
    <label>
      Volum sunet: <input type="range" id="soundVolume" min="0" max="1" step="0.01" value="1">
    </label><br>
    <label>
      <input type="checkbox" id="musicToggle" checked> Muzică ON/OFF
    </label><br>
    <label>
      Volum muzică: <input type="range" id="musicVolume" min="0" max="1" step="0.01" value="0.01">
    </label>
  </section>
  
  <section>
    <h3>🎨 Tema Vizuală</h3>
    <label>
      <input type="checkbox" id="darkModeToggle"> Mod întunecat
    </label><br>
    <label>
      Mărime text tutorial:
      <input type="range" id="tutorialTextSize" min="12" max="30" value="16">
    </label>
  </section>

  <section>
    <h3>📝 Suport și Feedback</h3>
    <textarea id="feedbackText" rows="4" placeholder="Scrie feedback-ul tău aici..."></textarea><br>
    <button id="sendFeedbackBtn">Trimite Feedback</button>
  </section>

  <section>
    <h3>⚠️ Resetare Joc</h3>
    <button id="resetGameBtn" style="color: red;">Resetează progresul complet</button>
  </section>
</div>


<div class="popupWindow" id="aboutPopup" style="display: none;">
  <div class="popupClose" onclick="closeAllPopups()">⭘</div>
  <h2>📜 Despre Joc</h2>

  <p><strong>🎮 Jocul:</strong> PRINDEL PE KEVINUȚĂ </p>

  <p><strong>🧠 Ideea:</strong><br>
  Încearcă să-l prinzi pe Kevin, un personaj fugar care dispare imediat ce dai click pe el. Pe drum, ai parte de emoji-uri haotice, surprize, întrebări capcană și momente random 100%. Fiecare punct contează, dar... unele te pot băga în belea. La 1000 puncte? Te duci pe Lună.</p>

  <p><strong>🤣 Ce-l face diferit:</strong></p>
<ul style="text-align: left; padding-left: 18px;">
  <li>🎧 Reacții audio autentice de la Kevin</li>
  <li>😂 Glume, meme-uri și troli în loc de premii serioase</li>
  <li>🌀 Elemente vizuale absurde (Putin zburător, mouse AI, slot machine care te rupe)</li>
  <li>📊 Sistem de scor și leaderboard în timp real</li>
  <li>🌕 O lume care se transformă în funcție de cât de bine (sau prost) joci</li>
  <li>🚀 Poți să-ți promovezi contul TikTok dacă ajungi la un scor mare în joc</li>
</ul>


  <p><strong>👨‍💻 Creator:</strong><br>
  Nume: (Lost_Soul_zzz)<br>
  Discord: <code>@lost_soul6216</code><br>
  TikTok: <a href="https://www.tiktok.com/@lost_soul_zzz?lang=ro-RO" target="_blank" rel="noopener noreferrer" style="color: #ffd700; text-decoration: underline;">@lost_soul_zzz</a>
</p>

<p><strong>💡 Inițiatorul ideii:</strong> Kevin Trinity KSDA<br>
TikTok 1: <a href="https://www.tiktok.com/@traiescpentruarta" target="_blank" rel="noopener noreferrer" style="color: #ffd700; text-decoration: underline;">@traiescpentruarta</a><br>
TikTok 2: <a href="https://www.tiktok.com/@kevintrinity01" target="_blank" rel="noopener noreferrer" style="color: #ffd700; text-decoration: underline;">@kevintrinity01</a></p>
 
<p><strong>🎵 Muzică de fundal realizată de:</strong><br>
  Nume: ValenTUN 💣<br>
  TikTok: <a href="https://www.tiktok.com/@valentun82" target="_blank" rel="noopener noreferrer" style="color: #ffd700; text-decoration: underline;">@valentun82</a>
</p>

  
  <p><strong>🧾 Versiune:</strong><br>
  v1.2.4 – 03.06.25</p>

  <hr style="margin: 12px 0; border: none; border-top: 1px solid #aaa;">

  <p><strong>❓ Probleme / bug-uri?</strong><br>
  Ai idei noi? Vrei să ajuți cu feedback?</p>

  <p>
    💡 Trimite propuneri sau raportează bug-uri pe:<br>
    🔗 Discord: <code>lost_soul6216 Sau pe formular 👇<br>
  📝 <a href="https://ksdapromovarii.squarespace.com/contact-8" target="_blank" rel="noopener noreferrer" style="color: #ffd700; text-decoration: underline;">Formularul oficial</a> 
  </p>
</div>
<div class="popupWindow" id="tutorialPopup" style="display:none; max-height: 80vh; overflow-y: auto; padding-right: 15px;">
  <div class="popupClose" onclick="closeAllPopups()">×</div>
  <h2 style="text-align: center; margin-bottom: 15px;">Tutorial KEVINUȚĂ – Ghid Complet</h2>
  
  <p><strong>Bine ai venit în lumea lui KEVINUȚĂ!</strong></p>

  <p>Acesta nu e un joc obișnuit — e o cursă haotică, plină de surprize, glume și provocări neașteptate. Scopul tău e să prinzi personajul Kevin și să aduni cât mai multe puncte, dar fii atent: nu toate emoji-urile sunt prietenoase!</p>

  <h3>Cum joci:</h3>
  <ul>
    <li><strong>Dă click pe Kevin</strong> (personajul fugar) ca să câștigi puncte.</li>
    <li><strong>Ai grijă la emoji-uri</strong> care apar aleator pe ecran:
      <ul>
        <li>Unele aduc puncte bonus (ex: 🍀 trifoi norocos).</li>
        <li>Altele scad puncte sau declanșează efecte haioase/periculoase (ex: 🔥 foc, 🪓 topor, 📞 telefon cu apel).</li>
      </ul>
    </li>
    <li><strong>Mini-jocuri și provocări</strong> apar pe parcurs (quiz, slot machine, etc.).</li>
    <li><strong>Scorul tău este urcat pe leaderboard</strong> în timp real.</li>
  </ul>
 
  <h3>Moduri de joc:</h3>
  <ul>
    <li><strong>Ușor:</strong> Kevin se mișcă lent, emoji-uri mai puține.</li>
    <li><strong>Greu:</strong> Kevin se mișcă mai rapid, emoji-uri periculoase.</li>
    <li><strong>Turbo:</strong> Kevin e super rapid, haos maxim.</li>
  </ul>

  <h3>Bonus special – Pe Lună cu KEVINUȚĂ:</h3>
  <p>Dacă aduni peste <strong>1000 de puncte</strong>, deblochezi modul Lună, cu noi provocări și efecte.</p>

  <h3>Promoție TikTon – Joacă și fii vedetă!</h3>
  <p>Pe lângă distracție, <strong>promovează-ți contul TikTon</strong> dacă ajungi pe leaderboard cu scor mare! Folosește numele tău real sau cel de TikTon când joci.</p>
  <p>Promoția se face manual – fii activ și implicat!</p>

  <h3>Sfaturi și trucuri:</h3>
  <ul>
    <li>Nu da click altundeva decât pe Kevin, altfel pierzi puncte.</li>
    <li>Fii rapid și atent la emoji-uri.</li>
    <li>Joacă modurile mai grele pentru a urca mai repede în clasament.</li>
    <li>Salvează-ți progresul cu opțiunea „Ține-mă minte”.</li>
  </ul>

  <p style="text-align:center; font-weight:bold; margin-top: 15px;">Succes și să prinzi cât mai multe puncte!<br>KEVINUȚĂ Studio™ – jocul tău, aventura ta.</p>
</div>


<!-- OUTSIDE MAIN BUTTONS – AT BOTTOM OF BODY OR POPUP CONTAINER -->
<div class="popupWindow" id="supportPopup" style="display: none; text-align: center;">
  <div class="popupClose" onclick="closeAllPopups()">×</div>
  <h2 style="text-align: center; font-size: 20px; margin-top: 0;">Susține Dezvoltatorul</h2>
  <p style="font-size: 14px; line-height: 1.5;">
  
    Sunt un dezvoltator pasionat cu vârsta de 17 ani care pune multă muncă, timp și suflet în proiectele pe care le creez...<br><br>
Dacă apreciezi ce fac, mă poți susține cu o donație. Orice ajutor contează – pentru motivație, upgrade-uri și continuarea proiectelor.<br><br>

    Mulțumesc sincer!<br><br>


  </p>

  <div style="display: flex; justify-content: center; gap: 15px; margin: 10px 0;">
    <a href="https://revolut.me/florinnica83" target="_blank">
      <img src="https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/e321bd8e-87d9-4b41-9ad0-c12b93a1cb0e/images.png?format=300w" alt="Revolut" style="width: 100px; border-radius: 10px;">
    </a>
    <a href="https://paypal.me/florinnica83?country.x=RO&locale.x=ro_RO" target="_blank">
      <img src="https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/65c2415a-d6bb-4847-8c28-a4ccd446d2a4/Paypal-Logo-Background-PNG-Image.png?format=500w" alt="PayPal" style="width: 100px; border-radius: 10px;">
    </a>
  </div>

  <div style="text-align: center; font-size: 13px;">
    Revolut: <a href="https://revolut.me/florinnica83" target="_blank">@florinnica83</a><br>
    PayPal: <a href="https://paypal.me/florinnica83?country.x=RO&locale.x=ro_RO" target="_blank">@florinnica83</a>
  </div>
</div>

<div class="popupWindow" id="updateLogPopup"
     style="display: none; max-width: 360px; max-height: 88vh; overflow-y: scroll; scrollbar-width: none;">
  <div class="popupClose" onclick="closeAllPopups()">×</div>
  
  <h2 style="text-align: center; font-size: 22px; margin-bottom: 15px;">📋 Jurnal de Actualizări</h2>

  <!-- NEWEST UPDATE - 5 IULIE -->
  <p style="text-align: center; font-size: 18px; font-weight: bold; margin-bottom: 12px;">🗓️ 05.07.2025</p>
  <ul style="list-style: none; padding: 0; margin: 0; text-align: center; font-size: 17px; line-height: 1.8;">
    <li>🛒 3 noi oferte adăugate în magazinul Merchant-ului</li>
    <li>🔻 Numărul de combo-uri necesare pentru rubine a fost redus</li>
    <li>🌌 2 emoji-uri noi pe Lună:
      <ul style="margin-top: 5px; font-size: 16px;">
        <li>🪐 Saturn – deschide un quiz special doar cu întrebări din spațiu</li>
        <li>💪 Power – oferă Kevinuței super-forță: distruge meteoriții dintr-o singură lovitură timp de 60s</li>
      </ul>
    </li>
    <li>🧼 Curățenie de cod & multe bug-uri reparate</li>
  </ul>

  <p style="text-align: center; font-weight: bold; font-size: 18px; margin-top: 20px;">
    🔮 Ce urmează? Rămâi pe fază pentru următorul update!<br>
    💬 Ai idei? Trimite feedback în fereastra „Setări”.
  </p>

  <hr style="margin: 25px auto; border: none; border-top: 2px solid #ffcc00; width: 80%;">

  <!-- UPDATE - 2 IULIE -->
  <p style="text-align: center; font-size: 18px; font-weight: bold; margin-bottom: 12px;">🗓️ 02.07.2025</p>
  <ul style="list-style: none; padding: 0; margin: 0; text-align: center; font-size: 17px; line-height: 1.8;">
    <li>🧺 Inventar adăugat – vezi și gestionează toate obiectele tale!</li>
    <li>💸 Poți vinde emoji-uri din inventar la Merchant pentru scor</li>
    <li>💎 Poți cumpăra oferte de la Merchant folosind rubine</li>
    <li>🧙 Merchant-ul apare automat la fiecare 5 minute</li>
    <li>🗨️ După cumpărare sau vânzare, spune „💰 Plăcerea a fost de partea mea!”, apoi dispare</li>
    <li>⚙️ Optimizări pentru mobil și PC</li>
    <li>🐛 Bug-uri fixate și cod curățat</li>
  </ul>

  <p style="text-align: center; font-weight: bold; font-size: 18px; margin-top: 20px;">
    🔮 Ce urmează? Rămâi pe fază pentru următorul update!
  </p>

  <hr style="margin: 25px auto; border: none; border-top: 2px solid #ffcc00; width: 80%;">

  <!-- UPDATE - 29 IUNIE -->
  <p style="text-align: center; font-size: 18px; font-weight: bold; margin: 30px 0 12px;">🗓️ 29.06.2025</p>
  <ul style="list-style: none; padding: 0; margin: 0; text-align: center; font-size: 17px; line-height: 1.8;">
    <li>🌌 Emojis noi pe Lună, fiecare cu propriul efect</li>
    <li>📘 Buton dedicat pentru jurnalul de actualizări</li>
    <li>📱 Optimizare mai bună pentru butoanele mobile</li>
    <li>🎯 Iconițe noi în Top 5 și Top 100</li>
    <li>👀 Monedă nouă ascunsă – vezi dacă o găsești!</li>
    <li>🟢 Buton „DOAR ONLINE” adăugat în Top 100</li>
    <li>🪛 Multe bug-uri reparate și îmbunătățiri generale</li>
  </ul>

  <p style="text-align: center; font-weight: bold; font-size: 18px; margin-top: 20px;">
    🔧 Rămâi pe fază pentru următorul update!
  </p>
</div>



<div id="top100Popup" class="popupWindow" style="display: none; max-height: 80vh; overflow-y: auto;">
  <div class="popupClose" onclick="closeTop100()">×</div>
  <h2 style="text-align: center;">🏆 Clasament Top 100</h2>

  <div style="text-align: center; margin-bottom: 12px;">
    <button id="showAllBtn" class="filter-btn active" onclick="filterTop100('all')">Toți jucătorii</button>
    <button id="showOnlineBtn" class="filter-btn" onclick="filterTop100('online')">Doar online</button>
  </div>

  <div id="top100List"></div>
</div>


<div id="gameOverPopup" style="display: none;">
  <div class="blood-overlay"></div>
  <img src="https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/4765e40b-e3d1-4b77-9dcb-8f2eff63635b/ccbce4fd-4ab9-4b9b-b107-05d725cd9003_removalai_preview.png?format=500w"
       class="game-over-image" alt="Reaper" />
  <div class="game-over-content">
    <h1>GAME OVER<br>Ai murit</h1>
    <button onclick="restartToMainMenu()">🔁 Play Again</button>
  </div>
</div>

 <div id="mutePopup" style="
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0,0,0,0.85);
  color: white;
  padding: 12px 20px;
  border-radius: 10px;
  font-size: 16px;
  z-index: 99999;
  display: none;
  text-align: center;
  border: 2px solid red;
"></div>


<!-- Popup pentru feedback -->
<div id="customPopup" style="
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0,0,0,0.85);
  color: white;
  padding: 12px 20px;
  border-radius: 10px;
  font-size: 16px;
  z-index: 99999;
  display: none;
  text-align: center;
  border: 2px solid red;
"></div> 

<button id="toggleUIBtn" style="position:fixed; bottom:1px; right:20px; z-index:20000; width:64px; height:64px; background:none; border:none; cursor:pointer; padding:0;">
  <img src="https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/aabf09d1-3384-4027-87fa-c40efa6a5760/fc7ae222-5af6-4f41-9b59-842029df96e9_removalai_preview.png?format=500w" 
       alt="Show/Hide UI" 
       style="width:100%; height:auto; display:block;">
</button>

<div id="globalPopup" style="
  display: none;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: rgba(0, 0, 0, 0.8);
  color: white;
  padding: 20px 30px; 
  font-size: 20px;
  border-radius: 10px;
  z-index: 999999;
  text-align: center;
  box-shadow: 0 0 20px #00d4ff;
"></div>
<div id="globalMessageBanner" style="display:none;"></div>


<div id="noSignalOverlay">
  <div class="glitch-text" data-text="FĂRĂ SEMNAL">FĂRĂ SEMNAL</div>
  <div class="scanlines"></div>
  <div class="noise"></div>
</div>

<div id="memoryGame" class="popup" style="display:none;">
  <div id="memoryTimer">⏱️ 60</div>
  <div id="memoryGrid"></div>
</div>


<div id="memoryGameClassic" class="popupWindow" style="display: none;">
  <div id="memoryTimerClassic"></div>
  <div id="memoryGridClassic"></div>
  <div id="memoryResultClassic" style="margin-top: 12px; font-size: 18px; font-weight: bold; text-align: center;"></div>
</div>

<div id="inventoryPopup" style="display: none;">
  <div id="inventoryHeader">

    <span>🎒 Inventar</span>


    <button id="closeInventoryBtn">✖</button>
  </div>

  <div id="inventoryTabs">
    <button class="active" id="tabItems">Items</button>
    <button id="tabPets">Pets</button>
  </div>

<div id="equippedCounter" style="
  text-align: center;
  color: #00ff88;
  font-size: 14px;
  margin-bottom: 8px;
  font-family: 'Orbitron', sans-serif;
">
  0/2 echipați
</div>

  <div id="inventoryContent">
    <!-- Items Section -->
    <div id="itemsSection" class="inventory-section" style="display: block;">
      <!-- Obiectele apar aici -->
    </div>


    <!-- Pets Section – asigură-te că ASTA EXISTĂ -->
    <div id="petsSection" class="inventory-section" style="display: none;">

      <div id="petInventoryContainer" style="
        padding: 10px;
        max-height: 300px;
        overflow-y: auto;
        color: white;
        font-family: 'rubik', sans-serif;
      ">


        <!-- Animalele apar aici -->
      </div>
    </div>
  </div>
</div>

<!-- Popup Emoji Detalii -->
<div id="emojiInfoPopup" class="popup-overlay" style="display:none; background:transparent;">
  <div class="popup-content">
    <div id="popupEmoji" class="popup-emoji">😀</div>
    <div id="popupName" class="popup-name">Nume</div> 
    <div id="popupType" class="popup-type good">BUN</div>
    <div id="popupEffect" class="popup-effect">Efectul acestui emoji</div>
    <div id="popupScore" class="popup-score">+10 puncte</div>
<div id="popupFunny" class="popup-funny" style="font-size: 12px; margin-top: 10px; color: #ccc;">😄</div>
    <button onclick="closeEmojiPopup()">OK</button>
<button id="sellEmojiBtn" style="display: none; margin-top: 8px;
  background: #00cc88; color: white; border: none; padding: 8px 16px; border-radius: 4px;">
  💰 Vinde pentru scor
</button>
<button id="sellAllEmojiBtn" style="display:none; margin-top: 8px;
  background: #ffcc00; color: black; border: none; padding: 8px 16px; border-radius: 4px;">
  💰 Vinde Tot
</button>


  </div>
</div>


<!-- 🧙 Merchant sprite -->
<div id="merchantContainer" style="position:absolute; display:none; z-index:9999;">
  <img id="merchantSprite" 
       src="https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/244e1912-32a3-4068-a527-aad5e7ea0600/f709dfcd-f878-4401-a1a3-c3be5ee715d4_removalai_preview.png?format=500w" 
       style="width:80px; cursor:pointer;">
</div>

<!-- 💬 Fancy RPG Dialog Container -->
<div id="dialogContainer" style="
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  z-index: 99999;
  display: none;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  pointer-events: none;
">

  <!-- 🧍 Avatar floating above the bar -->
  <img id="dialogAvatar"
       src="https://images.squarespace-cdn.com/content/v1/68026d02ef3401024739f55f/c79af203-e5b2-40be-a5f8-a8087d53bfe0/f709dfcd-f878-4401-a1a3-c3be5ee715d4_removalai_preview.png?format=500w"
       style="
         width: 100px;
         height: auto;
         margin-left: -10px;
         margin-bottom: -12px;
         z-index: 1050002;
         pointer-events: none;
       ">

  <!-- ✨ Improved Dialog Bar -->
<div id="dialogBar" style="
  width: 100%;
  background: rgba(30, 30, 30, 0.85);
  backdrop-filter: blur(6px);
  color: #fff;
  padding: 24px 32px;
  font-size: 18px;
  font-family: 'Segoe UI', sans-serif;
  display: flex;
  align-items: center;
  min-height: 110px;
  border-top: 2px solid rgba(255, 255, 255, 0.2);
  box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.4);
  border-radius: 16px 16px 0 0;
  pointer-events: auto;
">

    <div style="flex-grow: 1;">
      <div id="dialogText" style="margin-bottom: 12px;"></div>
      <div id="dialogOptions" style="display: flex; gap: 10px;"></div>
    </div>
  </div>
</div>

<div id="shopPopup" class="popup-container" style="display: none;">
  <div class="popup-inner">
    <div class="popup-header">
  <div class="popup-title">
    🛍️ <span>Magazin</span>
  </div>
  <button id="closeShopBtn" class="popup-close">✖</button>
</div>

    <div class="tab-row">
      <button id="tabOffers" class="active">🎁 Oferte</button>
    </div>
    <div id="offersSection" class="offers-grid"></div>
  </div>
</div>

<div id="shopOfferPopup" class="popup-container" style="display: none;">
  <div class="popup-content">
    <div id="shopOfferEmoji" style="font-size: 48px;"></div>
    <div id="shopOfferFunny" style="margin-top: 10px;"></div>
    <div id="shopOfferCost" style="margin: 6px 0;"></div>
    <button id="buyOfferBtn">✅ Cumpără</button>
    <button onclick="document.getElementById('shopOfferPopup').style.display='none'">❌ Închide</button>
  </div>
</div>


<!-- 🔧 Custom Score-to-Ruby Dialog -->
<div id="scoreToRubyDialog" style="
  display: none;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: #1e1e1e;
  padding: 20px 30px;
  border-radius: 16px;
  box-shadow: 0 0 20px rgba(0,0,0,0.6);
  z-index: 99999;
  color: white;
  font-family: 'Segoe UI', sans-serif;
  text-align: center;
">
  <div style="margin-bottom: 12px;">💰 Căte Rubine vrei? (1 rubin = 25 scor)</div>
  <input id="scoreInputField" type="number" min="1" style="
    padding: 10px;
    font-size: 16px;
    width: 100%;
    max-width: 200px;
    margin-bottom: 12px;
    border-radius: 8px;
    border: none;
    outline: none;
    text-align: center;
  "/>
  <div>
<div style="display: flex; justify-content: center; gap: 12px;">
  <button id="scoreSubmitBtn" style="
    padding: 10px 20px;
    background: linear-gradient(to bottom, #ffd700, #ffae00);
    color: black;
    border: 2px solid #ffae00;
    border-radius: 12px;
    font-weight: bold;
    font-size: 16px;
    cursor: pointer;
    transition: all 0.2s ease;
  ">Confirmă</button>

  <button id="scoreCancelBtn" style="
    padding: 10px 20px;
    background: transparent;
    color: #ccc;
    border: 2px solid #666;
    border-radius: 12px;
    font-weight: bold;
    font-size: 16px;
    cursor: pointer;
    transition: all 0.2s ease;
  ">Renunță</button>
</div>

  </div> 
</div> 


<div id="space-quiz-popup" style="display:none;">
  <div class="space-quiz-window">
    <div id="space-question" class="space-question"></div>
    <div id="space-options" class="space-options"></div>
    <div id="space-feedback" class="space-feedback"></div>
  </div>
</div>

<div id="powerTimer" style="
  display: none;
  position: absolute;
  top: 150px; /* Adjust based on where you want it */
  left: 10px;
  padding: 4px 10px;
  font-size: 16px;
  font-weight: bold;
  color: white;
  background: linear-gradient(to right, #f8c300, #ffdd00);
  border: 2px solid #fff176;
  border-radius: 10px;
  box-shadow: 0 0 6px #ffdd00;
  z-index: 9999;
  text-shadow: 0 0 4px black;
">💪 60s</div>
 
</body>
</html>     